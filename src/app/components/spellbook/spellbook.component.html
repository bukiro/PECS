<div class="window-button-container">
    <button class="minimizebutton lower"
        [ngbTooltip]="get_Minimized() ? 'Click to show all choices and information.' : 'Click to hide finished choices and show compact information.'"
        [ngClass]="{'fancy-button':get_Minimized()}" (click)="minimize()">
        <i class='bi-arrows-collapse' *ngIf="get_Minimized()"></i>
        <i class='bi-arrows-expand' *ngIf="!get_Minimized()"></i>
    </button>
    <button class="tilemodebutton" [ngClass]="{'fancy-button':get_TileMode()}" (click)="toggle_TileMode()"
        [ngbTooltip]="get_TileMode() ? 'Click to enable list layout' : 'Click to enable tiled layout'">
        <!--Content is css only-->
        <div>
            <div> </div>
            <div> </div>
            <div> </div>
            <div> </div>
        </div>
    </button>
</div>
<div id="spellbook-height" class="attributeBox">
    <header class="sectionHeader box-header">Spells</header>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading()">
        <app-tags [creature]="'Character'" [objectName]="'Spellbook'" [showTraits]=true [showFeats]=true
            [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
        <button class="fullsize-only center-aligned list-item" *ngIf="get_HasSpells()"
            (click)="toggleSpellsMenu()">Prepare Spells</button>
        <ng-template #SpellAttacksEffectsPopoverContent>
            <div class="fullsize-only newrow">
                <app-objectEffects [creature]="'Character'" [objectName]="'Spell Attack Rolls'"></app-objectEffects>
            </div>
            <div class="fullsize-only newrow">
                <app-objectEffects [creature]="'Character'" [objectName]="'Spell DCs'"></app-objectEffects>
            </div>
        </ng-template>
        <ng-container *ngFor="let skill of get_SpellDCs(); let index = index; trackBy:trackByIndex;">
            <header class="sectionHeader fullsize-only" *ngIf="index == 0">
                <span class="fullsize-only" [ngbPopover]="SpellAttacksEffectsPopoverContent"
                    #SpellAttacksEffectsPopover="ngbPopover" triggers="click">
                    <i [ngbTooltip]="!SpellAttacksEffectsPopover.isOpen() ? 'Edit effects' : ''"
                        class='bi-lightning-charge'></i>
                </span>
                Spell Attacks & DCs
            </header>
            <app-skill [skill]=skill [isDC]=false></app-skill>
            <app-skill [skill]=skill [isDC]=true></app-skill>
        </ng-container>
        <app-tags [creature]="'Character'" [objectName]="'Spell DC'" [showTraits]=true [showFeats]=true [showItems]=true
            [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
        <ng-container *ngFor="let componentParameters of [get_ComponentParameters()]; trackBy:trackByIndex">
            <ng-container *ngFor="let spellCastingParameters of get_SpellCastingParameters(); trackBy:trackByIndex;">
                <header class="sectionHeader">
                    {{(spellCastingParameters.casting.className + (spellCastingParameters.casting.castingType !=
                    "Innate"
                    ? " " + spellCastingParameters.casting.tradition : "") +
                    ((spellCastingParameters.casting.castingType == "Focus") ? (" " +
                    spellCastingParameters.casting.source) : " Spells")).trim()}}
                    <span class="lower"
                        *ngIf="['Prepared', 'Spontaneous'].includes(spellCastingParameters.casting.castingType)">
                        <span class="lower">
                            {{spellCastingParameters.casting.castingType}}
                        </span>
                    </span>
                    <div class="newrow lower left-aligned" *ngIf="spellCastingParameters.casting.bondedItemCharges[0]">
                        <span>
                            {{spellCastingParameters.casting.bondedItemCharges[0]}}{{componentParameters.hasSuperiorBond
                            ? "*" : ""}} bonded item charge{{spellCastingParameters.casting.bondedItemCharges[0] != 1 ?
                            "s" : ""}} available
                        </span>
                        <i class="bi-question-circle" *ngIf="componentParameters.hasSuperiorBond"
                            [ngbPopover]="SuperiorBond"></i>
                        <ng-template #SuperiorBond>
                            <header class="spellHeader">
                                Superior Bond
                            </header>
                            <span>
                                You can use Drain Bonded Item one additional time per day, but only to cast a spell 2 or
                                more levels lower than your highest-level spell.
                            </span>
                        </ng-template>
                    </div>
                    <div class="newrow lower left-aligned" *ngIf="spellCastingParameters.maxStudiousCapacitySlots">
                        <span>
                            {{spellCastingParameters.maxStudiousCapacitySlots -
                            spellCastingParameters.usedStudiousCapacitySlots}} extra spell
                            casting{{spellCastingParameters.maxStudiousCapacitySlots -
                            spellCastingParameters.usedStudiousCapacitySlots != 1 ? "s" : ""}} available
                        </span>
                        <i class="bi-question-circle" [ngbPopover]="StudiousCapacity"></i>
                        <ng-template #StudiousCapacity>
                            <header class="spellHeader">
                                Studious Capacity
                            </header>
                            <span>
                                You can cast one spell each day even after you've run out of spell
                                slots of the appropriate spell level, but you can't use this ability to cast a spell of
                                your highest spell level.
                            </span>
                        </ng-template>
                    </div>
                    <div class="newrow lower left-aligned"
                        *ngIf="spellCastingParameters.maxFirstGreaterVitalEvolutionSlot || spellCastingParameters.maxSecondGreaterVitalEvolutionSlot">
                        <span>
                            {{(spellCastingParameters.usedFirstGreaterVitalEvolutionSlot == 0 ? 1 : 0) +
                            (spellCastingParameters.usedSecondGreaterVitalEvolutionSlot == 0 ? 1 : 0)}} extra spell
                            casting{{(spellCastingParameters.usedFirstGreaterVitalEvolutionSlot == 0 ? 1 : 0) +
                            (spellCastingParameters.usedSecondGreaterVitalEvolutionSlot == 0 ? 1 : 0) != 1 ? "s" : ""}}
                            available
                        </span>
                        <i class="bi-question-circle" [ngbPopover]="GreaterVitalEvolution"></i>
                        <ng-template #GreaterVitalEvolution>
                            <header class="spellHeader">
                                Greater Vital Evolution
                            </header>
                            <span>
                                Twice per day, you can cast a spell after you've run out of
                                spell slots of the appropriate spell level; the two spells you cast with this feat must
                                be of different spell levels.
                            </span>
                        </ng-template>
                    </div>
                </header>
                <ng-container
                    *ngFor="let spellCastingLevelParameters of get_SpellCastingLevelParameters(spellCastingParameters, componentParameters); trackBy:trackByIndex;">
                    <div class="list-item newrow" style="background-color:transparent"
                        *ngIf="(spellCastingLevelParameters.spellTakenList.length || spellCastingLevelParameters.temporaryChoiceList.length)">
                        <strong>
                            {{spellCastingLevelParameters.level == -1 ? "Focus Spells" :
                            (spellCastingLevelParameters.level == 0 ? "Cantrips" : "Level
                            "+spellCastingLevelParameters.level)}}
                        </strong>
                        <span class="hlist right-aligned"
                            *ngIf="spellCastingLevelParameters.maxSpellSlots && spellCastingLevelParameters.level != 0">
                            <strong>
                                {{(spellCastingLevelParameters.maxSpellSlots -
                                spellCastingLevelParameters.usedSpellSlots)}}{{spellCastingLevelParameters.extraSpellSlots}}
                                / {{spellCastingLevelParameters.maxSpellSlots}}
                            </strong>
                            <ng-container *ngIf="get_ManualMode()">
                                <button
                                    (click)="on_ManualSpellSlotsChange(spellCastingParameters.casting, spellCastingLevelParameters.level, -1)"
                                    [disabled]="spellCastingLevelParameters.usedSpellSlots >= spellCastingLevelParameters.maxSpellSlots">
                                    -
                                </button>
                                <button
                                    (click)="on_ManualSpellSlotsChange(spellCastingParameters.casting, spellCastingLevelParameters.level, 1)"
                                    [disabled]="spellCastingLevelParameters.usedSpellSlots <= 0">
                                    +
                                </button>
                            </ng-container>
                        </span>
                        <strong
                            *ngIf="spellCastingParameters.casting.bondedItemCharges[spellCastingLevelParameters.level] && spellCastingLevelParameters.level != 0">
                            {{spellCastingParameters.casting.bondedItemCharges[spellCastingLevelParameters.level]}}
                            bonded item charge available
                        </strong>
                    </div>
                    <div class="list-item"
                        *ngIf="spellCastingParameters.casting.castingType == 'Focus' && spellCastingLevelParameters.level == -1 && (spellCastingLevelParameters.spellTakenList.length || componentParameters.focusPoints.max)">
                        <div class="newrow">
                            <strong>Focus Points</strong>
                            <span class="hlist center-aligned">
                                <div class="value" style="margin-left:0; margin-right:0;">
                                    {{componentParameters.focusPoints.now}}
                                </div>
                                <ng-container *ngIf="get_ManualMode()">
                                    <button (click)="on_ManualFocusPointChange(-1)"
                                        [disabled]="componentParameters.focusPoints.now <= 0">
                                        -
                                    </button>
                                    <button (click)="on_ManualFocusPointChange(1)"
                                        [disabled]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max">
                                        +
                                    </button>
                                </ng-container>
                            </span>
                            <strong>Focus Pool</strong>
                            <div class="value">
                                {{componentParameters.focusPoints.max}}
                            </div>
                        </div>
                        <button class="newrow center-aligned" (click)="refocus()"
                            [disabled]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max">
                            Refocus
                        </button>
                        <app-tags [creature]="'Character'" [objectName]="'Focus'" [showTraits]=true [showFeats]=true
                            [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true>
                        </app-tags>
                    </div>
                    <div class="vlist" *ngIf="spellCastingLevelParameters.temporaryChoiceList.length">
                        <header class="subsectionHeader box-header">Level {{spellCastingLevelParameters.level}}
                            Temporary Spell Selections
                        </header>
                        <div class="list-item"
                            *ngFor="let choice of spellCastingLevelParameters.temporaryChoiceList; let choicesIndex = index; trackBy:trackByIndex;">
                            <app-spellchoice class="newrow" (showChoiceMessage)="receive_ChoiceMessage($event)"
                                (showSpellMessage)="receive_SpellMessage($event)"
                                [spellCasting]="spellCastingParameters.casting" [choice]="choice"
                                [showHeightened]="true" [allowBorrow]="false" [showChoice]="get_ShowList()"
                                [showSpell]="get_ShowSpell()" [level]="spellCastingLevelParameters.level"
                                [prepared]="choice.source == 'Infinite Possibilities'" [spellbook]="true">
                            </app-spellchoice>
                        </div>
                    </div>
                    <div [ngClass]="{'icon-list':get_TileMode(), 'list-item':!get_TileMode()}"
                        *ngIf="spellCastingLevelParameters.spellTakenList.length">
                        <ng-container
                            *ngFor="let spellParameters of get_SpellParameters(spellCastingLevelParameters, spellCastingParameters); let spellIndex = index; trackBy:trackByIndex;">
                            <ng-template #SpellTitleTemplate>
                                <span *ngIf="!get_TileMode()">
                                    <i class="value bi-patch-plus bonus" *ngIf="!spellParameters.isHostile"
                                        [ngbTooltip]="'Beneficial spell'"></i>
                                    <i class="value bi-patch-minus-fill penalty" *ngIf="spellParameters.isHostile"
                                        [ngbTooltip]="'Hostile spell'"></i>
                                </span>
                                <span [ngbTooltip]="'Signature spell'" *ngIf="spellParameters.isSignatureSpell">
                                    <i class='bi-stars'></i>
                                </span>
                                <span [ngbTooltip]="'Combination spell'"
                                    *ngIf="spellParameters.isSpellCombinationSpell">
                                    <i class='ra ra-frostfire'></i>
                                </span>
                                <span [ngbTooltip]="'Infinite Possibilities spell'"
                                    *ngIf="spellParameters.isInfinitePossibilitiesSpell">
                                    <i class='ra ra-kaleidoscope'></i>
                                </span>
                                <span [ngbTooltip]="'Spell Mastery spell'" *ngIf="spellParameters.isSpellMasterySpell">
                                    <i class='ra ra-crown'></i>
                                </span>
                                <span [ngbTooltip]="'Crossblooded Evolution spell'"
                                    *ngIf="spellParameters.choice.crossbloodedEvolution">
                                    <i class='ra ra-zigzag-leaf'></i>
                                </span>
                                {{spellParameters.spell.name}} {{spellParameters.gain.combinationSpellName ? " & " +
                                spellParameters.gain.combinationSpellName : ""}}
                                <ng-container *ngIf="!spellParameters.gain.combinationSpellName">
                                    <app-actionIcons [actionString]="spellParameters.spell.actions">
                                    </app-actionIcons>
                                    {{spellParameters.spell.castType}}
                                </ng-container>
                                {{(spellCastingParameters.casting.tradition != spellParameters.choice.tradition &&
                                spellParameters.choice.tradition) ? "(" + spellParameters.choice.tradition + ")" : ""}}
                                {{spellParameters.choice.frequency ? spellParameters.choice.frequency : ""}}
                            </ng-template>
                            <ng-template #SpellTooltipTemplate>
                                <span *ngIf="spellParameters.isSignatureSpell">
                                    <i class='bi-stars'></i>
                                </span>
                                <span *ngIf="spellParameters.isSpellCombinationSpell">
                                    <i class='ra ra-frostfire'></i>
                                </span>
                                <span *ngIf="spellParameters.isInfinitePossibilitiesSpell">
                                    <i class='ra ra-kaleidoscope'></i>
                                </span>
                                <span *ngIf="spellParameters.isSpellMasterySpell">
                                    <i class='ra ra-crown'></i>
                                </span>
                                <span *ngIf="spellParameters.choice.crossbloodedEvolution">
                                    <i class='ra ra-zigzag-leaf'></i>
                                </span>
                                {{spellParameters.spell.name}} {{spellParameters.gain.combinationSpellName ? " & " +
                                spellParameters.gain.combinationSpellName : ""}}
                                <ng-container *ngIf="!spellParameters.gain.combinationSpellName">
                                    <app-actionIcons [actionString]="spellParameters.spell.actions">
                                    </app-actionIcons>
                                    {{spellParameters.spell.castType}}
                                </ng-container>
                                {{(spellCastingParameters.casting.tradition != spellParameters.choice.tradition &&
                                spellParameters.choice.tradition) ? "(" + spellParameters.choice.tradition + ")" : ""}}
                                {{spellParameters.choice.frequency ? spellParameters.choice.frequency : ""}}
                            </ng-template>
                            <ng-template #SpellTemplate>
                                <header class="spellHeader left-aligned newrow" *ngIf="get_TileMode()">
                                    <ng-container *ngTemplateOutlet="SpellTitleTemplate">
                                    </ng-container>
                                </header>
                                <div class="newrow list-item left-aligned"
                                    *ngIf="spellParameters.effectiveSpellLevel != spellCastingLevelParameters.level">
                                    Effective spell level: {{spellParameters.effectiveSpellLevel}}
                                </div>
                                <app-spellTarget class="newrow vlist" [creature]="'Character'"
                                    [spell]="spellParameters.spell" [gain]="spellParameters.gain"
                                    [phrase]="'Cast' + (spellParameters.maxCharges ? ' (' + (spellParameters.maxCharges - spellParameters.usedCharges) + ' of ' + spellParameters.maxCharges + ' charges)' : '')"
                                    [casting]="spellCastingParameters.casting" [cannotCast]="spellParameters.cannotCast"
                                    [effectiveSpellLevel]="spellParameters.effectiveSpellLevel"
                                    [cannotExpend]="spellParameters.cannotExpend" [showExpend]="true"
                                    [bloodMagicFeats]="componentParameters.bloodMagicFeats" [showDismiss]="true"
                                    (castMessage)="on_Cast($event.target, $event.activated, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, $event.options)">
                                </app-spellTarget>
                                <div class="newrow"
                                    *ngIf="spellCastingParameters.casting.castingType == 'Focus' && spellParameters.spell.allowReturnFocusPoint"
                                    [ngbTooltip]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max ? 'Focus points are full.' : ''">
                                    <button class="newrow center-aligned" (click)="on_RestoreFocusPoint()"
                                        [disabled]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max">
                                        <span class="center-aligned">
                                            Return Focus Point
                                        </span>
                                    </button>
                                </div>
                                <div class="newrow"
                                    *ngIf="spellCastingParameters.casting.castingType == 'Prepared' && spellCastingParameters.casting.className == 'Wizard' && !spellParameters.gain.prepared && spellCastingLevelParameters.level > 0 && !spellParameters.gain.duration"
                                    [ngbTooltip]="!spellCastingLevelParameters.canRestore ? 'No bonded item charges remaining.' : ''">
                                    <button class="newrow center-aligned"
                                        (click)="on_Restore(spellParameters.gain, spellCastingParameters.casting, spellCastingLevelParameters.level)"
                                        [disabled]="!spellCastingLevelParameters.canRestore">
                                        <span class="center-aligned">
                                            Restore with bonded item
                                            <app-actionIcons [actionString]="'Free'">
                                            </app-actionIcons>
                                        </span>
                                    </button>
                                </div>
                                <div class="newrow"
                                    *ngIf="spellCastingParameters.casting.castingType == 'Prepared' && !spellParameters.gain.prepared && spellCastingLevelParameters.level > 0 && spellParameters.canReprepare">
                                    <button class="newrow center-aligned" (click)="on_Reprepare(spellParameters.gain)">
                                        <span class="center-aligned">
                                            Reprepare
                                            <app-actionIcons *ngIf="!get_ManualMode()" [actionString]="'10 minutes'">
                                            </app-actionIcons>
                                        </span>
                                    </button>
                                </div>
                                <div class="newrow" *ngIf="get_ManualMode() && spellParameters.gain.activeCooldown">
                                    <!-- End cooldown button in manual mode-->
                                    <button class="newrow center-aligned"
                                        (click)="on_ManualEndCooldown(spellParameters.gain)">
                                        <span class="center-aligned">
                                            End cooldown
                                        </span>
                                    </button>
                                </div>
                                <div class="newrow" *ngIf="get_ManualMode() && spellParameters.gain.chargesUsed">
                                    <!-- Restore charges button in manual mode-->
                                    <button class="newrow center-aligned"
                                        (click)="on_ManualRestoreCharge(spellParameters.gain)">
                                        <span>Restore charge</span>
                                    </button>
                                </div>
                                <div class="newrow"
                                    *ngIf="spellCastingParameters.canCounterSpell && !spellParameters.gain.active && spellCastingLevelParameters.level > 0"
                                    [ngbTooltip]="spellParameters.cannotExpend">
                                    <button class="newrow center-aligned"
                                        (click)="on_Cast('', true, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, {expend: true})"
                                        [disabled]="spellParameters.cannotExpend">
                                        Expend to counter spell
                                    </button>
                                </div>
                                <div class="newrow"
                                    *ngIf="spellParameters.canChannelSmite && !spellParameters.gain.active && spellCastingLevelParameters.level > 0"
                                    [ngbTooltip]="spellParameters.cannotExpend">
                                    <button class="newrow center-aligned"
                                        (click)="on_Cast('', true, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, {expend: true})"
                                        [disabled]="spellParameters.cannotExpend">
                                        Expend for channel smite
                                    </button>
                                </div>
                                <div class="newrow"
                                    *ngIf="spellParameters.canSwiftBanish && !spellParameters.gain.active && spellCastingLevelParameters.level > 0"
                                    [ngbTooltip]="spellParameters.cannotExpend">
                                    <button class="newrow center-aligned"
                                        (click)="on_Cast('', true, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, {expend: true})"
                                        [disabled]="spellParameters.cannotExpend">
                                        Expend for swift banishment
                                    </button>
                                </div>
                                <ng-container
                                    *ngFor="let conditionSet of get_SpellConditions(spellParameters.spell, spellParameters.effectiveSpellLevel, spellParameters.gain); let conditionSetIndex = index; trackBy:trackByIndex">
                                    <div class="newrow list-item left-aligned"
                                        *ngIf="conditionSet.condition && conditionSet.condition._choices.length && !conditionSet.gain.choiceBySubType && !conditionSet.gain.choiceLocked && !conditionSet.gain.copyChoiceFrom && !conditionSet.gain.hideChoices">
                                        <span>
                                            {{conditionSet.condition.name}} effect selection:
                                            <select
                                                [(ngModel)]="spellParameters.gain.effectChoices[conditionSetIndex].choice">
                                                <option
                                                    *ngFor="let choice of conditionSet.condition._choices; trackBy:trackByIndex;"
                                                    [ngValue]="choice">
                                                    {{choice}}
                                                </option>
                                            </select>
                                        </span>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="!spellParameters.gain.combinationSpellName">
                                    <app-spell class="list-item" [spell]="spellParameters.spell"
                                        [spellLevel]="spellParameters.effectiveSpellLevel"
                                        [source]="spellParameters.gain.source"
                                        [casting]="spellCastingParameters.casting">
                                    </app-spell>
                                </ng-container>
                                <ng-container *ngIf="spellParameters.gain.combinationSpellName">
                                    <header class="spellHeader left-aligned">
                                        {{spellParameters.spell.name}}
                                        <app-actionIcons [actionString]="spellParameters.spell.actions">
                                        </app-actionIcons>
                                        {{(spellParameters.spell.castType) ? spellParameters.spell.castType : ""}}
                                    </header>
                                    <app-spell class="list-item" [spell]="spellParameters.spell"
                                        [spellLevel]="spellParameters.effectiveSpellLevel"
                                        [source]="spellParameters.gain.source"
                                        [casting]="spellCastingParameters.casting">
                                    </app-spell>
                                    <ng-container
                                        *ngFor="let secondSpell of get_Spells(spellParameters.gain.combinationSpellName); trackBy:trackByIndex;">
                                        <header class="spellHeader left-aligned">
                                            {{secondSpell.name}}
                                            <app-actionIcons [actionString]="secondSpell.actions">
                                            </app-actionIcons>
                                            {{(secondSpell.castType) ? secondSpell.castType : ""}}
                                        </header>
                                        <app-spell class="list-item" [spell]="secondSpell"
                                            [spellLevel]="spellParameters.effectiveSpellLevel"
                                            [source]="spellParameters.gain.source"
                                            [casting]="spellCastingParameters.casting">
                                        </app-spell>
                                    </ng-container>
                                </ng-container>
                            </ng-template>
                            <ng-container *ngIf="!get_TileMode()">
                                <div class="list-item">
                                    <button class="newrow sublist-toggle left-aligned"
                                        (click)="toggle_Spell(spellCastingLevelParameters.level+spellCastingParameters.casting.castingType+spellCastingParameters.casting.className+spellParameters.gain.name+spellIndex)"
                                        [ngClass]="{'inactive-button': spellParameters.cannotCast}">
                                        <ng-container *ngTemplateOutlet="SpellTitleTemplate">
                                        </ng-container>
                                    </button>
                                    <div class="list-item sublist lower"
                                        [ngClass]="{'inactive-list': spellParameters.cannotCast}"
                                        *ngIf="get_ShowSpell()==spellCastingLevelParameters.level+spellCastingParameters.casting.castingType+spellCastingParameters.casting.className+spellParameters.gain.name+spellIndex">
                                        <ng-container *ngTemplateOutlet="SpellTemplate">
                                        </ng-container>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="get_TileMode()">
                                <button [stickyPopover]="SpellTemplate" triggers="click"
                                    [ngClass]="{'inactive-button': spellParameters.cannotCast, 'penalty':!spellParameters.cannotCast && spellParameters.isHostile, 'bonus':!spellParameters.cannotCast && !spellParameters.isHostile}">
                                    <app-gridIcon
                                        [ngClass]="{'inactive-button': spellParameters.cannotCast, 'penalty':!spellParameters.cannotCast && spellParameters.isHostile, 'bonus':!spellParameters.cannotCast && !spellParameters.isHostile}"
                                        [ngbTooltip]="SpellTooltipTemplate"
                                        [title]="spellParameters.spell.name + (spellParameters.gain.combinationSpellName ? ' & ' + spellParameters.gain.combinationSpellName : '')"
                                        [superTitle]="(spellParameters.isSignatureSpell ? 'icon-bi-stars|' : '') + (spellParameters.isSpellCombinationSpell ? 'icon-ra ra-frostfire|' : '') + (spellParameters.isInfinitePossibilitiesSpell ? 'icon-ra ra-kaleidoscope|' : '') + (spellParameters.isSpellMasterySpell ? 'icon-ra ra-crown|' : '') + (spellParameters.choice.crossbloodedEvolution ? 'icon-ra ra-zigzag-leaf|' : '')"
                                        [spell]="spellParameters.spell">
                                    </app-gridIcon>
                                </button>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
    </ng-container>
</div>
