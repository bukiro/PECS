<ng-container *ngFor="let traits of [item.get_Traits(characterService, get_Creature())]; trackBy:trackByIndex">
    <div class="newrow left-aligned tags" *ngIf="traits.length">
        <app-trait *ngFor="let trait of traits; trackBy:trackByIndex;"
            [name]="trait" [trait]="get_Traits(trait)[0]">
        </app-trait>
    </div>
</ng-container>
<div class="newrow left-aligned tags">
    <app-tags [creature]="creature" [objectName]="item.name" [showTraits]=true [showFeats]=true [showItems]=true
        [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
</div>
<div class="newrow" *ngIf="item.choices && item.choices.length && (itemStore ? true : item.showChoicesInInventory)">
    <span>Variation:
        <select [(ngModel)]="item.choice" (ngModelChange)="on_ChoiceChange()">
            <option *ngFor="let choice of item.choices; trackBy:trackByIndex;" [ngValue]="choice">
                {{choice}}
            </option>
        </select>
    </span>
</div>
<!-- Doubling Rings selection -->
<div class="newrow"
    *ngIf="item.isDoublingRings && !item.isTalismanCord && !(item.isRingOfWizardry && item.isRingOfWizardry.length) && !itemStore">
    <header class="spellHeader">Doubling Rings</header>
    <div class="newrow">
        <strong>Weapon wielded in the gold ring hand</strong>
        <select [(ngModel)]="item.data[0].value" (ngModelChange)="on_DoublingRingsChange()">
            <option *ngFor="let weapon of get_DoublingRingsOptions('gold'); trackBy:trackByIndex;"
                [ngValue]="weapon.id">
                {{weapon.get_Name()}}
            </option>
        </select>
    </div>
    <div class="newrow">
        <strong>Weapon wielded in the iron ring hand</strong>
        <select [(ngModel)]="item.data[1].value" (ngModelChange)="on_DoublingRingsChange()">
            <option *ngFor="let weapon of get_DoublingRingsOptions('iron'); trackBy:trackByIndex;"
                [ngValue]="weapon.id">
                {{weapon.get_Name()}}
            </option>
        </select>
    </div>
    <div class="newrow left-aligned" *ngIf="item.isDoublingRings == 'Doubling Rings (Greater)'">
        <input id="{{item.id}}doublingRingsApplyPropertyRunes" type="checkbox" [(ngModel)]="item.data[2].value"
            (ngModelChange)="on_DoublingRingsChange()">
        <label for="{{item.id}}doublingRingsApplyPropertyRunes">Apply property runes</label>
    </div>
</div>
<!-- Ring of Wizardry selection -->
<div class="newrow"
    *ngIf="item.isRingOfWizardry && item.isRingOfWizardry.length && !item.istalismanCord && !item.isDoublingRings && !itemStore">
    <header class="spellHeader">Ring of Wizardry</header>
    <div class="newrow"
        *ngFor="let wizardrySlot of item.isRingOfWizardry; let wizardryIndex = index; trackBy:trackByIndex">
        <strong>{{get_RingOfWizardrySlotName(wizardrySlot)}}</strong>
        <select [(ngModel)]="item.data[wizardryIndex].value"
            (ngModelChange)="on_RingOfWizardryChange(wizardrySlot, wizardryIndex)">
            <option *ngFor="let spellCasting of get_RingOfWizardryOptions(wizardrySlot); trackBy:trackByIndex;"
                [ngValue]="spellCasting">
                {{spellCasting}}
            </option>
        </select>
    </div>
</div>
<!-- Talisman Cord school display/selection -->
<div class="newrow"
    *ngIf="item.isTalismanCord && !item.isDoublingRings && !(item.isRingOfWizardry && item.isRingOfWizardry.length)">
    <header class="spellHeader">Talisman Cord</header>
    <ng-container *ngFor="let talismanCordIndex of [0, 1, 2]; trackBy:trackByIndex;">
        <div class="newrow" *ngIf="item.isTalismanCord > talismanCordIndex && item.data[talismanCordIndex]">
            <strong>{{item.data[talismanCordIndex].name}}</strong>
            <select [(ngModel)]="item.data[talismanCordIndex].value">
                <option *ngFor="let school of get_TalismanCordOptions(item, talismanCordIndex); trackBy:trackByIndex;"
                    [ngValue]="school">
                    {{school}}
                </option>
            </select>
        </div>
    </ng-container>
</div>
<app-itemContent [item]="item"></app-itemContent>
<!-- Item activities -->
<div class="list-item left-aligned" *ngFor="let activity of item.activities; trackBy:trackByIndex;">
    <header class="spellHeader" *ngIf="activity.name">
        {{activity.name}}
        <app-actionIcons *ngIf="activity.actions" [actionString]="activity.actions">
        </app-actionIcons>
        {{(activity.activationType) ? activity.activationType : ""}}
    </header>
    <app-activity [creature]="creature" [activity]=activity [gain]=activity
        [allowActivate]="allowActivate && !item.broken && (activity.resonant ? isSubItem : true)" [isSubItem]=isSubItem>
    </app-activity>
</div>
<!-- Known activities -->
<ng-container *ngFor="let gain of item.gainActivities; trackBy:trackByIndex;">
    <div class="list-item left-aligned" *ngFor="let activity of get_Activities(gain.name); trackBy:trackByIndex;">
        <header class="spellHeader">
            {{activity.name}}
            <app-actionIcons *ngIf="activity.actions" [actionString]="activity.actions">
            </app-actionIcons>
            {{(activity.activationType) ? activity.activationType : ""}}
        </header>
        <app-activity [creature]="creature" [activity]=activity [gain]=gain [allowActivate]=allowActivate
            [isSubItem]=isSubItem></app-activity>
    </div>
</ng-container>
<!-- Shown/related activities -->
<ng-container *ngFor="let activityName of item.showActivities; trackBy:trackByIndex;">
    <div class="list-item left-aligned" *ngFor="let activity of get_Activities(activityName); trackBy:trackByIndex;">
        <header class="spellHeader">
            {{activity.name}}
            <app-actionIcons *ngIf="activity.actions" [actionString]="activity.actions">
            </app-actionIcons>
            {{(activity.activationType) ? activity.activationType : ""}}
        </header>
        <app-activity [creature]="creature" [activity]=activity [gain]=null [allowActivate]=false [isSubItem]=isSubItem>
        </app-activity>
    </div>
</ng-container>
<!-- Spells that get cast by activating the item (Oils only) -->
<div class="list-item left-aligned" *ngFor="let cast of item.castSpells; trackBy:trackByIndex;">
    <div *ngFor="let spell of get_Spells(cast.name); trackBy:trackByIndex;">
        <header class="spellHeader">{{spell.name}}
            <app-actionIcons *ngIf="spell.actions" [actionString]="spell.actions">
            </app-actionIcons>
            {{spell.castType.toString()}}
        </header>
        <app-spell [spell]=spell [spellLevel]="cast.level ? cast.level : 0"></app-spell>
    </div>
</div>
<!-- Spells that you gain from equipping/investing the item -->
<ng-container *ngFor="let choice of item.gainSpells; trackBy:trackByIndex;">
    <div class="list-item left-aligned" *ngFor="let gain of choice.spells; trackBy:trackByIndex;">
        <div *ngFor="let spell of get_Spells(gain.name); trackBy:trackByIndex;">
            <header class="spellHeader">{{spell.name}}
                <app-actionIcons *ngIf="spell.actions" [actionString]="spell.actions">
                </app-actionIcons>
                {{spell.castType.toString()}}
            </header>
            <app-spell [spell]=spell [spellLevel]="get_GainedSpellLevel(spell, {gain: gain, choice: choice})">
            </app-spell>
        </div>
    </div>
</ng-container>
<!-- Material description -->
<div class="list-item left-aligned" *ngFor="let material of item.material; trackBy:trackByIndex;">
    <header class="spellHeader">{{material.name}}</header>
    <div class="newrow left-aligned" *ngIf="material.sourceBook">
        <strong>Source</strong>
        <i>{{material.sourceBook}}</i>
    </div>
    <ng-container *ngFor="let desc of material.desc.split('\n\n'); trackBy:trackByIndex;">
        <app-description class="newrow" [text]="desc"></app-description>
    </ng-container>
</div>
<!-- Armored skirt description if one is applied -->
<div class="list-item left-aligned" *ngIf="armoredSkirt">
    <header class="spellHeader">Armored Skirt</header>
    <app-item [item]=armoredSkirt></app-item>
</div>
<!-- Spell choices for wands/scrolls/etc -->
<div class="list-item left-aligned" *ngFor="let choice of get_StoredSpells(item); trackBy:trackByIndex;">
    <app-spellchoice class="newrow" [choice]="choice" [showHeightened]="true" [level]="choice.level" [itemSpell]="true">
    </app-spellchoice>
</div>
<!-- Spell descriptions and effect selections of selected spells -->
<ng-container *ngFor="let choice of get_StoredSpellsTaken(item); trackBy:trackByIndex;">
    <ng-container *ngFor="let taken of choice.spells; trackBy:trackByIndex;">
        <div class="list-item left-aligned" *ngFor="let spell of get_Spells(taken.name); trackBy:trackByIndex;">
            <header class="spellHeader">
                {{spell.name}}
                <app-actionIcons *ngIf="spell.actions" [actionString]="spell.actions">
                </app-actionIcons>
                {{spell.castType.toString()}}
            </header>
            <ng-container *ngIf="!itemStore">
                <ng-container
                    *ngFor="let conditionSet of get_SpellConditions(spell, choice.level, taken); let conditionSetIndex = index; trackBy:trackByIndex">
                    <div class="newrow list-item left-aligned"
                        *ngIf="conditionSet.condition._choices.length && !conditionSet.gain.choiceBySubType && !conditionSet.gain.choiceLocked && !conditionSet.gain.copyChoiceFrom && !conditionSet.gain.hideChoices">
                        <span>{{conditionSet.condition.name}}
                            effect selection:
                            <select [(ngModel)]="taken.effectChoices[conditionSetIndex].choice">
                                <option *ngFor="let choice of conditionSet.condition._choices; trackBy:trackByIndex;"
                                    [ngValue]="choice">
                                    {{choice}}
                                </option>
                            </select>
                        </span>
                    </div>
                </ng-container>
            </ng-container>
            <app-spell [spell]=spell [spellLevel]="(taken.level) ? taken.level : (choice.level ? choice.level : 0)">
            </app-spell>
        </div>
    </ng-container>
</ng-container>
<!-- Oil descriptions -->
<div class="list-item left-aligned" *ngFor="let oil of item.oilsApplied; trackBy:trackByIndex;">
    <header class="spellHeader">{{oil.get_Name()}}</header>
    <app-item [creature]="creature" [item]=oil [allowActivate]=allowActivate [isSubItem]=true></app-item>
</div>
<!-- Poison descriptions -->
<div class="list-item left-aligned" *ngFor="let poison of item.poisonsApplied; trackBy:trackByIndex;">
    <header class="spellHeader">{{poison.name}}</header>
    <button class="newrow left-aligned" (click)="on_PoisonUse(poison)" *ngIf="allowActivate">
        <span>Spend/Remove</span>
    </button>
    <app-item [creature]="creature" [item]=poison [allowActivate]=allowActivate [isSubItem]=true></app-item>
</div>
<!-- Rune descriptions -->
<div class="list-item left-aligned" *ngFor="let rune of item.propertyRunes; trackBy:trackByIndex;">
    <header class="spellHeader">{{rune.name}} Rune</header>
    <ng-container *ngFor="let spell of get_ItemSpell(rune); trackBy:trackByIndex;">
        <button class="newrow center-aligned" (click)="on_SpellItemUse(rune)">
            <span>Use
                <app-actionIcons *ngIf="spell.actions" [actionString]="spell.actions">
                </app-actionIcons>
                (Cast spell)
            </span>
        </button>
    </ng-container>
    <app-item [creature]="creature" [item]=rune [allowActivate]=allowActivate [isSubItem]=true></app-item>
</div>
<!-- Blade ally rune descriptions -->
<ng-container *ngIf="item.bladeAlly">
    <div class="list-item left-aligned" *ngFor="let rune of item.bladeAllyRunes; trackBy:trackByIndex;">
        <header class="spellHeader">{{rune.name}} Rune</header>
        <app-item [creature]="creature" [item]=rune [allowActivate]="allowActivate" [isSubItem]=true></app-item>
    </div>
</ng-container>
<!-- Emulated rune descriptions (oils) -->
<div class="list-item left-aligned" *ngIf="item.runeEffect">
    <header class="spellHeader">Rune Effect: {{item.runeEffect.name}}</header>
    <app-item [creature]="creature" [item]=item.runeEffect [allowActivate]=allowActivate [isSubItem]=isSubItem>
    </app-item>
</div>
<!-- Aeon stone descriptions -->
<div class="list-item left-aligned" *ngFor="let stone of item.aeonStones; trackBy:trackByIndex;">
    <header class="spellHeader">{{stone.name}}</header>
    <app-item [creature]="creature" [item]=stone [allowActivate]=allowActivate [isSubItem]=true></app-item>
</div>
<!-- Talisman cord descriptions -->
<div class="list-item left-aligned lower" *ngFor="let cord of item.talismanCords; trackBy:trackByIndex;">
    <header class="spellHeader">{{cord.name}}</header>
    <p>
        When you activate a talisman threaded through a cord with the same magic school trait that's also the cord's
        level or lower, attempt a <app-quickdice [diceString]="'1d20'"></app-quickdice> DC 16 flat check. On a success,
        that talisman is not consumed and can be used again.
    </p>
    <ng-container *ngFor="let talismanCordIndex of [0, 1, 2]; trackBy:trackByIndex;">
        <div class="newrow" *ngIf="cord.isTalismanCord > talismanCordIndex && cord.data[talismanCordIndex]">
            <strong>{{cord.data[talismanCordIndex].name}}</strong>
            {{cord.data[talismanCordIndex].value}}
        </div>
    </ng-container>
</div>
<!-- Talisman descriptions and activation -->
<div class="list-item left-aligned" *ngFor="let talisman of item.talismans; let index = index; trackBy:trackByIndex;">
    <header class="spellHeader">{{talisman.name}}</header>
    <button class="newrow left-aligned" (click)="on_TalismanUse(talisman, index)" *ngIf="allowActivate">
        <span>
            Activate
            <app-actionIcons *ngIf="talisman.actions" [actionString]="talisman.actions">
            </app-actionIcons>
            {{(talisman.activationType) ? talisman.activationType : ""}}
        </span>
    </button>
    <button class="newrow left-aligned" (click)="on_TalismanUse(talisman, index, true)"
        *ngIf="allowActivate && get_HaveMatchingTalismanCord(talisman)">
        <span>
            Activate and preserve with talisman cord
            <app-actionIcons *ngIf="talisman.actions" [actionString]="talisman.actions">
            </app-actionIcons>
            {{(talisman.activationType) ? talisman.activationType : ""}}
        </span>
    </button>
    <app-item [creature]="creature" [item]=talisman [allowActivate]=allowActivate [isSubItem]=true></app-item>
</div>
