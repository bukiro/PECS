<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<app-fly-in-menu
    position="left"
    [show]="show"
    [showMinimizeButton]="true"
    [minimized]="(isMinimized$ | async) ?? false"
    (toggleMinimized)="toggleMinimized($event)"
>
    <div
        id="animal-companion-height"
        class="itembox vlist"
    >
        <button
            type="button"
            class="itembox-close-button list-item center-aligned"
            (click)="toggleCompanionMenu()"
        >
            <header class="sectionHeader">Back to Character Sheet</header>
        </button>

        @if (
            (isMenuOpen$ | async) && (animalCompanion$ | async);
            as animalCompanion
        ) {
            <div class="animalcompanion-box">
                <!-- Desktop-only view -->

                <!-- Mobile-only buttons and views -->
                @if (isMobile$ | async) {
                    <div
                        class="character-sheet-app character-sheet-row desktop-hide"
                        id="mobile-tabs"
                    >
                        <button
                            aria-label="General"
                            type="button"
                            [ngClass]="{ 'fancy-button': showMode() === '' }"
                            (click)="toggleShowMode('')"
                        >
                            <i class="bi-info-circle-fill"></i>
                        </button>

                        <button
                            aria-label="Health"
                            type="button"
                            [ngClass]="{
                                'fancy-button': showMode() === 'Health',
                            }"
                            (click)="toggleShowMode('Health')"
                        >
                            <i class="ra ra-health"></i>
                        </button>

                        <button
                            aria-label="Defense"
                            type="button"
                            [ngClass]="{
                                'fancy-button': showMode() === 'Defense',
                            }"
                            (click)="toggleShowMode('Defense')"
                        >
                            <i class="ra ra-shield"></i>
                        </button>

                        <button
                            aria-label="Attacks"
                            type="button"
                            [ngClass]="{
                                'fancy-button': showMode() === 'Attacks',
                            }"
                            (click)="toggleShowMode('Attacks')"
                        >
                            <i class="ra ra-sword"></i>
                        </button>

                        <button
                            aria-label="Skills"
                            type="button"
                            [ngClass]="{
                                'fancy-button': showMode() === 'Skills',
                            }"
                            (click)="toggleShowMode('Skills')"
                        >
                            <i class="ra ra-muscle-up"></i>
                        </button>

                        <button
                            aria-label="Actions"
                            type="button"
                            [ngClass]="{
                                'fancy-button': showMode() === 'Actions',
                            }"
                            (click)="toggleShowMode('Actions')"
                        >
                            <app-action-icons
                                style="
                                    margin: 0.12rem -0.16rem -0.14rem -0.16rem;
                                "
                                [actionString]="'1A'"
                            />
                        </button>

                        <button
                            aria-label="Inventory"
                            type="button"
                            [ngClass]="{
                                'fancy-button': showMode() === 'Inventory',
                            }"
                            (click)="toggleShowMode('Inventory')"
                        >
                            <i class="bi-box"></i>
                        </button>

                        <button
                            aria-label="Conditions and Effects"
                            type="button"
                            [ngClass]="{
                                'fancy-button':
                                    showMode() === 'ConditionsEffects',
                            }"
                            (click)="toggleShowMode('ConditionsEffects')"
                        >
                            <i class="ra ra-lightning-bolt"></i>
                        </button>
                    </div>

                    <div class="character-sheet-column-container desktop-hide">
                        <div class="character-sheet-column">
                            @if (
                                !showMode() ||
                                ![
                                    "Health",
                                    "Defense",
                                    "Attacks",
                                    "Spells",
                                    "Skills",
                                    "Actions",
                                    "Inventory",
                                    "ConditionsEffects",
                                ].includes(showMode())
                            ) {
                                <app-general
                                    if="general"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (!showMode()) {
                                <app-abilities
                                    if="abilities"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (showMode() === "Health") {
                                <app-health
                                    if="health"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                    [forceMinimized]="showMode() === 'Downtime'"
                                />
                            }

                            @if (showMode() === "Defense") {
                                <app-defense
                                    if="defense"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (showMode() === "Attacks") {
                                <app-attacks
                                    if="attacks"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (showMode() === "Skills") {
                                <app-skills
                                    if="skills"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (showMode() === "Actions") {
                                <app-activities
                                    if="activities"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (showMode() === "Inventory") {
                                <app-inventory
                                    if="inventory"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                />
                            }

                            @if (showMode() === "ConditionsEffects") {
                                <app-effects
                                    if="effects"
                                    class="character-sheet-app"
                                    [creature]="animalCompanion"
                                    [fullDisplay]="true"
                                />
                            }
                        </div>
                    </div>
                } @else {
                    <app-effects
                        id="Companion-effects"
                        class="character-sheet-app character-sheet-row mobile-hide"
                        [creature]="animalCompanion"
                    />

                    <div class="character-sheet-column-container mobile-hide">
                        <div class="character-sheet-column">
                            <app-general
                                id="Companion-general"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />

                            <app-health
                                id="Companion-health"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />

                            <app-skills
                                id="Companion-skills"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />

                            <app-activities
                                id="Companion-activities"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />
                        </div>

                        <div class="character-sheet-column">
                            <app-abilities
                                id="Companion-abilities"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />

                            <app-defense
                                id="Companion-defense"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />

                            <app-attacks
                                id="Companion-attacks"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />

                            <app-inventory
                                id="Companion-inventory"
                                class="character-sheet-app"
                                [creature]="animalCompanion"
                            />
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</app-fly-in-menu>
