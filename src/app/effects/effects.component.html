<div id="{{creature}}-effects-height" class="attributeBox" [ngClass]="{'snug':!fullDisplay}">
    <ng-template #conditionTemplate let-conditionGain="conditionGain">
        <div style="display:flex"
            [ngClass]="{'attention':(conditionGain.duration == 1) || (conditionGain.nextStage == -1)}"
            *ngFor="let condition of [get_Conditions(conditionGain.name)[0]]; trackBy:trackByIndex;">
            <ng-template #conditionContent>
                <app-condition class="newrow" (showChoiceMessage)="receive_ItemMessage($event)" [creature]="creature"
                    [conditionGain]="conditionGain" [condition]="condition" [showItem]="get_ShowItem()"
                    [fullDisplay]="fullDisplay"></app-condition>
            </ng-template>
            <app-gridIcon class="condition" [ngClass]="{'penalty':!condition.buff, 'bonus':condition.buff}"
                placement="right bottom top" [condition]="conditionGain" [originalCondition]="condition"
                [ngbPopover]="conditionContent"
                [superTitle]="get_IsInformationalCondition(conditionGain, condition) ? 'icon-bi-info-circle' : ''"
                ngbTooltip="{{conditionGain.name}}" container="body" *ngIf="!fullDisplay">
            </app-gridIcon>
            <div class="list-item gridicon-fullsizebox" *ngIf="fullDisplay">
                <app-gridIcon class="condition" [condition]="conditionGain" [originalCondition]="condition"
                    [superTitle]="get_IsInformationalCondition(conditionGain, condition) ? 'icon-bi-info-circle' : ''"
                    [ngClass]="{'penalty':!condition.buff, 'bonus':condition.buff}">
                </app-gridIcon>
                <ng-container *ngTemplateOutlet="conditionContent"></ng-container>
            </div>
        </div>
    </ng-template>
    <ng-template #effectTemplate let-effect="effect">
        <ng-template #effectContent>
            <div class="newrow">
                <span>
                    <strong
                        [ngClass]="{'penalty':effect.penalty, 'bonus':!effect.penalty && !effect.setValue, 'absolute':effect.setValue}">{{effect.target}}
                        {{parseInt(effect.value) ? effect.value : ''}}{{effect.setValue ? "= "+effect.setValue : ''}}
                    </strong>
                </span>
            </div>
            <div class="newrow" *ngIf="effect.type != 'untyped' && !effect.toggle && !effect.setValue">
                <span>
                    <strong>Type</strong> {{effect.type + " " + (effect.penalty ? 'penalty' : 'bonus')}}</span>
            </div>
            <div class="newrow" *ngIf="effect.duration">
                <span>
                    <strong>Duration</strong> {{effect.duration ? get_Duration(effect.duration) : ''}}
                </span>
            </div>
            <div class="newrow">
                <span><strong>Source&nbsp;</strong>{{effect.source.includes('conditional, ') ? effect.source.substr(13)
                    : effect.source}}</span>
            </div>
            <div class="newrow" *ngIf="effect.source.includes('conditional, ')">
                <span><strong>Conditional&nbsp;</strong>This effect only applies for certain actions or under specific
                    circumstances.</span>
            </div>
        </ng-template>
        <app-gridIcon class="effect" [effect]="effect" placement="left bottom top"
            [ngClass]="{'penalty':effect.penalty, 'bonus':!effect.penalty && !effect.setValue, 'absolute':effect.setValue}"
            [ngbPopover]="effectContent" ngbTooltip="{{effect.target}}
        {{parseInt(effect.value) ? effect.value : ''}}{{effect.setValue ? '= '+effect.setValue :
        ''}}" container="body" *ngIf="!fullDisplay"></app-gridIcon>
        <div class="list-item gridicon-fullsizebox" *ngIf="fullDisplay">
            <app-gridIcon class="effect" [effect]="effect"
                [ngClass]="{'penalty':effect.penalty, 'bonus':!effect.penalty && !effect.setValue, 'absolute':effect.setValue}">
            </app-gridIcon>
            <div class="gridicon-sidebar">
                <ng-container *ngTemplateOutlet="effectContent"></ng-container>
            </div>
        </div>
    </ng-template>
    <app-tags [creature]="creature" [objectName]="'Effects'" [showTraits]=true [showFeats]=true [showItems]=true
        [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
    <div class="charactersheet-column-container padding-8" *ngIf="!fullDisplay">
        <div class="icon-list left-aligned dashed-border">
            <div class="icon-list-title" style="right: 0">
                <header class="sectionHeader box-header">Conditions</header>
            </div>
            <ng-container *ngFor="let conditionGain of get_AppliedConditions(true); trackBy:trackByConditionGainID;">
                <ng-container *ngTemplateOutlet="conditionTemplate;context:{conditionGain:conditionGain}">
                </ng-container>
            </ng-container>
        </div>
        <div class="icon-list right-aligned dashed-border">
            <div class="icon-list-title" style="left: 0">
                <header class="sectionHeader box-header">Effects</header>
            </div>
            <ng-container *ngFor="let effect of get_AppliedEffects(); trackBy:trackByUniqueEffect;">
                <ng-container *ngTemplateOutlet="effectTemplate;context:{effect:effect}"></ng-container>
            </ng-container>
        </div>
    </div>
    <ng-container *ngIf="fullDisplay">
        <div>
            <header class="subsectionHeader">
                Active Conditions
            </header>
            <div>
                <ng-container
                    *ngFor="let conditionGain of get_AppliedConditions(true); trackBy:trackByConditionGainID;">
                    <ng-container *ngTemplateOutlet="conditionTemplate;context:{conditionGain:conditionGain}">
                    </ng-container>
                </ng-container>
            </div>
        </div>
        <div>
            <header class="subsectionHeader">
                Active Effects
            </header>
            <div>
                <ng-container *ngFor="let effect of get_AppliedEffects(); trackBy:trackByUniqueEffect;">
                    <ng-container *ngTemplateOutlet="effectTemplate;context:{effect:effect}"></ng-container>
                </ng-container>
            </div>
        </div>
        <div>
            <header class="subsectionHeader">
                Inactive Conditions
            </header>
            <div class="notapplied">
                <ng-container
                    *ngFor="let conditionGain of get_AppliedConditions(false); trackBy:trackByConditionGainID;">
                    <ng-container *ngTemplateOutlet="conditionTemplate;context:{conditionGain:conditionGain}">
                    </ng-container>
                </ng-container>
            </div>
        </div>
        <div>
            <header class="subsectionHeader">
                Inactive Effects
            </header>
            <div class="notapplied">
                <ng-container *ngFor="let effect of get_NotAppliedEffects(); trackBy:trackByUniqueEffect;">
                    <ng-container *ngTemplateOutlet="effectTemplate;context:{effect:effect}"></ng-container>
                </ng-container>
            </div>
        </div>
        <header class="subsectionHeader">
            Hidden Effects
        </header>
        <div>
            <ng-container *ngFor="let effect of get_HiddenEffects(); trackBy:trackByUniqueEffect;">
                <ng-container *ngTemplateOutlet="effectTemplate;context:{effect:effect}"></ng-container>
            </ng-container>
        </div>
    </ng-container>
</div>