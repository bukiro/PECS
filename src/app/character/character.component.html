<div class="window-button-container">
    <button class="minimizebutton lower"
        [ngbTooltip]="get_Minimized() ? 'Click to show all choices and information.' : 'Click to hide finished choices and show compact information.'"
        [ngClass]="{'fancy-button':get_Minimized()}" (click)="minimize()">
        <i class='bi-arrows-collapse' *ngIf="get_Minimized()"></i>
        <i class='bi-arrows-expand' *ngIf="!get_Minimized()"></i>
    </button>
    <button class="tilemodebutton" [ngClass]="{'fancy-button':get_TileMode()}" (click)="toggle_TileMode()"
        [ngbTooltip]="get_TileMode() ? 'Click to enable list layout' : 'Click to enable tiled layout'">
        <!--Content is css only-->
        <div>
            <div> </div>
            <div> </div>
            <div> </div>
            <div> </div>
        </div>
    </button>
</div>
<div id="character-height" class="itembox vlist">
    <button class="list-item center-aligned" (click)="toggleCharacterMenu()">
        <header class="sectionHeader">Close</header>
    </button>
    <div class="charactersheet-column-container">
        <div class="charactersheet-column">
            <div class="loading" *ngIf="still_loading()">Loading</div>
            <!--Management list mode-->
            <ng-container *ngIf="!get_TileMode()">
                <div class="list-item">
                    <button class="newrow" (click)="on_NewCharacter()">
                        New Character
                    </button>
                </div>
                <ng-container *ngIf="get_SavegamesInitializing()">
                    <div class="list-item">
                        <button class="newrow loading" disabled>
                            Connecting to database...
                        </button>
                    </div>
                </ng-container>
                <ng-container *ngIf="!get_SavegamesInitializing()">
                    <ng-container *ngIf="!get_Savegames()">
                        <div class="list-item">
                            <button class="newrow" (click)="on_RetryDatabaseConnection()">
                                Database connection failed - click to retry
                            </button>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="get_Savegames()">
                        <div class="list-item">
                            <button class="newrow" (click)="toggle_List('load')"
                                [ngClass]="{'activechoice':get_ShowList()=='load'}">
                                Load Character
                            </button>
                        </div>
                        <div class="list-item" *ngIf="!get_GMMode()">
                            <button class="newrow" (click)="save_CharacterToDB()" [disabled]="get_IsBlankCharacter()">
                                Save Character
                            </button>
                        </div>
                    </ng-container>
                </ng-container>
                <div class="list-item">
                    <button class="newrow" (click)="toggle_List('settings')"
                        [ngClass]="{'activechoice':get_ShowList()=='settings'}">
                        Settings
                    </button>
                </div>
                <div class="list-item">
                    <button class="newrow" (click)="toggle_List('licenses')"
                        [ngClass]="{'activechoice':get_ShowList()=='licenses'}">
                        Licenses
                    </button>
                </div>
            </ng-container>
            <!--Management tile mode-->
            <div class="newrow list-item" *ngIf="get_TileMode()">
                <div class="icon-list">
                    <button (click)="on_NewCharacter()">
                        <app-gridIcon [ngbTooltip]="'New Character'" [subTitle]="'New'" [superTitle]="'icon-bi-file-earmark-person'">
                        </app-gridIcon>
                    </button>
                    <ng-container *ngIf="get_SavegamesInitializing()">
                        <button disabled>
                            <app-gridIcon class="loading" [ngbTooltip]="'Connecting to database...'" [title]="'D B'"
                                [superTitle]="'icon-bi-arrow-repeat'">
                            </app-gridIcon>
                        </button>
                    </ng-container>
                    <ng-container *ngIf="!get_SavegamesInitializing()">
                        <ng-container *ngIf="!get_Savegames()">
                            <button (click)="on_RetryDatabaseConnection()">
                                <app-gridIcon [ngbTooltip]="'Database connection failed - click to retry'"
                                    [superTitle]="'icon-bi-arrow-repeat'">
                                </app-gridIcon>
                            </button>
                        </ng-container>
                        <ng-container *ngIf="get_Savegames()">
                            <button (click)="toggle_List('load')" [ngClass]="{'activechoice':get_ShowList()=='load'}">
                                <app-gridIcon [ngbTooltip]="'Load Character'" [subTitle]="'Load'"
                                    [superTitle]="'icon-bi-file-earmark-arrow-down'">
                                </app-gridIcon>
                            </button>
                            <button *ngIf="!get_GMMode()" (click)="save_CharacterToDB()"
                                [disabled]="get_IsBlankCharacter()">
                                <app-gridIcon
                                    [ngbTooltip]="get_IsBlankCharacter() ? 'No changes to character yet.' : 'Save Character'" [subTitle]="'Save'"
                                    [superTitle]="'icon-bi-file-earmark-arrow-up'">
                                </app-gridIcon>
                            </button>
                        </ng-container>
                    </ng-container>
                    <button (click)="toggle_List('settings')" [ngClass]="{'activechoice':get_ShowList()=='settings'}">
                        <app-gridIcon [ngbTooltip]="'Settings'" [subTitle]="'Settings'" [superTitle]="'icon-bi-gear'">
                        </app-gridIcon>
                    </button>
                    <button (click)="toggle_List('licenses')" [ngClass]="{'activechoice':get_ShowList()=='licenses'}">
                        <app-gridIcon [ngbTooltip]="'Licenses'" [subTitle]="'Licenses'" [superTitle]="'ยง'">
                        </app-gridIcon>
                    </button>
                </div>
            </div>
            <ng-container *ngIf="!still_loading() && get_CharacterMenuState() == 'in'">
                <div class="list-item">
                    <strong>Experience Points</strong>
                    <span>
                        <button (click)="on_LevelUp()"
                            *ngIf="get_Character().experiencePoints >= 1000 && get_Character().level < 20">Level
                            Up</button>
                        <input type="number" class="number4" id="experiencePoints"
                            [(ngModel)]="get_Character().experiencePoints" (keypress)="numbersOnly($event)"
                            maxLength="4"
                            [ngbTooltip]="(get_Character().experiencePoints >= 1000 && get_Character().level < 20) ? 'You are ready to level up!' : ''"
                            [ngClass]="{'bonus':(get_Character().experiencePoints >= 1000 && get_Character().level < 20)}">
                    </span>
                </div>
                <div class="list-item" *ngFor="let oldLevel of [get_Character().level]; trackBy:trackByIndex;">
                    <strong>
                        Level
                    </strong>
                    <span>
                        <select [(ngModel)]="get_Character().level" (ngModelChange)="on_LevelChange(oldLevel)">
                            <option
                                *ngFor="let level of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; trackBy:trackByIndex;"
                                [ngValue]="level">
                                {{level}}
                            </option>
                        </select>
                    </span>
                </div>
                <header class="subsectionHeader">Show Level</header>
                <!--Level selection-->
                <div class="list-item">
                    <div id="levelBox" class="fullwidth levelBoxTop">
                        <button class="center-aligned" (click)="toggle_Level(0)"
                            [ngClass]="{'fancy-button':get_ShowLevel()==0}">Everything</button>
                        <button class="center-aligned" (click)="toggle_Level(-1)"
                            [ngClass]="{'fancy-button':get_ShowLevel()==-1}">History</button>
                    </div>
                    <div id="levelBox" class="fullwidth">
                        <button class="center-aligned"
                            *ngFor="let levelNumber of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; trackBy:trackByIndex;"
                            (click)="toggle_Level(levelNumber)" [disabled]="!get_Character().class.name"
                            [ngClass]="{'fancy-button':get_ShowLevel()==levelNumber}">{{levelNumber}}</button>
                    </div>
                </div>
                <app-tags [creature]="'Character'" [objectName]="'Character'" [showTraits]=true [showFeats]=true
                    [showItems]=true [showActivities]=true [showConditions]=true></app-tags>
                <div class="vlist" [ngClass]="{'invisible':get_ShowLevel() > 0}">
                    <header class="sectionHeader">History</header>
                    <div class="list-item">
                        <strong>Name</strong>
                        <span>
                            <input type="text" id="charactername" [(ngModel)]="get_Character().name"
                                (blur)="on_NameChange()" maxLength="100">
                        </span>
                    </div>
                    <div class="list-item">
                        <div class="newrow">
                            <strong>Party name</strong>
                            <span>
                                <input type="text" id="partyname" [(ngModel)]="get_Character().partyName"
                                    maxLength="100">
                            </span>
                        </div>
                        <div class="newrow" *ngIf="get_Savegames()?.length">
                            <span></span>
                            <span>
                                <select [(ngModel)]="get_Character().partyName">
                                    <option *ngFor="let partyName of get_Parties(); trackBy:trackByIndex;"
                                        [ngValue]="partyName">
                                        {{partyName}}
                                    </option>
                                </select>
                            </span>
                        </div>
                    </div>
                    <div class="list-item">
                        <strong>
                            Alignment
                        </strong>
                        <span>
                            <select [(ngModel)]="get_Character().alignment" (ngModelChange)="on_AlignmentChange()">
                                <option *ngFor="let alignment of get_Alignments(); trackBy:trackByIndex;"
                                    [ngValue]="alignment">
                                    {{alignment}}
                                </option>
                            </select>
                        </span>
                    </div>
                    <!--Available Ancestry Feats-->
                    <div class="list-item fullsize-only" *ngIf="get_Character().class.ancestry.name">
                        <strong>Available Ancestry Feats</strong>
                        <div class="newrow left-aligned" *ngIf="get_Character().class.ancestry?.ancestries.length">
                            <cite class="trait"
                                *ngFor="let ancestry of get_Character().class.ancestry.ancestries; trackBy:trackByIndex;">
                                {{ancestry}}
                            </cite>
                        </div>
                    </div>
                    <!--History list mode-->
                    <ng-container *ngIf="!get_TileMode()">
                        <!--BaseValues-->
                        <div class="list-item">
                            <button class="newrow fancy-button"
                                [ngClass]="{'choicecleared':get_Character().baseValues.length, 'activechoice':get_ShowList()=='alternativeBaseValues'}"
                                (click)="toggle_List('alternativeBaseValues')">
                                Alternative Ability Values: {{(get_Character().baseValues.length) ? "Used" : "Not
                                Used"}}
                            </button>
                        </div>
                        <!--Class-->
                        <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.name}">
                            <button class="newrow"
                                [ngClass]="{'fancy-button choicecleared':get_Character().class.name, 'activechoice':get_ShowList()=='class'}"
                                (click)="toggle_List('class')">
                                Class{{(get_Character().class.name) ? ": "+ get_Character().class.name : ""}}
                            </button>
                        </div>
                        <!--Ancestry-->
                        <ng-container *ngIf="get_Character().class.name">
                            <div class="list-item list-header"
                                [ngClass]="{'fullsize-only':get_Character().class.ancestry.name}">
                                <button class="newrow"
                                    [ngClass]="{'fancy-button choicecleared':get_Character().class.ancestry.name, 'activechoice':get_ShowList()=='ancestry'}"
                                    (click)="toggle_List('ancestry')">
                                    Ancestry{{(get_Character().class.ancestry.name) ? ": "+
                                    get_Character().class.ancestry.name : ""}}
                                </button>
                            </div>
                        </ng-container>
                        <!--Heritage-->
                        <ng-container *ngIf="get_Character().class.ancestry.name">
                            <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.heritage.name}">
                                <button class="newrow"
                                    [ngClass]="{'fancy-button choicecleared':get_Character().class.heritage.name, 'activechoice':get_ShowList()=='heritage'}"
                                    (click)="toggle_List('heritage')">
                                    Heritage{{(get_Character().class.heritage.name) ? ": "+
                                    get_Character().class.heritage.name : ""}}
                                </button>
                            </div>
                        </ng-container>
                        <!--Languages-->
                        <ng-container
                            *ngFor="let currentLanguages of [get_CurrentLanguages(get_Character().level)]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let blankLanguages of [get_BlankLanguages(get_Character().level)]; trackBy:trackByIndex">
                                <div class="list-item" [ngClass]="{'fullsize-only':!blankLanguages}"
                                    *ngIf="get_LanguagesAvailable()">
                                    <button class="newrow"
                                        [ngClass]="{'fancy-button choicecleared':!blankLanguages, 'activechoice':get_ShowList()=='languages' && get_ShowContentLevelNumber()==get_Character().level}"
                                        (click)="toggle_List('languages', get_Character().level)">
                                        Languages
                                    </button>
                                </div>
                            </ng-container>
                        </ng-container>
                        <!--Background-->
                        <ng-container *ngIf="get_Character().class.name">
                            <div class="list-item"
                                [ngClass]="{'fullsize-only':(get_Character().class.background.name)}">
                                <button class="newrow"
                                    [ngClass]="{'fancy-button choicecleared':((get_Character().class.background.name)), 'activechoice':get_ShowList()=='background'}"
                                    (click)="toggle_List('background')">
                                    Background{{(get_Character().class.background.name) ? ": "+
                                    get_Character().class.background.name : ""}}
                                </button>
                            </div>
                        </ng-container>
                        <!--Deity-->
                        <ng-container *ngIf="get_Character().class.name">
                            <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.deity}">
                                <button class="newrow"
                                    [ngClass]="{'fancy-button choicecleared':get_Character().class.deity, 'activechoice':get_ShowList()=='deity'}"
                                    (click)="toggle_List('deity')">
                                    Deity{{get_Character().class.deity ? ": "+get_Character().class.deity : ""}}
                                </button>
                            </div>
                        </ng-container>
                    </ng-container>
                    <!--History tile mode-->
                    <div class="list-item icon-list" *ngIf="get_TileMode()">
                        <!--BaseValues-->
                        <button class="fancy-button"
                            [ngClass]="{'choicecleared':get_Character().baseValues.length, 'activechoice':get_ShowList()=='alternativeBaseValues'}"
                            (click)="toggle_List('alternativeBaseValues')">
                            <app-gridIcon class="fancy-button"
                                [ngbTooltip]="'Alternative Ability Values: ' + (get_Character().baseValues.length ? 'Used' : 'Not Used')"
                                [title]="'A B I'">
                            </app-gridIcon>
                        </button>
                        <!--Class-->
                        <button
                            [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.name, 'activechoice':get_ShowList()=='class'}"
                            (click)="toggle_List('class')">
                            <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.name}"
                                [ngbTooltip]="'Class' + (get_Character().class.name ? ': ' + get_Character().class.name : '')"
                                [title]="get_Character().class.name ? get_Character().class.name : 'C L A S'">
                            </app-gridIcon>
                        </button>
                        <!--Ancestry-->
                        <ng-container *ngIf="get_Character().class.name">
                            <button
                                [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.ancestry.name, 'activechoice':get_ShowList()=='ancestry'}"
                                (click)="toggle_List('ancestry')">
                                <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.ancestry.name}"
                                    [ngbTooltip]="'Ancestry' + (get_Character().class.ancestry.name ? ': ' + get_Character().class.ancestry.name : '')"
                                    [title]="get_Character().class.ancestry.name ? get_Character().class.ancestry.name : 'A N C E'">
                                </app-gridIcon>
                            </button>
                        </ng-container>
                        <!--Heritage-->
                        <ng-container *ngIf="get_Character().class.ancestry.name">
                            <button
                                [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.heritage.name, 'activechoice':get_ShowList()=='heritage'}"
                                (click)="toggle_List('heritage')">
                                <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.heritage.name}"
                                    [ngbTooltip]="'Heritage' + (get_Character().class.heritage.name ? ': ' + get_Character().class.heritage.name : '')"
                                    [title]="get_Character().class.heritage.name ? get_Character().class.heritage.name : 'H E R I'">
                                </app-gridIcon>
                            </button>
                        </ng-container>
                        <!--Languages-->
                        <ng-container
                            *ngFor="let currentLanguages of [get_CurrentLanguages(get_Character().level)]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let blankLanguages of [get_BlankLanguages(get_Character().level)]; trackBy:trackByIndex">
                                <button
                                    [ngClass]="{'fancy-button choicecleared fullsize-only':!blankLanguages, 'activechoice':get_ShowList()=='languages' && get_ShowContentLevelNumber()==get_Character().level}"
                                    (click)="toggle_List('languages', get_Character().level)"
                                    *ngIf="get_LanguagesAvailable()">
                                    <app-gridIcon [ngClass]="{'fancy-button':!blankLanguages}"
                                        [ngbTooltip]="'Languages'" [title]="'L A N G'"
                                        [superTitle]="currentLanguages.toString()">
                                    </app-gridIcon>
                                </button>
                            </ng-container>
                        </ng-container>
                        <!--Background-->
                        <ng-container *ngIf="get_Character().class.name">
                            <button
                                [ngClass]="{'fancy-button choicecleared fullsize-only':((get_Character().class.background.name)), 'activechoice':get_ShowList()=='background'}"
                                (click)="toggle_List('background')">
                                <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.background.name}"
                                    [ngbTooltip]="'Background' + (get_Character().class.background.name ? ': ' + get_Character().class.background.name : '')"
                                    [title]="get_Character().class.background.name ? get_Character().class.background.name : 'B A C K'">
                                </app-gridIcon>
                            </button>
                        </ng-container>
                        <!--Deity-->
                        <ng-container *ngIf="get_Character().class.name">
                            <button
                                [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.deity, 'activechoice':get_ShowList()=='deity'}"
                                (click)="toggle_List('deity')">
                                <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.deity}"
                                    [ngbTooltip]="'Deity' + (get_Character().class.deity ? ': ' + get_Character().class.deity : '')"
                                    [title]="get_Character().class.deity ? get_Character().class.deity : 'D E I T'">
                                </app-gridIcon>
                            </button>
                        </ng-container>
                    </div>
                </div>
                <!--Levels-->
                <ng-container *ngIf="get_Character().class">
                    <ng-container *ngFor="let level of get_Character().class.levels; trackBy:trackByIndex;">
                        <div
                            [ngClass]="{'invisible':!(level.number > 0 && [0,level.number].includes(get_ShowLevel())), 'vlist':!get_TileMode()}">
                            <header class="sectionHeader levelHeader" *ngIf="level.number > 0">Level
                                {{level.number}}</header>
                            <div [ngClass]="{'character-choice-grid':get_TileMode(), 'vlist':!get_TileMode()}">
                                <div [ngClass]="{'icon-list vertical':get_TileMode()}">
                                    <ng-container
                                        *ngFor="let fixedAbilityBoosts of [get_AbilityBoosts(level.number, level.number, '', '', '', '', true)]; trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let fixedSkillIncreases of [get_SkillIncreases(level.number, level.number, '', '', '', true)]; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let fixedFeats of [get_FeatsTaken(level.number, level.number, '', '', '', true, 'feat')]; trackBy:trackByIndex;">
                                                <ng-container
                                                    *ngFor="let fixedFeatures of [get_FeatsTaken(level.number, level.number, '', '', '', true, 'feature')]; trackBy:trackByIndex;">
                                                    <ng-container
                                                        *ngIf="fixedAbilityBoosts.length + fixedSkillIncreases.length + fixedFeatures.length + fixedFeats.length > 0">
                                                        <!--Fixed information list mode-->
                                                        <div class="fullsize-only list-item" *ngIf="!get_TileMode()">
                                                            <button class="newrow sublist-toggle fancy-button"
                                                                (click)="toggle_List('fixedchanges', level.number, {abilityBoosts:fixedAbilityBoosts, skillIncreases:fixedSkillIncreases, features:fixedFeatures, feats:fixedFeats})"
                                                                [ngClass]="{'activechoice':get_ShowList()=='fixedchanges' && get_ShowContentLevelNumber()==level.number}">
                                                                Show fixed changes
                                                            </button>
                                                        </div>
                                                        <!--Fixed information tile mode-->
                                                        <div class="fullsize-only" *ngIf="get_TileMode()">
                                                            <button
                                                                [ngClass]="{'fancy-button activechoice':get_ShowFixedChangesLevelNumber()==level.number}"
                                                                (click)="toggle_FixedChangesLevelNumber(level.number)">
                                                                <app-gridIcon
                                                                    [ngClass]="{'fancy-button':get_ShowFixedChangesLevelNumber()==level.number}"
                                                                    [ngbTooltip]="(get_ShowFixedChangesLevelNumber()==level.number ? 'Hide' : 'Show') + ' fixed changes'"
                                                                    [superTitle]="'icon-bi-lock-fill'">
                                                                </app-gridIcon>
                                                            </button>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                </div>
                                <!--Ability boosts-->
                                <div id="abilityboosts"
                                    [ngClass]="{'icon-list vertical':get_TileMode(), 'vlist':!get_TileMode()}">
                                    <!--Tile mode fixed ability boosts-->
                                    <ng-container
                                        *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                        <ng-container
                                            *ngFor="let boost of get_AbilityBoosts(level.number, level.number, '', '', '', '', true); trackBy:trackByIndex;">
                                            <ng-template #FixedAbilityBoostContent>
                                                <div class="newrow left-aligned">
                                                    <strong>{{boost.type == 'Flaw' ? 'Flaw' :
                                                        'Boost'}}</strong>
                                                    {{boost.name}}
                                                </div>
                                                <div class="newrow left-aligned">
                                                    <strong>Source</strong>
                                                    {{boost.source}}
                                                </div>
                                            </ng-template>
                                            <button class="fullsize-only inactive-button"
                                                #FixedAbilityPopover="ngbPopover"
                                                [ngbPopover]="FixedAbilityBoostContent" triggers="click">
                                                <app-gridIcon class="abilityboost"
                                                    [ngbTooltip]="!FixedAbilityPopover.isOpen() && ((boost.type == 'Flaw' ? 'Flaw: ' : 'Boost: ') + boost.name)"
                                                    [title]="boost.name" [superTitle]="'icon-bi-lock-fill'"
                                                    [detail]="(boost.type == 'Flaw' ? 'Flaw' : 'Boost')">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <ng-container *ngFor="let choice of level.abilityChoices; trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let maxAvailable of [get_MaxAvailable(choice)]; trackBy:trackByIndex;">
                                            <!--List mode ability boost buttons-->
                                            <div class="list-item" *ngIf="maxAvailable && !get_TileMode()"
                                                [ngClass]="{'problem':(choice.boosts.length > maxAvailable || someAbilitiesIllegal(choice, level.number)), 'fullsize-only':choice.boosts.length == maxAvailable}">
                                                <button class="newrow sublist-toggle abilityboost"
                                                    [ngClass]="{'fancy-button choicecleared':choice.boosts.length == maxAvailable, 'activechoice':get_ShowList()==choice.id}"
                                                    (click)="toggle_List(choice.id, level.number, choice)">
                                                    {{get_AbilityChoiceTitle(choice)}}
                                                </button>
                                            </div>
                                            <!--Tile mode ability boost buttons-->
                                            <button class="abilityboost" *ngIf="maxAvailable && get_TileMode()"
                                                (click)="toggle_List(choice.id, level.number, choice)"
                                                [ngClass]="{'problem':(choice.boosts.length > maxAvailable || someAbilitiesIllegal(choice, level.number)), 'fancy-button fullsize-only choicecleared':choice.boosts.length == maxAvailable, 'activechoice':get_ShowList()==choice.id}">
                                                <app-gridIcon class="abilityboost"
                                                    [ngbTooltip]="get_AbilityChoiceTitle(choice)" openDelay=100
                                                    [superTitle]="maxAvailable.toString()"
                                                    [title]="(maxAvailable == 1 && choice.boosts.length) ? choice.boosts[0].name : ((maxAvailable > 1 && choice.boosts.length > 0) ? choice.boosts.length.toString() : '')"
                                                    [ngClass]="{'fancy-button':choice.boosts.length == maxAvailable}">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                </div>
                                <!--Skill Increases-->
                                <div id="skillincreases"
                                    [ngClass]="{'icon-list vertical':get_TileMode(), 'vlist':!get_TileMode()}">
                                    <!--Tile mode fixed skill increases -->
                                    <ng-container
                                        *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                        <ng-container
                                            *ngFor="let skillIncrease of get_SkillIncreases(level.number, level.number, '', '', '', true); trackBy:trackByIndex;">
                                            <ng-template #FixedSkillIncreaseContent>
                                                <div class="newrow left-aligned">
                                                    <strong>{{skillIncrease.name}}</strong>
                                                </div>
                                                <div class="newrow left-aligned">
                                                    <strong>Source</strong>
                                                    {{skillIncrease.source}}
                                                </div>
                                            </ng-template>
                                            <button class="fullsize-only inactive-button"
                                                #FixedSkillPopover="ngbPopover" [ngbPopover]="FixedSkillIncreaseContent"
                                                triggers="click" triggers="click">
                                                <app-gridIcon class="skillincrease"
                                                    [ngbTooltip]="!FixedSkillPopover.isOpen() && skillIncrease.name"
                                                    [title]="skillIncrease.name" [superTitle]="'icon-bi-lock-fill'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Skill Choices handle tile mode internally-->
                                    <ng-container
                                        *ngFor="let choice of get_SkillChoices(level); let index = index; trackBy:trackByIndex;">
                                        <app-skillchoice (showSkillChoiceMessage)="receive_ChoiceMessage($event)"
                                            [choice]="choice" [showChoice]="get_ShowList()" [levelNumber]="level.number"
                                            [showContent]="false" [excludeTemporary]="true" [tileMode]="get_TileMode()">
                                        </app-skillchoice>
                                    </ng-container>
                                </div>
                                <!--Feat choices-->
                                <div id="featchoices"
                                    [ngClass]="{'icon-list vertical':get_TileMode(), 'vlist':!get_TileMode()}">
                                    <!--Tile mode fixed feats-->
                                    <ng-container
                                        *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                        <ng-container
                                            *ngFor="let feat of get_FeatsTaken(level.number, level.number, '', '', '', true, 'feat'); trackBy:trackByIndex;">
                                            <ng-template #FixedFeatContent>
                                                <header class="spellHeader">{{feat.name}}</header>
                                                <div class="newrow left-aligned">
                                                    <strong>Source</strong>
                                                    {{feat.source}}
                                                </div>
                                                <app-feat [feat]="get_FeatsAndFeatures(feat.name)[0]" [choice]="null"
                                                    [levelNumber]="level.number">
                                                </app-feat>
                                            </ng-template>
                                            <button class="fullsize-only inactive-button" #FixedFeatPopover="ngbPopover"
                                                [ngbPopover]="FixedFeatContent" triggers="click">
                                                <app-gridIcon class="featchoice"
                                                    [ngbTooltip]="!FixedFeatPopover.isOpen() && feat.name"
                                                    [title]="feat.name" [superTitle]="'icon-bi-lock-fill'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Feat Choices handle tile mode internally-->
                                    <ng-container
                                        *ngFor="let choice of get_FeatChoices(level, false); let index = index; trackBy:trackByIndex;">
                                        <app-featchoice (showFeatChoiceMessage)="receive_ChoiceMessage($event)"
                                            (showFeatMessage)="receive_FeatMessage($event)" [choice]="choice"
                                            [levelNumber]="level.number" [showContent]="false"
                                            [showFeat]="get_ShowItem()" [showChoice]="get_ShowList()"
                                            [unavailableFeats]="get_Character().settings.unavailableFeats"
                                            [lowerLevelFeats]="get_Character().settings.lowerLevelFeats"
                                            [higherLevelFeats]="get_Character().settings.higherLevelFeats"
                                            [archetypeFeats]="get_Character().settings.archetypeFeats"
                                            [tileMode]="get_TileMode()">
                                        </app-featchoice>
                                    </ng-container>
                                </div>
                                <!--Special choices-->
                                <div id="specialchoices"
                                    [ngClass]="{'icon-list vertical':get_TileMode(), 'vlist':!get_TileMode()}">
                                    <!--Tile mode fixed features-->
                                    <ng-container
                                        *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                        <ng-container
                                            *ngFor="let feature of get_FeatsTaken(level.number, level.number, '', '', '', true, 'feature'); trackBy:trackByIndex;">
                                            <ng-template #FixedFeatureContent>
                                                <header class="spellHeader">{{feature.name}}</header>
                                                <div class="newrow left-aligned">
                                                    <strong>Source</strong>
                                                    {{feature.source}}
                                                </div>
                                                <app-feat [feat]="get_FeatsAndFeatures(feature.name)[0]" [choice]="null"
                                                    [levelNumber]="level.number">
                                                </app-feat>
                                            </ng-template>
                                            <button class="fullsize-only inactive-button"
                                                #FixedFeaturePopover="ngbPopover" [ngbPopover]="FixedFeatureContent"
                                                triggers="click">
                                                <app-gridIcon class="specialchoice"
                                                    [ngbTooltip]="!FixedFeaturePopover.isOpen() && feature.name"
                                                    [title]="feature.name" [superTitle]="'icon-bi-lock-fill'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Languages - show if you have gained languages this level-->
                                    <ng-container *ngIf="level.number > 0 && get_LanguagesAvailable(level.number)">
                                        <ng-container
                                            *ngFor="let currentLanguages of [get_CurrentLanguages(level.number)]; trackBy:trackByIndex">
                                            <ng-container
                                                *ngFor="let blankLanguages of [get_BlankLanguages(level.number)]; trackBy:trackByIndex">
                                                <div class="list-item" *ngIf="!get_TileMode()"
                                                    [ngClass]="{'fullsize-only':!blankLanguages}">
                                                    <button class="newrow specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':!blankLanguages, 'activechoice':get_ShowList()=='languages' && get_ShowContentLevelNumber()==level.number}"
                                                        (click)="toggle_List('languages', level.number)">
                                                        Languages: {{currentLanguages -
                                                        blankLanguages}}/{{currentLanguages}}
                                                    </button>
                                                </div>
                                                <button class="specialchoice" *ngIf="get_TileMode()"
                                                    [ngClass]="{'fancy-button choicecleared fullsize-only':!blankLanguages, 'activechoice':get_ShowList()=='languages' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('languages', level.number)">
                                                    <app-gridIcon class="specialchoice"
                                                        [ngClass]="{'fancy-button':!blankLanguages}"
                                                        [ngbTooltip]="'Languages: ' + (currentLanguages - blankLanguages) + '/' + currentLanguages"
                                                        [title]="blankLanguages ? blankLanguages.toString() : currentLanguages.toString()"
                                                        [superTitle]="'icon-ra ra-speech-bubbles'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                    <!--"Specialchoice" feat choices (feats handle tile mode internally)-->
                                    <ng-container
                                        *ngFor="let choice of get_FeatChoices(level, true); let index = index; trackBy:trackByIndex;">
                                        <app-featchoice (showFeatChoiceMessage)="receive_ChoiceMessage($event)"
                                            (showFeatMessage)="receive_FeatMessage($event)" [choice]="choice"
                                            [levelNumber]="level.number" [showContent]="false"
                                            [showFeat]="get_ShowItem()" [showChoice]="get_ShowList()"
                                            [unavailableFeats]="get_Character().settings.unavailableFeats"
                                            [lowerLevelFeats]="get_Character().settings.lowerLevelFeats"
                                            [higherLevelFeats]="get_Character().settings.higherLevelFeats"
                                            [archetypeFeats]="get_Character().settings.archetypeFeats"
                                            [tileMode]="get_TileMode()">
                                        </app-featchoice>
                                    </ng-container>
                                    <!--Animal Companion-->
                                    <ng-container *ngIf="get_CompanionAvailable(level.number)">
                                        <ng-container *ngFor="let companion of [get_Companion()]; trackBy:trackByIndex">
                                            <div class="list-item" *ngIf="!get_TileMode()"
                                                [ngClass]="{'fullsize-only':(companion.name && companion.species && companion.class.ancestry.name)}">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':(companion.name && companion.species && companion.class.ancestry.name), 'activechoice':get_ShowList()=='animalcompanion' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('animalcompanion', level.number)">
                                                    Animal Companion{{(companion.class.ancestry.name) ? ": "+
                                                    companion.class.ancestry.name : ""}}
                                                </button>
                                            </div>
                                            <button class="specialchoice" *ngIf="get_TileMode()"
                                                [ngClass]="{'fancy-button choicecleared fullsize-only':(companion.name && companion.species && companion.class.ancestry.name), 'activechoice':get_ShowList()=='animalcompanion' && get_ShowContentLevelNumber()==level.number}"
                                                (click)="toggle_List('animalcompanion', level.number)">
                                                <app-gridIcon class="specialchoice"
                                                    [ngClass]="{'fancy-button':(companion.name && companion.species && companion.class.ancestry.name)}"
                                                    [ngbTooltip]="'Animal Companion' + ((companion.class.ancestry.name) ? ': ' + companion.class.ancestry.name : '')"
                                                    [title]="companion.class.ancestry.name || ''"
                                                    [superTitle]="'icon-ra ra-wolf-howl'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Animal Specializations-->
                                    <ng-container *ngIf="get_CompanionSpecializationsAvailable(level.number)">
                                        <ng-container
                                            *ngFor="let available of [get_CompanionSpecializationsAvailable(level.number)]; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let takenSpecializations of [get_TakenCompanionSpecializations(level.number)]; trackBy:trackByIndex">
                                                <div class="list-item" *ngIf="!get_TileMode()"
                                                    [ngClass]="{'fullsize-only':takenSpecializations.length == available}">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':(takenSpecializations.length == available), 'activechoice':get_ShowList()=='companionspecialization' && get_ShowContentLevelNumber()==level.number}"
                                                        (click)="toggle_List('companionspecialization', level.number)">
                                                        Animal Companion Specialization{{available > 1 ? ": "+
                                                        takenSpecializations.length +"/"+ available :
                                                        (takenSpecializations.length == 1) ? ": "+
                                                        takenSpecializations[0] : ""}}
                                                    </button>
                                                </div>
                                                <button class="specialchoice" *ngIf="get_TileMode()"
                                                    [ngClass]="{'fancy-button choicecleared fullsize-only':(takenSpecializations.length == available), 'activechoice':get_ShowList()=='companionspecialization' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('companionspecialization', level.number)">
                                                    <app-gridIcon class="specialchoice"
                                                        [ngClass]="{'fancy-button':(takenSpecializations.length == available)}"
                                                        [ngbTooltip]="'Animal Companion Specialization' + (available > 1 ? ': ' + takenSpecializations.length + '/' + available : (takenSpecializations.length == 1 ? ': ' + takenSpecializations[0] : ''))"
                                                        [title]="(available > 1) ? takenSpecializations.length.toString() + '/' + available.toString() : (takenSpecializations.length ? takenSpecializations[0] : '')"
                                                        [superTitle]="'icon-ra ra-love-howl'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                    <!--Familiar-->
                                    <ng-container *ngIf="get_FamiliarAvailable(level.number)">
                                        <ng-container
                                            *ngFor="let finished of [get_Familiar().name && get_Familiar().species]; trackBy:trackByIndex;">
                                            <div class="list-item" *ngIf="!get_TileMode()"
                                                [ngClass]="{'fullsize-only':finished}">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':finished, 'activechoice':get_ShowList()=='familiar' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('familiar', level.number)">
                                                    Familiar
                                                </button>
                                            </div>
                                            <button class="specialchoice" *ngIf="get_TileMode()"
                                                [ngClass]="{'fancy-button choicecleared fullsize-only':finished, 'activechoice':get_ShowList()=='familiar' && get_ShowContentLevelNumber()==level.number}"
                                                (click)="toggle_List('familiar', level.number)">
                                                <app-gridIcon class="specialchoice"
                                                    [ngClass]="{'fancy-button':finished}" [ngbTooltip]="'Familiar'"
                                                    [superTitle]="'icon-ra ra-raven'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Different Worlds-->
                                    <ng-container
                                        *ngFor="let differentWorldsFeat of get_DifferentWorldsFeat(level.number); trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let finished of [differentWorldsFeat.data.name && differentWorldsFeat.data.background]; trackBy:trackByIndex;">
                                            <!--Different Worlds-->
                                            <div class="list-item" *ngIf="!get_TileMode()"
                                                [ngClass]="{'fullsize-only':finished}">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':finished, 'activechoice':get_ShowList()=='differentworlds' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('differentworlds', level.number)">
                                                    Different Worlds{{(differentWorldsFeat.data.background) ? ": " +
                                                    differentWorldsFeat.data.background : ""}}
                                                </button>
                                            </div>
                                            <button class="specialchoice" *ngIf="get_TileMode()"
                                                [ngClass]="{'fancy-button choicecleared fullsize-only':finished, 'activechoice':get_ShowList()=='differentworlds' && get_ShowContentLevelNumber()==level.number}"
                                                (click)="toggle_List('differentworlds', level.number)">
                                                <app-gridIcon class="specialchoice"
                                                    [ngClass]="{'fancy-button':finished}"
                                                    [ngbTooltip]="'Different Worlds' + (differentWorldsFeat.data.background ? ': ' + differentWorldsFeat.data.background : '')"
                                                    [title]="differentWorldsFeat.data.background"
                                                    [superTitle]="'icon-ra ra-arcane-mask'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Blessed Blood-->
                                    <ng-container *ngIf="get_BlessedBloodFeat(level.number)">
                                        <ng-container
                                            *ngFor="let blessedBloodSpells of [get_BlessedBloodSpells()]; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let finished of [blessedBloodSpells >= 3]; trackBy:trackByIndex;">
                                                <div class="list-item" *ngIf="!get_TileMode()"
                                                    [ngClass]="{'fullsize-only':finished}">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':finished, 'activechoice':get_ShowList()=='blessedblood' && get_ShowContentLevelNumber()==level.number}"
                                                        (click)="toggle_List('blessedblood', level.number)">
                                                        Blessed Blood Deity Spells: {{blessedBloodSpells}}/3
                                                    </button>
                                                </div>
                                                <button class="specialchoice" *ngIf="get_TileMode()"
                                                    [ngClass]="{'fancy-button choicecleared fullsize-only':finished, 'activechoice':get_ShowList()=='blessedblood' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('blessedblood', level.number)">
                                                    <app-gridIcon class="specialchoice"
                                                        [ngClass]="{'fancy-button':finished}"
                                                        [ngbTooltip]="'Blessed Blood Deity Spells: ' + blessedBloodSpells.toString() + '/3'"
                                                        [title]="finished ? '3' : blessedBloodSpells.toString() + '/3'"
                                                        [superTitle]="'icon-ra ra-burning-eye'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                    <!--Additional Heritages-->
                                    <ng-container
                                        *ngFor="let heritageGain of get_AdditionalHeritagesAvailable(level.number); trackBy:trackByIndex">
                                        <ng-container
                                            *ngFor="let heritageIndex of get_AdditionalHeritageIndex(heritageGain.source); trackBy:trackByIndex">
                                            <ng-container
                                                *ngFor="let finished of [get_Character().class.additionalHeritages[heritageIndex].name]; trackBy:trackByIndex">
                                                <div class="list-item" *ngIf="!get_TileMode()"
                                                    [ngClass]="{'fullsize-only':finished}">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':get_Character().class.additionalHeritages[heritageIndex].name, 'activechoice':get_ShowList()=='additionalheritage' && get_ShowContentLevelNumber()==level.number && this.get_ShowContent()?.id==heritageGain.source}"
                                                        (click)="toggle_List('additionalheritages', level.number, {id: 'additionalheritage'+level.number+heritageGain.source, source: heritageGain.source})">
                                                        Heritage
                                                        ({{heritageGain.source}}){{finished ? ": "+
                                                        get_Character().class.additionalHeritages[heritageIndex].name
                                                        : ""}}
                                                    </button>
                                                </div>
                                                <button class="specialchoice" *ngIf="get_TileMode()"
                                                    [ngClass]="{'fancy-button choicecleared fullsize-only':finished, 'activechoice':get_ShowList()=='additionalheritage' && get_ShowContentLevelNumber()==level.number && this.get_ShowContent()?.id==heritageGain.source}"
                                                    (click)="toggle_List('additionalheritages', level.number, {id: 'additionalheritage'+level.number+heritageGain.source, source: heritageGain.source})">
                                                    <app-gridIcon class="specialchoice"
                                                        [ngClass]="{'fancy-button':finished}"
                                                        [ngbTooltip]="'Heritage (' + heritageGain.source + ')' + (finished ? ': ' + get_Character().class.additionalHeritages[heritageIndex].name : '')"
                                                        [title]="finished ? get_Character().class.additionalHeritages[heritageIndex].name : ''"
                                                        [superTitle]="'icon-ra ra-sprout-emblem'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                    <!--Fuse Stance-->
                                    <ng-container
                                        *ngFor="let feat of get_FuseStanceFeat(level.number); trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let finished of [feat.data.stances.length == 2 && feat.data.name]; trackBy:trackByIndex">
                                            <div class="list-item" *ngIf="!get_TileMode()"
                                                [ngClass]="{'fullsize-only':finished}">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':finished, 'activechoice':get_ShowList()=='fusestance' && get_ShowContentLevelNumber()==level.number}"
                                                    (click)="toggle_List('fusestance', level.number)">
                                                    Fuse Stance{{(finished) ? ": "+
                                                    feat.data.name + " (" + feat.data.stances.join(', ') + ")" :
                                                    ""}}
                                                </button>
                                            </div>
                                            <button class="specialchoice" *ngIf="get_TileMode()"
                                                [ngClass]="{'fancy-button choicecleared fullsize-only':finished, 'activechoice':get_ShowList()=='fusestance' && get_ShowContentLevelNumber()==level.number}"
                                                (click)="toggle_List('fusestance', level.number)">
                                                <app-gridIcon class="specialchoice"
                                                    [ngClass]="{'fancy-button':finished}"
                                                    [ngbTooltip]="'Fuse Stance' + (finished ? ': ' + feat.data.name + ' (' + feat.data.stances.join(', ') + ')' : '')"
                                                    [title]="finished ? feat.data.name : ''"
                                                    [superTitle]="'icon-ra ra-double-team'">
                                                </app-gridIcon>
                                            </button>
                                        </ng-container>
                                    </ng-container>
                                    <!--Lore Training-->
                                    <ng-container *ngFor="let choice of level.loreChoices; trackBy:trackByIndex;">
                                        <div class="list-item" *ngIf="choice.available && !get_TileMode()"
                                            [ngClass]="{'problem':(choice.increases.length > choice.available), 'fullsize-only':choice.increases.length == choice.available}">
                                            <button class="newrow sublist-toggle specialchoice"
                                                [ngClass]="{'fancy-button choicecleared':choice.increases.length == choice.available, 'activechoice':get_ShowList()==choice.id}"
                                                (click)="toggle_List(choice.id, level.number, choice)">
                                                Lore Training
                                                ({{choice.source}}){{(choice.increases.length) ? ": "+
                                                choice.increases[0].name : ""}}
                                            </button>
                                        </div>
                                        <button class="specialchoice" *ngIf="choice.available && get_TileMode()"
                                            [ngClass]="{'fancy-button choicecleared fullsize-only':choice.increases.length == choice.available, 'activechoice':get_ShowList()=='choice.id'}"
                                            (click)="toggle_List(choice.id, level.number, choice)">
                                            <app-gridIcon class="specialchoice"
                                                [ngClass]="{'fancy-button':choice.increases.length == choice.available}"
                                                [ngbTooltip]="'Lore Training (' + choice.source + ')' + ((choice.increases.length) ? ': ' + choice.loreName : '')"
                                                [title]="choice.increases.length == choice.available ? choice.loreName : ''"
                                                [superTitle]="'icon-ra ra-book'">
                                            </app-gridIcon>
                                        </button>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-container>
        </div>
        <div class="charactersheet-column">
            <div id="character-choiceArea-top" style="margin-top:-.3em"></div>
            <!--Choice content and templates-->
            <!--Load character content-->
            <ng-container *ngIf="get_ShowList()=='load'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">Load Character</header>
                </div>
                <div id="choiceArea" class="list-item">
                    <div class="list-item" *ngIf="get_Savegames() && !get_Savegames().length">
                        No characters available in database.
                    </div>
                    <div class="list-item" *ngIf="!get_Savegames()">
                        Database connection failed.
                    </div>
                    <div *ngIf="get_Savegames() && get_Savegames().length" class="list-item gridicon-fullsizebox">
                        <input class="character-choice" id="loadAsGM" type="checkbox" [(ngModel)]="loadAsGM">
                        <span>
                            <label for="loadAsGM">
                                <strong>
                                    Load character as GM
                                </strong>
                            </label>
                            <i class="bi-question-circle"
                                [ngbPopover]="'Open the character in a read-only mode where it can\'t be saved and can\'t send or receive effects to or from other players.'"></i>
                        </span>
                    </div>
                    <ng-container
                        *ngFor="let savegame of (get_Savegames() || []); let index = index; trackBy:trackByIndex;">
                        <ng-template #SavegameDeleteModal let-modal>
                            <div class="modal-header">
                                <header class="sectionHeader modal-title" id="modal-title">Delete Character
                                </header>
                                <button type="button" class="close" aria-label="close"
                                    (click)="modal.dismiss('Cross click')" ngbAutofocus>
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body vlist">
                                <p>Are you sure you want to delete <strong>{{savegame.name}}</strong>?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary"
                                    (click)="modal.dismiss('Cancel click')">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-danger" (click)="modal.close('Ok click')">
                                    Ok
                                </button>
                            </div>
                        </ng-template>
                        <header class="sectionHeader center-aligned"
                            *ngIf="index == 0 || savegame.partyName != get_Savegames()[index-1].partyName">
                            {{savegame.partyName}}</header>
                        <div class="list-item newrow">
                            <span>
                                <strong>{{savegame.name}}</strong> Level {{savegame.level}}
                                <span>{{get_SavegameTitle(savegame)}}</span>
                            </span>
                            <span style="flex-basis: auto; flex-grow: 0;">
                                <button (click)="load_CharacterFromDB(savegame)">
                                    Load{{loadAsGM ? " as GM" : ""}}
                                </button>
                                <button style="margin-left: .3em;"
                                    (click)="open_DeleteModal(SavegameDeleteModal, savegame)">
                                    Delete
                                </button>
                            </span>
                        </div>
                    </ng-container>
                </div>
            </ng-container>
            <!--Settings-->
            <ng-container *ngIf="get_ShowList()=='settings'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">Settings</header>
                </div>
                <div id="choiceArea" class="list-item">
                    <div class="list-item">
                        <strong>Look</strong>
                        <div class="list-item gridicon-fullsizebox">
                            <input id="accent" type="color" class="character-choice" id="coloraccent"
                                style="padding:0 2px" [(ngModel)]="get_Character().settings.accent"
                                (ngModelChange)="set_Accent()" maxLength="7">
                            <label for="accent">
                                <strong>
                                    Color Accent
                                </strong>
                            </label>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input id="darkmode" class="character-choice" type="checkbox"
                                [(ngModel)]="get_Character().settings.darkmode" (ngModelChange)="set_Darkmode()">
                            <label for="darkmode">
                                <strong>
                                    Dark mode
                                </strong>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <strong>Tags</strong>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="hintsShowMoreInformation" type="checkbox"
                                [(ngModel)]="get_Character().settings.hintsShowMoreInformation">
                            <label for="hintsShowMoreInformation">
                                <strong>
                                    Clicking a tag shows additional information, if available
                                </strong>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <strong>Choices</strong>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="autoCloseChoices" type="checkbox"
                                [(ngModel)]="get_Character().settings.autoCloseChoices">
                            <label for="autoCloseChoices">
                                <strong>
                                    Automatically close choices when they are finished
                                </strong>
                            </label>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="showOtherOptions" type="checkbox"
                                [(ngModel)]="get_Character().settings.showOtherOptions">
                            <label for="showOtherOptions">
                                <strong>
                                    Keep showing the other options in finished choices
                                </strong>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <strong>Feats</strong>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="unavailableFeats" type="checkbox"
                                [(ngModel)]="get_Character().settings.unavailableFeats">
                            <label for="unavailableFeats">
                                <strong>
                                    Show unavailable feats
                                </strong>
                            </label>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="lowerLevelFeats" type="checkbox"
                                [(ngModel)]="get_Character().settings.lowerLevelFeats">
                            <label for="lowerLevelFeats">
                                <strong>
                                    Show lower level feats
                                </strong>
                            </label>
                        </div>
                        <div class="fullwidth" [ngbCollapse]="!get_Character().settings.unavailableFeats">
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="higherLevelFeats" type="checkbox"
                                    [(ngModel)]="get_Character().settings.higherLevelFeats">
                                <label for="higherLevelFeats">
                                    <strong>
                                        Show higher level feats
                                    </strong>
                                </label>
                            </div>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="archetypeFeats" type="checkbox"
                                [(ngModel)]="get_Character().settings.archetypeFeats">
                            <label for="archetypeFeats">
                                <strong>
                                    Show archetype feats
                                </strong>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <strong>Spells</strong>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="showHeightenedSpells" type="checkbox"
                                [(ngModel)]="get_Character().settings.showHeightenedSpells">
                            <label for="showHeightenedSpells">
                                <strong>
                                    Show heightened spells in spell choices
                                </strong>
                            </label>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="noFriendlyCasterConditions" type="checkbox"
                                [(ngModel)]="get_Character().settings.noFriendlyCasterConditions"
                                (ngModelChange)="on_UpdateSpellbook()">
                            <span>
                                <label for="noFriendlyCasterConditions">
                                    <strong>
                                        Avoid informational caster
                                        conditions for friendly spells
                                    </strong>
                                </label>
                                <i class="bi-question-circle"
                                    [ngbPopover]="'When casting targeted spells with a duration, the caster will receive a condition that gives information about the effect and tracks the duration. This option will disable these caster conditions for friendly spells if they have no effect on the caster.'"></i>
                            </span>
                        </div>
                        <div class="fullwidth" [ngbCollapse]="!get_Character().settings.unavailableFeats">
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="noHostileCasterConditions" type="checkbox"
                                    [(ngModel)]="get_Character().settings.noHostileCasterConditions"
                                    (ngModelChange)="on_UpdateSpellbook()">
                                <span>
                                    <label for="noHostileCasterConditions">
                                        <strong>
                                            Avoid informational caster conditions for hostile spells
                                        </strong>
                                    </label>
                                    <i class="bi-question-circle"
                                        [ngbPopover]="'When casting targeted spells with a duration, the caster will receive a condition that gives information about the effect and tracks the duration. This option will disable these caster conditions for hostile spells if they have no effect on the caster.'"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="list-item">
                        <strong>Automation</strong>
                        <ng-template #ManualModeDescription>
                            <p>
                                Manual mode is for players who want more control over their attributes, or just need
                                to restore a spell quickly. Many automatic and temporary effects are disabled in manual
                                mode, and buttons are added that allow you to change them yourself. The main differences
                                are listed below:
                            </p>
                            <header class="subsectionHeader">Conditions and effects</header>
                            <ul>
                                <li>
                                    Most mechanisms that would add conditions are disabled in manual mode. Conditions
                                    can be added manually from the conditions menu, including those that would normally
                                    be caused by activities, spells or items.
                                </li>
                                <li>
                                    Any conditions that remain or are added manually still cause effects.
                                </li>
                                <li>
                                    Conditions can still end automatically with time or through other factors, for
                                    example by decreasing their value every turn.
                                </li>
                                <li>
                                    Any custom effects still apply.
                                </li>
                                <li>
                                    Hints can still be activated and will then grant their respective effects.
                                </li>
                                <li>
                                    You cannot send or receive any conditions and effects to or from other players.
                                </li>
                            </ul>
                            <header class="subsectionHeader">Activities</header>
                            <ul>
                                <li>
                                    Activities do not cause conditions or one-time effects (like temporary Hit Points).
                                </li>
                                <li>
                                    Activities do not cast spells.
                                </li>
                                <li>
                                    Because activities don't cause conditions or cast spells, you cannot select a target
                                    for an activity.
                                </li>
                                <li>
                                    Activities still grant items on activation (like extra attacks or transformed
                                    weapons).
                                </li>
                                <li>
                                    Activities use charges and go into cooldown. Charges can be restored and cooldown
                                    can be cancelled with a button.
                                </li>
                            </ul>
                            <header class="subsectionHeader">Items</header>
                            <ul>
                                <li>
                                    Consumables do not cause conditions or one-time effects, and do not grant other
                                    items when activated (like extra attacks).
                                </li>
                                <li>
                                    Consumables do not cast spells.
                                </li>
                                <li>
                                    Because consumables don't cause conditions or cast spells, you cannot select a
                                    target for them.
                                </li>
                                <li>
                                    Activities on items can be activated and act according to the above description.
                                </li>
                                <li>
                                    Equipped and invested items still grant abilities, bonuses and penalties.
                                </li>
                                <li>
                                    Being encumbered does not cause the Encumbered condition.
                                </li>
                            </ul>
                            <header class="subsectionHeader">Spells</header>
                            <ul>
                                <li>
                                    Spells do not cause conditions. Because all effects of a spell come from the
                                    conditions it causes, they don't cause any one-time effects, grant any items or
                                    senses or apply any bonuses or penalties.
                                </li>
                                <li>
                                    Because spells have no effects, you cannot select a target for them.
                                </li>
                                <li>
                                    Spells use up spell slots and focus points, and prepared spells get used up. Buttons
                                    are added to reprepare spells and restore spell slots and focus points.
                                </li>
                                <li>
                                    Spells can still go into cooldown, which can be cancelled with a button.
                                </li>
                                <li>
                                    Casting spells does not trigger bloodline powers in sorcerers.
                                </li>
                            </ul>
                            <header class="subsectionHeader">Health</header>
                            <ul>
                                <li>
                                    The wounded and dying value is not tied to a condition. You can manually change both
                                    values with new buttons.
                                </li>
                                <li>
                                    Being reduced to 0 Hit Points does not cause the Dying or Unconscious conditions,
                                    and being healed from 0 Hit points does not end them.
                                </li>
                            </ul>
                            <header class="subsectionHeader">Feats</header>
                            <ul>
                                <li>
                                    Feats are unchanged, as their effects are not temporary.
                                </li>
                                <li>
                                    Feats still cause conditions and effects, and apply one-time effects when you take
                                    them.
                                </li>
                            </ul>
                        </ng-template>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="manualMode" type="checkbox"
                                [(ngModel)]="get_Character().settings.manualMode"
                                (change)="on_ManualMode($event.target.checked)">
                            <span>
                                <label for="manualMode">
                                    <strong>
                                        Use manual mode
                                    </strong>
                                </label>
                                <i *ngIf="!get_Character().settings.manualMode" class="bi-question-circle"
                                    [ngbPopover]="ManualModeDescription" autoClose=false triggers="click"></i>
                            </span>
                        </div>
                        <div class="fullwidth" [ngbCollapse]="!get_Character().settings.manualMode">
                            <div class="lower">
                                <ng-container *ngTemplateOutlet="ManualModeDescription"></ng-container>
                            </div>
                        </div>
                        <div class="fullwidth vlist" [ngbCollapse]="get_Character().settings.manualMode">
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="checkMessagesAutomatically" type="checkbox"
                                    [(ngModel)]="get_Character().settings.checkMessagesAutomatically"
                                    (change)="on_CheckMessagesAutomaticallyChange($event.target.checked)">
                                <label for="checkMessagesAutomatically">
                                    <strong>
                                        Check for new effects from other party members every 5 seconds
                                    </strong>
                                </label>
                            </div>
                            <div class="fullwidth" [ngbCollapse]="!get_Character().settings.checkMessagesAutomatically">
                                <div class="list-item gridicon-fullsizebox">
                                    <input class="character-choice" id="applyMessagesAutomatically" type="checkbox"
                                        [(ngModel)]="get_Character().settings.applyMessagesAutomatically">
                                    <span>
                                        <label for="applyMessagesAutomatically">
                                            <strong>
                                                Automatically apply new effects
                                            </strong>
                                        </label>
                                        <i class="bi-question-circle"
                                            [ngbPopover]="'While automatically checking for new effects, all found effects are immediately applied. You will not be able to select which effects to keep.'"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="sendTurnStartMessage" type="checkbox"
                                    [(ngModel)]="get_Character().settings.sendTurnStartMessage">
                                <span>
                                    <label for="sendTurnStartMessage">
                                        <strong>
                                            Send an event to your party when your turn starts
                                        </strong>
                                    </label>
                                    <i class="bi-question-circle"
                                        [ngbPopover]="'If you have given any conditions to your party members that end on your turn, sending this event will end these conditions on their side. The other players still need to check for effects manually or automatically if they want to benefit from this function.'"></i>
                                </span>
                            </div>
                            <div class="fullwidth" [ngbCollapse]="!get_Character().settings.sendTurnStartMessage">
                                <div class="list-item gridicon-fullsizebox">
                                    <input class="character-choice" id="sendTurnEndMessage" type="checkbox"
                                        [(ngModel)]="get_Character().settings.sendTurnEndMessage">
                                    <label for="sendTurnEndMessage">
                                        <strong>
                                            Send event when your turn ends instead (experimental)
                                        </strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
            <!--History content-->
            <!--Alternative Ability Values content-->
            <ng-container *ngIf="get_ShowList()=='alternativeBaseValues'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">Alternative Ability Values:
                        {{get_Character().baseValues.length ? 'Used' : 'Not used'}}</header>
                </div>
                <div id="choiceArea" class="list-item">
                    <div class="list-item">
                        <p>
                            You can roll your own ability scores and enter them here. If you use these values, your
                            character gets one fewer free ability boosts than normal from their ancestry and from
                            their background. These ability boosts cannot raise a score above 18. If this would happen,
                            you can put the ability boost into another ability score instead, as if it were a free
                            ability boost. The character does not get any more free ability boosts on level 1.
                        </p>
                    </div>
                    <div class="list-item gridicon-fullsizebox">
                        <input id="useAlternativeBaseValues" class="character-choice" type="checkbox"
                            (change)="on_BaseValueChange()" [checked]="get_Character().baseValues.length">
                        <label for="useAlternativeBaseValues">
                            <strong>Enter your own Ability scores</strong>
                        </label>
                    </div>
                    <div class="list-item gridicon-fullsizebox"
                        *ngFor="let ability of get_Character().baseValues; trackBy:trackByIndex;">
                        <input type="number" class="number2" [(ngModel)]="ability.baseValue"
                            (blur)="on_AbilityChange(ability.name)" maxlength="2" (keypress)="numbersOnly($event)">
                        <strong>{{ability.name}}</strong>
                    </div>
                </div>
            </ng-container>
            <!--Class choice content-->
            <ng-container *ngIf="get_ShowList()=='class'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Class{{(get_Character().class.name) ? ": "+ get_Character().class.name : ""}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <ng-container *ngFor="let class of get_AvailableClasses(); trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let checked of [class.name === get_Character().class.name]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let disabled of [get_Character().class.name && (class.name != get_Character().class.name)]; trackBy:trackByIndex">
                                <ng-template #ClassChoiceDetailsTemplate>
                                    <header class="spellHeader">{{class.name}}</header>
                                    <div class="button newrow no-animation" *ngIf="!disabled"
                                        [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                        <label>
                                            <input type="checkbox"
                                                (change)="onClassChange(class, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                            "Remove" :
                                            "Choose"}}
                                        </label>
                                    </div>
                                    <div class="newrow left-aligned tags">
                                        <cite class="trait" *ngFor="let trait of class.traits; trackBy:trackByIndex;"
                                            [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                    </div>
                                    <div class="newrow left-aligned" *ngIf="class.sourceBook">
                                        <strong>Source</strong>
                                        <i>{{class.sourceBook}}</i>
                                    </div>
                                    <div class="newrow left-aligned"
                                        *ngFor="let desc of class.desc; trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let text of desc.value.split('\n\n'); let textIndex = index; trackBy:trackByIndex;">
                                            <header class="featureHeader" *ngIf="textIndex == 0">{{desc.name}}
                                            </header>
                                            <p *ngIf="text.split('\n').length == 1">
                                                {{text}}
                                            </p>
                                            <ul *ngIf="text.split('\n').length > 1">
                                                <li *ngFor="let line of text.split('\n'); trackBy:trackByIndex;">
                                                    {{line}}
                                                </li>
                                            </ul>
                                        </ng-container>
                                    </div>
                                </ng-template>
                                <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':checked}">
                                    <input id="{{class.name}}" type="checkbox" class="character-choice"
                                        (change)="onClassChange(class, $event.target.checked)" [checked]="checked"
                                        [disabled]="disabled">
                                    <div class="gridicon-fullsizebox" [ngbPopover]="ClassChoiceDetailsTemplate"
                                        triggers="click">
                                        <app-gridIcon [title]="class.name"></app-gridIcon>
                                        <header class="sectionHeader">
                                            <span>
                                                {{class.name}}
                                            </span>
                                        </header>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <!--Ancestry choice content-->
            <ng-container *ngIf="get_ShowList()=='ancestry'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Ancestry{{(get_Character().class.ancestry.name) ? ": "+ get_Character().class.ancestry.name
                        : ""}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <ng-container *ngFor="let ancestry of get_AvailableAncestries(); trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let checked of [ancestry.name === get_Character().class.ancestry.name]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let disabled of [get_Character().class.ancestry.name && (ancestry.name != get_Character().class.ancestry.name)]; trackBy:trackByIndex">
                                <ng-template #AncestryChoiceDetailsTemplate>
                                    <header class="spellHeader">{{ancestry.name}}</header>
                                    <div class="button newrow no-animation" *ngIf="!disabled"
                                        [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                        <label>
                                            <input type="checkbox"
                                                (change)="onAncestryChange(ancestry, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                            "Remove" : "Choose"}}
                                        </label>
                                    </div>
                                    <div class="newrow left-aligned tags">
                                        <cite class="trait" *ngFor="let trait of ancestry.traits; trackBy:trackByIndex;"
                                            [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                    </div>
                                    <div class="newrow left-aligned" *ngIf="ancestry.sourceBook">
                                        <strong>Source</strong>
                                        <i>{{ancestry.sourceBook}}</i>
                                    </div>
                                    <div class="newrow left-aligned"
                                        *ngFor="let desc of ancestry.desc; trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let text of desc.value.split('\n\n'); let textIndex = index; trackBy:trackByIndex;">
                                            <header class="featureHeader" *ngIf="textIndex == 0">
                                                {{desc.name}}
                                            </header>
                                            <p *ngIf="text.split('\n').length == 1">
                                                {{text}}
                                            </p>
                                            <ul *ngIf="text.split('\n').length > 1">
                                                <li *ngFor="let line of text.split('\n'); trackBy:trackByIndex;">
                                                    {{line}}
                                                </li>
                                            </ul>
                                        </ng-container>
                                    </div>
                                </ng-template>
                                <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':checked}">
                                    <input id="{{ancestry.name}}" type="checkbox" class="character-choice"
                                        (change)="onAncestryChange(ancestry, $event.target.checked)" [checked]="checked"
                                        [disabled]="disabled">
                                    <div class="gridicon-fullsizebox" [ngbPopover]="AncestryChoiceDetailsTemplate"
                                        triggers="click">
                                        <app-gridIcon [title]="ancestry.name"
                                            [detail]="ancestry.traits.includes('Rare') ? 'Rare' : (ancestry.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                        </app-gridIcon>
                                        <header class="sectionHeader">
                                            <span>{{ancestry.name}}&nbsp;</span>
                                            <cite class="trait" *ngIf="ancestry.traits.includes('Rare')"
                                                [ngbPopover]="get_Traits('Rare')[0]?.desc" openDelay=100>Rare</cite>
                                            <cite class="trait" *ngIf="ancestry.traits.includes('Uncommon')"
                                                [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                openDelay=100>Uncommon</cite>
                                        </header>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <!--Heritage choice content-->
            <ng-container *ngIf="get_ShowList()=='heritage'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Heritage{{(get_Character().class.heritage.name) ? ": "+ get_Character().class.heritage.name
                        : ""}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <ng-container
                        *ngFor="let heritage of get_AvailableHeritages('', get_Character().class.ancestry.name); trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let selected of [heritage.name == get_Character().class.heritage.name]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let checked of [selected || get_HaveHeritage(heritage.name)]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [!selected && (checked || get_Character().class.heritage.name)]; trackBy:trackByIndex">
                                    <ng-template #HeritageChoiceDetailsTemplate>
                                        <header class="spellHeader">{{heritage.name}}</header>
                                        <div class="button newrow no-animation"
                                            *ngIf="!disabled && !heritage.subTypes.length"
                                            [ngClass]="{'fancy-button':selected, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="onHeritageChange(heritage, $event.target.checked)"
                                                    [checked]="selected" [disabled]="disabled" hidden>{{selected ?
                                                "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned tags">
                                            <cite class="trait"
                                                *ngFor="let trait of heritage.traits; trackBy:trackByIndex;"
                                                [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="heritage.sourceBook">
                                            <strong>Source</strong>
                                            <i>{{heritage.sourceBook}}</i>
                                        </div>
                                        <div class="newrow left-aligned">
                                            <ng-container
                                                *ngFor="let desc of heritage.desc.split('\n\n'); trackBy:trackByIndex;">
                                                <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                        {{line}}
                                                    </li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                        <ng-container
                                            *ngFor="let activityName of heritage.gainActivities; trackBy:trackByIndex;">
                                            <div class="newrow left-aligned"
                                                *ngFor="let activity of get_Activities(activityName); trackBy:trackByIndex;">
                                                <header class="spellHeader left-aligned">{{activity.name}}
                                                    <app-actionIcons *ngIf="activity.actions"
                                                        [actionString]="activity.actions">
                                                    </app-actionIcons>
                                                    {{(activity.activationType) ? activity.activationType : ""}}
                                                </header>
                                                <app-activity class="newrow" [activity]=activity [allowActivate]=false>
                                                </app-activity>
                                            </div>
                                        </ng-container>
                                        <!--Subheritages-->
                                        <ng-container
                                            *ngFor="let subheritage of heritage.subTypes; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let subheritageSelected of [subheritage.name === get_Character().class.heritage.name]; trackBy:trackByIndex;">
                                                <ng-container
                                                    *ngFor="let subheritageChecked of [subheritageSelected || get_HaveHeritage(heritage.name)]; trackBy:trackByIndex;">
                                                    <ng-container
                                                        *ngFor="let subheritageDisabled of [!subheritageSelected && (subheritageChecked || get_Character().class.heritage.name)]; trackBy:trackByIndex;">
                                                        <div class="list-item"
                                                            [ngClass]="{'selected':subheritageSelected}">
                                                            <div class="gridicon-fullsizebox lower">
                                                                <input id="{{subheritage.name}}" type="checkbox"
                                                                    class="character-choice"
                                                                    (change)="onHeritageChange(subheritage, $event.target.checked)"
                                                                    [checked]="subheritageChecked"
                                                                    [disabled]="subheritageDisabled">
                                                                <label for="{{subheritage.name}}">
                                                                    <strong>{{subheritage.subType}}</strong>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                        <!--End Subheritages-->
                                    </ng-template>
                                    <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':selected}">
                                        <input *ngIf="!heritage.subTypes.length" id="{{heritage.name}}" type="checkbox"
                                            class="character-choice"
                                            (change)="onHeritageChange(heritage, $event.target.checked)"
                                            [checked]="checked" [disabled]="disabled">
                                        <button class="character-choice" *ngIf="heritage.subTypes.length"
                                            (click)="HeritageChoiceDetailsPopover.toggle()">+</button>
                                        <div class="gridicon-fullsizebox" #HeritageChoiceDetailsPopover="ngbPopover"
                                            [ngbPopover]="HeritageChoiceDetailsTemplate" triggers="click">
                                            <app-gridIcon [title]="heritage.name"
                                                [detail]="heritage.traits.includes('Rare') ? 'Rare' : (heritage.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                            </app-gridIcon>
                                            <header class="sectionHeader">
                                                <span>{{heritage.name}}&nbsp;</span>
                                                <cite class="trait" *ngIf="heritage.traits.includes('Rare')"
                                                    [ngbPopover]="get_Traits('Rare')[0]?.desc" openDelay=100>Rare</cite>
                                                <cite class="trait" *ngIf="heritage.traits.includes('Uncommon')"
                                                    [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                    openDelay=100>Uncommon</cite>
                                            </header>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <!--Languages content-->
            <ng-container *ngIf="get_ShowList()=='languages'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">Languages</header>
                </div>
                <div id="choiceArea" class="list-item">
                    <div class="newrow list-item left-aligned">
                        <strong *ngIf="get_Character().class.ancestry.recommendedLanguages.length">
                            Recommended Languages
                        </strong>
                        {{get_Character().class.ancestry.recommendedLanguages.join(', ')}}
                    </div>
                    <ng-container *ngFor="let language of get_Character().class.languages; trackBy:trackByIndex;">
                        <div class="list-item"
                            *ngIf="language.locked || language.level <= get_ShowContentLevelNumber()">
                            <ng-template #LanguageSource>
                                <div class="newrow">
                                    <span>
                                        <strong>Source</strong>
                                        {{language.source}}
                                    </span>
                                </div>
                                <div class="newrow" *ngIf="language.level > 0">
                                    <span>
                                        <strong>Level</strong>
                                        {{language.level}}
                                    </span>
                                </div>
                            </ng-template>
                            <div class="newrow" [ngbPopover]="language.source ? LanguageSource : null">
                                <input class="newrow" type="text" [(ngModel)]="language.name"
                                    (blur)="on_LanguageChange()" [disabled]="language.locked">
                            </div>
                        </div>
                    </ng-container>
                </div>
            </ng-container>
            <!--Background choice content-->
            <ng-container *ngIf="get_ShowList()=='background'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Background{{(get_Character().class.background.name) ? ": "+
                        get_Character().class.background.name : ""}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <!-- Filter -->
                    <div class="list-item lower">
                        <strong>Filter</strong>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="adventureBackgroundsFilter" type="checkbox"
                                [(ngModel)]="adventureBackgrounds">
                            <label for="adventureBackgroundsFilter"><strong>Show adventure
                                    backgrounds</strong></label>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input class="character-choice" id="regionalBackgroundsFilter" type="checkbox"
                                [(ngModel)]="regionalBackgrounds">
                            <label for="regionalBackgroundsFilter"><strong>Show regional
                                    backgrounds</strong></label>
                        </div>
                    </div>
                    <!-- End Filter -->
                    <ng-container *ngFor="let background of get_AvailableBackgrounds(); trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let checked of [background.name === get_Character().class.background.name || background.name === get_Character().class.background.superType]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let disabled of [get_Character().class.background.name && (background.name != get_Character().class.background.name)]; trackBy:trackByIndex">
                                <ng-template #BackgroundChoiceDetailsTemplate>
                                    <header class="spellHeader">{{background.name}}</header>
                                    <div class="button newrow no-animation" *ngIf="!disabled && !background.subTypes"
                                        [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                        <label>
                                            <input type="checkbox"
                                                (change)="onBackgroundChange(background, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                            "Remove" : "Choose"}}
                                        </label>
                                    </div>
                                    <div class="newrow left-aligned tags">
                                        <cite class="trait"
                                            *ngFor="let trait of background.traits; trackBy:trackByIndex;"
                                            [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                    </div>
                                    <div class="newrow left-aligned" *ngIf="background.sourceBook">
                                        <strong>Source</strong>
                                        <i>{{background.sourceBook}}</i>
                                    </div>
                                    <div class="newrow left-aligned" *ngIf="background.prerequisites">
                                        <strong>Prerequisites</strong>
                                        {{background.prerequisites}}
                                    </div>
                                    <div class="newrow left-aligned" *ngIf="background.region">
                                        <strong>Region</strong>
                                        {{background.region}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <ng-container
                                            *ngFor="let desc of background.desc.split('\n\n'); trackBy:trackByIndex;">
                                            <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                            <ul *ngIf="desc.split('\n').length > 1">
                                                <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                    {{line}}
                                                </li>
                                            </ul>
                                        </ng-container>
                                    </div>
                                    <div class="list-item lower newrow problem" *ngIf="background.inputRequired">
                                        <strong>Player input required:</strong>
                                        <div class="newrow left-aligned">
                                            <p
                                                *ngFor="let inputRequired of background.inputRequired.split('\n'); trackBy:trackByIndex;">
                                                {{inputRequired}}
                                            </p>
                                        </div>
                                    </div>
                                    <!--Subbackgrounds-->
                                    <div class="list-item"
                                        [ngClass]="{'selected':subbackground.name === get_Character().class.background.name}"
                                        *ngFor="let subbackground of get_SubBackgrounds(background.name); trackBy:trackByIndex;">
                                        <div class="gridicon-fullsizebox lower">
                                            <input id="{{subbackground.name}}" type="checkbox" class="character-choice"
                                                (change)="onBackgroundChange(subbackground, $event.target.checked)"
                                                [checked]="subbackground.name === get_Character().class.background.name"
                                                [disabled]="get_Character().class.background.name && (subbackground.name != get_Character().class.background.name)">
                                            <label for="{{subbackground.name}}">
                                                <strong>{{subbackground.subType}}</strong>
                                            </label>
                                        </div>
                                    </div>
                                    <!--End Subbackgrounds-->
                                </ng-template>
                                <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':checked}">
                                    <input *ngIf="!background.subTypes" id="{{background.name}}" type="checkbox"
                                        class="character-choice"
                                        (change)="onBackgroundChange(background, $event.target.checked)"
                                        [checked]="checked" [disabled]="disabled">
                                    <button class="character-choice" *ngIf="background.subTypes"
                                        (click)="BackgroundChoiceDetailsPopover.toggle()">+</button>
                                    <div class="gridicon-fullsizebox" #BackgroundChoiceDetailsPopover="ngbPopover"
                                        [ngbPopover]="BackgroundChoiceDetailsTemplate" triggers="click">
                                        <app-gridIcon [title]="background.name"
                                            [detail]="background.traits.includes('Rare') ? 'Rare' : (background.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                        </app-gridIcon>
                                        <header class="sectionHeader">
                                            <span>{{background.name}}&nbsp;</span>
                                            <cite class="trait" *ngIf="background.traits.includes('Rare')"
                                                [ngbPopover]="get_Traits('Rare')[0]?.desc" openDelay=100>Rare</cite>
                                            <cite class="trait" *ngIf="background.traits.includes('Uncommon')"
                                                [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                openDelay=100>Uncommon</cite>
                                            <cite class="trait" *ngIf="background.adventurePath"
                                                [ngbPopover]="get_Traits('Adventure')[0]?.desc"
                                                openDelay=100>Adventure</cite>
                                            <cite class="trait" *ngIf="background.region"
                                                [ngbPopover]="get_Traits('Regional')[0]?.desc"
                                                openDelay=100>Regional</cite>
                                        </header>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <ng-container *ngIf="get_ShowList()=='deity'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Deity{{get_Character().class.deity ? ": "+get_Character().class.deity : ""}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <ng-container *ngFor="let deity of get_AvailableDeities(); trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let checked of [deity.name === get_Character().class.deity]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let disabled of [get_Character().class.deity && (deity.name != get_Character().class.deity)]; trackBy:trackByIndex">
                                <ng-template #DeityChoiceDetailsTemplate>
                                    <header class="spellHeader">{{deity.name}}</header>
                                    <div class="button newrow no-animation" *ngIf="!disabled"
                                        [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                        <label>
                                            <input type="checkbox"
                                                (change)="on_DeityChange(deity, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                            "Remove" : "Choose"}}
                                        </label>
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Follower Alignments</strong>
                                        {{deity.followerAlignments.join(", ")}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Divine Ability</strong>
                                        {{deity.divineAbility.join(" or ")}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Divine Font</strong>
                                        {{deity.divineFont.join(" or ")}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Divine Skill</strong>
                                        {{deity.divineSkill.join(" or ")}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Favored Weapon</strong>
                                        {{deity.favoredWeapon.join(" or ")}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Domains</strong>
                                        {{deity.domains.join(", ")}}
                                    </div>
                                    <div class="newrow left-aligned">
                                        <strong>Cleric Spells</strong>
                                    </div>
                                    <div class="list-item lower left-aligned"
                                        *ngFor="let spell of deity.clericSpells; trackBy:trackByIndex;">
                                        <strong>Level {{spell.level}}</strong>
                                        {{spell.name}}{{(spell.note ? "("+spell.note+")" : "")}}
                                    </div>
                                </ng-template>
                                <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':checked}">
                                    <input id="{{deity.name}}" type="checkbox" class="character-choice"
                                        (change)="on_DeityChange(deity, $event.target.checked)" [checked]="checked"
                                        [disabled]="disabled">
                                    <div class="gridicon-fullsizebox" [ngbPopover]="DeityChoiceDetailsTemplate"
                                        triggers="click">
                                        <app-gridIcon [title]="deity.name" [detail]="deity.alignment">
                                        </app-gridIcon>
                                        <header class="sectionHeader">
                                            <span>{{deity.name}}&nbsp;</span>
                                            <cite class="trait">{{deity.alignment}}</cite>
                                        </header>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <!--Level content-->
            <!--Fixed content template (list mode only)-->
            <ng-container *ngIf="get_ShowList()=='fixedchanges'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Level {{this.get_ShowContentLevelNumber()}} fixed changes
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <!--Fixed Ability boosts-->
                    <header class="sectionHeader center-aligned" *ngIf="this.get_ShowContent()?.abilityBoosts?.length">
                        Ability Boosts
                    </header>
                    <ng-container *ngFor="let boost of this.get_ShowContent().abilityBoosts; trackBy:trackByIndex;">
                        <div class="list-item abilityboost">
                            <div>
                                <span>
                                    <strong>
                                        {{(boost.type == 'Flaw') ? 'Flaw' : 'Boost'}}
                                    </strong>
                                    {{boost.name}}
                                </span>
                                <span class="newrow left-aligned">
                                    <strong>
                                        Source
                                    </strong>
                                    {{boost.source}}
                                </span>
                            </div>
                        </div>
                    </ng-container>
                    <!--Fixed Skill Increases-->
                    <header class="sectionHeader center-aligned" *ngIf="this.get_ShowContent()?.skillIncreases?.length">
                        Skill Increases
                    </header>
                    <ng-container
                        *ngFor="let skillIncrease of this.get_ShowContent().skillIncreases; trackBy:trackByIndex;">
                        <div class="list-item skillincrease">
                            <div>
                                <strong>
                                    {{skillIncrease.name}}
                                </strong>
                                <span class="newrow left-aligned">
                                    <strong>
                                        Source
                                    </strong>
                                    {{skillIncrease.source}}
                                </span>
                            </div>
                        </div>
                    </ng-container>
                    <!--Fixed Feats-->
                    <header class="sectionHeader center-aligned" *ngIf="this.get_ShowContent()?.feats?.length">
                        Feats
                    </header>
                    <ng-container *ngFor="let feat of this.get_ShowContent().feats; trackBy:trackByIndex;">
                        <ng-template #FixedFeatDetail>
                            <header class="spellHeader">{{feat.name}}</header>
                            <app-feat [feat]="get_FeatsAndFeatures(feat.name)[0]" [choice]="null"
                                [levelNumber]="this.get_ShowContentLevelNumber()">
                            </app-feat>
                        </ng-template>
                        <div class="list-item featchoice">
                            <strong>
                                {{feat.name}}
                            </strong>
                            <i class="bi-question-circle" [ngbPopover]="FixedFeatDetail"></i>
                            <span class="newrow left-aligned">
                                <strong>
                                    Source
                                </strong>
                                {{feat.source}}
                            </span>
                        </div>
                    </ng-container>
                    <!--Fixed Features-->
                    <header class="sectionHeader center-aligned" *ngIf="this.get_ShowContent()?.features?.length">
                        Features
                    </header>
                    <ng-container *ngFor="let feature of this.get_ShowContent().features; trackBy:trackByIndex;">
                        <ng-template #FixedFeatureDetail>
                            <header class="spellHeader">{{feature.name}}</header>
                            <app-feat [feat]="get_FeatsAndFeatures(feature.name)[0]" [choice]="null"
                                [levelNumber]="this.get_ShowContentLevelNumber()">
                            </app-feat>
                        </ng-template>
                        <div class="list-item specialchoice">
                            <strong>
                                {{feature.name}}
                            </strong>
                            <i class="bi-question-circle" [ngbPopover]="FixedFeatureDetail"></i>
                            <span class="newrow left-aligned">
                                <strong>
                                    Source
                                </strong>
                                {{feature.source}}
                            </span>
                        </div>
                    </ng-container>
                </div>
            </ng-container>
            <!--Ability Choice Content-->
            <ng-container *ngFor="let abilityContent of get_ActiveChoiceContent('AbilityChoice'); trackBy:trackByID">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        {{get_AbilityChoiceTitle(abilityContent.choice)}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <ng-container
                        *ngFor="let ability of get_AvailableAbilities(abilityContent.choice, abilityContent.levelNumber); trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let checked of [get_AbilityTakenByThis(ability, abilityContent.choice, abilityContent.levelNumber)]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let disabled of [this.cannotBoost(ability, abilityContent.levelNumber, abilityContent.choice).length || (abilityContent.choice.boosts.length == get_MaxAvailable(abilityContent.choice) && !checked)]; trackBy:trackByIndex">
                                <div class="newrow list-item"
                                    [ngClass]="{'selected':checked, 'problem':abilityIllegal(abilityContent.levelNumber, ability)}">
                                    <div class="gridicon-fullsizebox">
                                        <input id="{{ability.name}}" type="checkbox" class="character-choice"
                                            (change)="on_AbilityBoost(ability.name, $event.target.checked, abilityContent.choice, false)"
                                            [checked]="checked" [disabled]="disabled">
                                        <div class="gridicon-fullsizebox"
                                            *ngFor="let baseValue of [ability.baseValue(get_Character(), characterService, abilityContent.levelNumber)]; trackBy:trackByIndex;">
                                            <app-gridIcon [title]="ability.name" [ngbPopover]="baseValue.explain"
                                                triggers="hover:click" openDelay=1
                                                [superTitle]="baseValue.result.toString()">
                                            </app-gridIcon>
                                            <header class="sectionHeader">
                                                <span>{{ability.name}}&nbsp;</span>
                                                <cite class="problem"
                                                    *ngFor="let reason of cannotBoost(ability, abilityContent.levelNumber, abilityContent.choice); trackBy:trackByIndex;">
                                                    {{reason}}
                                                </cite>
                                                <cite class="problem"
                                                    *ngIf="abilityIllegal(abilityContent.levelNumber, ability)"
                                                    [ngbPopover]="'Abilities cannot be raised above 18 on level 1.'">
                                                    Limit reached
                                                </cite>
                                            </header>
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <!--Skill Choice Content-->
            <ng-container *ngFor="let skillContent of get_ActiveChoiceContent('SkillChoice'); trackBy:trackByID;">
                <app-skillchoice (showSkillChoiceMessage)="receive_ChoiceMessage($event)" [choice]="skillContent.choice"
                    [levelNumber]="skillContent.levelNumber" [showTitle]="false" [showChoice]="skillContent.name"
                    [excludeTemporary]="true">
                </app-skillchoice>
            </ng-container>
            <!--Feat Choice Content-->
            <ng-container *ngFor="let featContent of get_ActiveChoiceContent('FeatChoice'); trackBy:trackByID;">
                <app-featchoice (showFeatChoiceMessage)="receive_ChoiceMessage($event)"
                    (showFeatMessage)="receive_FeatMessage($event)" [choice]="featContent.choice"
                    [levelNumber]="featContent.levelNumber" [showTitle]="false" [showFeat]="get_ShowItem()"
                    [showChoice]="featContent.name" [unavailableFeats]="get_Character().settings.unavailableFeats"
                    [lowerLevelFeats]="get_Character().settings.lowerLevelFeats"
                    [higherLevelFeats]="get_Character().settings.higherLevelFeats"
                    [archetypeFeats]="get_Character().settings.archetypeFeats">
                </app-featchoice>
            </ng-container>
            <!--Lore Training content-->
            <ng-container *ngFor="let loreContent of get_ActiveChoiceContent('LoreChoice'); trackBy:trackByID">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Lore Training ({{loreContent.choice.source}}){{(loreContent.choice.increases.length) ? ": "+
                        loreContent.choice.loreName : ""}}
                    </header>
                </div>
                <div id="choiceArea" class="list-item">
                    <ng-container
                        *ngFor="let checked of [get_SkillIncreases(loreContent.levelNumber, loreContent.levelNumber, 'Lore: '+loreContent.choice.loreName, loreContent.choice.source, loreContent.choice.id).length]; trackBy:trackByIndex">
                        <ng-container
                            *ngFor="let illegal of [get_Skills('Lore: '+loreContent.choice.loreName).length && !checked]; trackBy:trackByIndex">
                            <ng-container
                                *ngFor="let disabled of [!loreContent.choice.loreName || illegal]; trackBy:trackByIndex">
                                <div class="newrow left-aligned list-item">
                                    <strong>Lore Type</strong>
                                    {{loreContent.choice.loreDesc}}
                                </div>
                                <div class="newrow list-item gridicon-fullsizebox">
                                    <div class="button no-animation" style="max-width: fit-content;"
                                        [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                        <label>
                                            <input id="{{loreContent.choice.id}}" type="checkbox"
                                                (change)="on_LoreChange($event.target.checked, loreContent.choice)"
                                                [checked]="checked" [disabled]="disabled" hidden>
                                            {{checked ? "Change" : "Save"}}
                                        </label>
                                    </div>
                                    <header class="sectionHeader">
                                        <input id="LoreName" type="text" [(ngModel)]="loreContent.choice.loreName"
                                            [disabled]="checked" (blur)="on_LoreNameChange" maxLength="20">
                                        <cite class="problem" *ngIf="illegal">
                                            Lore already trained
                                        </cite>
                                    </header>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
            <!--Animal Companion Content-->
            <ng-container
                *ngFor="let companionContent of get_ActiveSpecialChoiceShown('animalcompanion'); trackBy:trackByID">
                <ng-container *ngFor="let companion of [get_Companion()]; trackBy: trackByIndex">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Animal Companion{{(companion.class.ancestry.name) ? ": "+ companion.class.ancestry.name
                            : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="list-item">
                        <div class="newrow list-item">
                            <button class="newrow list-item" (click)="on_NewCompanion()">
                                <header class="sectionHeader">Reset Animal Companion</header>
                            </button>
                            <div class="newrow list-item left-aligned">
                                <strong>
                                    Name
                                </strong>
                                <input id="CompanionName" type="text" [(ngModel)]="companion.name" maxLength="30">
                            </div>
                            <div class="newrow list-item left-aligned">
                                <strong>
                                    Animal
                                </strong>
                                <input id="CompanionSpecies" type="text" [(ngModel)]="companion.species" maxLength="30">
                            </div>
                        </div>
                        <div class="list-item transparent">
                            <header class="sectionHeader">Type</header>
                        </div>
                        <ng-container *ngFor="let type of get_AvailableCompanionTypes(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [type.name == companion.class.ancestry.name]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [companion.class.ancestry.name && (type.name != companion.class.ancestry.name)]; trackBy:trackByIndex">
                                    <ng-template #AnimalCompanionDetailsTemplate>
                                        <header class="spellHeader">{{type.name}}</header>
                                        <div class="button newrow no-animation" *ngIf="!disabled"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="on_CompanionTypeChange(type, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>
                                                {{checked ? "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned">
                                            <div class="newrow left-aligned tags">
                                                <cite class="trait"
                                                    *ngFor="let trait of type.traits; trackBy:trackByIndex;"
                                                    [ngbPopover]="get_Traits(trait)[0]?.desc"
                                                    openDelay=100>{{trait}}</cite>
                                            </div>
                                            <div class="newrow left-aligned" *ngIf="type.sourceBook">
                                                <strong>Source</strong>
                                                <i>{{type.sourceBook}}</i>
                                            </div>
                                            <ng-container
                                                *ngFor="let desc of type.desc.split('\n\n'); trackBy:trackByIndex;">
                                                <p *ngIf="desc.split('\n').length == 1">
                                                    {{desc}}
                                                </p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                        {{line}}
                                                    </li>
                                                </ul>
                                            </ng-container>
                                            <p>
                                                <strong>Size</strong> {{size(type.size)}}
                                            </p>
                                            <ng-container *ngFor="let gain of type.gainItems; trackBy:trackByIndex;">
                                                <p *ngFor="let item of get_ItemFromGain(gain); trackBy:trackByIndex;">
                                                    <strong>Melee</strong>
                                                    {{item.displayName}},
                                                    <strong>Damage</strong>
                                                    {{item.dicenum+"d"+item.dicesize}}
                                                </p>
                                            </ng-container>
                                            <p>
                                                <span
                                                    *ngFor="let ability of get_AnimalCompanionAbilities(type); let index = index; trackBy:trackByIndex;">
                                                    {{index ? ", " : ""}}<strong>{{ability.name}}</strong>
                                                    {{ability.modifier}}
                                                </span>
                                            </p>
                                            <p>
                                                <strong>Hit Points</strong>
                                                {{type.hitpoints}}
                                            </p>
                                            <p>
                                                <strong>Skill</strong>
                                                {{type.skillChoices[0].increases[0].name}}
                                            </p>
                                            <p>
                                                <strong>Senses</strong>
                                                {{type.senses.join(",
                                                ")}}
                                            </p>
                                            <p>
                                                <strong>Speed</strong>
                                                <span
                                                    *ngFor="let speed of type.speeds; let index = index; trackBy:trackByIndex;">
                                                    {{index > 0 ? ", " : ""}}{{speed.name.split(' ')[0] + " " +
                                                    speed.value + " feet"}}
                                                </span>
                                            </p>
                                            <p>
                                                <strong>Support Benefit</strong>
                                                {{type.supportBenefit}}
                                            </p>
                                            <p *ngIf="type.specialdesc.length">
                                                <strong>Special</strong>
                                                {{type.specialdesc}}
                                            </p>
                                        </div>
                                        <ng-container *ngFor="let gain of [type.activities[1]]; trackBy:trackByIndex;">
                                            <div class="newrow left-aligned"
                                                *ngFor="let activity of get_Activities(gain.name); trackBy:trackByIndex;">
                                                <header class="spellHeader left-aligned">
                                                    Advanced Maneuver: {{activity.name}}
                                                    <app-actionIcons *ngIf="activity.actions"
                                                        [actionString]="activity.actions">
                                                    </app-actionIcons>
                                                    {{(activity.activationType) ? activity.activationType : ""}}
                                                </header>
                                                <app-activity class="newrow" [activity]=activity [allowActivate]=false>
                                                </app-activity>
                                            </div>
                                        </ng-container>
                                    </ng-template>
                                    <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':checked}">
                                        <input id="{{type.name}}" type="checkbox" class="character-choice"
                                            (change)="on_CompanionTypeChange(type, $event.target.checked)"
                                            [checked]="checked" [disabled]="disabled">
                                        <div class="gridicon-fullsizebox">
                                            <app-gridIcon [title]="type.name">
                                            </app-gridIcon>
                                            <header class="sectionHeader">
                                                <span [ngbPopover]="AnimalCompanionDetailsTemplate"
                                                    triggers="click">{{type.name}}</span>
                                            </header>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
            <!--Companion Specialization Content-->
            <ng-container
                *ngFor="let companionSpecializationContent of get_ActiveSpecialChoiceShown('companionspecialization'); trackBy:trackByID">
                <ng-container *ngFor="let companion of [get_Companion()]; trackBy:trackByIndex">
                    <ng-container
                        *ngFor="let available of [get_CompanionSpecializationsAvailable(companionSpecializationContent.levelNumber)]; trackBy:trackByIndex;">
                        <ng-container
                            *ngFor="let takenSpecializations of [get_TakenCompanionSpecializations(companionSpecializationContent.levelNumber)]; trackBy:trackByIndex">
                            <div class="newrow list-item padding-8 center-aligned">
                                <header class="box-header sectionHeader">
                                    Animal Companion Specialization{{available > 1 ? ": "+
                                    takenSpecializations.length +"/"+ available : (takenSpecializations.length == 1)
                                    ? ": "+ takenSpecializations[0] : ""}}
                                </header>
                            </div>
                            <div class="list-item">
                                <p>
                                    The first time an animal gains a specialization, it gains the following: Its
                                    proficiency rank for unarmed attacks increases to expert. Its proficiency ranks
                                    for saving throws and Perception increase to master. Increase its Dexterity
                                    modifier by 1 and its Intelligence modifier by 2. Its unarmed attack damage
                                    increases from two dice to three dice, and it increases its additional damage
                                    with unarmed attacks from 2 to 4 or from 3 to 6.
                                </p>
                            </div>
                            <div id="choiceArea" class="list-item">
                                <ng-container
                                    *ngFor="let spec of get_AvailableCompanionSpecializations(companionSpecializationContent.levelNumber); trackBy:trackByIndex;">
                                    <ng-container
                                        *ngFor="let taken of [takenSpecializations.includes(spec.name)]; trackBy:trackByIndex">
                                        <ng-container
                                            *ngFor="let checked of [taken || have_CompanionSpecialization(spec.name)]; trackBy:trackByIndex">
                                            <ng-container
                                                *ngFor="let disabled of [(have_CompanionSpecialization(spec.name) || (takenSpecializations.length == available)) && !taken]; trackBy:trackByIndex">
                                                <ng-template #CompanionSpecializationDetailsTemplate>
                                                    <header class="spellHeader">{{spec.name}}</header>
                                                    <div class="button newrow no-animation"
                                                        *ngIf="!disabled && (taken || !checked)"
                                                        [ngClass]="{'fancy-button':taken}">
                                                        <label>
                                                            <input type="checkbox"
                                                                (change)="on_SpecializationChange(spec, $event.target.checked, companionSpecializationContent.levelNumber)"
                                                                [checked]="checked" [disabled]="disabled" hidden>
                                                            {{checked ? "Remove" : "Choose"}}
                                                        </label>
                                                    </div>
                                                    <div class="newrow left-aligned">
                                                        <cite class="problem" *ngIf="checked && !taken">
                                                            Already taken
                                                        </cite>
                                                    </div>
                                                    <div class="newrow left-aligned">
                                                        <p>
                                                            {{spec.desc}}
                                                        </p>
                                                    </div>
                                                </ng-template>
                                                <div class="list-item gridicon-fullsizebox"
                                                    [ngClass]="{'selected':taken}">
                                                    <input id="{{spec.name}}" type="checkbox" class="character-choice"
                                                        (change)="on_SpecializationChange(spec, $event.target.checked, companionSpecializationContent.levelNumber)"
                                                        [checked]="checked" [disabled]="disabled">
                                                    <div class="gridicon-fullsizebox">
                                                        <app-gridIcon [title]="spec.name">
                                                        </app-gridIcon>
                                                        <header class="sectionHeader">
                                                            <span [ngbPopover]="CompanionSpecializationDetailsTemplate"
                                                                triggers="click">{{spec.name}}</span>
                                                        </header>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
            <!--Familiar Content-->
            <ng-container *ngFor="let familiarContent of get_ActiveSpecialChoiceShown('familiar'); trackBy:trackByID">
                <ng-container *ngFor="let familiar of [get_Familiar()]; trackBy:trackByIndex">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Familiar
                        </header>
                    </div>
                    <div id="choiceArea" class="list-item">
                        <div class="newrow list-item">
                            <button class="newrow list-item" (click)="on_NewFamiliar()">
                                <header class="sectionHeader">Reset Familiar</header>
                            </button>
                            <div class="newrow list-item left-aligned">
                                <strong>
                                    Name
                                </strong>
                                <input id="FamiliarName" type="text" [(ngModel)]="familiar.name" maxLength="30">
                            </div>
                            <div class="newrow list-item left-aligned">
                                <strong>
                                    Creature
                                </strong>
                                <input id="FamiliarCreature" type="text" [(ngModel)]="familiar.species" maxLength="30">
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="FamiliarSwimmer" type="checkbox"
                                    (click)="on_FamiliarSpeedChange($event.target.checked)"
                                    [checked]="is_FamiliarSwimmer()">
                                <label for="FamiliarSwimmer">
                                    <strong>
                                        Gain Swim Speed instead of Land Speed
                                    </strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </ng-container>
            <!--Different Worlds content-->
            <ng-container
                *ngFor="let differentWorldsContent of get_ActiveSpecialChoiceShown('differentworlds'); trackBy:trackByID">
                <ng-container
                    *ngFor="let differentWorldsFeat of get_DifferentWorldsFeat(differentWorldsContent.levelNumber); trackBy:trackByIndex;">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Different Worlds{{(differentWorldsFeat.data.background) ? ": "+
                            differentWorldsFeat.data.background : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="list-item">
                        <div class="newrow list-item">
                            <div class="newrow list-item left-aligned">
                                <strong>Alternative name</strong>
                                <input type="text" [(ngModel)]="differentWorldsFeat.data.name" (blur)=on_NameChange()
                                    maxLength="30">
                            </div>
                        </div>
                        <div class="list-item transparent">
                            <header class="sectionHeader">Alternative background</header>
                        </div>
                        <!-- Filter -->
                        <div class="list-item lower">
                            <strong>Filter</strong>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="adventureBackgroundsFilter" type="checkbox"
                                    [(ngModel)]="adventureBackgrounds">
                                <label for="adventureBackgroundsFilter"><strong>Show adventure
                                        backgrounds</strong></label>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="regionalBackgroundsFilter" type="checkbox"
                                    [(ngModel)]="regionalBackgrounds">
                                <label for="regionalBackgroundsFilter"><strong>Show regional
                                        backgrounds</strong></label>
                            </div>
                        </div>
                        <!-- End Filter -->
                        <ng-container *ngFor="let background of get_Backgrounds(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let selected of [background.name === differentWorldsFeat.data.background]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let checked of [selected || background.name === get_Character().class.background.name || background.name === get_Character().class.background.superType]; trackBy:trackByIndex">
                                    <ng-container
                                        *ngFor="let disabled of [!selected && (checked || differentWorldsFeat.data.background)]; trackBy:trackByIndex">
                                        <ng-template #DifferentWorldsBackgroundChoiceDetailsTemplate>
                                            <header class="spellHeader">{{background.name}}</header>
                                            <div class="button newrow no-animation" *ngIf="!disabled"
                                                [ngClass]="{'fancy-button':selected, 'disabled':disabled}">
                                                <label>
                                                    <input type="checkbox"
                                                        (change)="on_DifferentWorldsBackgroundChange(differentWorldsContent.levelNumber, differentWorldsFeat, background, $event.target.checked)"
                                                        [checked]="checked" [disabled]="disabled" hidden>{{selected
                                                    ? "Remove" : "Choose"}}
                                                </label>
                                            </div>
                                            <div class="newrow left-aligned tags">
                                                <cite class="trait"
                                                    *ngFor="let trait of background.traits; trackBy:trackByIndex;"
                                                    [ngbPopover]="get_Traits(trait)[0]?.desc"
                                                    openDelay=100>{{trait}}</cite>
                                            </div>
                                            <div class="newrow left-aligned" *ngIf="background.sourceBook">
                                                <strong>Source</strong>
                                                <i>{{background.sourceBook}}</i>
                                            </div>
                                            <div class="newrow left-aligned" *ngIf="background.prerequisites">
                                                <strong>Prerequisites</strong>
                                                {{background.prerequisites}}
                                            </div>
                                            <div class="newrow left-aligned" *ngIf="background.region">
                                                <strong>Region</strong>
                                                {{background.region}}
                                            </div>
                                            <div class="newrow left-aligned">
                                                <ng-container
                                                    *ngFor="let desc of background.desc.split('\n\n'); let index = index; trackBy:trackByIndex;">
                                                    <ng-container *ngIf="index == 0">
                                                        <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                        <ul *ngIf="desc.split('\n').length > 1">
                                                            <li
                                                                *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                                {{line}}
                                                            </li>
                                                        </ul>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="background.loreChoices[0]?.loreName != ''">
                                                    <p>
                                                        You're trained in {{background.loreChoices[0].loreName}}
                                                        Lore.
                                                    </p>
                                                </ng-container>
                                                <ng-container *ngIf="background.loreChoices[0]?.loreDesc != ''">
                                                    <p>
                                                        You're trained in
                                                        {{background.loreChoices[0].loreDesc.substr(0,1).toLowerCase()}}{{background.loreChoices[0].loreDesc.substr(1)}}.
                                                    </p>
                                                </ng-container>
                                            </div>
                                        </ng-template>
                                        <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':selected}">
                                            <input id="{{background.name}}" type="checkbox" class="character-choice"
                                                (change)="on_DifferentWorldsBackgroundChange(differentWorldsContent.levelNumber, differentWorldsFeat, background, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled">
                                            <div class="gridicon-fullsizebox"
                                                [ngbPopover]="DifferentWorldsBackgroundChoiceDetailsTemplate"
                                                triggers="click">
                                                <app-gridIcon [title]="background.name"
                                                    [detail]="background.traits.includes('Rare') ? 'Rare' : (background.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                                </app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span>{{background.name}}&nbsp;</span>
                                                    <cite class="trait" *ngIf="background.traits.includes('Rare')"
                                                        [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                        openDelay=100>Rare</cite>
                                                    <cite class="trait" *ngIf="background.traits.includes('Uncommon')"
                                                        [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                        openDelay=100>Uncommon</cite>
                                                </header>
                                            </div>
                                        </div>
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
            <!--Blessed Blood Content-->
            <ng-container
                *ngFor="let blessedBloodContent of get_ActiveSpecialChoiceShown('blessedblood'); trackBy:trackByID;">
                <ng-container *ngFor="let blessedBloodSpells of [get_BlessedBloodSpells()]; trackBy:trackByIndex;">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Blessed Blood Deity Spells: {{blessedBloodSpells}}/3
                        </header>
                    </div>
                    <div class="list-item">
                        <p>
                            Add up to three of your deity's spells (spells your deity grants to clerics) to your
                            spell list. They are not automatically added to your repertoire, but you can select them
                            just as you would spells normally on the divine spell list.
                        </p>
                    </div>
                    <div id="choiceArea" class="list-item">
                        <ng-container *ngFor="let spell of get_BlessedBloodDeitySpells(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [get_BlessedBloodHaveSpell(spell)]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [blessedBloodSpells >= 3 && !checked]; trackBy:trackByIndex">
                                    <ng-template #BlessedBloodChoiceDetailsTemplate>
                                        <header class="spellHeader newrow">
                                            <span style="flex-grow:10">
                                                {{spell.name}}
                                                <app-actionIcons *ngIf="spell.actions" [actionString]="spell.actions">
                                                </app-actionIcons>
                                                {{(spell.castType) ? spell.castType : ""}}
                                            </span>
                                            <span style="flex-basis:auto; flex-shrink:0">
                                                Spell {{spell.levelreq}}
                                            </span>
                                        </header>
                                        <div class="button newrow no-animation" *ngIf="!disabled"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="on_BlessedBloodSpellTaken(spell, blessedBloodContent.levelNumber, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>
                                                {{checked ? "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <app-spell class="newrow" [spell]=spell [spellLevel]="spell.levelreq">
                                        </app-spell>
                                    </ng-template>
                                    <div class="list-item gridicon-fullsizebox" [ngClass]="{'selected':checked}">
                                        <input id="{{spell.name}}" type="checkbox" class="character-choice"
                                            (change)="on_BlessedBloodSpellTaken(spell, blessedBloodContent.levelNumber, $event.target.checked)"
                                            [checked]="checked" [disabled]="disabled">
                                        <div class="gridicon-fullsizebox"
                                            [ngbPopover]="BlessedBloodChoiceDetailsTemplate" triggers="click">
                                            <app-gridIcon [title]="spell.name">
                                            </app-gridIcon>
                                            <header class="sectionHeader">
                                                <span>{{spell.name}}</span>
                                            </header>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
            <!--Fuse Stance content-->
            <ng-container
                *ngFor="let fuseStanceContent of get_ActiveSpecialChoiceShown('fusestance'); trackBy:trackByID;">
                <ng-container
                    *ngFor="let fuseStanceFeat of get_FuseStanceFeat(fuseStanceContent.levelNumber); trackBy:trackByIndex">
                    <ng-container
                        *ngFor="let finished of [fuseStanceFeat.data.stances.length == 2]; trackBy:trackByIndex">
                        <div class="newrow list-item padding-8 center-aligned">
                            <header class="box-header sectionHeader">
                                Fuse Stance{{(finished && fuseStanceFeat.data.name) ? ": "+
                                fuseStanceFeat.data.name + " (" + fuseStanceFeat.data.stances.join(', ') + ")" :
                                ""}}
                            </header>
                        </div>
                        <div class="list-item">
                            <p>
                                Choose two stances you know and combine them into a single fused stance. Give your
                                new fused stance a unique name. When you enter your fused stance, you gain all the
                                effects of both stances, including the requirements and restrictions.
                            </p>
                            <p>
                                You can't fuse stances with fundamentally incompatible requirements or restrictions
                                (such as Mountain Stance and Crane Stance, which both require using only one type of
                                Strike).
                            </p>
                        </div>
                        <div id="choiceArea" class="list-item">
                            <div class="newrow list-item">
                                <div class="newrow list-item left-aligned">
                                    <strong>Stance name</strong>
                                    <input type="text" [(ngModel)]="fuseStanceFeat.data.name"
                                        (blur)="on_FuseStanceNameChange()" maxLength="30">
                                </div>
                            </div>
                            <div class="list-item transparent">
                                <header class="sectionHeader">Fused Stances</header>
                            </div>
                            <ng-container
                                *ngFor="let stance of get_StancesToFuse(fuseStanceContent.levelNumber, fuseStanceFeat); trackBy:trackByIndex;">
                                <ng-template #FuseStanceChoiceDetailsPopover>
                                    <header class="spellHeader">{{stance.activity.name}}
                                        <app-actionIcons *ngIf="stance.activity.actions"
                                            [actionString]="stance.activity.actions">
                                        </app-actionIcons>{{(stance.activity.activationType) ?
                                        stance.activity.activationType
                                        : ""}}
                                    </header>
                                    <app-activity [creature]="'Character'" [activity]=stance.activity
                                        [allowActivate]=false>
                                    </app-activity>
                                </ng-template>
                                <div class="list-item gridicon-fullsizebox"
                                    [ngClass]="{'unavailable':stance.reason, 'selected':fuseStanceFeat.data.stances.includes(stance.activity.name)}">
                                    <input id="{{stance.activity.name}}" type="checkbox" class="character-choice"
                                        (change)="on_FuseStanceStanceChange(fuseStanceFeat, stance.activity.name, $event.target.checked)"
                                        [checked]="fuseStanceFeat.data.stances.includes(stance.activity.name)"
                                        [disabled]="(finished || stance.reason) && !fuseStanceFeat.data.stances.includes(stance.activity.name)">
                                    <div class="gridicon-fullsizebox" [ngbPopover]="FuseStanceChoiceDetailsPopover"
                                        triggers="click">
                                        <app-gridIcon [title]="stance.activity.name"
                                            [superTitle]="stance.restricted ? 'icon-ra ra-bird-claw' : ''">
                                        </app-gridIcon>
                                        <header class="sectionHeader">
                                            <span>{{stance.activity.name}}&nbsp;</span>
                                            <cite class="trait" *ngIf="stance.restricted"
                                                [ngbPopover]="'While in this stance, you can only use the stance\'s special attack. You can only add one stance of this type to the fused stance.'"
                                                openDelay=100>
                                                Attack restrictions
                                            </cite>
                                            <cite class="problem" *ngIf="stance.reason">
                                                {{stance.reason}}
                                            </cite>
                                        </header>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-container>
            <!--Additional Heritages content-->
            <ng-container
                *ngFor="let additionalHeritagesContent of get_ActiveSpecialChoiceShown('additionalheritages'); trackBy:trackByID;">
                <ng-container
                    *ngFor="let heritageGain of get_AdditionalHeritagesAvailable(additionalHeritagesContent.levelNumber); trackBy:trackByIndex">
                    <ng-container
                        *ngFor="let heritageIndex of get_AdditionalHeritageIndex(heritageGain.source); trackBy:trackByIndex">
                        <ng-container *ngIf="heritageGain.source == additionalHeritagesContent.choice.source">
                            <div class="newrow list-item padding-8 center-aligned">
                                <header class="box-header sectionHeader">
                                    Heritage
                                    ({{heritageGain.source}}){{(get_Character().class.additionalHeritages[heritageIndex].name)
                                    ? ": "+ get_Character().class.additionalHeritages[heritageIndex].name : ""}}
                                </header>
                            </div>
                            <div id="choiceArea" class="list-item">
                                <ng-container
                                    *ngFor="let heritage of get_AvailableHeritages('', heritageGain.ancestry, heritageIndex); trackBy:trackByIndex;">
                                    <ng-container
                                        *ngFor="let selected of [heritage.name === get_Character().class.additionalHeritages[heritageIndex].name]; trackBy:trackByIndex;">
                                        <ng-container
                                            *ngFor="let checked of [selected || get_HaveHeritage(heritage.name)]; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let disabled of [!selected && (checked || get_Character().class.additionalHeritages[heritageIndex].name)]; trackBy:trackByIndex;">
                                                <ng-template #HeritageChoiceDetailsTemplate>
                                                    <header class="spellHeader">{{heritage.name}}</header>
                                                    <div class="button newrow no-animation"
                                                        *ngIf="!disabled && !heritage.subTypes.length"
                                                        [ngClass]="{'fancy-button':selected, 'disabled':disabled}">
                                                        <label>
                                                            <input type="checkbox"
                                                                (change)="on_AdditionalHeritageChange(heritage, $event.target.checked, heritageIndex, heritageGain.source)"
                                                                [checked]="checked" [disabled]="disabled"
                                                                hidden>{{checked ? "Remove" : "Choose"}}
                                                        </label>
                                                    </div>
                                                    <div class="newrow left-aligned tags">
                                                        <cite class="trait"
                                                            *ngFor="let trait of heritage.traits; trackBy:trackByIndex;"
                                                            [ngbPopover]="get_Traits(trait)[0]?.desc"
                                                            openDelay=100>{{trait}}</cite>
                                                    </div>
                                                    <div class="newrow left-aligned" *ngIf="heritage.sourceBook">
                                                        <strong>Source</strong>
                                                        <i>{{heritage.sourceBook}}</i>
                                                    </div>
                                                    <div class="newrow left-aligned">
                                                        <ng-container
                                                            *ngFor="let desc of heritage.desc.split('\n\n'); trackBy:trackByIndex;">
                                                            <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                            <ul *ngIf="desc.split('\n').length > 1">
                                                                <li
                                                                    *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                                    {{line}}
                                                                </li>
                                                            </ul>
                                                        </ng-container>
                                                    </div>
                                                    <ng-container
                                                        *ngFor="let activityName of heritage.gainActivities; trackBy:trackByIndex;">
                                                        <div class="newrow left-aligned"
                                                            *ngFor="let activity of get_Activities(activityName); trackBy:trackByIndex;">
                                                            <header class="spellHeader left-aligned">
                                                                {{activity.name}}
                                                                <app-actionIcons *ngIf="activity.actions"
                                                                    [actionString]="activity.actions">
                                                                </app-actionIcons>
                                                                {{(activity.activationType) ? activity.activationType :
                                                                ""}}
                                                            </header>
                                                            <app-activity class="newrow" [activity]=activity
                                                                [allowActivate]=false>
                                                            </app-activity>
                                                        </div>
                                                    </ng-container>
                                                    <!--Subheritages-->
                                                    <ng-container
                                                        *ngFor="let subheritage of heritage.subTypes; trackBy:trackByIndex;">
                                                        <ng-container
                                                            *ngFor="let subheritageSelected of [subheritage.name === get_Character().class.additionalHeritages[heritageIndex].name]; trackBy:trackByIndex;">
                                                            <ng-container
                                                                *ngFor="let subheritageChecked of [subheritageSelected || get_HaveHeritage(heritage.name)]; trackBy:trackByIndex;">
                                                                <ng-container
                                                                    *ngFor="let subheritageDisabled of [!subheritageSelected && (subheritageChecked || get_Character().class.additionalHeritages[heritageIndex].name)]; trackBy:trackByIndex;">
                                                                    <div class="list-item"
                                                                        [ngClass]="{'selected':subheritageSelected}">
                                                                        <div class="gridicon-fullsizebox lower">
                                                                            <input id="{{subheritage.name}}"
                                                                                type="checkbox" class="character-choice"
                                                                                (change)="on_AdditionalHeritageChange(subheritage, $event.target.checked, heritageIndex, heritageGain.source)"
                                                                                [checked]="subheritageChecked"
                                                                                [disabled]="subheritageDisabled">
                                                                            <label for="{{subheritage.name}}">
                                                                                <strong>{{subheritage.subType}}</strong>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </ng-container>
                                                            </ng-container>
                                                        </ng-container>
                                                    </ng-container>
                                                    <!--End Subheritages-->
                                                </ng-template>
                                                <div class="list-item gridicon-fullsizebox"
                                                    [ngClass]="{'selected':selected}">
                                                    <input *ngIf="!heritage.subTypes.length" id="{{heritage.name}}"
                                                        type="checkbox" class="character-choice"
                                                        (change)="on_AdditionalHeritageChange(heritage, $event.target.checked, heritageIndex, heritageGain.source)"
                                                        [checked]="checked" [disabled]="disabled">
                                                    <button class="character-choice" *ngIf="heritage.subTypes.length"
                                                        (click)="HeritageChoiceDetailsPopover.toggle()">+</button>
                                                    <div class="gridicon-fullsizebox"
                                                        #HeritageChoiceDetailsPopover="ngbPopover"
                                                        [ngbPopover]="HeritageChoiceDetailsTemplate" triggers="click">
                                                        <app-gridIcon [title]="heritage.name"
                                                            [detail]="heritage.traits.includes('Rare') ? 'Rare' : (heritage.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                                        </app-gridIcon>
                                                        <header class="sectionHeader">
                                                            <span>{{heritage.name}}&nbsp;</span>
                                                            <cite class="trait" *ngIf="heritage.traits.includes('Rare')"
                                                                [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                                openDelay=100>Rare</cite>
                                                            <cite class="trait"
                                                                *ngIf="heritage.traits.includes('Uncommon')"
                                                                [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                                openDelay=100>Uncommon</cite>
                                                        </header>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
            <!--Licenses content-->
            <ng-container *ngIf="get_ShowList()=='licenses'">
                <div class="newrow list-item padding-8 center-aligned">
                    <header class="box-header sectionHeader">
                        Licenses
                    </header>
                </div>
                <div id="choiceArea" style="font-size: 1em;" class="charactersheet-app">
                    <app-licenses></app-licenses>
                </div>
            </ng-container>
        </div>
    </div>
</div>