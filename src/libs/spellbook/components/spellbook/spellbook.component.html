<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<div class="corner-button-tray">
    <app-minimize-button
        [ngModel]="(isMinimized$ | async) ?? false"
        (ngModelChange)="toggleMinimized($event)"
    />

    <app-tile-mode-button
        [ngModel]="(isTileMode$ | async) ?? false"
        (ngModelChange)="toggleTileMode($event)"
    />
</div>

<div
    id="spellbook-height"
    class="attributeBox"
>
    <header class="sectionHeader box-header">Spells</header>

    <app-tags
        [creature]="character"
        [objectName]="'Spellbook'"
        [showTraits]=true
        [showFeats]=true
        [showItems]=true
        [showActivities]=true
        [showConditions]=true
        [showEffects]=true
    />

    <button
        *ngIf="hasAnySpells$ | async"
        type="button"
        class="minimized-hide center-aligned list-item"
        (click)="toggleSpellsMenu()"
    >
        Prepare Spells
    </button>

    <ng-template #SpellAttacksEffectsPopoverContent>
        <div class="minimized-hide newrow">
            <app-object-effects
                [creature]="character"
                [objectName]="'Spell Attack Rolls'"
            />
        </div>

        <div class="minimized-hide newrow">
            <app-object-effects
                [creature]="character"
                [objectName]="'Spell DCs'"
            />
        </div>
    </ng-template>

    <ng-container *ngFor="let skill of spellDCs$() | async; let index = index; trackBy:trackByIndex;">
        <header
            *ngIf="index === 0"
            class="sectionHeader minimized-hide"
        >
            <span
                #SpellAttacksEffectsPopover="ngbPopover"
                class="minimized-hide"
                triggers="click"
                [ngbPopover]="SpellAttacksEffectsPopoverContent"
            >
                <i
                    class='bi-lightning-charge'
                    [ngbTooltip]="!SpellAttacksEffectsPopover.isOpen() ? 'Edit effects' : ''"
                ></i>
            </span>
            Spell Attacks & DCs
        </header>

        <app-skill
            [skill]="skill"
            [isDC]="false"
        />

        <app-skill
            [skill]="skill"
            [isDC]="true"
        />
    </ng-container>

    <app-tags
        [creature]="character"
        [objectName]="'Spell DC'"
        [showTraits]=true
        [showFeats]=true
        [showItems]=true
        [showActivities]=true
        [showConditions]=true
        [showEffects]=true
    />

    <ng-container *ngIf="(componentParameters$() | async) as componentParameters">
        <ng-container *ngFor="let spellCastingParameters of (spellCastingParameters$() | async); trackBy:trackByIndex;">
            <header class="sectionHeader">
                {{(spellCastingParameters.casting.className + (spellCastingParameters.casting.castingType !=
                    "Innate"
                    ? " " + spellCastingParameters.casting.tradition : "") +
                    ((spellCastingParameters.casting.castingType === "Focus") ? (" " +
                    spellCastingParameters.casting.source) : " Spells")).trim()}}
                <span
                    *ngIf="['Prepared', 'Spontaneous'].includes(spellCastingParameters.casting.castingType)"
                    class="lower"
                >
                    <span class="lower">
                        {{spellCastingParameters.casting.castingType}}
                    </span>
                </span>

                <div
                    *ngIf="spellCastingParameters.casting.bondedItemCharges[0]"
                    class="newrow lower left-aligned"
                >
                    <span>
                        {{spellCastingParameters.casting.bondedItemCharges[0]}}{{componentParameters.hasSuperiorBond
                            ? "*" : ""}} bonded item charge{{spellCastingParameters.casting.bondedItemCharges[0] !== 1 ?
                            "s" : ""}} available
                    </span>

                    <i
                        *ngIf="componentParameters.hasSuperiorBond"
                        class="bi-question-circle"
                        [ngbPopover]="SuperiorBond"
                    ></i>

                    <ng-template #SuperiorBond>
                        <header class="spellHeader">Superior Bond</header>

                        <span>
                            You can use Drain Bonded Item one additional time per day, but only to cast a spell 2 or
                                more levels lower than your highest-level spell.
                        </span>
                    </ng-template>
                </div>

                <div
                    *ngIf="spellCastingParameters.maxStudiousCapacitySlots"
                    class="newrow lower left-aligned"
                >
                    <span>
                        {{spellCastingParameters.maxStudiousCapacitySlots -
                            spellCastingParameters.usedStudiousCapacitySlots}} extra spell
                            casting{{spellCastingParameters.maxStudiousCapacitySlots -
                            spellCastingParameters.usedStudiousCapacitySlots !== 1 ? "s" : ""}} available
                    </span>

                    <i
                        class="bi-question-circle"
                        [ngbPopover]="StudiousCapacity"
                    ></i>

                    <ng-template #StudiousCapacity>
                        <header class="spellHeader">Studious Capacity</header>

                        <span>
                            You can cast one spell each day even after you've run out of spell
                                slots of the appropriate spell level, but you can't use this ability to cast a spell of
                                your highest spell level.
                        </span>
                    </ng-template>
                </div>

                <div
                    *ngIf="spellCastingParameters.maxFirstGreaterVitalEvolutionSlot || spellCastingParameters.maxSecondGreaterVitalEvolutionSlot"
                    class="newrow lower left-aligned"
                >
                    <span>
                        {{(spellCastingParameters.usedFirstGreaterVitalEvolutionSlot === 0 ? 1 : 0) +
                            (spellCastingParameters.usedSecondGreaterVitalEvolutionSlot === 0 ? 1 : 0)}} extra spell
                            casting{{(spellCastingParameters.usedFirstGreaterVitalEvolutionSlot === 0 ? 1 : 0) +
                            (spellCastingParameters.usedSecondGreaterVitalEvolutionSlot === 0 ? 1 : 0) !== 1 ? "s" :
                            ""}}
                            available
                    </span>

                    <i
                        class="bi-question-circle"
                        [ngbPopover]="GreaterVitalEvolution"
                    ></i>

                    <ng-template #GreaterVitalEvolution>
                        <header class="spellHeader">Greater Vital Evolution</header>

                        <span>
                            Twice per day, you can cast a spell after you've run out of
                                spell slots of the appropriate spell level; the two spells you cast with this feat must
                                be of different spell levels.
                        </span>
                    </ng-template>
                </div>
            </header>

            <ng-container *ngFor="let spellCastingLevelParameters of (spellCastingLevelParameters$(spellCastingParameters, componentParameters) | async); trackBy:trackByIndex;">
                <div
                    *ngIf="(spellCastingLevelParameters.spellTakenList.length || spellCastingLevelParameters.temporaryChoiceList.length)"
                    class="list-item newrow"
                    style="background-color:transparent"
                >
                    <strong>
                        {{levelTitle(spellCastingLevelParameters.level)}}
                    </strong>

                    <span
                        *ngIf="spellCastingLevelParameters.maxSpellSlots && spellCastingLevelParameters.level !== 0"
                        class="hlist right-aligned"
                    >
                        <strong>
                            {{(spellCastingLevelParameters.maxSpellSlots -
                                spellCastingLevelParameters.usedSpellSlots)}}{{spellCastingLevelParameters.extraSpellSlots}}
                                / {{spellCastingLevelParameters.maxSpellSlots}}
                        </strong>

                        <ng-container *ngIf="isManualMode$ | async">
                            <button
                                type="button"
                                [disabled]="spellCastingLevelParameters.usedSpellSlots >= spellCastingLevelParameters.maxSpellSlots"
                                (click)="onManualIncSpellSlots(spellCastingParameters.casting, spellCastingLevelParameters.level, -1)"
                            >
                                -
                            </button>

                            <button
                                type="button"
                                [disabled]="spellCastingLevelParameters.usedSpellSlots <= 0"
                                (click)="onManualIncSpellSlots(spellCastingParameters.casting, spellCastingLevelParameters.level, 1)"
                            >
                                +
                            </button>
                        </ng-container>
                    </span>

                    <strong *ngIf="spellCastingParameters.casting.bondedItemCharges[spellCastingLevelParameters.level] && spellCastingLevelParameters.level !== 0">
                        {{spellCastingParameters.casting.bondedItemCharges[spellCastingLevelParameters.level]}}
                            bonded item charge available
                    </strong>
                </div>

                <div
                    *ngIf="spellCastingLevelParameters.displayFocusPoints"
                    class="list-item"
                >
                    <div class="newrow">
                        <strong>Focus Points</strong>

                        <span class="hlist center-aligned">
                            <div
                                class="value"
                                style="margin-left:0; margin-right:0;"
                            >
                                {{componentParameters.focusPoints.now}}
                            </div>

                            <ng-container *ngIf="isManualMode$ | async">
                                <button
                                    type="button"
                                    [disabled]="componentParameters.focusPoints.now <= 0"
                                    (click)="onManualIncFocusPoints(-1, componentParameters.focusPoints.max)"
                                >
                                    -
                                </button>

                                <button
                                    type="button"
                                    [disabled]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max"
                                    (click)="onManualIncFocusPoints(1, componentParameters.focusPoints.max)"
                                >
                                    +
                                </button>
                            </ng-container>
                        </span>

                        <strong>Focus Pool</strong>

                        <div class="value">{{componentParameters.focusPoints.max}}</div>
                    </div>

                    <button
                        type="button"
                        class="newrow center-aligned"
                        [disabled]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max"
                        (click)="onRefocus()"
                    >
                        Refocus
                    </button>

                    <app-tags
                        [creature]="character"
                        [objectName]="'Focus'"
                        [showTraits]=true
                        [showFeats]=true
                        [showItems]=true
                        [showActivities]=true
                        [showConditions]=true
                        [showEffects]=true
                    />
                </div>

                <div
                    *ngIf="spellCastingLevelParameters.temporaryChoiceList.length"
                    class="vlist"
                >
                    <header class="subsectionHeader box-header">
                        Level {{spellCastingLevelParameters.level}}
                            Temporary Spell Selections
                    </header>

                    <div
                        *ngFor="let choice of spellCastingLevelParameters.temporaryChoiceList; let choicesIndex = index; trackBy:trackByIndex;"
                        class="list-item"
                    >
                        <app-spell-choice
                            class="newrow"
                            [spellCasting]="spellCastingParameters.casting"
                            [choice]="choice"
                            [showHeightened]="true"
                            [allowBorrow]="false"
                            [showChoice]="shownList()"
                            [showSpell]="shownSpell()"
                            [level]="spellCastingLevelParameters.level"
                            [prepared]="choice.source === 'Infinite Possibilities'"
                            [spellbook]="true"
                            (shownChoiceMessage)="receiveShowChoiceMessage($event)"
                            (shownSpellMessage)="receiveShowSpellMessage($event)"
                        />
                    </div>
                </div>

                <div
                    *ngIf="spellCastingLevelParameters.spellTakenList.length && { enabled: isTileMode$ | async } as tileMode"
                    [ngClass]="{'icon-list':tileMode.enabled, 'list-item':!tileMode.enabled}"
                >
                    <ng-container *ngFor="let spellParameters of (spellParameters$(spellCastingLevelParameters, spellCastingParameters) | async); let spellIndex = index; trackBy:trackByIndex;">
                        <ng-template #SpellTitleTemplate>
                            <span *ngIf="!tileMode.enabled">
                                <i
                                    *ngIf="!spellParameters.isHostile"
                                    class="value bi-patch-plus bonus"
                                    [ngbTooltip]="'Beneficial spell'"
                                ></i>

                                <i
                                    *ngIf="spellParameters.isHostile"
                                    class="value bi-patch-minus-fill penalty"
                                    [ngbTooltip]="'Hostile spell'"
                                ></i>
                            </span>

                            <span
                                *ngIf="spellParameters.isSignatureSpell"
                                [ngbTooltip]="'Signature spell'"
                            >
                                <i class='bi-stars'></i>
                            </span>

                            <span
                                *ngIf="spellParameters.isSpellCombinationSpell"
                                [ngbTooltip]="'Combination spell'"
                            >
                                <i class='ra ra-frostfire'></i>
                            </span>

                            <span
                                *ngIf="spellParameters.isInfinitePossibilitiesSpell"
                                [ngbTooltip]="'Infinite Possibilities spell'"
                            >
                                <i class='ra ra-kaleidoscope'></i>
                            </span>

                            <span
                                *ngIf="spellParameters.isSpellMasterySpell"
                                [ngbTooltip]="'Spell Mastery spell'"
                            >
                                <i class='ra ra-crown'></i>
                            </span>

                            <span
                                *ngIf="spellParameters.choice.crossbloodedEvolution"
                                [ngbTooltip]="'Crossblooded Evolution spell'"
                            >
                                <i class='ra ra-zigzag-leaf'></i>
                            </span>
                            {{spellParameters.spell.name}} {{spellParameters.gain.combinationSpellName ? " & " +
                                spellParameters.gain.combinationSpellName : ""}}
                            <ng-container *ngIf="!spellParameters.gain.combinationSpellName">
                                <app-action-icons [actionString]="spellParameters.spell.actions" />
                                {{spellParameters.spell.castType}}
                            </ng-container>
                            {{(spellCastingParameters.casting.tradition !== spellParameters.choice.tradition &&
                                spellParameters.choice.tradition) ? "(" + spellParameters.choice.tradition + ")" : ""}}
                                {{spellParameters.choice.frequency ? spellParameters.choice.frequency : ""}}
                        </ng-template>

                        <ng-template #SpellTooltipTemplate>
                            <span *ngIf="spellParameters.isSignatureSpell">
                                <i class='bi-stars'></i>
                            </span>

                            <span *ngIf="spellParameters.isSpellCombinationSpell">
                                <i class='ra ra-frostfire'></i>
                            </span>

                            <span *ngIf="spellParameters.isInfinitePossibilitiesSpell">
                                <i class='ra ra-kaleidoscope'></i>
                            </span>

                            <span *ngIf="spellParameters.isSpellMasterySpell">
                                <i class='ra ra-crown'></i>
                            </span>

                            <span *ngIf="spellParameters.choice.crossbloodedEvolution">
                                <i class='ra ra-zigzag-leaf'></i>
                            </span>
                            {{spellParameters.spell.name}} {{spellParameters.gain.combinationSpellName ? " & " +
                                spellParameters.gain.combinationSpellName : ""}}
                            <ng-container *ngIf="!spellParameters.gain.combinationSpellName">
                                <app-action-icons [actionString]="spellParameters.spell.actions" />
                                {{spellParameters.spell.castType}}
                            </ng-container>
                            {{(spellCastingParameters.casting.tradition !== spellParameters.choice.tradition &&
                                spellParameters.choice.tradition) ? "(" + spellParameters.choice.tradition + ")" : ""}}
                                {{spellParameters.choice.frequency ? spellParameters.choice.frequency : ""}}
                        </ng-template>

                        <ng-template #SpellTemplate>
                            <header
                                *ngIf="tileMode.enabled"
                                class="spellHeader left-aligned newrow"
                            >
                                <ng-container *ngTemplateOutlet="SpellTitleTemplate" />
                            </header>

                            <div
                                *ngIf="spellParameters.effectiveSpellLevel !== spellCastingLevelParameters.level"
                                class="newrow list-item left-aligned"
                            >
                                Effective spell level: {{spellParameters.effectiveSpellLevel}}
                            </div>

                            <app-spell-target
                                class="newrow vlist"
                                [creature]="character"
                                [spell]="spellParameters.spell"
                                [gain]="spellParameters.gain"
                                [phrase]="'Cast' + (spellParameters.maxCharges ? ' (' + (spellParameters.maxCharges - spellParameters.usedCharges) + ' of ' + spellParameters.maxCharges + ' charges)' : '')"
                                [casting]="spellCastingParameters.casting"
                                [cannotCast]="spellParameters.cannotCast"
                                [effectiveSpellLevel]="spellParameters.effectiveSpellLevel"
                                [cannotExpend]="spellParameters.cannotExpend"
                                [showExpend]="true"
                                [bloodMagicFeats]="componentParameters.bloodMagicFeats"
                                [showDismiss]="true"
                                (castMessage)="onCast($event.target, $event.activated, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, $event.options)"
                            />

                            <div
                                *ngIf="spellCastingParameters.casting.castingType === 'Focus' && spellParameters.spell.allowReturnFocusPoint"
                                class="newrow"
                                [ngbTooltip]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max ? 'Focus points are full.' : ''"
                            >
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    [disabled]="componentParameters.focusPoints.now >= componentParameters.focusPoints.max"
                                    (click)="onReturnFocusPoint(componentParameters.focusPoints.max)"
                                >
                                    <span class="center-aligned">Return Focus Point</span>
                                </button>
                            </div>

                            <div
                                *ngIf="spellParameters.showRestoreOption"
                                class="newrow"
                                [ngbTooltip]="!spellCastingLevelParameters.canRestore ? 'No bonded item charges remaining.' : ''"
                            >
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    [disabled]="!spellCastingLevelParameters.canRestore"
                                    (click)="onRestoreSpellFromBondedItem(spellParameters.gain, spellCastingParameters.casting, spellCastingLevelParameters.level)"
                                >
                                    <span class="center-aligned">
                                        Restore with bonded item
                                        <app-action-icons [actionString]="'Free'" />
                                    </span>
                                </button>
                            </div>

                            <div
                                *ngIf="spellCastingParameters.casting.castingType === 'Prepared' && !spellParameters.gain.prepared && spellCastingLevelParameters.level > 0 && spellParameters.canReprepare"
                                class="newrow"
                            >
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    (click)="onReprepareSpell(spellParameters.gain)"
                                >
                                    <span class="center-aligned">
                                        Reprepare
                                        <app-action-icons
                                            *ngIf="(isManualMode$ | async) === false"
                                            [actionString]="'10 minutes'"
                                        />
                                    </span>
                                </button>
                            </div>

                            <div
                                *ngIf="spellParameters.gain.activeCooldown && (isManualMode$ | async)"
                                class="newrow"
                            >
                                <!-- End cooldown button in manual mode -->
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    (click)="onManualEndCooldown(spellParameters.gain)"
                                >
                                    <span class="center-aligned">End cooldown</span>
                                </button>
                            </div>

                            <div
                                *ngIf="spellParameters.gain.chargesUsed && (isManualMode$ | async)"
                                class="newrow"
                            >
                                <!-- Restore charges button in manual mode -->
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    (click)="onManualRestoreCharge(spellParameters.gain)"
                                >
                                    <span>Restore charge</span>
                                </button>
                            </div>

                            <div
                                *ngIf="spellCastingParameters.canCounterSpell && !spellParameters.gain.active && spellCastingLevelParameters.level > 0"
                                class="newrow"
                                [ngbTooltip]="spellParameters.cannotExpend"
                            >
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    [disabled]="spellParameters.cannotExpend"
                                    (click)="onCast('', true, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, {expend: true})"
                                >
                                    Expend to counter spell
                                </button>
                            </div>

                            <div
                                *ngIf="spellParameters.canChannelSmite && !spellParameters.gain.active && spellCastingLevelParameters.level > 0"
                                class="newrow"
                                [ngbTooltip]="spellParameters.cannotExpend"
                            >
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    [disabled]="spellParameters.cannotExpend"
                                    (click)="onCast('', true, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, {expend: true})"
                                >
                                    Expend for channel smite
                                </button>
                            </div>

                            <div
                                *ngIf="spellParameters.canSwiftBanish && !spellParameters.gain.active && spellCastingLevelParameters.level > 0"
                                class="newrow"
                                [ngbTooltip]="spellParameters.cannotExpend"
                            >
                                <button
                                    type="button"
                                    class="newrow center-aligned"
                                    [disabled]="spellParameters.cannotExpend"
                                    (click)="onCast('', true, { spellParameters: spellParameters, spellCastingLevelParameters: spellCastingLevelParameters, spellCastingParameters: spellCastingParameters, componentParameters: componentParameters }, {expend: true})"
                                >
                                    Expend for swift banishment
                                </button>
                            </div>

                            <ng-container *ngFor="let conditionSet of spellConditions$(spellParameters.spell, spellParameters.effectiveSpellLevel, spellParameters.gain) | async; let conditionSetIndex = index; trackBy:trackByIndex">
                                <div
                                    *ngIf="conditionSet.show"
                                    class="newrow list-item left-aligned"
                                >
                                    <span>
                                        {{conditionSet.condition.name}} effect selection:
                                        <select
                                            aria-label="Select condition effect"
                                            [(ngModel)]="spellParameters.gain.effectChoices[conditionSetIndex].choice"
                                        >
                                            <option
                                                *ngFor="let choice of conditionSet.choices; trackBy:trackByIndex;"
                                                [ngValue]="choice"
                                            >
                                                {{choice}}
                                            </option>
                                        </select>
                                    </span>
                                </div>
                            </ng-container>

                            <ng-container *ngIf="!spellParameters.gain.combinationSpellName">
                                <app-spell
                                    class="list-item"
                                    [spell]="spellParameters.spell"
                                    [spellLevel]="spellParameters.effectiveSpellLevel"
                                    [source]="spellParameters.gain.source"
                                    [casting]="spellCastingParameters.casting"
                                />
                            </ng-container>

                            <ng-container *ngIf="spellParameters.gain.combinationSpellName">
                                <header class="spellHeader left-aligned">
                                    {{spellParameters.spell.name}}
                                    <app-action-icons [actionString]="spellParameters.spell.actions" />
                                    {{(spellParameters.spell.castType) ? spellParameters.spell.castType : ""}}
                                </header>

                                <app-spell
                                    class="list-item"
                                    [spell]="spellParameters.spell"
                                    [spellLevel]="spellParameters.effectiveSpellLevel"
                                    [source]="spellParameters.gain.source"
                                    [casting]="spellCastingParameters.casting"
                                />

                                <ng-container *ngIf="spellFromName(spellParameters.gain.combinationSpellName) as secondSpell">
                                    <header class="spellHeader left-aligned">
                                        {{secondSpell.name}}
                                        <app-action-icons [actionString]="secondSpell.actions" />
                                        {{(secondSpell.castType) ? secondSpell.castType : ""}}
                                    </header>

                                    <app-spell
                                        class="list-item"
                                        [spell]="secondSpell"
                                        [spellLevel]="spellParameters.effectiveSpellLevel"
                                        [source]="spellParameters.gain.source"
                                        [casting]="spellCastingParameters.casting"
                                    />
                                </ng-container>
                            </ng-container>
                        </ng-template>

                        <ng-container *ngIf="!tileMode.enabled">
                            <div class="list-item">
                                <button
                                    type="button"
                                    aria-label="Show spell"
                                    class="newrow sublist-toggle left-aligned"
                                    [ngClass]="{'inactive-button': spellParameters.cannotCast}"
                                    (click)="toggleShownSpell(spellCastingLevelParameters.level+spellCastingParameters.casting.castingType+spellCastingParameters.casting.className+spellParameters.gain.name+spellIndex)"
                                >
                                    <ng-container *ngTemplateOutlet="SpellTitleTemplate" />
                                </button>

                                <div
                                    *ngIf="shownSpell()===spellCastingLevelParameters.level+spellCastingParameters.casting.castingType+spellCastingParameters.casting.className+spellParameters.gain.name+spellIndex"
                                    class="list-item sublist lower"
                                    [ngClass]="{'inactive-list': spellParameters.cannotCast}"
                                >
                                    <ng-container *ngTemplateOutlet="SpellTemplate" />
                                </div>
                            </div>
                        </ng-container>

                        <ng-container *ngIf="tileMode.enabled">
                            <button
                                type="button"
                                aria-label="Show spell"
                                triggers="click"
                                [stickyPopover]="SpellTemplate"
                                [ngClass]="{'inactive-button': spellParameters.cannotCast, 'penalty':!spellParameters.cannotCast && spellParameters.isHostile, 'bonus':!spellParameters.cannotCast && !spellParameters.isHostile}"
                            >
                                <app-grid-icon
                                    [ngClass]="{'inactive-button': spellParameters.cannotCast, 'penalty':!spellParameters.cannotCast && spellParameters.isHostile, 'bonus':!spellParameters.cannotCast && !spellParameters.isHostile}"
                                    [ngbTooltip]="SpellTooltipTemplate"
                                    [title]="spellParameters.spell.name + (spellParameters.gain.combinationSpellName ? ' & ' + spellParameters.gain.combinationSpellName : '')"
                                    [superTitle]="(spellParameters.isSignatureSpell ? 'icon-bi-stars|' : '') + (spellParameters.isSpellCombinationSpell ? 'icon-ra ra-frostfire|' : '') + (spellParameters.isInfinitePossibilitiesSpell ? 'icon-ra ra-kaleidoscope|' : '') + (spellParameters.isSpellMasterySpell ? 'icon-ra ra-crown|' : '') + (spellParameters.choice.crossbloodedEvolution ? 'icon-ra ra-zigzag-leaf|' : '')"
                                    [spell]="spellParameters.spell"
                                />
                            </button>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </ng-container>
</div>
