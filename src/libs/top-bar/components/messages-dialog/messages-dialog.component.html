<app-character-sheet-card>
    <app-dialog-header
        #Header
        [title]="title"
        [close]="close"
    />

    <div class="content">
        <p>
            Select all effects you want to apply. All other effects will be
            discarded.
        </p>

        <div class="content__header">
            <app-checkbox-input
                id="messagesSelectAll"
                [ngModel]="areAllMessagesSelected()"
                (ngModelChange)="onSelectAllMessages($event)"
            />

            <label for="messagesSelectAll">
                <strong>Select all</strong>
            </label>
        </div>

        <div class="content__list">
            @for (enriched of enrichedMessages$ | async; track $index) {
                <div class="list-item gridicon-fullsizebox">
                    <app-checkbox-input
                        id="message{{ enriched.message.id }}"
                        [(ngModel)]="enriched.message.selected"
                    />

                    <label for="message{{ enriched.message.id }}">
                        <div class="newrow left-aligned">
                            @if (enriched.message.offeredItem.length) {
                                <i class="ra ra-sword"></i>
                            }

                            @if (enriched.message.gainCondition.length) {
                                <i class="ra ra-splash"></i>
                            }

                            @if (
                                enriched.message.gainCondition.length &&
                                enriched.message.activateCondition
                            ) {
                                <i class="bi-play-circle"></i>
                            }

                            @if (
                                enriched.message.gainCondition.length &&
                                !enriched.message.activateCondition
                            ) {
                                <i class="bi-stop-circle"></i>
                            }

                            @if (
                                enriched.messageTargetCreature.type ===
                                "Character"
                            ) {
                                <i class="ra ra-player"></i>
                            }

                            @if (
                                enriched.messageTargetCreature.type ===
                                "Companion"
                            ) {
                                <i class="ra ra-wolf-howl"></i>
                            }

                            @if (
                                enriched.messageTargetCreature.type ===
                                "Familiar"
                            ) {
                                <i class="ra ra-raven"></i>
                            }

                            @if (enriched.message.gainCondition.length) {
                                <strong>
                                    {{
                                        enriched.message.gainCondition[0].name +
                                            (enriched.message.gainCondition[0]
                                                .choice
                                                ? ": " +
                                                  enriched.message
                                                      .gainCondition[0].choice
                                                : "")
                                    }}
                                </strong>
                                {{
                                    enriched.conditionMessageDurationDescription
                                }}
                            }

                            @if (enriched.message.offeredItem.length) {
                                <strong>
                                    {{
                                        (enriched.message.itemAmount !== 1
                                            ? enriched.message.itemAmount + " "
                                            : "") +
                                            enriched.message.offeredItem[0].name
                                    }}
                                </strong>
                                {{ enriched.itemMessageIncludedAmount }}
                            }
                        </div>

                        <div class="text-small">
                            Sent{{
                                enriched.messageSenderName
                                    ? " by " + enriched.messageSenderName
                                    : ""
                            }}
                            at {{ enriched.message.time }}
                        </div>
                    </label>
                </div>
            }
        </div>

        <div class="content__options">
            <app-label-input-pair
                label="Keep checking automatically"
                type="switch"
                [sublines]="['Can be turned off in settings']"
                [(ngModel)]="character.settings.checkMessagesAutomatically"
            />
        </div>
    </div>

    <app-dialog-footer
        #Footer
        [cancelLabel]="cancelLabel"
        [buttons]="buttons"
        [close]="close"
        [hideCancel]="hideCancel"
    />
</app-character-sheet-card>
