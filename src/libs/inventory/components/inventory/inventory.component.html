<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<app-character-sheet-card
    [showMinimizeButton]="shouldShowMinimizeButton"
    [showTileModeButton]="true"
    [minimized]="(isMinimized$ | async) ?? false"
    [tileMode]="(isTileMode$ | async) ?? false"
    (toggleMinimized)="toggleMinimized($event)"
    (toggleTileMode)="toggleTileMode($event)"
>
    @if (creature$ | async; as creature) {
        <div
            class="attributeBox"
            id="{{ creature }}-inventory-height"
        >
            <header class="sectionHeader box-header">Inventory</header>

            @if (!itemStore) {
                <button
                    type="button"
                    class="minimized-hide list-item center-aligned"
                    (click)="
                        setItemsMenuTarget(creature.type); toggleItemsMenu()
                    "
                >
                    Get Items
                </button>
            }

            @if (creature.isCharacter()) {
                <header class="subsectionHeader">Currency</header>
            }

            @if (creature.isCharacter() && character.cash; as cash) {
                <div class="list-item">
                    <strong>Platinum</strong>

                    <div class="value">{{ cash[0] }}</div>

                    <strong>Gold</strong>

                    <div class="value">{{ cash[1] }}</div>

                    <strong>Silver</strong>

                    <div class="value">{{ cash[2] }}</div>

                    <strong>Copper</strong>

                    <div class="value center-aligned">{{ cash[3] }}</div>

                    <button
                        type="button"
                        class="center-aligned"
                        [ngbTooltip]="
                            'Exchange coins for higher currency (no higher than Gold).'
                        "
                        (click)="sortCash()"
                    >
                        Sort
                    </button>
                </div>
            }

            <header class="subsectionHeader">Bulk</header>

            @if (currentBulk$ | async; as currentBulk) {
                <app-attribute-value
                    [title]="'Bulk'"
                    [creature]="creature"
                    [customEffectsTarget]="'Bulk'"
                    [value]="currentBulk.result"
                    [bonuses]="currentBulk.bonuses"
                />

                <app-tags
                    [creature]="creature"
                    [objectName]="'Bulk'"
                    [showTraits]="true"
                    [showFeats]="true"
                    [showItems]="true"
                    [showActivities]="true"
                    [showConditions]="true"
                    [showEffects]="true"
                />
            }

            @if (encumberedLimit$ | async; as encumberedLimit) {
                <app-attribute-value
                    [title]="'Encumbered Limit'"
                    [creature]="creature"
                    [customEffectsTarget]="'Encumbered Limit'"
                    [value]="encumberedLimit.result"
                    [bonuses]="encumberedLimit.bonuses"
                />

                <app-tags
                    [creature]="creature"
                    [objectName]="'Encumbered Limit'"
                    [showTraits]="true"
                    [showFeats]="true"
                    [showItems]="true"
                    [showActivities]="true"
                    [showConditions]="true"
                    [showEffects]="true"
                />
            }

            @if (maxBulk$ | async; as maxBulk) {
                <app-attribute-value
                    [title]="'Max Bulk'"
                    [creature]="creature"
                    [customEffectsTarget]="'Max Bulk'"
                    [value]="maxBulk.result"
                    [bonuses]="maxBulk.bonuses"
                />

                <app-tags
                    [creature]="creature"
                    [objectName]="'Max Bulk'"
                    [showTraits]="true"
                    [showFeats]="true"
                    [showItems]="true"
                    [showActivities]="true"
                    [showConditions]="true"
                    [showEffects]="true"
                />
            }

            @if (
                quickCraftingParameters$() | async;
                as quickCraftingParameters
            ) {
                <header class="sectionHeader minimized-hide box-header">
                    Quick Crafting
                </header>

                <app-tags
                    [creature]="creature"
                    [objectName]="'Quick Crafting'"
                    [showTraits]="true"
                    [showFeats]="true"
                    [showItems]="true"
                    [showActivities]="true"
                    [showConditions]="true"
                    [showEffects]="true"
                />

                @if (quickCraftingParameters.hasSnareSpecialist) {
                    <button
                        type="button"
                        class="list-item"
                        (click)="toggleShownList('snarespecialist')"
                    >
                        <header class="sectionHeader">Snare Specialist</header>
                    </button>
                }

                @if (shownList() === "snarespecialist") {
                    @if (
                        !itemsPreparedForQuickCrafting("snarespecialist").length
                    ) {
                        <div class="newrow">
                            You don't have any snares prepared for quick
                            deployment.
                        </div>
                    }

                    @for (
                        preparedItem of itemsPreparedForQuickCrafting(
                            "snarespecialist"
                        );
                        track $index
                    ) {
                        @if (
                            "snarespecialist" + preparedItem.item.id;
                            as inventoryID
                        ) {
                            <div class="list-item">
                                <button
                                    type="button"
                                    class="newrow sublist-toggle"
                                    [ngClass]="{
                                        'inactive-button':
                                            !preparedItem.learned
                                                .snareSpecialistAvailable,
                                    }"
                                    (click)="toggleShownItem(inventoryID)"
                                >
                                    <span>
                                        {{
                                            preparedItem.learned
                                                .snareSpecialistAvailable
                                        }}
                                        {{ preparedItem.item.effectiveName$() }}
                                    </span>

                                    <span>
                                        {{
                                            preparedItem.item.level
                                                ? "Level " +
                                                  preparedItem.item.level
                                                : "&nbsp;"
                                        }}
                                    </span>
                                </button>

                                @if (shownItem() === inventoryID) {
                                    <div
                                        class="list-item sublist lower"
                                        [ngClass]="{
                                            'inactive-list':
                                                !preparedItem.learned
                                                    .snareSpecialistAvailable,
                                        }"
                                    >
                                        @if (
                                            cannotCraftReason$(
                                                preparedItem.item,
                                                preparedItem.learned,
                                                "snarespecialist"
                                            ) | async;
                                            as cannotCraftReason
                                        ) {
                                            <div
                                                [ngbTooltip]="
                                                    cannotCraftReason.join('\n')
                                                "
                                            >
                                                <button
                                                    type="button"
                                                    class="newrow center-aligned"
                                                    [disabled]="
                                                        cannotCraftReason.length
                                                    "
                                                    (click)="
                                                        craftItem(
                                                            preparedItem.item,
                                                            preparedItem.learned,
                                                            'snarespecialist'
                                                        )
                                                    "
                                                >
                                                    <span>
                                                        Deploy Snare
                                                        <app-action-icons
                                                            [actionString]="
                                                                (snareSpecialistActions$(
                                                                    preparedItem.item
                                                                ) | async) ?? ''
                                                            "
                                                        />
                                                    </span>
                                                </button>
                                            </div>
                                        }

                                        <app-item
                                            [item]="preparedItem.item"
                                            [itemStore]="true"
                                        />
                                    </div>
                                }
                            </div>
                        }
                    }
                }
            }

            <header class="sectionHeader minimized-hide box-header">
                Items
            </header>

            <app-tags
                [creature]="creature"
                [objectName]="'Inventory'"
                [showTraits]="true"
                [showFeats]="true"
                [showItems]="true"
                [showActivities]="true"
                [showConditions]="true"
                [showEffects]="true"
            />

            @if (currentInvested$ | async; as currentInvested) {
                <div class="minimized-hide">
                    <app-attribute-value
                        [title]="'Invested'"
                        [value]="currentInvested"
                    />
                </div>
            }

            @if (maxInvested$ | async; as maxInvested) {
                <div class="minimized-hide">
                    <app-attribute-value
                        [title]="'Max Invested'"
                        [creature]="creature"
                        [customEffectsTarget]="'Max Invested'"
                        [value]="maxInvested.result"
                        [bonuses]="maxInvested.bonuses"
                    />

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Max Invested'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                        [showEffects]="true"
                        [specialEffects]="maxInvested.effects"
                    />
                </div>
            }

            <div
                class="vlist"
                cdkDropListGroup
            >
                @for (
                    inventory of creature.inventories;
                    track inventoryIndex;
                    let inventoryIndex = $index
                ) {
                    <div
                        class="list-item"
                        [ngClass]="{ 'minimized-hide': inventoryIndex > 1 }"
                    >
                        @if (inventory.bulkLimit) {
                            <header class="sectionHeader minimized-hide newrow">
                                {{ inventoryName$(inventory) | async }}
                                {{ inventoryBulkDescription(inventory) }}
                            </header>
                        }

                        @if (
                            isInventoryEmpty(inventory) && {
                                enabled: isTileMode$ | async,
                            };
                            as tileMode
                        ) {
                            <div
                                cdkDropList
                                id="{{ inventory.id }}|blank"
                                [ngClass]="{
                                    'icon-list': tileMode.enabled,
                                    'vlist fullwidth': !tileMode.enabled,
                                }"
                                [ngStyle]="{
                                    'min-height': tileMode.enabled
                                        ? null
                                        : '2em',
                                    display: tileMode.enabled ? null : 'flex',
                                }"
                                (cdkDropListDropped)="
                                    dragdropInventoryItem($event)
                                "
                            ></div>
                        }

                        @for (itemSet of inventory.names; track $index) {
                            @if (
                                sortItemSet(inventory, itemSet.key);
                                as itemList
                            ) {
                                @if (itemList.length) {
                                    <header class="subsectionHeader newrow">
                                        {{ itemSet.name }}
                                    </header>
                                }

                                @if (
                                    itemList.length && {
                                        enabled: isTileMode$ | async,
                                    };
                                    as tileMode
                                ) {
                                    <div
                                        cdkDropList
                                        id="{{ inventory.id }}|{{
                                            itemSet.key
                                        }}"
                                        [ngClass]="{
                                            'icon-list': tileMode.enabled,
                                            'vlist fullwidth':
                                                !tileMode.enabled,
                                        }"
                                        [ngStyle]="{
                                            'min-height': tileMode.enabled
                                                ? null
                                                : '2em',
                                        }"
                                        (cdkDropListDropped)="
                                            dragdropInventoryItem($event)
                                        "
                                    >
                                        @for (
                                            itemParameters of itemParameters$(
                                                itemList
                                            ) | async;
                                            track itemParameters.id
                                        ) {
                                            <ng-template #ItemIconsTemplate>
                                                @if (
                                                    itemParameters.asEquipment
                                                        ?.material?.[0];
                                                    as material
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            material &&
                                                            material?.name
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-diamond"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.asEquipment
                                                        ?.broken
                                                ) {
                                                    <span
                                                        [ngbTooltip]="'Broken'"
                                                    >
                                                        <i
                                                            class="ra ra-broken-shield"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.asEquipment
                                                        ?.shoddy
                                                ) {
                                                    <span
                                                        [ngbTooltip]="'Shoddy'"
                                                    >
                                                        <i
                                                            class="ra ra-broken-bottle"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.item
                                                        .expiration
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Temporary Item'
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-clockwork"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.asWeapon
                                                        ?.large
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Large Weapon'
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-large-hammer"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters
                                                        .asBladeAllyChangeable
                                                        ?.bladeAlly
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Blade Ally'
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-fireball-sword"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters
                                                        .asBattleforgedChangeable
                                                        ?.battleforged
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Battleforged'
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-anvil"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.hasEmblazonArmament
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Emblazon Armament'
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-fire-shield"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.emblazonEnergyChoice
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Emblazon Energy: ' +
                                                            itemParameters.emblazonEnergyChoice
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-bolt-shield"
                                                        ></i>
                                                    </span>
                                                }

                                                @if (
                                                    itemParameters.hasEmblazonAntimagic
                                                ) {
                                                    <span
                                                        [ngbTooltip]="
                                                            'Emblazon Antimagic'
                                                        "
                                                    >
                                                        <i
                                                            class="ra ra-eye-shield"
                                                        ></i>
                                                    </span>
                                                }
                                            </ng-template>

                                            <ng-template #ItemTitleTemplate>
                                                <span
                                                    class="hlist left-aligned"
                                                >
                                                    @if (
                                                        itemParameters.canUse !==
                                                            undefined && {
                                                            enabled:
                                                                isTileMode$
                                                                | async,
                                                        };
                                                        as tileMode
                                                    ) {
                                                        <span>
                                                            @if (
                                                                !tileMode.enabled &&
                                                                itemParameters.canUse ===
                                                                    false
                                                            ) {
                                                                <i
                                                                    class="value bi-x penalty"
                                                                    [ngbTooltip]="
                                                                        'You are not trained with this item.'
                                                                    "
                                                                ></i>
                                                            }

                                                            @if (
                                                                !tileMode.enabled &&
                                                                itemParameters.canUse
                                                            ) {
                                                                <i
                                                                    class="value bi-check2 bonus"
                                                                    [ngbTooltip]="
                                                                        'You are trained with this item.'
                                                                    "
                                                                ></i>
                                                            }
                                                        </span>
                                                    }

                                                    <ng-container
                                                        *ngTemplateOutlet="
                                                            ItemIconsTemplate
                                                        "
                                                    />
                                                    {{
                                                        itemParameters.item
                                                            .amount !==
                                                            undefined &&
                                                        itemParameters.item
                                                            .amount !== 1
                                                            ? itemParameters
                                                                  .item.amount +
                                                              " "
                                                            : ""
                                                    }}
                                                    {{
                                                        itemParameters.item.effectiveName$()
                                                    }}
                                                    @if (
                                                        itemParameters.containedItemsAmount
                                                    ) {
                                                        <span class="lower">
                                                            contains
                                                            {{
                                                                itemParameters.containedItemsAmount
                                                            }}
                                                            {{
                                                                itemParameters.containedItemsAmount ===
                                                                1
                                                                    ? "item"
                                                                    : "items"
                                                            }}
                                                        </span>
                                                    }
                                                </span>

                                                @if (
                                                    itemParameters.item.level
                                                ) {
                                                    <span
                                                        style="
                                                            flex-basis: auto;
                                                            flex-grow: 0;
                                                        "
                                                    >
                                                        Level
                                                        {{
                                                            itemParameters.item
                                                                .level
                                                        }}
                                                    </span>
                                                }
                                            </ng-template>

                                            <ng-template #ItemTooltipTemplate>
                                                <ng-container
                                                    *ngTemplateOutlet="
                                                        ItemIconsTemplate
                                                    "
                                                />
                                                {{
                                                    itemParameters.item
                                                        .amount !== undefined &&
                                                    itemParameters.item
                                                        .amount !== 1
                                                        ? itemParameters.item
                                                              .amount + " "
                                                        : ""
                                                }}
                                                {{
                                                    itemParameters.item.effectiveName$()
                                                }}
                                                @if (
                                                    itemParameters.containedItemsAmount
                                                ) {
                                                    <span class="lower">
                                                        contains
                                                        {{
                                                            itemParameters.containedItemsAmount
                                                        }}
                                                        {{
                                                            itemParameters.containedItemsAmount ===
                                                            1
                                                                ? "item"
                                                                : "items"
                                                        }}
                                                    </span>
                                                }
                                            </ng-template>

                                            <ng-template #ItemTemplate>
                                                @if (isTileMode$ | async) {
                                                    <header
                                                        class="spellHeader newrow"
                                                    >
                                                        <ng-container
                                                            *ngTemplateOutlet="
                                                                ItemTitleTemplate
                                                            "
                                                        />
                                                    </header>
                                                }

                                                @if (itemParameters.asArmor) {
                                                    <div
                                                        class="newrow left-aligned"
                                                    >
                                                        <span
                                                            [ngClass]="{
                                                                absolute:
                                                                    itemParameters.asArmor.hasProficiencyChanged(
                                                                        itemParameters.proficiency
                                                                    ),
                                                            }"
                                                        >
                                                            {{
                                                                itemParameters.asArmor.title$()
                                                                    | async
                                                            }}
                                                        </span>

                                                        @if (
                                                            itemParameters.asArmor.hasProficiencyChanged(
                                                                itemParameters.proficiency
                                                            )
                                                        ) {
                                                            <span>
                                                                (normally
                                                                {{
                                                                    itemParameters
                                                                        .asArmor
                                                                        .prof
                                                                }})
                                                            </span>
                                                        }
                                                    </div>
                                                }

                                                @if (itemParameters.asWeapon) {
                                                    <div
                                                        class="newrow left-aligned"
                                                    >
                                                        <span
                                                            [ngClass]="{
                                                                absolute:
                                                                    itemParameters.asWeapon.hasProficiencyChanged(
                                                                        itemParameters.proficiency
                                                                    ),
                                                            }"
                                                        >
                                                            {{
                                                                itemParameters.asWeapon.title(
                                                                    {
                                                                        preparedProficiency:
                                                                            itemParameters.proficiency,
                                                                    }
                                                                )
                                                            }}
                                                        </span>

                                                        @if (
                                                            itemParameters.asWeapon.hasProficiencyChanged(
                                                                itemParameters.proficiency
                                                            )
                                                        ) {
                                                            <span>
                                                                (normally
                                                                {{
                                                                    itemParameters
                                                                        .asWeapon
                                                                        .prof
                                                                }})
                                                            </span>
                                                        }
                                                    </div>
                                                }

                                                @if (
                                                    itemParameters.item
                                                        .expiration
                                                ) {
                                                    <div class="newrow lower">
                                                        <span>
                                                            <strong
                                                                >Duration</strong
                                                            >
                                                            {{
                                                                durationDescription$(
                                                                    itemParameters
                                                                        .item
                                                                        .expiration
                                                                ) | async
                                                            }}
                                                            @if (
                                                                itemParameters
                                                                    .item
                                                                    .expiresOnlyIf
                                                            ) {
                                                                <span>
                                                                    {{
                                                                        itemParameters
                                                                            .item
                                                                            .expiresOnlyIf ===
                                                                        "equipped"
                                                                            ? "(The item only expires while equipped.)"
                                                                            : "(The item only expires while not equipped.)"
                                                                    }}
                                                                </span>
                                                            }
                                                        </span>
                                                    </div>
                                                }

                                                @if (
                                                    itemParameters.item
                                                        .amount !== undefined &&
                                                    itemParameters.asImmediateStoredSpellItem
                                                ) {
                                                    @for (
                                                        itemSpell of itemStoredSpell(
                                                            itemParameters.item
                                                        );
                                                        track $index
                                                    ) {
                                                        <app-spell-target
                                                            class="newrow vlist"
                                                            [creature]="
                                                                creature
                                                            "
                                                            [phrase]="
                                                                !!itemParameters
                                                                    .asWand
                                                                    ?.cooldown
                                                                    ? 'Overcharge (Cooldown ' +
                                                                      (durationDescription$(
                                                                          itemParameters
                                                                              .asWand
                                                                              ?.cooldown
                                                                      )
                                                                          | async) +
                                                                      ') and cast'
                                                                    : 'Cast'
                                                            "
                                                            [showActions]="true"
                                                            [spell]="
                                                                itemSpell.spell
                                                            "
                                                            [gain]="
                                                                itemSpell.gain
                                                            "
                                                            [cannotCast]="
                                                                itemParameters
                                                                    .asEquipment
                                                                    ?.broken
                                                                    ? 'The item is broken and cannot be used.'
                                                                    : ''
                                                            "
                                                            [effectiveSpellLevel]="
                                                                itemSpell.choice
                                                                    .level
                                                            "
                                                            (castMessage)="
                                                                onUseSpellCastingItem(
                                                                    itemParameters.item,
                                                                    $event.target,
                                                                    inventory
                                                                )
                                                            "
                                                        />
                                                    }
                                                }

                                                @if (
                                                    itemParameters.asConsumable &&
                                                    itemParameters.item
                                                        .amount !== undefined
                                                ) {
                                                    @if (
                                                        itemParameters.item
                                                            .amount !==
                                                            undefined &&
                                                        (
                                                            itemParameters.asGenericConsumable ||
                                                            itemParameters.asDrinkableConsumable
                                                        )?.actions
                                                    ) {
                                                        <button
                                                            type="button"
                                                            class="newrow center-aligned"
                                                            [disabled]="
                                                                !itemParameters
                                                                    .asConsumable
                                                                    .amount
                                                            "
                                                            (click)="
                                                                onUseConsumable(
                                                                    itemParameters.asConsumable,
                                                                    creature.type,
                                                                    inventory
                                                                )
                                                            "
                                                        >
                                                            <span>
                                                                Use
                                                                @if (
                                                                    itemParameters
                                                                        .asConsumable
                                                                        .actions
                                                                ) {
                                                                    <app-action-icons
                                                                        [actionString]="
                                                                            itemParameters
                                                                                .asConsumable
                                                                                .actions
                                                                        "
                                                                    />
                                                                }
                                                                {{
                                                                    itemParameters
                                                                        .asConsumable
                                                                        .activationType
                                                                        ? itemParameters
                                                                              .asConsumable
                                                                              .activationType
                                                                        : ""
                                                                }}
                                                            </span>
                                                        </button>
                                                    }

                                                    @if (
                                                        !!itemParameters.asDrinkableConsumable &&
                                                        itemParameters
                                                            .asDrinkableConsumable
                                                            .actions
                                                    ) {
                                                        @if (
                                                            (isManualMode$
                                                                | async) ===
                                                                false &&
                                                            (isAnimalCompanionAvailable$
                                                                | async)
                                                        ) {
                                                            <button
                                                                type="button"
                                                                class="newrow center-aligned"
                                                                [disabled]="
                                                                    !itemParameters
                                                                        .asDrinkableConsumable
                                                                        .amount
                                                                "
                                                                (click)="
                                                                    onUseConsumable(
                                                                        itemParameters.asDrinkableConsumable,
                                                                        creatureTypesEnum.AnimalCompanion,
                                                                        inventory
                                                                    )
                                                                "
                                                            >
                                                                <span>
                                                                    Use (Give to
                                                                    your animal
                                                                    companion)
                                                                    <app-action-icons
                                                                        [actionString]="
                                                                            itemParameters
                                                                                .asDrinkableConsumable
                                                                                .actions
                                                                        "
                                                                    />
                                                                    {{
                                                                        itemParameters
                                                                            .asDrinkableConsumable
                                                                            .activationType
                                                                            ? itemParameters
                                                                                  .asDrinkableConsumable
                                                                                  .activationType
                                                                            : ""
                                                                    }}
                                                                </span>
                                                            </button>
                                                        }

                                                        @if (
                                                            (isManualMode$
                                                                | async) ===
                                                                false &&
                                                            (isFamiliarAvailable$
                                                                | async)
                                                        ) {
                                                            <button
                                                                type="button"
                                                                class="newrow center-aligned"
                                                                [disabled]="
                                                                    !itemParameters
                                                                        .item
                                                                        .amount
                                                                "
                                                                (click)="
                                                                    onUseConsumable(
                                                                        itemParameters.asDrinkableConsumable,
                                                                        creatureTypesEnum.Familiar,
                                                                        inventory
                                                                    )
                                                                "
                                                            >
                                                                <span>
                                                                    Use (Give to
                                                                    your
                                                                    familiar)
                                                                    <app-action-icons
                                                                        [actionString]="
                                                                            itemParameters
                                                                                .asDrinkableConsumable
                                                                                .actions
                                                                        "
                                                                    />
                                                                    {{
                                                                        itemParameters
                                                                            .asDrinkableConsumable
                                                                            .activationType
                                                                            ? itemParameters
                                                                                  .asDrinkableConsumable
                                                                                  .activationType
                                                                            : ""
                                                                    }}
                                                                </span>
                                                            </button>
                                                        }
                                                    }
                                                }

                                                <ng-template
                                                    #ContainerItemDropModal
                                                    let-dropModal
                                                >
                                                    <div class="modal-header">
                                                        <header
                                                            class="sectionHeader modal-title"
                                                            id="modal-title"
                                                        >
                                                            <i
                                                                class="ra ra-hive-emblem"
                                                            ></i>
                                                            Drop contained
                                                            items?
                                                        </header>

                                                        <button
                                                            type="button"
                                                            class="close"
                                                            aria-label="close"
                                                            ngbAutofocus
                                                            (click)="
                                                                dropModal.dismiss(
                                                                    'Cross click'
                                                                )
                                                            "
                                                        >
                                                            <span
                                                                aria-hidden="true"
                                                                >&times;</span
                                                            >
                                                        </button>
                                                    </div>

                                                    <div
                                                        class="modal-body vlist"
                                                    >
                                                        <div
                                                            class="fullsize-scroll-box vlist"
                                                            style="
                                                                max-height: 50vh;
                                                            "
                                                        >
                                                            <div
                                                                class="list-item newrow left-aligned"
                                                            >
                                                                This item is a
                                                                container with
                                                                {{
                                                                    itemParameters.containedItemsAmount
                                                                }}
                                                                item(s)
                                                                currently
                                                                inside. You can
                                                                drop the entire
                                                                pack or keep the
                                                                contained items.
                                                                <div
                                                                    class="newrow lower"
                                                                >
                                                                    If you
                                                                    choose to
                                                                    keep the
                                                                    contained
                                                                    items, they
                                                                    will be
                                                                    moved
                                                                    loosely into
                                                                    your main
                                                                    inventory.
                                                                </div>
                                                            </div>

                                                            <button
                                                                type="button"
                                                                class="fullwidth btn btn-primary"
                                                                style="
                                                                    background-color: rgb(
                                                                        var(
                                                                            --accent
                                                                        )
                                                                    );
                                                                "
                                                                (click)="
                                                                    dropModal.close(
                                                                        'Drop all'
                                                                    )
                                                                "
                                                            >
                                                                Drop this
                                                                container and
                                                                all the items
                                                                inside
                                                            </button>

                                                            <button
                                                                type="button"
                                                                class="fullwidth btn btn-primary"
                                                                style="
                                                                    background-color: rgb(
                                                                        var(
                                                                            --accent
                                                                        )
                                                                    );
                                                                "
                                                                (click)="
                                                                    dropModal.close(
                                                                        'Drop one'
                                                                    )
                                                                "
                                                            >
                                                                Drop this
                                                                container, but
                                                                keep the items
                                                                inside
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <div class="modal-footer">
                                                        <button
                                                            type="button"
                                                            class="btn btn-outline-secondary"
                                                            (click)="
                                                                dropModal.dismiss(
                                                                    'Cancel click'
                                                                )
                                                            "
                                                        >
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </ng-template>

                                                <ng-template
                                                    #GrantingItemDropModal
                                                    let-dropModal
                                                >
                                                    <div class="modal-header">
                                                        <header
                                                            class="sectionHeader modal-title"
                                                            id="modal-title"
                                                        >
                                                            <i
                                                                class="ra ra-hive-emblem"
                                                            ></i>
                                                            Drop included items?
                                                        </header>

                                                        <button
                                                            type="button"
                                                            class="close"
                                                            aria-label="close"
                                                            ngbAutofocus
                                                            (click)="
                                                                dropModal.dismiss(
                                                                    'Cross click'
                                                                )
                                                            "
                                                        >
                                                            <span
                                                                aria-hidden="true"
                                                                >&times;</span
                                                            >
                                                        </button>
                                                    </div>

                                                    <div
                                                        class="modal-body vlist"
                                                    >
                                                        <div
                                                            class="fullsize-scroll-box vlist"
                                                            style="
                                                                max-height: 50vh;
                                                            "
                                                        >
                                                            <div
                                                                class="list-item newrow left-aligned"
                                                            >
                                                                This item
                                                                originally came
                                                                with additional
                                                                items attached
                                                                or included. You
                                                                can drop
                                                                everything or
                                                                just this item.
                                                                <div
                                                                    class="newrow lower"
                                                                >
                                                                    If you
                                                                    choose to
                                                                    drop
                                                                    everything,
                                                                    the
                                                                    following
                                                                    rules apply:
                                                                </div>

                                                                <div
                                                                    class="newrow lower"
                                                                >
                                                                    <ul>
                                                                        <li>
                                                                            Items
                                                                            that
                                                                            cannot
                                                                            stack
                                                                            (most
                                                                            equipment
                                                                            and
                                                                            some
                                                                            consumables)
                                                                            will
                                                                            only
                                                                            be
                                                                            dropped
                                                                            if
                                                                            they
                                                                            were
                                                                            explicitly
                                                                            granted
                                                                            by
                                                                            this
                                                                            item.
                                                                        </li>

                                                                        <li>
                                                                            For
                                                                            items
                                                                            that
                                                                            can
                                                                            stack,
                                                                            you
                                                                            will
                                                                            drop
                                                                            as
                                                                            many
                                                                            as
                                                                            you
                                                                            originally
                                                                            received
                                                                            with
                                                                            this
                                                                            item.
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>

                                                            <button
                                                                type="button"
                                                                class="fullwidth btn btn-primary"
                                                                style="
                                                                    background-color: rgb(
                                                                        var(
                                                                            --accent
                                                                        )
                                                                    );
                                                                "
                                                                (click)="
                                                                    dropModal.close(
                                                                        'Drop all'
                                                                    )
                                                                "
                                                            >
                                                                Drop this item
                                                                and all items
                                                                granted by it
                                                            </button>

                                                            <button
                                                                type="button"
                                                                class="fullwidth btn btn-primary"
                                                                style="
                                                                    background-color: rgb(
                                                                        var(
                                                                            --accent
                                                                        )
                                                                    );
                                                                "
                                                                (click)="
                                                                    dropModal.close(
                                                                        'Drop one'
                                                                    )
                                                                "
                                                            >
                                                                Drop this item,
                                                                but keep all
                                                                items granted by
                                                                it
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <div class="modal-footer">
                                                        <button
                                                            type="button"
                                                            class="btn btn-outline-secondary"
                                                            (click)="
                                                                dropModal.dismiss(
                                                                    'Cancel click'
                                                                )
                                                            "
                                                        >
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </ng-template>

                                                <!-- Upper row of buttons -->
                                                <div class="newrow">
                                                    @if (
                                                        itemParameters.asEquipment
                                                    ) {
                                                        @if (
                                                            maxInvested$
                                                                | async;
                                                            as maxInvested
                                                        ) {
                                                            @if (
                                                                currentInvested$
                                                                    | async;
                                                                as currentInvested
                                                            ) {
                                                                @if (
                                                                    canEquipItem(
                                                                        itemParameters.item,
                                                                        inventoryIndex
                                                                    )
                                                                ) {
                                                                    <span>
                                                                        @if (
                                                                            !itemParameters
                                                                                .asEquipment
                                                                                .equipped
                                                                        ) {
                                                                            <button
                                                                                type="button"
                                                                                (click)="
                                                                                    onEquipItem(
                                                                                        itemParameters.asEquipment,
                                                                                        inventory,
                                                                                        true
                                                                                    )
                                                                                "
                                                                            >
                                                                                Equip
                                                                            </button>
                                                                        }

                                                                        @if (
                                                                            itemParameters
                                                                                .asEquipment
                                                                                .equipped
                                                                        ) {
                                                                            <button
                                                                                type="button"
                                                                                (click)="
                                                                                    onEquipItem(
                                                                                        itemParameters.asEquipment,
                                                                                        inventory,
                                                                                        false
                                                                                    )
                                                                                "
                                                                            >
                                                                                Unequip
                                                                            </button>
                                                                        }
                                                                    </span>
                                                                }

                                                                @if (
                                                                    canInvestItem(
                                                                        itemParameters.item,
                                                                        inventoryIndex
                                                                    )
                                                                ) {
                                                                    <span>
                                                                        @if (
                                                                            !itemParameters
                                                                                .asEquipment
                                                                                .invested
                                                                        ) {
                                                                            <button
                                                                                type="button"
                                                                                [disabled]="
                                                                                    currentInvested >=
                                                                                        maxInvested.result &&
                                                                                    !itemParameters
                                                                                        .asEquipment
                                                                                        .invested
                                                                                "
                                                                                (click)="
                                                                                    onInvestItem(
                                                                                        itemParameters.asEquipment,
                                                                                        inventory,
                                                                                        true
                                                                                    )
                                                                                "
                                                                            >
                                                                                Invest
                                                                            </button>
                                                                        }

                                                                        @if (
                                                                            itemParameters
                                                                                .asEquipment
                                                                                .invested
                                                                        ) {
                                                                            <button
                                                                                type="button"
                                                                                (click)="
                                                                                    onInvestItem(
                                                                                        itemParameters.asEquipment,
                                                                                        inventory,
                                                                                        false
                                                                                    )
                                                                                "
                                                                            >
                                                                                Uninvest
                                                                            </button>
                                                                        }
                                                                    </span>
                                                                }
                                                            }
                                                        }
                                                    }

                                                    @if (
                                                        itemParameters.asStackable
                                                    ) {
                                                        <span class="gap-text">
                                                            <button
                                                                type="button"
                                                                [disabled]="
                                                                    itemParameters
                                                                        .asStackable
                                                                        .amount <=
                                                                    0
                                                                "
                                                                (click)="
                                                                    onAmountChange(
                                                                        itemParameters.asStackable,
                                                                        -1
                                                                    )
                                                                "
                                                            >
                                                                -1
                                                            </button>

                                                            <button
                                                                type="button"
                                                                (click)="
                                                                    onAmountChange(
                                                                        itemParameters.asStackable,
                                                                        1
                                                                    )
                                                                "
                                                            >
                                                                +1
                                                            </button>
                                                        </span>
                                                    }

                                                    @if (
                                                        !canEquipItem(
                                                            itemParameters.item,
                                                            inventoryIndex
                                                        ) &&
                                                        !canInvestItem(
                                                            itemParameters.item,
                                                            inventoryIndex
                                                        ) &&
                                                        !itemParameters.asStackable
                                                    ) {
                                                        <span>
                                                            &nbsp;
                                                            <!-- This span is a placeholder that appears if no other button is valid on the left side of the Drop button -->
                                                        </span>
                                                    }

                                                    @if (
                                                        canDropItem(
                                                            itemParameters.item
                                                        )
                                                    ) {
                                                        <span>
                                                            <app-item-target
                                                                [item]="
                                                                    itemParameters.item
                                                                "
                                                                [inventory]="
                                                                    inventory
                                                                "
                                                                [creature]="
                                                                    creature
                                                                "
                                                                (moveMessage)="
                                                                    moveInventoryItem(
                                                                        itemParameters.item,
                                                                        inventory,
                                                                        $event.target,
                                                                        $event.amount,
                                                                        $event.including
                                                                    )
                                                                "
                                                            />
                                                        </span>

                                                        @switch (
                                                            showDropAllButtons(
                                                                itemParameters.item
                                                            )
                                                        ) {
                                                            @case (true) {
                                                                <span>
                                                                    <button
                                                                        type="button"
                                                                        [ngbTooltip]="
                                                                            'Choose what to do with included items'
                                                                        "
                                                                        (click)="
                                                                            openGrantingOrContainerItemDropModal(
                                                                                GrantingItemDropModal,
                                                                                itemParameters.item,
                                                                                inventory
                                                                            )
                                                                        "
                                                                    >
                                                                        <i
                                                                            class="ra ra-hive-emblem"
                                                                        ></i>
                                                                        Drop...
                                                                    </button>
                                                                </span>
                                                            }

                                                            @case (false) {
                                                                @if (
                                                                    itemParameters.containedItemsAmount
                                                                ) {
                                                                    <span>
                                                                        <button
                                                                            type="button"
                                                                            [ngbTooltip]="
                                                                                'Choose what to do with contained items'
                                                                            "
                                                                            (click)="
                                                                                openGrantingOrContainerItemDropModal(
                                                                                    ContainerItemDropModal,
                                                                                    itemParameters.item,
                                                                                    inventory
                                                                                )
                                                                            "
                                                                        >
                                                                            <i
                                                                                class="ra ra-hive-emblem"
                                                                            ></i>
                                                                            Drop...
                                                                        </button>
                                                                    </span>
                                                                }

                                                                @if (
                                                                    !itemParameters.containedItemsAmount
                                                                ) {
                                                                    <span>
                                                                        <button
                                                                            type="button"
                                                                            (click)="
                                                                                dropInventoryItem(
                                                                                    itemParameters.item,
                                                                                    inventory
                                                                                )
                                                                            "
                                                                        >
                                                                            Drop
                                                                        </button>
                                                                    </span>
                                                                }
                                                            }
                                                        }
                                                    }
                                                </div>

                                                <!-- Lower row of buttons -->
                                                @if (
                                                    itemParameters.item
                                                        .tradeable &&
                                                        effectivePrice(
                                                            itemParameters.item
                                                        );
                                                    as effectivePrice
                                                ) {
                                                    <div class="newrow">
                                                        @if (
                                                            itemParameters.stack &&
                                                                itemParameters.asStackable;
                                                            as stackable
                                                        ) {
                                                            <span
                                                                class="gap-text"
                                                            >
                                                                <span
                                                                    [ngbTooltip]="
                                                                        stackable.amount <=
                                                                        itemParameters.stack
                                                                            ? 'Use the sell button to sell the last item of a stack'
                                                                            : 'Sell at half price'
                                                                    "
                                                                >
                                                                    <button
                                                                        type="button"
                                                                        [disabled]="
                                                                            stackable.amount <=
                                                                            itemParameters.stack
                                                                        "
                                                                        (click)="
                                                                            onAmountChange(
                                                                                stackable,
                                                                                -itemParameters.stack,
                                                                                true
                                                                            )
                                                                        "
                                                                    >
                                                                        Sell
                                                                        {{
                                                                            itemParameters.stack
                                                                        }}
                                                                    </button>
                                                                </span>

                                                                <button
                                                                    type="button"
                                                                    [disabled]="
                                                                        !characterHasFunds(
                                                                            effectivePrice
                                                                        )
                                                                    "
                                                                    (click)="
                                                                        onAmountChange(
                                                                            stackable,
                                                                            itemParameters.stack,
                                                                            true
                                                                        )
                                                                    "
                                                                >
                                                                    Buy
                                                                    {{
                                                                        itemParameters.stack
                                                                    }}
                                                                </button>
                                                            </span>
                                                        } @else {
                                                            <span>
                                                                &nbsp;
                                                                <!-- This span is a placeholder that appears if no other button is valid on the left side of the Sell button -->
                                                            </span>
                                                        }

                                                        <span>
                                                            <span
                                                                [ngbTooltip]="
                                                                    itemParameters
                                                                        .asEquipment
                                                                        ?.broken ||
                                                                    itemParameters
                                                                        .asEquipment
                                                                        ?.shoddy
                                                                        ? 'The item is worthless in this state'
                                                                        : 'Sell at half price'
                                                                "
                                                            >
                                                                <button
                                                                    type="button"
                                                                    [disabled]="
                                                                        itemParameters
                                                                            .item
                                                                            .amount <=
                                                                            0 ||
                                                                        itemParameters
                                                                            .asEquipment
                                                                            ?.broken ||
                                                                        itemParameters
                                                                            .asEquipment
                                                                            ?.shoddy
                                                                    "
                                                                    (click)="
                                                                        dropInventoryItem(
                                                                            itemParameters.item,
                                                                            inventory,
                                                                            true
                                                                        )
                                                                    "
                                                                >
                                                                    Sell
                                                                    {{
                                                                        showDropAllButtons(
                                                                            itemParameters.item
                                                                        )
                                                                            ? "with all parts"
                                                                            : ""
                                                                    }}
                                                                    {{
                                                                        itemParameters.containedItemsAmount
                                                                            ? "without contained items"
                                                                            : ""
                                                                    }}
                                                                </button>
                                                            </span>
                                                        </span>
                                                    </div>
                                                }

                                                <div
                                                    class="list-item newrow left-aligned"
                                                >
                                                    @if (
                                                        itemParameters.asEquipment
                                                    ) {
                                                        <span>
                                                            <label
                                                                for="{{
                                                                    itemParameters
                                                                        .asEquipment
                                                                        .id
                                                                }}showname"
                                                            >
                                                                <div
                                                                    class="button no-animation"
                                                                    [ngClass]="{
                                                                        'fancy-button':
                                                                            itemParameters
                                                                                .asEquipment
                                                                                .showName,
                                                                    }"
                                                                >
                                                                    <input
                                                                        class="invisible"
                                                                        type="checkbox"
                                                                        id="{{
                                                                            itemParameters
                                                                                .asEquipment
                                                                                .id
                                                                        }}showname"
                                                                        [(ngModel)]="
                                                                            itemParameters
                                                                                .asEquipment
                                                                                .showName
                                                                        "
                                                                    />
                                                                    <i
                                                                        class="bi-pencil-square"
                                                                    ></i>
                                                                    Name
                                                                </div>
                                                            </label>
                                                        </span>
                                                    }

                                                    <span>
                                                        <label
                                                            for="{{
                                                                itemParameters
                                                                    .item.id
                                                            }}shownotes"
                                                        >
                                                            <div
                                                                class="button no-animation"
                                                                [ngClass]="{
                                                                    'fancy-button':
                                                                        itemParameters
                                                                            .item
                                                                            .showNotes,
                                                                }"
                                                            >
                                                                <input
                                                                    class="invisible"
                                                                    type="checkbox"
                                                                    id="{{
                                                                        itemParameters
                                                                            .item
                                                                            .id
                                                                    }}shownotes"
                                                                    [(ngModel)]="
                                                                        itemParameters
                                                                            .item
                                                                            .showNotes
                                                                    "
                                                                />
                                                                <i
                                                                    class="bi-pencil-square"
                                                                ></i>
                                                                Notes
                                                            </div>
                                                        </label>
                                                    </span>

                                                    @if (
                                                        itemParameters.asRuneChangeable
                                                    ) {
                                                        <span>
                                                            <label
                                                                for="{{
                                                                    itemParameters
                                                                        .asRuneChangeable
                                                                        .id
                                                                }}showrunes"
                                                            >
                                                                <div
                                                                    class="button no-animation"
                                                                    [ngClass]="{
                                                                        'fancy-button':
                                                                            itemParameters
                                                                                .asRuneChangeable
                                                                                .showRunes,
                                                                    }"
                                                                >
                                                                    <input
                                                                        class="invisible"
                                                                        type="checkbox"
                                                                        id="{{
                                                                            itemParameters
                                                                                .asRuneChangeable
                                                                                .id
                                                                        }}showrunes"
                                                                        [(ngModel)]="
                                                                            itemParameters
                                                                                .asRuneChangeable
                                                                                .showRunes
                                                                        "
                                                                    />
                                                                    <i
                                                                        class="bi-pencil-square"
                                                                    ></i>
                                                                    Runes
                                                                </div>
                                                            </label>
                                                        </span>
                                                    }

                                                    @if (
                                                        itemParameters.asStatusChangeable
                                                    ) {
                                                        <span>
                                                            <label
                                                                for="{{
                                                                    itemParameters
                                                                        .asStatusChangeable
                                                                        .id
                                                                }}showstatus"
                                                            >
                                                                <div
                                                                    class="button no-animation"
                                                                    [ngClass]="{
                                                                        'fancy-button':
                                                                            itemParameters
                                                                                .asStatusChangeable
                                                                                .showStatus,
                                                                    }"
                                                                >
                                                                    <input
                                                                        class="invisible"
                                                                        type="checkbox"
                                                                        id="{{
                                                                            itemParameters
                                                                                .asStatusChangeable
                                                                                .id
                                                                        }}showstatus"
                                                                        [(ngModel)]="
                                                                            itemParameters
                                                                                .asStatusChangeable
                                                                                .showStatus
                                                                        "
                                                                    />
                                                                    <i
                                                                        class="bi-pencil-square"
                                                                    ></i>
                                                                    Status
                                                                </div>
                                                            </label>
                                                        </span>
                                                    }

                                                    <!-- Changing Name -->
                                                    @if (
                                                        itemParameters.asEquipment
                                                    ) {
                                                        <div
                                                            class="list-item newrow left-aligned"
                                                            [ngbCollapse]="
                                                                !itemParameters
                                                                    .asEquipment
                                                                    .showName
                                                            "
                                                        >
                                                            <span>Name</span>

                                                            <input
                                                                aria-label="Item name"
                                                                type="textarea"
                                                                class="fullwidth"
                                                                [(ngModel)]="
                                                                    itemParameters
                                                                        .item
                                                                        .displayName
                                                                "
                                                            />
                                                        </div>
                                                    }

                                                    <!-- Changing Notes -->
                                                    <div
                                                        class="list-item newrow left-aligned"
                                                        [ngbCollapse]="
                                                            !itemParameters.item
                                                                .showNotes
                                                        "
                                                    >
                                                        <span>Notes</span>

                                                        <input
                                                            aria-label="Item notes"
                                                            type="textarea"
                                                            class="fullwidth"
                                                            [(ngModel)]="
                                                                itemParameters
                                                                    .item.notes
                                                            "
                                                        />
                                                    </div>

                                                    <!-- Changing Runes -->
                                                    @if (
                                                        itemParameters.asRuneChangeable
                                                    ) {
                                                        <app-item-runes
                                                            class="newrow"
                                                            [ngbCollapse]="
                                                                !itemParameters
                                                                    .asRuneChangeable
                                                                    .showRunes
                                                            "
                                                            [item]="
                                                                itemParameters.asRuneChangeable
                                                            "
                                                            [itemStore]="false"
                                                            [itemRoles]="
                                                                itemParameters
                                                            "
                                                        />
                                                    }

                                                    <!-- Changing Status -->
                                                    @if (
                                                        itemParameters.asStatusChangeable ||
                                                        itemParameters
                                                            .asEquipment
                                                            ?.broken ||
                                                        itemParameters
                                                            .asEquipment?.shoddy
                                                    ) {
                                                        <div
                                                            class="list-item newrow left-aligned"
                                                            [ngbCollapse]="
                                                                !(
                                                                    itemParameters
                                                                        .asStatusChangeable
                                                                        ?.showStatus ||
                                                                    itemParameters
                                                                        .asEquipment
                                                                        ?.broken ||
                                                                    itemParameters
                                                                        .asEquipment
                                                                        ?.shoddy
                                                                )
                                                            "
                                                        >
                                                            <span>Status</span>

                                                            @if (
                                                                itemParameters.asEquipment && {
                                                                    allowed:
                                                                        isRepairAllowed(
                                                                            itemParameters.asEquipment
                                                                        ),
                                                                };
                                                                as repairAllowedStatus
                                                            ) {
                                                                <div
                                                                    class="newrow"
                                                                >
                                                                    <span
                                                                        [ngbPopover]="
                                                                            !repairAllowedStatus.allowed
                                                                                ? 'To repair a broken shield, restore its hit points above the Broken Threshold.'
                                                                                : ''
                                                                        "
                                                                    >
                                                                        <input
                                                                            type="checkbox"
                                                                            id="{{
                                                                                itemParameters
                                                                                    .item
                                                                                    .id
                                                                            }}broken"
                                                                            [disabled]="
                                                                                !repairAllowedStatus.allowed
                                                                            "
                                                                            [(ngModel)]="
                                                                                itemParameters
                                                                                    .asEquipment
                                                                                    .broken
                                                                            "
                                                                            (ngModelChange)="
                                                                                onItemBroken(
                                                                                    itemParameters.asEquipment
                                                                                )
                                                                            "
                                                                        />
                                                                        <label
                                                                            for="{{
                                                                                itemParameters
                                                                                    .item
                                                                                    .id
                                                                            }}broken"
                                                                        >
                                                                            <i
                                                                                class="ra ra-broken-shield"
                                                                            ></i>
                                                                            Broken
                                                                        </label>

                                                                        <ng-template
                                                                            #BrokenDescTemplate
                                                                        >
                                                                            <div
                                                                                class="newrow left-aligned popover-keepalive"
                                                                            >
                                                                                A
                                                                                broken
                                                                                object
                                                                                can't
                                                                                be
                                                                                used
                                                                                for
                                                                                its
                                                                                normal
                                                                                function,
                                                                                nor
                                                                                does
                                                                                it
                                                                                grant
                                                                                bonuses
                                                                                -
                                                                                with
                                                                                the
                                                                                exception
                                                                                of
                                                                                armor.
                                                                                Broken
                                                                                armor
                                                                                still
                                                                                grants
                                                                                its
                                                                                item
                                                                                bonus
                                                                                to
                                                                                AC,
                                                                                but
                                                                                it
                                                                                also
                                                                                imparts
                                                                                a
                                                                                status
                                                                                penalty
                                                                                to
                                                                                AC
                                                                                depending
                                                                                on
                                                                                its
                                                                                category:
                                                                                -1
                                                                                for
                                                                                broken
                                                                                light
                                                                                armor,
                                                                                -2
                                                                                for
                                                                                broken
                                                                                medium
                                                                                armor,
                                                                                or
                                                                                -3
                                                                                for
                                                                                broken
                                                                                heavy
                                                                                armor.
                                                                                A
                                                                                broken
                                                                                item
                                                                                still
                                                                                imposes
                                                                                penalties
                                                                                and
                                                                                limitations
                                                                                normally
                                                                                incurred
                                                                                by
                                                                                carrying,
                                                                                holding,
                                                                                or
                                                                                wearing
                                                                                it.
                                                                                For
                                                                                example,
                                                                                broken
                                                                                armor
                                                                                would
                                                                                still
                                                                                impose
                                                                                its
                                                                                Dexterity
                                                                                modifier
                                                                                cap,
                                                                                check
                                                                                penalty,
                                                                                and
                                                                                so
                                                                                forth.
                                                                            </div>
                                                                        </ng-template>

                                                                        <i
                                                                            class="bi-question-circle"
                                                                            [ngbPopover]="
                                                                                BrokenDescTemplate
                                                                            "
                                                                        ></i>
                                                                    </span>
                                                                </div>
                                                            }

                                                            @if (
                                                                itemParameters.asEquipment
                                                            ) {
                                                                <div
                                                                    class="newrow"
                                                                >
                                                                    <span>
                                                                        <input
                                                                            type="checkbox"
                                                                            id="{{
                                                                                itemParameters
                                                                                    .asEquipment
                                                                                    .id
                                                                            }}shoddy"
                                                                            [(ngModel)]="
                                                                                itemParameters
                                                                                    .asEquipment
                                                                                    .shoddy
                                                                            "
                                                                        />
                                                                        <label
                                                                            for="{{
                                                                                itemParameters
                                                                                    .asEquipment
                                                                                    .id
                                                                            }}shoddy"
                                                                        >
                                                                            <i
                                                                                class="ra ra-broken-bottle"
                                                                            ></i>
                                                                            Shoddy
                                                                        </label>

                                                                        <ng-template
                                                                            #ShoddyDescTemplate
                                                                        >
                                                                            <div
                                                                                class="newrow left-aligned popover-keepalive"
                                                                            >
                                                                                When
                                                                                available,
                                                                                a
                                                                                shoddy
                                                                                item
                                                                                usually
                                                                                costs
                                                                                half
                                                                                the
                                                                                Price
                                                                                of
                                                                                a
                                                                                standard
                                                                                item,
                                                                                though
                                                                                you
                                                                                can
                                                                                never
                                                                                sell
                                                                                one
                                                                                in
                                                                                any
                                                                                case.
                                                                                Attacks
                                                                                and
                                                                                checks
                                                                                involving
                                                                                a
                                                                                shoddy
                                                                                item
                                                                                take
                                                                                a
                                                                                -2
                                                                                item
                                                                                penalty.
                                                                                This
                                                                                penalty
                                                                                also
                                                                                applies
                                                                                to
                                                                                any
                                                                                DCs
                                                                                that
                                                                                a
                                                                                shoddy
                                                                                item
                                                                                applies
                                                                                to
                                                                                (such
                                                                                as
                                                                                AC,
                                                                                for
                                                                                shoddy
                                                                                armor).
                                                                                A
                                                                                shoddy
                                                                                suit
                                                                                of
                                                                                armor
                                                                                also
                                                                                worsens
                                                                                the
                                                                                armor's
                                                                                check
                                                                                penalty
                                                                                by
                                                                                2.
                                                                                A
                                                                                shoddy
                                                                                item's
                                                                                Hit
                                                                                Points
                                                                                and
                                                                                Broken
                                                                                Threshold
                                                                                are
                                                                                each
                                                                                half
                                                                                that
                                                                                of
                                                                                a
                                                                                normal
                                                                                item
                                                                                of
                                                                                its
                                                                                type.
                                                                            </div>
                                                                        </ng-template>

                                                                        <i
                                                                            class="bi-question-circle"
                                                                            [ngbPopover]="
                                                                                ShoddyDescTemplate
                                                                            "
                                                                        ></i>
                                                                    </span>
                                                                </div>
                                                            }
                                                        </div>
                                                    }

                                                    @if (
                                                        itemParameters.asWeapon &&
                                                        (itemParameters.asWeapon
                                                            .large ||
                                                            (isLargeWeaponAllowed$(
                                                                itemParameters.item
                                                            ) | async))
                                                    ) {
                                                        <div
                                                            class="list-item newrow"
                                                        >
                                                            <span>
                                                                <input
                                                                    type="checkbox"
                                                                    id="{{
                                                                        itemParameters
                                                                            .asWeapon
                                                                            .id
                                                                    }}large"
                                                                    [(ngModel)]="
                                                                        itemParameters
                                                                            .asWeapon
                                                                            .large
                                                                    "
                                                                />
                                                                <label
                                                                    for="{{
                                                                        itemParameters
                                                                            .asWeapon
                                                                            .id
                                                                    }}large"
                                                                >
                                                                    <i
                                                                        class="ra ra-large-hammer"
                                                                    ></i>
                                                                    Large
                                                                </label>

                                                                <ng-template
                                                                    #LargeDescTemplate
                                                                >
                                                                    <div
                                                                        class="newrow left-aligned popover-keepalive"
                                                                    >
                                                                        You can
                                                                        use a
                                                                        weapon
                                                                        built
                                                                        for a
                                                                        Large
                                                                        creature
                                                                        if you
                                                                        are
                                                                        Small or
                                                                        Medium
                                                                        (both
                                                                        normally
                                                                        and when
                                                                        raging).
                                                                        If
                                                                        you're
                                                                        not
                                                                        Small or
                                                                        Medium,
                                                                        you can
                                                                        use a
                                                                        weapon
                                                                        built
                                                                        for a
                                                                        creature
                                                                        one size
                                                                        larger
                                                                        than
                                                                        you.
                                                                        While
                                                                        wielding
                                                                        the
                                                                        weapon
                                                                        in
                                                                        combat,
                                                                        your
                                                                        additional
                                                                        damage
                                                                        from
                                                                        Rage
                                                                        increases
                                                                        from 2
                                                                        to 6,
                                                                        and you
                                                                        have the
                                                                        clumsy 1
                                                                        condition
                                                                        because
                                                                        of its
                                                                        unwieldy
                                                                        size.
                                                                    </div>
                                                                </ng-template>

                                                                <i
                                                                    class="bi-question-circle"
                                                                    [ngbPopover]="
                                                                        LargeDescTemplate
                                                                    "
                                                                ></i>
                                                            </span>
                                                        </div>
                                                    }

                                                    @if (
                                                        itemParameters.asBladeAllyChangeable &&
                                                            (itemParameters
                                                                .asBladeAllyChangeable
                                                                .bladeAlly ||
                                                                (isBladeAllyAllowed$(
                                                                    itemParameters.item
                                                                ) | async)) && {
                                                                used: isBladeAllyUsed(),
                                                            };
                                                        as bladeAllyStatus
                                                    ) {
                                                        <div
                                                            class="list-item newrow"
                                                        >
                                                            <div class="newrow">
                                                                <span
                                                                    [ngbPopover]="
                                                                        !itemParameters
                                                                            .asBladeAllyChangeable
                                                                            .bladeAlly &&
                                                                        bladeAllyStatus.used
                                                                            ? 'Another item is already designated as your blade ally.'
                                                                            : ''
                                                                    "
                                                                >
                                                                    <input
                                                                        type="checkbox"
                                                                        id="{{
                                                                            itemParameters
                                                                                .asBladeAllyChangeable
                                                                                .id
                                                                        }}bladeally"
                                                                        [disabled]="
                                                                            !itemParameters
                                                                                .asBladeAllyChangeable
                                                                                .bladeAlly &&
                                                                            bladeAllyStatus.used
                                                                        "
                                                                        [(ngModel)]="
                                                                            itemParameters
                                                                                .asBladeAllyChangeable
                                                                                .bladeAlly
                                                                        "
                                                                    />
                                                                    <label
                                                                        for="{{
                                                                            itemParameters
                                                                                .asBladeAllyChangeable
                                                                                .id
                                                                        }}bladeally"
                                                                    >
                                                                        <i
                                                                            class="ra ra-fireball-sword"
                                                                        ></i>
                                                                        Blade
                                                                        Ally
                                                                    </label>

                                                                    <ng-template
                                                                        #BladeAllyDescTemplate
                                                                    >
                                                                        <div
                                                                            class="newrow left-aligned popover-keepalive"
                                                                        >
                                                                            You
                                                                            can
                                                                            select
                                                                            one
                                                                            weapon
                                                                            or
                                                                            handwraps
                                                                            of
                                                                            mighty
                                                                            blows
                                                                            when
                                                                            you
                                                                            make
                                                                            your
                                                                            daily
                                                                            preparations.
                                                                            In
                                                                            your
                                                                            hands,
                                                                            the
                                                                            item
                                                                            gains
                                                                            the
                                                                            effect
                                                                            of a
                                                                            property
                                                                            rune
                                                                            and
                                                                            you
                                                                            also
                                                                            gain
                                                                            the
                                                                            weapon's
                                                                            critical
                                                                            specialization
                                                                            effect.
                                                                            For
                                                                            a
                                                                            champion
                                                                            following
                                                                            the
                                                                            tenets
                                                                            of
                                                                            good,
                                                                            choose
                                                                            disrupting,
                                                                            ghost
                                                                            touch,
                                                                            returning,
                                                                            or
                                                                            shifting.
                                                                            For
                                                                            a
                                                                            champion
                                                                            following
                                                                            the
                                                                            tenets
                                                                            of
                                                                            evil,
                                                                            choose
                                                                            fearsome,
                                                                            returning,
                                                                            or
                                                                            shifting.
                                                                        </div>
                                                                    </ng-template>

                                                                    <i
                                                                        class="bi-question-circle"
                                                                        [ngbPopover]="
                                                                            BladeAllyDescTemplate
                                                                        "
                                                                    ></i>
                                                                </span>
                                                            </div>

                                                            @if (
                                                                itemParameters.asBladeAllyChangeable &&
                                                                itemParameters
                                                                    .asBladeAllyChangeable
                                                                    .bladeAlly
                                                            ) {
                                                                <app-item-blade-ally
                                                                    class="list-item newrow"
                                                                    [item]="
                                                                        itemParameters.asBladeAllyChangeable
                                                                    "
                                                                />
                                                            }
                                                        </div>
                                                    }

                                                    @if (
                                                        itemParameters.asEmblazonArmamentChangeable &&
                                                        (itemParameters
                                                            .asEmblazonArmamentChangeable
                                                            .emblazonArmament ||
                                                            (isEmblazonArmamentAllowed$(
                                                                itemParameters.item
                                                            ) | async))
                                                    ) {
                                                        <app-item-emblazon-armament
                                                            class="fullwidth"
                                                            [item]="
                                                                itemParameters.asEmblazonArmamentChangeable
                                                            "
                                                        />
                                                    }

                                                    @if (
                                                        itemParameters.asBattleforgedChangeable &&
                                                        (itemParameters
                                                            .asBattleforgedChangeable
                                                            .battleforged ||
                                                            (isBattleforgedAllowed$(
                                                                itemParameters.item
                                                            ) | async))
                                                    ) {
                                                        <div
                                                            class="list-item newrow"
                                                        >
                                                            <span>
                                                                <input
                                                                    type="checkbox"
                                                                    id="{{
                                                                        itemParameters
                                                                            .item
                                                                            .id
                                                                    }}battleforged"
                                                                    [(ngModel)]="
                                                                        itemParameters
                                                                            .asBattleforgedChangeable
                                                                            .battleforged
                                                                    "
                                                                />
                                                                <label
                                                                    for="{{
                                                                        itemParameters
                                                                            .item
                                                                            .id
                                                                    }}battleforged"
                                                                >
                                                                    <i
                                                                        class="ra ra-anvil"
                                                                    ></i>
                                                                    Battleforged
                                                                </label>

                                                                <ng-template
                                                                    #BattleforgedDescTemplate
                                                                >
                                                                    <div
                                                                        class="newrow left-aligned popover-keepalive"
                                                                    >
                                                                        You can
                                                                        sharpen
                                                                        weapons,
                                                                        polish
                                                                        armor,
                                                                        and
                                                                        apply
                                                                        special
                                                                        techniques
                                                                        to
                                                                        temporarily
                                                                        gain
                                                                        better
                                                                        effects
                                                                        from
                                                                        your
                                                                        armaments.
                                                                        By
                                                                        spending
                                                                        1 hour
                                                                        working
                                                                        on a
                                                                        weapon
                                                                        or
                                                                        armor,
                                                                        you can
                                                                        grant it
                                                                        the
                                                                        effects
                                                                        of a +1
                                                                        potency
                                                                        rune
                                                                        until
                                                                        your
                                                                        next
                                                                        daily
                                                                        preparations,
                                                                        gaining
                                                                        a +1
                                                                        item
                                                                        bonus to
                                                                        attack
                                                                        rolls
                                                                        for a
                                                                        weapon
                                                                        or
                                                                        increasing
                                                                        armor's
                                                                        item
                                                                        bonus to
                                                                        AC by 1.
                                                                        This has
                                                                        no
                                                                        effect
                                                                        if the
                                                                        weapon
                                                                        or armor
                                                                        already
                                                                        had a
                                                                        potency
                                                                        rune.
                                                                    </div>
                                                                </ng-template>

                                                                <i
                                                                    class="bi-question-circle"
                                                                    [ngbPopover]="
                                                                        BattleforgedDescTemplate
                                                                    "
                                                                ></i>
                                                            </span>
                                                        </div>
                                                    }

                                                    @if (
                                                        itemParameters.item
                                                            .type !== "oils"
                                                    ) {
                                                        <app-item-oils
                                                            class="hide-empty"
                                                            [item]="
                                                                itemParameters.item
                                                            "
                                                            [itemStore]="false"
                                                        />
                                                    }

                                                    @if (
                                                        itemParameters.asWeapon
                                                    ) {
                                                        <app-item-poisons
                                                            class="hide-empty"
                                                            [item]="
                                                                itemParameters.asWeapon
                                                            "
                                                            [itemStore]="false"
                                                        />
                                                    }

                                                    @if (
                                                        itemParameters.asTalismanChangeable &&
                                                        canApplyTalismans(
                                                            itemParameters.asTalismanChangeable
                                                        )
                                                    ) {
                                                        <app-item-talismans
                                                            [item]="
                                                                itemParameters.asTalismanChangeable
                                                            "
                                                            [itemStore]="false"
                                                        />
                                                    }

                                                    @if (
                                                        itemParameters.asTalismanChangeable &&
                                                        canApplyTalismanCords(
                                                            itemParameters.asTalismanChangeable
                                                        )
                                                    ) {
                                                        <app-item-talisman-cords
                                                            [item]="
                                                                itemParameters.asTalismanChangeable
                                                            "
                                                        />
                                                    }

                                                    @if (
                                                        itemParameters.asWornItem &&
                                                        itemParameters
                                                            .asWornItem
                                                            .isWayfinder
                                                    ) {
                                                        <app-item-aeon-stones
                                                            class="list-item hide-empty"
                                                            [item]="
                                                                itemParameters.asWornItem
                                                            "
                                                            [itemStore]="false"
                                                        />
                                                    }

                                                    <!-- Too many slotted Aeon Stones warning -->
                                                    @if (
                                                        itemParameters.asWornItem &&
                                                        itemHasBlockedSlottedAeonStones(
                                                            itemParameters.asWornItem
                                                        )
                                                    ) {
                                                        <div
                                                            class="newrow list-item problem"
                                                        >
                                                            You have invested
                                                            too many wayfinders
                                                            with aeon stones
                                                            slotted in them. All
                                                            effects of these
                                                            aeon stones are
                                                            disabled.
                                                        </div>
                                                    }

                                                    @if (
                                                        itemParameters.asShield
                                                    ) {
                                                        <div
                                                            class="list-item newrow"
                                                        >
                                                            <strong>HP</strong>

                                                            <div class="value">
                                                                {{
                                                                    itemParameters.asShield.currentHitPoints$()
                                                                        | async
                                                                }}
                                                            </div>

                                                            <strong
                                                                >Max HP</strong
                                                            >

                                                            <div class="value">
                                                                {{
                                                                    itemParameters.asShield.effectiveMaxHP$()
                                                                        | async
                                                                }}
                                                            </div>

                                                            <strong>BT</strong>

                                                            <div class="value">
                                                                {{
                                                                    itemParameters.asShield.effectiveBrokenThreshold$()
                                                                        | async
                                                                }}
                                                            </div>
                                                        </div>

                                                        <div
                                                            class="list-item newrow"
                                                        >
                                                            <ng-template
                                                                #DamageSliderTemplate
                                                            >
                                                                <div
                                                                    class="popover-keepalive slider-container"
                                                                    style="
                                                                        min-width: 25vw;
                                                                        max-width: 100%;
                                                                    "
                                                                    [style.--name]="
                                                                        '\'Damage: ' +
                                                                        shieldDamage +
                                                                        '\''
                                                                    "
                                                                >
                                                                    <input
                                                                        aria-label="Shield damage amount slider"
                                                                        class="slider"
                                                                        type="range"
                                                                        min="0"
                                                                        max="{{
                                                                            itemParameters.asShield.effectiveMaxHP$()
                                                                                | async
                                                                        }}"
                                                                        [(ngModel)]="
                                                                            shieldDamage
                                                                        "
                                                                    />
                                                                </div>
                                                            </ng-template>

                                                            <span>
                                                                <button
                                                                    type="button"
                                                                    [disabled]="
                                                                        shieldDamage ===
                                                                        0
                                                                    "
                                                                    (click)="
                                                                        onShieldHPChange(
                                                                            itemParameters.asShield,
                                                                            shieldDamage
                                                                        )
                                                                    "
                                                                >
                                                                    Damage
                                                                </button>
                                                            </span>

                                                            <span
                                                                class="hlist center-aligned"
                                                            >
                                                                <input
                                                                    #DamagePopover="ngbPopover"
                                                                    aria-label="Shield damage amount"
                                                                    triggers="manual"
                                                                    class="number3"
                                                                    type="number"
                                                                    maxLength="3"
                                                                    min="0"
                                                                    [ngbPopover]="
                                                                        DamageSliderTemplate
                                                                    "
                                                                    max="{{
                                                                        itemParameters.asShield.effectiveMaxHP$()
                                                                            | async
                                                                    }}"
                                                                    [(ngModel)]="
                                                                        shieldDamage
                                                                    "
                                                                    (focus)="
                                                                        DamagePopover.open()
                                                                    "
                                                                    (keypress)="
                                                                        positiveNumbersOnly(
                                                                            $event
                                                                        )
                                                                    "
                                                                />
                                                            </span>

                                                            <span
                                                                class="right-aligned"
                                                            >
                                                                <button
                                                                    type="button"
                                                                    [disabled]="
                                                                        shieldDamage ===
                                                                        0
                                                                    "
                                                                    (click)="
                                                                        onShieldHPChange(
                                                                            itemParameters.asShield,
                                                                            -shieldDamage
                                                                        )
                                                                    "
                                                                >
                                                                    Repair
                                                                </button>
                                                            </span>
                                                        </div>
                                                    }
                                                </div>

                                                <app-item
                                                    class="lower"
                                                    [creature]="creature"
                                                    [item]="itemParameters.item"
                                                    [allowActivate]="
                                                        itemParameters.item.investedOrEquipped()
                                                    "
                                                    [armoredSkirt]="
                                                        itemParameters.asArmor?.armoredSkirt(
                                                            creature
                                                        )
                                                    "
                                                />
                                            </ng-template>

                                            @if (
                                                itemParameters.item.id;
                                                as inventoryID
                                            ) {
                                                @if (isTileMode$ | async) {
                                                    <button
                                                        type="button"
                                                        aria-label="Show item"
                                                        triggers="click"
                                                        cdkDrag
                                                        [stickyPopover]="
                                                            ItemTemplate
                                                        "
                                                        [ngClass]="{
                                                            'fancy-button':
                                                                itemParameters.item.investedOrEquipped(),
                                                            problem:
                                                                itemParameters
                                                                    .asEquipment
                                                                    ?.broken,
                                                            penalty:
                                                                itemParameters.canUse ===
                                                                false,
                                                            bonus: itemParameters.canUse,
                                                        }"
                                                        [cdkDragData]="
                                                            itemParameters.item
                                                        "
                                                        [cdkDragDisabled]="
                                                            !canDropItem(
                                                                itemParameters.item
                                                            )
                                                        "
                                                        (click)="
                                                            toggleShownItem()
                                                        "
                                                    >
                                                        <app-grid-icon
                                                            [ngClass]="{
                                                                'fancy-button':
                                                                    itemParameters.item.investedOrEquipped(),
                                                                problem:
                                                                    itemParameters
                                                                        .asEquipment
                                                                        ?.broken,
                                                                penalty:
                                                                    itemParameters.canUse ===
                                                                    false,
                                                                bonus: itemParameters.canUse,
                                                            }"
                                                            [ngbTooltip]="
                                                                ItemTooltipTemplate
                                                            "
                                                            [title]="
                                                                itemParameters.item.gridIconTitle()
                                                            "
                                                            [detail]="
                                                                'noparse|' +
                                                                (itemParameters
                                                                    .item.level
                                                                    ? itemParameters.item.level.toString()
                                                                    : '')
                                                            "
                                                            [item]="
                                                                itemParameters.item
                                                            "
                                                        />
                                                    </button>
                                                } @else {
                                                    <div
                                                        class="list-item"
                                                        cdkDrag
                                                        [cdkDragData]="
                                                            itemParameters.item
                                                        "
                                                        [cdkDragDisabled]="
                                                            !canDropItem(
                                                                itemParameters.item
                                                            )
                                                        "
                                                    >
                                                        <button
                                                            type="button"
                                                            aria-label="Show item"
                                                            class="newrow sublist-toggle"
                                                            [ngClass]="{
                                                                'fancy-button':
                                                                    itemParameters.item.investedOrEquipped(),
                                                                problem:
                                                                    itemParameters
                                                                        .asEquipment
                                                                        ?.broken,
                                                            }"
                                                            (click)="
                                                                toggleShownItem(
                                                                    inventoryID
                                                                )
                                                            "
                                                        >
                                                            <ng-container
                                                                *ngTemplateOutlet="
                                                                    ItemTitleTemplate
                                                                "
                                                            />
                                                        </button>

                                                        @if (
                                                            shownItem() ===
                                                            inventoryID
                                                        ) {
                                                            <div
                                                                class="list-item sublist"
                                                                [ngClass]="{
                                                                    'fancy-list':
                                                                        itemParameters.item.investedOrEquipped(),
                                                                    problem:
                                                                        itemParameters
                                                                            .asEquipment
                                                                            ?.broken,
                                                                }"
                                                            >
                                                                <ng-container
                                                                    *ngTemplateOutlet="
                                                                        ItemTemplate
                                                                    "
                                                                />
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                }
                            }
                        }

                        <!-- Miscellaneous Items -->
                        <header class="subsectionHeader minimized-hide">
                            Miscellaneous Items
                        </header>

                        <button
                            type="button"
                            class="minimized-hide newrow center-aligned"
                            (click)="addNewOtherItem(inventory)"
                        >
                            Add
                        </button>

                        @for (item of inventory.otheritems; track $index) {
                            <div class="minimized-hide list-item">
                                <strong>Name</strong>

                                <input
                                    aria-label="Item name"
                                    type="text"
                                    id="miscellaneousItemName{{
                                        inventoryIndex
                                    }}_{{ $index }}"
                                    [(ngModel)]="item.name"
                                />
                                <strong>Bulk</strong>

                                <input
                                    aria-label="Item bulk"
                                    class="number2"
                                    id="miscellaneousItemBulk{{
                                        inventoryIndex
                                    }}_{{ $index }}"
                                    [ngModel]="item.bulk"
                                    (blur)="validateBulk(item)"
                                    (beforeinput)="
                                        bulkOnlyInputValidation(
                                            $event,
                                            item.bulk
                                        )
                                    "
                                    (ngModelChange)="
                                        item.bulk = $event.toUpperCase()
                                    "
                                />
                                <button
                                    type="button"
                                    (click)="removeOtherItem(item, inventory)"
                                >
                                    Drop
                                </button>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    }
</app-character-sheet-card>
