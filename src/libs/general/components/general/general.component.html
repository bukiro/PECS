<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<app-character-sheet-card
    [showMinimizeButton]="shouldShowMinimizeButton"
    [minimized]="(isMinimized$ | async) ?? false"
    (toggleMinimized)="toggleMinimized($event)"
>
    <div
        class="attributeBox"
        id="{{ creature }}-general-height"
    >
        <header class="sectionHeader box-header">General Information</header>

        @if (creature.isCharacter()) {
            <div class="list-item">
                <span>
                    <strong>Level</strong>
                    {{ creature.level$ | async }}
                </span>

                @if (
                    { amount: (creature.heroPoints$ | async) ?? 0 };
                    as heroPoints
                ) {
                    <span class="hlist">
                        <strong>Hero Points</strong>
                        {{ heroPoints.amount }}
                        <button
                            type="button"
                            aria-label="Increase hero points"
                            [disabled]="heroPoints.amount <= 0"
                            (click)="incHeroPoints(-1)"
                        >
                            -
                        </button>

                        <button
                            type="button"
                            aria-label="Decrease hero points"
                            [disabled]="heroPoints.amount >= 3"
                            (click)="incHeroPoints(1)"
                        >
                            +
                        </button>
                    </span>
                }
            </div>

            <div class="minimized-hide list-item">
                <strong>Character Name</strong>

                <span>{{ creature.name$ | async }}</span>
            </div>

            @if (creature.class.ancestry.name) {
                <div class="minimized-hide list-item">
                    <strong>Ancestry</strong>

                    <span>
                        {{ creature.class.ancestry.name
                        }}{{
                            creature.class.heritage.name
                                ? " - " + creature.class.heritage.name
                                : ""
                        }}
                    </span>

                    @if (creature.class.ancestry.traits.length) {
                        <div class="newrow left-aligned">
                            @for (
                                trait of characterTraits$ | async;
                                track $index
                            ) {
                                <app-trait
                                    [name]="trait.name"
                                    [trait]="trait"
                                />
                            }
                        </div>
                    }

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Ancestry'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                        [showEffects]="true"
                    />
                </div>
            }

            @if (creature.class.background.name; as background) {
                <div class="minimized-hide list-item">
                    <strong>Background</strong>

                    <span>{{ background }}</span>
                </div>
            }

            @if (creature.class.name) {
                <div class="minimized-hide list-item">
                    @for (classChoice of classChoices$ | async; track $index) {
                        <div class="newrow">
                            <strong
                                [ngStyle]="{
                                    'margin-left': classChoice.subChoice
                                        ? '1em'
                                        : '',
                                }"
                                >{{ classChoice.name }}</strong
                            >

                            <span>{{ classChoice.choice }}</span>
                        </div>
                    }
                </div>
            }

            @if (creatureSize$ | async; as creatureSize) {
                <div class="minimized-hide list-item">
                    <strong>Size</strong>

                    <span>{{ creatureSize }}</span>

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Size'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                        [showEffects]="true"
                    />
                </div>
            }

            @if (creature.alignment$ | async; as alignment) {
                <div class="minimized-hide list-item">
                    <strong>Alignment</strong>

                    <span>{{ alignment }}</span>

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Alignment'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                        [showEffects]="true"
                    />
                </div>
            }

            @if (creature.class.deity) {
                <div class="minimized-hide list-item">
                    <strong>Deity</strong>

                    <span>{{ creature.class.deity }}</span>
                </div>
            }

            @if ((domains$ | async) ?? []; as domains) {
                @if (domains.length) {
                    <div class="minimized-hide list-item">
                        <strong>Deity's Domains</strong>

                        <div class="newrow">
                            <ul>
                                @for (domain of domains; track $index) {
                                    <li>
                                        <ng-template #DomainDescTemplate>
                                            @if (domain.sourceBook) {
                                                <div
                                                    class="newrow left-aligned"
                                                >
                                                    <strong>Source</strong>

                                                    <i>{{
                                                        domain.sourceBook
                                                    }}</i>
                                                </div>
                                            }

                                            <div class="newrow left-aligned">
                                                {{ domain.desc }}
                                            </div>
                                        </ng-template>

                                        <span [ngbPopover]="DomainDescTemplate">
                                            {{ domain.name }}
                                            <i class="bi-question-circle"></i>
                                        </span>
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                }
            }

            @if (creature.class.ancestry.languages.length) {
                <div class="list-item">
                    <strong>Languages</strong>

                    <span>{{ languages() }}</span>

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Languages'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                    />
                </div>
            }

            @if (tenets$ | async; as tenets) {
                @if (tenets.length) {
                    <div class="minimized-hide list-item">
                        <strong>Tenets</strong>

                        <div class="newrow">
                            <ul>
                                @for (tenet of tenets; track $index) {
                                    <li>{{ tenet }}</li>
                                }
                            </ul>
                        </div>
                    </div>
                }
            }

            @if (edicts$ | async; as edicts) {
                @if (edicts.length) {
                    <div class="minimized-hide list-item">
                        <strong>Edicts</strong>

                        <div class="newrow">
                            <ul>
                                @for (edict of edicts; track $index) {
                                    <li>{{ edict }}</li>
                                }
                            </ul>
                        </div>
                    </div>
                }
            }

            @if (anathemas$ | async; as anathemas) {
                @if (anathemas.length) {
                    <div class="minimized-hide list-item">
                        <strong>Anathema</strong>

                        <div class="newrow">
                            <ul>
                                @for (anathema of anathemas; track $index) {
                                    <li>{{ anathema }}</li>
                                }
                            </ul>
                        </div>
                    </div>
                }
            }

            <app-tags
                [creature]="creature"
                [objectName]="'Tenets'"
                [showTraits]="true"
                [showFeats]="true"
                [showItems]="true"
                [showActivities]="true"
                [showConditions]="true"
            />

            @for (
                differentWorldsData of differentWorldsData$ | async;
                track $index
            ) {
                <div class="minimized-hide list-item">
                    <strong>Alternative Identity (Different Worlds)</strong>

                    <span>
                        {{ differentWorldsData.getValue("name") }}
                        {{
                            !!differentWorldsData.getValue("background")
                                ? "(" +
                                  differentWorldsData.getValue("background") +
                                  ")"
                                : ""
                        }}
                    </span>
                </div>
            }
        }

        @if (creature.isAnimalCompanion()) {
            @if (companionTraits$ | async; as companionTraits) {
                @if (companionTraits.length) {
                    <div class="newrow left-aligned tags">
                        @for (trait of companionTraits; track $index) {
                            <app-trait
                                [name]="trait.name"
                                [trait]="trait"
                            />
                        }
                    </div>
                }
            }

            @if (character$ | async; as character) {
                <app-tags
                    [creature]="character"
                    [objectName]="'Animal Companion'"
                    [showTraits]="true"
                    [showFeats]="true"
                    [showItems]="true"
                    [showActivities]="true"
                    [showConditions]="true"
                    [showEffects]="true"
                />
            }

            <div class="minimized-hide list-item">
                <strong>Companion Name</strong>

                <span>{{ creature.name }}</span>
            </div>

            @if (companionSpecies$ | async; as companionSpecies) {
                <div class="minimized-hide list-item">
                    <strong>Animal</strong>

                    <span>{{ companionSpecies }}</span>
                </div>
            }

            @if (companionSpecializations$ | async; as specializations) {
                @if (specializations.length) {
                    <div class="minimized-hide list-item">
                        <strong>Specializations</strong>

                        <span>{{ companionSpecializations$ }}</span>
                    </div>
                }
            }

            @if (creatureSize$ | async; as creatureSize) {
                <div class="minimized-hide list-item">
                    <strong>Size</strong>

                    <span>{{ creatureSize }}</span>

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Size'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                        [showEffects]="true"
                    />
                </div>
            }

            @if (creature.class.ancestry.name) {
                <div class="list-item">
                    <strong>Support Benefit</strong>

                    <p>
                        {{ creature.class.ancestry.supportBenefit }}
                    </p>
                </div>
            }
        }

        @if (creature.isFamiliar()) {
            @if (familiarTraits$ | async; as companionTraits) {
                @if (companionTraits.length) {
                    <div class="newrow left-aligned tags">
                        @for (trait of companionTraits; track $index) {
                            <app-trait
                                [name]="trait.name"
                                [trait]="trait"
                            />
                        }
                    </div>
                }
            }

            @if (character$ | async; as character) {
                <app-tags
                    [creature]="character"
                    [objectName]="'Familiar'"
                    [showTraits]="true"
                    [showFeats]="true"
                    [showItems]="true"
                    [showActivities]="true"
                    [showConditions]="true"
                    [showEffects]="true"
                />
            }

            <div class="minimized-hide list-item">
                <strong>Familiar Name</strong>

                <span>{{ creature.name$ | async }}</span>
            </div>

            <div class="minimized-hide list-item">
                <strong>Creature</strong>

                <span>{{ creature.species }}</span>
            </div>

            @if (creatureSize$ | async; as creatureSize) {
                <div class="minimized-hide list-item">
                    <strong>Size</strong>

                    <span>{{ creatureSize }}</span>

                    <app-tags
                        [creature]="creature"
                        [objectName]="'Size'"
                        [showTraits]="true"
                        [showFeats]="true"
                        [showItems]="true"
                        [showActivities]="true"
                        [showConditions]="true"
                        [showEffects]="true"
                    />
                </div>
            }

            @if (familiarAbilities$ | async; as familiarAbilities) {
                @if (familiarAbilities.length) {
                    <div class="vlist">
                        <header class="subsectionHeader">
                            Familiar Abilities
                        </header>

                        @for (ability of familiarAbilities; track $index) {
                            <div class="list-item">
                                <strong>{{ ability.ability.name }}</strong>

                                <div class="newrow left-aligned tags">
                                    @for (
                                        trait of ability.traits;
                                        track $index
                                    ) {
                                        <app-trait
                                            [name]="trait.name"
                                            [trait]="trait"
                                        />
                                    }
                                </div>

                                <div class="newrow left-aligned">
                                    {{ ability.ability.desc }}
                                </div>
                            </div>
                        }
                    </div>
                }
            }
        }
    </div>
</app-character-sheet-card>
