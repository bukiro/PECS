<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<div class="corner-button-tray">
    <app-minimize-button
        *ngIf="shouldShowMinimizeButton$ | async"
        [ngModel]="(isMinimized$ | async) ?? false"
        (ngModelChange)="toggleMinimized($event)"
    ></app-minimize-button>
</div>

<div
    id="{{creature}}-general-height"
    class="attributeBox"
>
    <header class="sectionHeader box-header">General Information</header>

    <ng-container *ngIf="creature.isCharacter()">
        <div class="list-item">
            <span>
                <strong>Level</strong>
                {{creature.level$ | async}}
            </span>

            <span
                class="hlist"
                *ngIf="{ amount: (creature.heroPoints$ | async) ?? 0 } as heroPoints"
            >
                <strong>Hero Points</strong>
                {{heroPoints.amount}}
                <button
                    type="button"
                    aria-label="Increase hero points"
                    (click)="incHeroPoints(-1)"
                    [disabled]="heroPoints.amount <= 0"
                >
                    -
                </button>

                <button
                    type="button"
                    aria-label="Decrease hero points"
                    (click)="incHeroPoints(1)"
                    [disabled]="heroPoints.amount >= 3"
                >
                    +
                </button>
            </span>
        </div>

        <div class="minimized-hide list-item">
            <strong>Character Name</strong>

            <span>{{creature.name$ | async}}</span>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creature.class.ancestry.name"
        >
            <strong>Ancestry</strong>

            <span>
                {{creature.class.ancestry.name}}{{(creature.class.heritage.name) ? " - " +
                    creature.class.heritage.name : ""}}
            </span>

            <div
                class="newrow left-aligned"
                *ngIf="creature.class.ancestry.traits.length"
            >
                <app-trait
                    *ngFor="let trait of characterTraits$ | async; trackBy:trackByIndex;"
                    [name]="trait.name"
                    [trait]="trait"
                >
                </app-trait>
            </div>

            <app-tags
                [creature]="creature"
                [objectName]="'Ancestry'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
                [showEffects]=true
            ></app-tags>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creature.class.background?.name as background"
        >
            <strong>Background</strong>

            <span>{{background}}</span>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creature.class.name"
        >
            <div
                class="newrow"
                *ngFor="let classChoice of classChoices$ | async; trackBy:trackByIndex;"
            >
                <strong [ngStyle]="{'margin-left': classChoice.subChoice ? '1em' : ''}">{{classChoice.name}}</strong>

                <span>{{classChoice.choice}}</span>
            </div>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creatureSize$ | async as creatureSize"
        >
            <strong>Size</strong>

            <span>{{creatureSize}}</span>

            <app-tags
                [creature]="creature"
                [objectName]="'Size'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
                [showEffects]=true
            ></app-tags>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creature.alignment$ | async as alignment"
        >
            <strong>Alignment</strong>

            <span>{{alignment}}</span>

            <app-tags
                [creature]="creature"
                [objectName]="'Alignment'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
                [showEffects]=true
            ></app-tags>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creature.class.deity"
        >
            <strong>Deity</strong>

            <span>{{creature.class.deity}}</span>
        </div>

        <ng-container *ngIf="((domains$ | async) ?? []) as domains">
            <div
                class="minimized-hide list-item"
                *ngIf="domains.length"
            >
                <strong>Deity's Domains</strong>

                <div class="newrow">
                    <ul>
                        <li *ngFor="let domain of domains; trackBy:trackByIndex;">
                            <ng-template #DomainDescTemplate>
                                <div
                                    class="newrow left-aligned"
                                    *ngIf="domain.sourceBook"
                                >
                                    <strong>Source</strong>

                                    <i>{{domain.sourceBook}}</i>
                                </div>

                                <div class="newrow left-aligned">{{domain.desc}}</div>
                            </ng-template>

                            <span [ngbPopover]="DomainDescTemplate">
                                {{domain.name}}
                                <i class="bi-question-circle"></i>
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </ng-container>

        <div
            class="list-item"
            *ngIf="creature.class.ancestry.languages?.length"
        >
            <strong>Languages</strong>

            <span>{{languages()}}</span>

            <app-tags
                [creature]="creature"
                [objectName]="'Languages'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
            ></app-tags>
        </div>

        <ng-container *ngIf="tenets$ | async as tenets">
            <div
                class="minimized-hide list-item"
                *ngIf="tenets.length"
            >
                <strong>Tenets</strong>

                <div class="newrow">
                    <ul>
                        <li *ngFor="let tenet of tenets; trackBy:trackByIndex;">{{tenet}}</li>
                    </ul>
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="edicts$ | async as edicts">
            <div
                class="minimized-hide list-item"
                *ngIf="edicts.length"
            >
                <strong>Edicts</strong>

                <div class="newrow">
                    <ul>
                        <li *ngFor="let edict of edicts; trackBy:trackByIndex;">{{edict}}</li>
                    </ul>
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="anathemas$ | async as anathemas">
            <div
                class="minimized-hide list-item"
                *ngIf="anathemas.length"
            >
                <strong>Anathema</strong>

                <div class="newrow">
                    <ul>
                        <li *ngFor="let anathema of anathemas; trackBy:trackByIndex;">{{anathema}}</li>
                    </ul>
                </div>
            </div>
        </ng-container>

        <app-tags
            [creature]="creature"
            [objectName]="'Tenets'"
            [showTraits]=true
            [showFeats]=true
            [showItems]=true
            [showActivities]=true
            [showConditions]=true
        ></app-tags>

        <div
            class="minimized-hide list-item"
            *ngFor="let differentWorldsData of differentWorldsData$ | async; trackBy:trackByIndex;"
        >
            <strong>Alternative Identity (Different Worlds)</strong>

            <span>
                {{differentWorldsData.getValue('name')}} {{!!differentWorldsData.getValue('background') ?
                    "("+differentWorldsData.getValue('background')+")" : ""}}
            </span>
        </div>
    </ng-container>

    <ng-container *ngIf="creature.isAnimalCompanion()">
        <ng-container *ngIf="companionTraits$ | async as companionTraits">
            <div
                class="newrow left-aligned tags"
                *ngIf="companionTraits.length"
            >
                <app-trait
                    *ngFor="let trait of companionTraits; trackBy:trackByIndex;"
                    [name]="trait.name"
                    [trait]="trait"
                >
                </app-trait>
            </div>
        </ng-container>

        <ng-container *ngIf="character$ | async as character">
            <app-tags
                [creature]="character"
                [objectName]="'Animal Companion'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
                [showEffects]=true
            >
            </app-tags>
        </ng-container>

        <div class="minimized-hide list-item">
            <strong>Companion Name</strong>

            <span>{{creature.name}}</span>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="companionSpecies$ | async as companionSpecies"
        >
            <strong>Animal</strong>

            <span>{{companionSpecies}}</span>
        </div>

        <ng-container *ngIf="companionSpecializations$ | async as specializations">
            <div
                class="minimized-hide list-item"
                *ngIf="specializations.length"
            >
                <strong>Specializations</strong>

                <span>{{companionSpecializations$}}</span>
            </div>
        </ng-container>

        <div
            class="minimized-hide list-item"
            *ngIf="creatureSize$ | async as creatureSize"
        >
            <strong>Size</strong>

            <span>{{creatureSize}}</span>

            <app-tags
                [creature]="creature"
                [objectName]="'Size'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
                [showEffects]=true
            ></app-tags>
        </div>

        <div
            class="list-item"
            *ngIf="creature.class.ancestry.name"
        >
            <strong>Support Benefit</strong>

            <p>
                {{creature.class.ancestry.supportBenefit}}
            </p>
        </div>
    </ng-container>

    <ng-container *ngIf="creature.isFamiliar()">
        <ng-container *ngIf="familiarTraits$ | async as companionTraits">
            <div
                class="newrow left-aligned tags"
                *ngIf="companionTraits.length"
            >
                <app-trait
                    *ngFor="let trait of companionTraits; trackBy:trackByIndex;"
                    [name]="trait.name"
                    [trait]="trait"
                >
                </app-trait>
            </div>
        </ng-container>

        <app-tags
            *ngIf="character$ | async as character"
            [creature]="character"
            [objectName]="'Familiar'"
            [showTraits]=true
            [showFeats]=true
            [showItems]=true
            [showActivities]=true
            [showConditions]=true
            [showEffects]=true
        >
        </app-tags>

        <div class="minimized-hide list-item">
            <strong>Familiar Name</strong>

            <span>{{creature.name$ | async}}</span>
        </div>

        <div class="minimized-hide list-item">
            <strong>Creature</strong>

            <span>{{creature.species}}</span>
        </div>

        <div
            class="minimized-hide list-item"
            *ngIf="creatureSize$ | async as creatureSize"
        >
            <strong>Size</strong>

            <span>{{creatureSize}}</span>

            <app-tags
                [creature]="creature"
                [objectName]="'Size'"
                [showTraits]=true
                [showFeats]=true
                [showItems]=true
                [showActivities]=true
                [showConditions]=true
                [showEffects]=true
            ></app-tags>
        </div>

        <ng-container *ngIf="familiarAbilities$ | async as familiarAbilities">
            <div
                class="vlist"
                *ngIf="familiarAbilities.length"
            >
                <header class="subsectionHeader">Familiar Abilities</header>

                <div
                    class="list-item"
                    *ngFor="let ability of familiarAbilities; trackBy:trackByIndex;"
                >
                    <strong>{{ability.ability.name}}</strong>

                    <div class="newrow left-aligned tags">
                        <app-trait
                            *ngFor="let trait of ability.traits; trackBy:trackByIndex;"
                            [name]="trait.name"
                            [trait]="trait"
                        >
                        </app-trait>
                    </div>

                    <div class="newrow left-aligned">
                        {{ability.ability.desc}}
                    </div>
                </div>
            </div>
        </ng-container>
    </ng-container>
</div>
