<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
@if (itemTraits$() | async; as traits) {
    @if (traits.length) {
        <div class="newrow left-aligned tags">
            @for (trait of traits; track $index) {
                <app-trait
                    [name]="trait"
                    [trait]="traitFromName(trait)"
                />
            }
        </div>
    }
}

<app-item-content [item]="item" />

<!-- Item activities -->
@if (itemParameters(); as itemParameters) {
    @if (itemParameters.asHavingItemActivities?.activities; as activities) {
        @for (activity of activities; track $index) {
            <div class="list-item left-aligned">
                @if (activity.name) {
                    <header class="spellHeader">
                        {{ activity.name }}
                        @if (activity.actions) {
                            <app-action-icons
                                [actionString]="activity.actions"
                            />
                        }
                        {{
                            activity.activationType
                                ? activity.activationType
                                : ""
                        }}
                    </header>
                }

                <div class="newrow left-aligned">
                    @for (trait of activity.traits; track $index) {
                        <app-trait
                            [name]="trait"
                            [trait]="traitFromName(trait)"
                        />
                    }

                    @for (trait of activity.activationTraits(); track $index) {
                        <app-trait
                            [name]="trait"
                            [trait]="traitFromName(trait)"
                            [extraDescription]="
                                '(This trait was derived from the action components.)'
                            "
                        />
                    }
                </div>

                <app-activity-content
                    [creature]="creature"
                    [activity]="activity"
                    [gain]="activity"
                    [allowActivate]="false"
                    [cooldown]="
                        (activityCooldown$(activity) | async) ??
                        activity.cooldown
                    "
                />
            </div>
        }
    }

    <!-- Common activities -->
    @if (
        itemParameters.asGrantingActivities?.gainActivities;
        as gainedActivities
    ) {
        @for (gain of gainedActivities; track $index) {
            @if (gain.originalActivity; as activity) {
                <div class="list-item left-aligned">
                    <header class="spellHeader">
                        {{ activity.name }}
                        @if (activity.actions) {
                            <app-action-icons
                                [actionString]="activity.actions"
                            />
                        }
                        {{
                            activity.activationType
                                ? activity.activationType
                                : ""
                        }}
                    </header>

                    <div class="newrow left-aligned">
                        @for (trait of activity.traits; track $index) {
                            <app-trait
                                [name]="trait"
                                [trait]="traitFromName(trait)"
                            />
                        }

                        @for (
                            trait of activity.activationTraits();
                            track $index
                        ) {
                            <app-trait
                                [name]="trait"
                                [trait]="traitFromName(trait)"
                                [extraDescription]="
                                    '(This trait was derived from the action components.)'
                                "
                            />
                        }
                    </div>

                    <app-activity-content
                        [creature]="creature"
                        [activity]="activity"
                        [gain]="gain"
                        [allowActivate]="false"
                    />
                </div>
            }
        }
    }
}
