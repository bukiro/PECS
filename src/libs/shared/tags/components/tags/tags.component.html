<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
@if (collectAllTags(); as allTags) {
    <div class="minimized-hide newrow left-aligned">
        @for (traitSet of traits$ | async; track $index) {
            @for (trait of traitSet.traits; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'trait'"
                    [object]="trait.trait"
                    [objectName]="traitSet.setName"
                    [sourceBook]="trait.trait.sourceBook"
                    [description]="
                        trait.trait.name + ' (' + trait.itemNamesList + ')'
                    "
                />
            }
        }

        @for (featSet of feats$ | async; track $index) {
            @for (feat of featSet.feats; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'feat'"
                    [object]="feat"
                    [objectName]="featSet.setName"
                    [description]="feat.displayName || feat.name"
                />
            }
        }

        @for (elementSet of companionElements$ | async; track $index) {
            @for (element of elementSet.elements; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'feat'"
                    [object]="element"
                    [objectName]="elementSet.setName"
                    [description]="element.name"
                />
            }
        }

        @for (elementSet of familiarElements$ | async; track $index) {
            @for (feat of elementSet.feats; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'feat'"
                    [object]="feat"
                    [objectName]="elementSet.setName"
                    [description]="feat.displayName || feat.name"
                />
            }
        }

        @for (itemSet of items$ | async; track $index) {
            @for (item of itemSet.items; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'item'"
                    [object]="item"
                    [objectName]="itemSet.setName"
                    [description]="item.name"
                />
            }
        }

        @for (specializationSet of specializations$ | async; track $index) {
            @for (spec of specializationSet.specializations; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'item'"
                    [object]="spec"
                    [objectName]="specializationSet.setName"
                    [description]="spec.name"
                />
            }
        }

        @for (activitySet of activities$ | async; track $index) {
            @for (activity of activitySet.activities; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'activity'"
                    [object]="activity"
                    [objectName]="activitySet.setName"
                    [description]="activity.name"
                />
            }
        }

        @for (conditionSets of allTags.conditions; track $index) {
            @for (conditionSet of conditionSets.conditionSets; track $index) {
                <app-hint
                    [creature]="creature"
                    [color]="'condition'"
                    [object]="conditionSet"
                    [objectName]="conditionSets.setName"
                    [description]="conditionSet.condition.name"
                />
            }
        }

        @for (effect of effects$ | async; track $index) {
            <ng-template #effectPopover>
                <div class="newrow">
                    <span>
                        <strong
                            [ngClass]="{
                                penalty: effect.penalty,
                                bonus: !effect.penalty && !effect.hasSetValue,
                                absolute: effect.hasSetValue,
                            }"
                        >
                            {{ effect.target }} {{ effect.displayTitle(true) }}
                        </strong>
                    </span>
                </div>

                @if (
                    effect.type !== "untyped" &&
                    !effect.toggled &&
                    !effect.setValue
                ) {
                    <div class="newrow">
                        <span>
                            <strong>Type</strong>
                            {{
                                effect.type +
                                    " " +
                                    (effect.penalty ? "penalty" : "bonus")
                            }}
                        </span>
                    </div>
                }

                @if (effect.duration) {
                    <div class="newrow">
                        <span>
                            <strong>Duration</strong>
                            {{
                                effect.duration
                                    ? (durationDescription$(effect.duration)
                                      | async)
                                    : ""
                            }}
                        </span>
                    </div>
                }

                <div class="newrow">
                    <span>
                        <strong>Granted by</strong>
                        {{
                            effect.source.includes("conditional, ")
                                ? effect.source.substr(13)
                                : effect.source
                        }}
                    </span>
                </div>

                @if (effect.source.includes("conditional, ")) {
                    <div class="newrow">
                        <span>
                            <strong>Conditional</strong>
                            This effect only applies for certain actions or
                            under specific circumstances.
                        </span>
                    </div>
                }
            </ng-template>

            <cite
                class="effect"
                [ngClass]="{
                    penalty: effect.penalty,
                    bonus: !effect.penalty && !effect.setValue,
                    absolute: effect.setValue,
                }"
                [ngbPopover]="effectPopover"
            >
                {{ effect.displayTitle(false) }}
                ({{ effect.source }})
            </cite>
        }
    </div>
}
