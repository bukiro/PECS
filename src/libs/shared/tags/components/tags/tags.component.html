<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<ng-container *ngIf="collectAllTags() as allTags">
    <div
        class="minimized-hide newrow left-aligned"
    >
        <ng-container *ngFor="let traitSet of traits$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let trait of traitSet.traits; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'trait'"
                    [object]="trait.trait"
                    [objectName]="traitSet.setName"
                    [sourceBook]="trait.trait.sourceBook"
                    [description]="trait.trait.name +' ('+ trait.itemNamesList + ')'"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let featSet of feats$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let feat of featSet.feats; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'feat'"
                    [object]="feat"
                    [objectName]="featSet.setName"
                    [description]="feat.displayName || feat.name"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let elementSet of companionElements$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let element of elementSet.elements; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'feat'"
                    [object]="element"
                    [objectName]="elementSet.setName"
                    [description]="element.name"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let elementSet of familiarElements$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let feat of elementSet.feats; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'feat'"
                    [object]="feat"
                    [objectName]="elementSet.setName"
                    [description]="feat.displayName || feat.name"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let itemSet of items$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let item of itemSet.items; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'item'"
                    [object]="item"
                    [objectName]="itemSet.setName"
                    [description]="item.name"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let specializationSet of specializations$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let spec of specializationSet.specializations; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'item'"
                    [object]="spec"
                    [objectName]="specializationSet.setName"
                    [description]="spec.name"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let activitySet of activities$ | async; trackBy:trackByIndex;">
            <ng-container *ngFor="let activity of activitySet.activities; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'activity'"
                    [object]="activity"
                    [objectName]="activitySet.setName"
                    [description]="activity.name"
                ></app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let conditionSets of allTags.conditions; trackBy:trackByIndex;">
            <ng-container *ngFor="let conditionSet of conditionSets.conditionSets; trackBy:trackByIndex;">
                <app-hint
                    [creature]="creature"
                    [color]="'condition'"
                    [object]="conditionSet"
                    [objectName]="conditionSets.setName"
                    [description]="conditionSet.condition.name"
                >
                </app-hint>
            </ng-container>
        </ng-container>

        <ng-container *ngFor="let effect of (effects$ | async); trackBy:trackByIndex;">
            <ng-template #effectPopover>
                <div class="newrow">
                    <span>
                        <strong [ngClass]="{'penalty':effect.penalty, 'bonus':!effect.penalty && !effect.hasSetValue, 'absolute':effect.hasSetValue}">
                            {{effect.target}} {{effect.displayTitle(true)}}
                        </strong>
                    </span>
                </div>

                <div
                    class="newrow"
                    *ngIf="effect.type !== 'untyped' && !effect.toggled && !effect.setValue"
                >
                    <span>
                        <strong>Type</strong>
                        {{effect.type + " " + (effect.penalty ? 'penalty' : 'bonus')}}
                    </span>
                </div>

                <div
                    class="newrow"
                    *ngIf="effect.duration"
                >
                    <span>
                        <strong>Duration</strong>
                        {{effect.duration ? durationDescription(effect.duration) : ''}}
                    </span>
                </div>

                <div class="newrow">
                    <span>
                        <strong>Granted by</strong>
                        {{effect.source.includes('conditional, ') ?
                        effect.source.substr(13) : effect.source}}
                    </span>
                </div>

                <div
                    class="newrow"
                    *ngIf="effect.source.includes('conditional, ')"
                >
                    <span>
                        <strong>Conditional</strong>
                        This effect only applies for certain actions or under specific circumstances.
                    </span>
                </div>
            </ng-template>

            <cite
                class="effect"
                [ngClass]="{'penalty':effect.penalty, 'bonus':!effect.penalty && !effect.setValue, 'absolute':effect.setValue}"
                [ngbPopover]="effectPopover"
            >
                {{effect.displayTitle(false)}}
                ({{effect.source}})
            </cite>
        </ng-container>
    </div>
</ng-container>
