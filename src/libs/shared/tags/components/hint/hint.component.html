<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
@for (hint of hints$() | async; track $index) {
    @if (hintSource(hint); as source) {
        <ng-template #SimpleHintContent>
            @for (
                text of hintDescription(hint).split("\n\n");
                track $index
            ) {
                <app-description
                    class="newrow"
                    [text]="text"
                />
            }
        </ng-template>

        <ng-template #HintContent>
            @for (
                text of hintDescription(hint).split("\n\n");
                track $index
            ) {
                <app-description
                    class="newrow"
                    [text]="text"
                />
            }

            @if (objectHasType(source)) {
                <label>
                    <div
                        class="button newrow center-aligned"
                        [ngClass]="{
                            'fancy-button':
                                character.settings.hintsShowMoreInformation,
                        }"
                    >
                        {{
                            character.settings.hintsShowMoreInformation
                                ? "Show Less"
                                : "Show More"
                        }}
                        <input
                            type="checkbox"
                            hidden
                            [(ngModel)]="
                                character.settings.hintsShowMoreInformation
                            "
                        />
                    </div>
                </label>
            }

            @if (
                character.settings.hintsShowMoreInformation &&
                    objectAsNamedObject(source);
                as namedObject
            ) {
                <div class="list-item">
                    @if (namedObject.name) {
                        <header class="spellHeader">
                            {{ namedObject.name }}
                        </header>
                    }

                    @if (sourceBook) {
                        <div class="newrow left-aligned">
                            <strong>Source</strong>

                            <i>{{ sourceBook }}</i>
                        </div>
                    }

                    @if (objectAsFeat(source); as feat) {
                        <app-feat [feat]="feat" />
                    }

                    @if (objectAsConditionGainSet(source); as conditionSet) {
                        <app-hint-condition
                            [condition]="conditionSet.condition"
                            [conditionGain]="conditionSet.gain"
                            [creature]="creature"
                        />
                    }

                    @if (objectAsActivity(source); as activity) {
                        <div class="newrow left-aligned">
                            @for (trait of activity.traits; track $index) {
                                <app-trait
                                    [name]="trait"
                                    [trait]="traitFromName(trait)"
                                />
                            }

                            @for (
                                trait of activity.activationTraits();
                                track $index
                            ) {
                                <app-trait
                                    [name]="trait"
                                    [trait]="traitFromName(trait)"
                                    [extraDescription]="
                                        '(This trait was derived from the action components.)'
                                    "
                                />
                            }
                        </div>

                        <app-activity-content
                            class="fullwidth vlist lower"
                            [creature]="creature"
                            [allowActivate]="false"
                            [activity]="activity"
                            [cooldown]="
                                (activityCooldown$(activity) | async) ??
                                activity.cooldown
                            "
                        />
                    }

                    @if (objectAsItem(source); as item) {
                        <app-hint-item
                            [item]="item"
                            [creature]="creature"
                        />
                    }

                    @if (objectAsDescOnly(source); as descOnly) {
                        <div class="newrow left-aligned">
                            <app-description
                                class="newrow"
                                [text]="descOnly.desc"
                            />
                        </div>
                    }
                </div>
            }
        </ng-template>

        <cite class="{{ color }}">
            <span
                #fullDetailPopover="ngbPopover"
                triggers="click"
                [ngbPopover]="HintContent"
            >
                <span
                    triggers="hover"
                    [ngbPopover]="
                        (!fullDetailPopover.isOpen() && SimpleHintContent) ||
                        undefined
                    "
                >
                    {{ hint.replaceTitle || description }}{{ hintChoice(hint) }}
                </span>
            </span>

            @if (hint.effects && hint.effects.length) {
                <input
                    aria-label="Activate the default level of this trait's effects"
                    type="checkbox"
                    triggers="hover"
                    [ngbTooltip]="'Activate any effects of this hint.'"
                    [(ngModel)]="hint.active"
                    (ngModelChange)="onActivateEffect()"
                />
                @if (hint.extraActivations > 0) {
                    <input
                        aria-label="Activate the second level of this trait's effects"
                        type="checkbox"
                        triggers="hover"
                        [ngbTooltip]="
                            'Activate the second level of this hint\'s effects.'
                        "
                        [(ngModel)]="hint.active2"
                        (ngModelChange)="onActivateEffect()"
                    />
                }
                @if (hint.extraActivations > 1) {
                    <input
                        aria-label="Activate the third level of this trait's effects"
                        type="checkbox"
                        triggers="hover"
                        [ngbTooltip]="
                            'Activate the third level of this hint\'s effects.'
                        "
                        [(ngModel)]="hint.active3"
                        (ngModelChange)="onActivateEffect()"
                    />
                }
                @if (hint.extraActivations > 2) {
                    <input
                        aria-label="Activate the fourth level of this trait's effects"
                        type="checkbox"
                        triggers="hover"
                        [ngbTooltip]="
                            'Activate the fourth level of this hint\'s effects.'
                        "
                        [(ngModel)]="hint.active4"
                        (ngModelChange)="onActivateEffect()"
                    />
                }
                @if (hint.extraActivations > 3) {
                    <input
                        aria-label="Activate the fifth level of this trait's effects"
                        type="checkbox"
                        triggers="hover"
                        [ngbTooltip]="
                            'Activate the fifth level of this hint\'s effects.'
                        "
                        [(ngModel)]="hint.active5"
                        (ngModelChange)="onActivateEffect()"
                    />
                }
            }
        </cite>
    }
}
