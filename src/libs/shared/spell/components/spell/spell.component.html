<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<div
    *ngIf="spell"
    class="newrow lower"
>
    <div class="newrow left-aligned">
        <app-trait
            *ngFor="let trait of spell.traits; trackBy:trackByIndex;"
            [name]="trait"
            [trait]="traitFromName(trait)"
        />

        <app-trait
            *ngFor="let trait of spell.activationTraits(); trackBy:trackByIndex;"
            [name]="trait"
            [trait]="traitFromName(trait)"
            [extraDescription]="'(This trait was derived from the action components.)'"
        />

        <app-tags
            [objectName]="spell.name"
            [showTraits]=true
            [showFeats]=true
            [showItems]=true
            [showActivities]=true
            [showConditions]=true
            [showEffects]=true
            [specialNames]="source ? [source] : []"
        />
    </div>

    <app-spell-content
        class="vlist fullwidth"
        [spell]="spell"
        [spellLevel]="(spellLevelFromBaseLevel$(spell, spellLevel) | async) ?? spellLevel"
        [casting]="casting"
    />

    <div
        *ngFor="let feat of characterFeatsShowingHintsOnThis$(spell.name) | async; trackBy:trackByIndex;"
        class="newrow left-aligned"
    >
        <header class="spellHeader">{{feat.name}}</header>

        <div
            *ngIf="feat.traits.length"
            class="newrow left-aligned"
        >
            <app-trait
                *ngFor="let trait of feat.traits; trackBy:trackByIndex;"
                [name]="trait"
                [trait]="traitFromName(trait)"
            />
        </div>

        <div
            *ngFor="let desc of feat.desc.split('\n\n'); trackBy:trackByIndex;"
            class="newrow left-aligned"
        >
            <app-description
                class="newrow"
                [text]="desc"
            />
        </div>
    </div>
</div>
