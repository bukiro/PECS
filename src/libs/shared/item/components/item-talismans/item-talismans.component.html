<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<!-- Changing Talismans -->
<div class="list-item">
    @for (index of availableSlots(); track $index) {
        <div class="newrow">
            @if ($first) {
                <strong>Affix Talisman</strong>
            } @else {
                <span>&nbsp;</span>
            }

            <select
                aria-label="Select talisman"
                [disabled]="!item.talismans[index - 1] && index > 0"
                [(ngModel)]="newTalisman[index]"
                (change)="onSelectTalisman(index)"
            >
                <ng-template
                    #TalismanTemplate
                    let-option
                >
                    <option
                        [ngValue]="option"
                        title="{{
                            talismanTitle(
                                option.talisman,
                                option.talismanCordCompatible
                            )
                        }}"
                    >
                        @if (option.talismanCordCompatible) {
                            <span>&#9741;</span>
                        }
                        {{
                            option.talisman.amount > 1
                                ? option.talisman.amount
                                : ""
                        }}
                        {{ option.talisman.name }}
                    </option>
                </ng-template>

                @for (
                    talisman of initialTalismans(index);
                    track $index
                ) {
                    @if ($first) {
                        <option [ngValue]="talisman"></option>
                    } @else {
                        <optgroup label="Current Talisman">
                            <ng-container
                                *ngTemplateOutlet="
                                    TalismanTemplate;
                                    context: { $implicit: talisman }
                                "
                            />
                        </optgroup>
                    }
                }

                @for (inv of inventoriesOrCleanItems(); track $index) {
                    @if (availableTalismans(inv); as availableTalismans) {
                        @if (availableTalismans.length) {
                            <optgroup
                                [label]="
                                    itemStore
                                        ? 'Available talismans'
                                        : (inventoryName$(inv) | async)
                                "
                            >
                                @for (
                                    talisman of availableTalismans;
                                    track $index
                                ) {
                                    <ng-container
                                        *ngTemplateOutlet="
                                            TalismanTemplate;
                                            context: { $implicit: talisman }
                                        "
                                    />
                                }
                            </optgroup>
                        }
                    }
                }
            </select>
        </div>
    }
</div>
