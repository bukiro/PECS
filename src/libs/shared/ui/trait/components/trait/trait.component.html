<cite
    class="trait"
    [ngClass]="{
        'trait-rare': trait.name === 'Rare',
        'trait-uncommon': trait.name === 'Uncommon',
        'extra-trait': extraDescription,
    }"
>
    <ng-template #TraitContent>
        @if (trait.sourceBook) {
            <div class="newrow left-aligned">
                <strong>Source</strong>

                <i>{{ trait.sourceBook }}</i>
            </div>
        }

        @for (split of trait.desc.split("\n\n"); track $index) {
            <app-description [text]="split" />
        }

        @if (extraDescription) {
            <div class="newrow left-aligned">
                {{ extraDescription }}
            </div>
        }

        @if (trait.objectEffects && trait.objectEffects.length && item) {
            @for (split of trait.effectDesc.split("\n\n"); track $index) {
                <app-description [text]="split" />
            }
        }
    </ng-template>

    <span
        triggers="hover"
        [ngbPopover]="TraitContent"
    >
        {{ extraDescription ? "+ " : "" }}{{ name || trait.name }}
    </span>

    @if (trait.objectEffects && trait.objectEffects.length && item) {
        @for (activation of objectTraitActivations$() | async; track $index) {
            <input
                aria-label="Activate the default level of this trait's effects"
                type="checkbox"
                triggers="hover"
                [ngbTooltip]="'Activate any effects of this trait.'"
                [(ngModel)]="activation.active"
                (ngModelChange)="onActivateEffect()"
            />

            @if (trait.extraActivations > 0) {
                <input
                    aria-label="Activate the second level of this trait's effects"
                    type="checkbox"
                    triggers="hover"
                    [ngbTooltip]="
                        'Activate the second level of this trait\'s effects.'
                    "
                    [(ngModel)]="activation.active2"
                    (ngModelChange)="onActivateEffect()"
                />
            }

            @if (trait.extraActivations > 1) {
                <input
                    aria-label="Activate the third level of this trait's effects"
                    type="checkbox"
                    triggers="hover"
                    [ngbTooltip]="
                        'Activate the third level of this trait\'s effects.'
                    "
                    [(ngModel)]="activation.active3"
                    (ngModelChange)="onActivateEffect()"
                />
            }
        }
    }
</cite>
