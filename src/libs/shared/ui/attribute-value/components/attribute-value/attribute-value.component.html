<ng-template #TitleTemplate>
    <div class="title">
        <span class="title__title">{{ title }}</span>

        <span
            *ngFor="let subline of sublines ?? []; trackBy:trackByIndex"
            class="title__subline"
        >
            {{ subline }}
        </span>
    </div>
</ng-template>

<ng-container *ngIf="!showValueOnLeftSide" [ngTemplateOutlet]="TitleTemplate"></ng-container>

<div
    class="value"
    *ngIf="value !== undefined"
>
    <div
        class="value__value"
        [ngClass]="{
            'background-color-penalty': hasPenalties && !hasAbsolutes,
            'background-color-bonus': hasBonuses && !hasAbsolutes && !hasPenalties,
            'background-color-absolute': hasAbsolutes
        }"
        [ngbPopover]="BonusesTemplate"
        [disablePopover]="!bonuses?.length"
    >
        {{ value }}
    </div>

    <!-- Dice roll icon -->
    <div
        *ngIf="quickdiceTemplate"
        class="value__icon value__icon--dice"
    >
        <ng-container *ngTemplateOutlet="quickdiceTemplate"></ng-container>
    </div>

    <ng-template #BonusesTemplate>
        <app-bonus-list
            *ngIf="bonuses?.length"
            [bonuses]="bonuses"
        ></app-bonus-list>
    </ng-template>

    <!-- Notes icon -->
    <div
        *ngIf="showNotesIcon"
        class="value__icon value__icon--notes"
    >
        <span (click)="showNotes = !showNotes">
            <i
                [ngbTooltip]="'Edit notes'"
                class='bi-pencil-square'
            ></i>
        </span>
    </div>

    <!-- Bonuses icon -->
    <div
        *ngIf="bonuses?.length"
        class="value__icon value__icon--bonuses"
    >
        <span [ngbPopover]="BonusesTemplate">
            <i class='bi-info'></i>
        </span>
    </div>

    <!-- Effects icon -->
    <div
        *ngIf="effectsTarget"
        class="value__icon value__icon--effects"
    >
        <span
            [ngbPopover]="EffectsTemplate"
            [popoverTitle]="'Custom effects on ' + title"
            #EffectsPopover="ngbPopover"
            triggers="click"
        >
            <i
                [ngbTooltip]="'Edit effects'"
                [disableTooltip]="EffectsPopover.isOpen()"
                class='bi-lightning-charge'
            ></i>
        </span>

        <ng-template #EffectsTemplate>
            <app-object-effects
                [creature]="effectsTarget.creature"
                [objectName]="effectsTarget.target"
            ></app-object-effects>
        </ng-template>
    </div>
</div>

<ng-container *ngIf="!!showValueOnLeftSide" [ngTemplateOutlet]="TitleTemplate"></ng-container>
