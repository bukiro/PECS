<ng-template #TitleTemplate>
    <div class="title">
        <span class="title__title">{{ title }}</span>

        <span
            *ngFor="let subline of sublines ?? []; trackBy:trackByIndex"
            class="title__subline"
        >
            {{ subline }}
        </span>
    </div>
</ng-template>

<ng-container *ngIf="!showValueOnLeftSide" [ngTemplateOutlet]="TitleTemplate" />

<div
    *ngIf="value !== undefined"
    class="value"
>
    <div
        class="value__value"
        [ngClass]="{
            'background-color-penalty': hasPenalties && !hasAbsolutes,
            'background-color-bonus': hasBonuses && !hasAbsolutes && !hasPenalties,
            'background-color-absolute': hasAbsolutes
        }"
        [ngbPopover]="BonusesTemplate"
        [disablePopover]="!bonuses?.length"
    >
        {{ value }}
    </div>

    <!-- Dice roll icon -->
    <div
        *ngIf="quickdiceTemplate"
        class="value__icon value__icon--dice"
    >
        <ng-container *ngTemplateOutlet="quickdiceTemplate" />
    </div>

    <ng-template #BonusesTemplate>
        <app-bonus-list
            *ngIf="bonuses?.length"
            [bonuses]="bonuses"
        />
    </ng-template>

    <!-- Notes icon -->
    <div
        *ngIf="showNotesIcon"
        class="value__icon value__icon--notes"
    >
        <span (click)="showNotes = !showNotes">
            <i
                class='bi-pencil-square'
                [ngbTooltip]="'Edit notes'"
            ></i>
        </span>
    </div>

    <!-- Bonuses icon -->
    <div
        *ngIf="bonuses?.length"
        class="value__icon value__icon--bonuses"
    >
        <span [ngbPopover]="BonusesTemplate">
            <i class='bi-info'></i>
        </span>
    </div>

    <!-- Effects icon -->
    <div
        *ngIf="customEffectsTarget"
        class="value__icon value__icon--effects"
    >
        <span
            #EffectsPopover="ngbPopover"
            triggers="click"
            [ngbPopover]="EffectsTemplate"
            [popoverTitle]="'Custom effects on ' + title"
        >
            <i
                class='bi-lightning-charge'
                [ngbTooltip]="'Edit effects'"
                [disableTooltip]="EffectsPopover.isOpen()"
            ></i>
        </span>

        <ng-template #EffectsTemplate>
            <app-object-effects
                [creature]="customEffectsTarget.creature"
                [objectName]="customEffectsTarget.target"
            />
        </ng-template>
    </div>
</div>

<ng-container *ngIf="!!showValueOnLeftSide" [ngTemplateOutlet]="TitleTemplate" />
