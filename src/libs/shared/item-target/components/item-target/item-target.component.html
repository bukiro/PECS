<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<ng-template
    #ItemTargetModal
    let-modal
>
    <div class="modal-header">
        <header
            class="sectionHeader modal-title"
            id="modal-title"
        >
            Move item
        </header>

        <button
            type="button"
            class="close"
            aria-label="close"
            ngbAutofocus
            (click)="modal.dismiss('Cross click')"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body vlist">
        <div
            class="fullsize-scroll-box vlist"
            style="max-height: 50vh;"
        >
            <div
                *ngIf="isItemContainer"
                class="list-item newrow left-aligned"
            >
                <i class="ra ra-hive-emblem"></i>
                This item contains {{containedItemsAmount()}} items with a total bulk of {{inventoryBulk()}}.
            </div>

            <div
                *ngIf="doesItemGrantItems"
                class="list-item newrow left-aligned"
            >
                <i class="ra ra-hive-emblem"></i>
                This item has additional parts with a total bulk of {{containedBulkString(item)}}.
                <div class="newrow left-aligned">
                    <input
                        id="excludingParts"
                        type="checkbox"
                        [(ngModel)]="isExcludingParts"
                    >
                    <label for="excludingParts">
                        <strong>Move without parts (local only)</strong>
                    </label>
                </div>
            </div>

            <div
                *ngIf="canItemSplit"
                class="list-item newrow"
            >
                <strong>Split stack</strong>

                <span>
                    Move
                    <span class="value">
                        <button
                            type="button"
                            [disabled]="selectedAmount<=0"
                            (click)="onIncSplit(-1)"
                        >
                            -
                        </button>
                        {{selectedAmount}}
                        <button
                            type="button"
                            [disabled]="selectedAmount>=item.amount"
                            (click)="onIncSplit(1)"
                        >
                            +
                        </button>
                    </span>
                </span>

                <span>
                    Keep
                    <span class="value">{{item.amount - selectedAmount}}</span>
                </span>
            </div>

            <ng-container *ngFor="let target of (itemTargets$ | async); trackBy:trackByIndex">
                <div class="list-item newrow">
                    <span
                        class="hlist"
                        style="font-size: 1.5em;"
                    >
                        <ng-container [ngSwitch]="targetType(target)">
                            <i
                                *ngSwitchCase="'Inventory'"
                                class="ra ra-hive-emblem"
                                style="line-height: 1.5;"
                            ></i>

                            <i
                                *ngSwitchCase="'Companion'"
                                class="ra ra-wolf-howl"
                                style="line-height: 1.5;"
                            ></i>

                            <i
                                *ngSwitchCase="'Familiar'"
                                class="ra ra-raven"
                                style="line-height: 1.5;"
                            ></i>

                            <i
                                *ngSwitchDefault

                                class="ra ra-player"                                style="line-height: 1.5;"
                            ></i>
                        </ng-container>

                        <strong>{{targetName$(target) | async}}</strong>

                        <span>{{containerBulk(target)}}</span>
                    </span>

                    <span
                        *ngFor="let cannotMove of [cannotMove(target)]; trackBy:trackByIndex"
                        style="flex-grow:0"
                        [ngbTooltip]="cannotMove"
                    >
                        <ng-template #CurrentButton>
                            <button
                                type="button"
                                class="btn inactive-button"
                                disabled
                            >
                                Current
                            </button>
                        </ng-template>

                        <button
                            *ngIf="!isSameInventoryAsTarget(target); else CurrentButton"
                            type="button"
                            class="btn btn-primary"
                            style="background-color: rgb(var(--accent))"
                            [disabled]="cannotMove || (item.amount && !selectedAmount)"
                            [ngSwitch]="targetType(target)"
                            (click)="onSetTarget(target); modal.close('Move click')"
                        >
                            <span *ngSwitchCase="'Inventory'">Move</span>

                            <span *ngSwitchCase="'Player'">Offer</span>

                            <span *ngSwitchDefault>Give</span>
                        </button>
                    </span>
                </div>
            </ng-container>
        </div>
    </div>

    <div class="modal-footer">
        <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="modal.dismiss('Cancel click')"
        >
            Cancel
        </button>
    </div>
</ng-template>

<button
    type="button"
    class="center-aligned"
    (click)="openItemTargetModal(ItemTargetModal)"
>
    Move...
</button>
