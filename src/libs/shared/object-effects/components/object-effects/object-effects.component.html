<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<div class="vlist">
    <header class="subsectionHeader">Custom effects on {{ objectName }}</header>

    <button
        type="button"
        class="newrow center-aligned"
        (click)="newCustomEffectOnThis()"
    >
        Add effect
    </button>

    @for (effect of customEffectsOnThis(); track $index) {
        <div class="newrow list-item">
            <ng-template #FormulaTemplate>
                <strong>Formula</strong>
                {{ effect.setValue || effect.value || "" }}
            </ng-template>

            <span class="hlist">
                <strong class="no-shadow">Granted by</strong>

                <input
                    type="text"
                    aria-label="Effect source input"
                    maxLength="50"
                    id="customEffectSource{{ objectName }}{{ $index }}"
                    [(ngModel)]="effect.source"
                    (blur)="updateEffects()"
                />
            </span>

            <span class="hlist">
                <strong class="no-shadow">Type</strong>

                <select
                    aria-label="Select effect type"
                    [(ngModel)]="effect.type"
                    (ngModelChange)="updateEffects()"
                >
                    @for (type of bonusTypes(); track $index) {
                        <option>
                            {{ type }}
                        </option>
                    }
                </select>
            </span>

            @if (effectValueParameters(effect); as effectValueParameters) {
                <span class="hlist">
                    <strong class="no-shadow">Value</strong>

                    @switch (effectValueParameters.displayType) {
                        @case ("Formula") {
                            <span>
                                <span
                                    class="value"
                                    [ngClass]="{
                                        absolute:
                                            effectValueParameters
                                                .formulaValue?.[0] === '=',
                                        bonus:
                                            effectValueParameters
                                                .formulaValue?.[0] === '+',
                                        penalty:
                                            effectValueParameters
                                                .formulaValue?.[0] === '-',
                                    }"
                                >
                                    {{ effectValueParameters.formulaValue }}
                                </span>

                                @if (effectValueParameters.isFormula) {
                                    <i
                                        class="bi-calculator"
                                        [ngbPopover]="FormulaTemplate"
                                    ></i>
                                }
                            </span>
                        }

                        @case ("Toggle") {
                            <span class="value absolute">on</span>
                        }

                        @case ("Value") {
                            <input
                                aria-label="Effect value input"
                                type="number"
                                class="number4"
                                maxLength="30"
                                id="customEffectValue{{ objectName }}{{
                                    $index
                                }}"
                                [(ngModel)]="effect.value"
                                (blur)="validate(effect)"
                            />
                        }
                    }
                </span>
            }

            <button
                type="button"
                style="flex-basis: auto; flex-grow: 0"
                (click)="removeCustomEffect(effect)"
            >
                Remove
            </button>
        </div>
    }
</div>
