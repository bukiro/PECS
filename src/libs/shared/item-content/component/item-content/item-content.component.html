<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
@if (itemRoles(); as itemRoles) {
    @if (item.sourceBook) {
        <div class="newrow left-aligned">
            <span>
                <strong>Source</strong>

                <i>{{ item.sourceBook }}</i>
            </span>
        </div>
    }

    @if (item.PFSnote) {
        <div class="newrow left-aligned">
            <span>
                <strong>PFS Note</strong>

                <i>{{ item.PFSnote }}</i>
            </span>
        </div>
    }

    <div class="newrow left-aligned">
        @if (item.tradeable && priceText(); as calculatedPriceText) {
            <span>
                <strong>Price</strong>
                {{ calculatedPriceText }}
                {{
                    itemRoles.stack && itemRoles.stack > 1
                        ? "per " + itemRoles.stack
                        : ""
                }}
            </span>
        }

        @if (itemRoles.asWeapon?.dicenum || itemRoles.asWeapon?.extraDamage) {
            <span>
                <strong>Damage</strong>

                @if (itemRoles.asWeapon?.dicenum) {
                    {{ itemRoles.asWeapon?.dicenum }}d{{
                        itemRoles.asWeapon?.dicesize
                    }}
                    {{ itemRoles.asWeapon?.dmgType }}
                }

                @if (itemRoles.asWeapon?.extraDamage) {
                    {{ itemRoles.asWeapon?.extraDamage?.replace("\n", " ") }}
                }
            </span>
        }

        @if (acBonusParameters$(itemRoles) | async; as acBonusParameters) {
            <span>
                <strong>AC Bonus</strong>

                <span
                    [ngClass]="{
                        penalty: acBonusParameters.penalty,
                        bonus: acBonusParameters.bonus,
                    }"
                >
                    {{ acBonusParameters.effective }}
                    {{ itemRoles.asShield?.coverbonus ? "(4)" : "" }}
                </span>
            </span>
        }

        @if (dexCapParameters$(itemRoles) | async; as dexCapParameters) {
            <span>
                <strong>Dex Cap</strong>

                <span
                    [ngClass]="{
                        penalty: dexCapParameters.penalty,
                        bonus: dexCapParameters.bonus,
                    }"
                >
                    {{
                        dexCapParameters.effective < 0
                            ? "none"
                            : dexCapParameters.effective
                    }}
                    <!-- this comment prevents
                    strange formatting -->
                </span>
            </span>
        }

        @if (
            skillPenaltyParameters$(itemRoles) | async;
            as skillPenaltyParameters
        ) {
            <span>
                <strong>Check Penalty</strong>

                <span
                    [ngClass]="{
                        penalty: skillPenaltyParameters.penalty,
                        bonus: skillPenaltyParameters.bonus,
                    }"
                    >{{ skillPenaltyParameters.effective }}</span
                >
            </span>
        }

        @if (speedPenaltyParameters(itemRoles); as speedPenaltyParameters) {
            <span>
                <strong>Speed Penalty</strong>

                <span
                    [ngClass]="{
                        penalty: speedPenaltyParameters.penalty,
                        bonus: speedPenaltyParameters.bonus,
                    }"
                    >{{ speedPenaltyParameters.effective }}</span
                >
            </span>
        }

        @if (
            strengthRequirementParameters$(itemRoles) | async;
            as strenthRequirementParameters
        ) {
            <span>
                <strong>Strength</strong>

                <span
                    [ngClass]="{
                        penalty: strenthRequirementParameters.penalty,
                        bonus: strenthRequirementParameters.bonus,
                    }"
                >
                    {{ strenthRequirementParameters.effective }}
                </span>
            </span>
        }

        @if (uncertainItemLiteralValue("usage"); as usage) {
            <span>
                <strong>Usage</strong>
                {{ usage }}
            </span>
        }

        @if (item.storeBulk) {
            <span>
                <strong>Bulk</strong>
                {{ item.storeBulk }}
            </span>
        }

        @if (bulkParameters(item); as bulkParameters) {
            <span>
                <strong>
                    Bulk
                    {{
                        itemRoles.asEquipment?.carryingBulk &&
                        !itemRoles.asEquipment?.equipped
                            ? "(unequipped)"
                            : ""
                    }}
                </strong>

                <span
                    [ngClass]="{
                        penalty: bulkParameters.penalty,
                        bonus: bulkParameters.bonus,
                    }"
                    >{{ bulkParameters.effective || 0 }}</span
                >
            </span>
        }

        @if (
            itemRoles.asEquipment?.carryingBulk &&
            itemRoles.asEquipment?.equipped
        ) {
            <span>
                <strong>Unequipped bulk</strong>
                {{ itemRoles.asEquipment?.carryingBulk }}
            </span>
        }

        @if (hardnessParameters$(itemRoles) | async; as hardnessParameters) {
            <span>
                <strong>Hardness</strong>

                <span
                    [ngClass]="{
                        penalty: hardnessParameters.penalty,
                        bonus: hardnessParameters.bonus,
                    }"
                    >{{ hardnessParameters.effective }}</span
                >
            </span>
        }

        @if (hitpointParameters$(itemRoles) | async; as hitpointParameters) {
            <span>
                <strong>HP</strong>

                @if (hitpointParameters.brokenThreshold) {
                    <strong>(BT)</strong>
                }

                <span
                    [ngClass]="{
                        penalty: hitpointParameters.maxHP.penalty,
                        bonus: hitpointParameters.maxHP.bonus,
                    }"
                    >{{ hitpointParameters.maxHP.effective }}</span
                >

                @if (hitpointParameters.brokenThreshold) {
                    <span
                        [ngClass]="{
                            penalty: hitpointParameters.brokenThreshold.penalty,
                            bonus: hitpointParameters.brokenThreshold.bonus,
                        }"
                    >
                        ({{ hitpointParameters.brokenThreshold.effective }})
                    </span>
                }
            </span>
        }
    </div>

    @if (itemRoles.asWeapon || uncertainItemLiteralValue("hands")) {
        <div class="newrow left-aligned">
            @if (
                itemRoles.asWeapon?.hands || uncertainItemLiteralValue("hands");
                as hands
            ) {
                <span>
                    <strong>Hands</strong>
                    {{ hands }}
                </span>
            }

            @if (itemRoles.asWeapon?.ranged) {
                <span>
                    <strong>Range</strong>
                    {{ itemRoles.asWeapon?.ranged }} ft.
                </span>
            }

            @if (itemRoles.asWeapon?.reload) {
                <span>
                    <strong>Reload</strong>
                    {{ itemRoles.asWeapon?.reload }}
                </span>
            }
        </div>
    }

    @if (item.access) {
        <div class="newrow left-aligned">
            <span>
                <strong>Access</strong>

                <i>{{ item.access }}</i>
            </span>
        </div>
    }

    <!-- Activation text for activated standalone items, such as wands (identified by not having a trigger or requirements) -->
    @if (shouldShowActivations()) {
        <div class="newrow gap-text left-aligned">
            <strong>Activate</strong>

            @if (uncertainItemLiteralValue("actions"); as actions) {
                <app-action-icons [actionString]="actions.toString()" />
            }

            @if (
                uncertainItemLiteralValue("activationType");
                as activationType
            ) {
                <span>{{ activationType }}</span>
            }

            @if (uncertainItemLiteralValue("frequency"); as frequency) {
                <strong>Frequency</strong>

                <span>{{ frequency }}</span>
            }

            @if (uncertainItemLiteralValue("effect"); as effect) {
                <strong>Effect</strong>

                <app-description
                    [text]="effect.toString()"
                    [oneLiner]="true"
                />
            }
        </div>
    }

    <div class="newrow left-aligned">
        @if (uncertainItemLiteralValue("ammunition"); as ammunition) {
            <span>
                <strong>Ammunition</strong>
                {{ ammunition }}
            </span>
        }
    </div>

    <!-- Activation text for talismans (identified by having a trigger or requirements, but no effect) -->
    @if (shouldShowTalismans()) {
        <div class="newrow left-aligned">
            <strong>Activate</strong>

            @if (uncertainItemLiteralValue("actions"); as actions) {
                <app-action-icons [actionString]="actions.toString()" />
            }

            @if (
                uncertainItemLiteralValue("activationType");
                as activationType
            ) {
                <span>{{ activationType }}</span>
            }

            @if (uncertainItemLiteralValue("trigger"); as trigger) {
                <span>
                    <strong>Trigger</strong>
                    {{ trigger }}
                </span>
            }

            @if (uncertainItemLiteralValue("requirements"); as requirements) {
                <span>
                    <strong>Requirements</strong>
                    {{ requirements }}
                </span>
            }
        </div>
    }

    <div class="newrow left-aligned">
        <hr class="newrow" />
        @for (desc of item.desc.split("\n\n"); track $index) {
            <app-description
                class="newrow"
                [text]="desc"
            />
        }

        @if (languageGainsFromItem(); as languageGains) {
            @if (languageGains.length) {
                <div class="newrow list-item">
                    @for (
                        gainLanguage of languageGains;
                        track languageIndex;
                        let languageIndex = $index
                    ) {
                        <div class="newrow">
                            <strong>{{ gainLanguage.title }}</strong>

                            @if (!gainLanguage.locked) {
                                <input
                                    aria-label="Language granted by the item"
                                    type="text"
                                    id="{{ item.id }}language{{
                                        languageIndex
                                    }}name"
                                    [(ngModel)]="gainLanguage.name"
                                />
                            }
                            @if (gainLanguage.locked) {
                                {{ gainLanguage.name }}
                            }
                        </div>
                    }
                </div>
            }
        }

        @if (doesItemHaveShownData()) {
            <div class="newrow list-item">
                @for (data of item.data; track dataIndex; let dataIndex = $index) {
                    @if (data.show) {
                        <div class="newrow">
                            <strong>{{ data.name }}</strong>

                            @if (data.type === "string") {
                                <input
                                    aria-label="Item data text"
                                    type="text"
                                    id="{{ item.id }}data{{
                                        dataIndex
                                    }}value-string"
                                    [(ngModel)]="data.value"
                                />
                            }

                            @if (data.type === "boolean") {
                                <input
                                    aria-label="Toggle item data"
                                    type="checkbox"
                                    id="{{ item.id }}data{{
                                        dataIndex
                                    }}value-boolean"
                                    [(ngModel)]="data.value"
                                />
                            }
                        </div>
                    }
                }
            </div>
        }

        <!-- Alchemical elixir data -->
        @if (asAlchemicalElixir(); as asAlchemicalElixir) {
            @if (asAlchemicalElixir.benefit) {
                <p class="gap-text">
                    <strong>Benefit</strong>

                    <app-description
                        [text]="asAlchemicalElixir.benefit"
                        [oneLiner]="true"
                    />
                </p>
            }

            @if (asAlchemicalElixir.drawback) {
                <p class="gap-text">
                    <strong>Drawback</strong>

                    <app-description
                        [text]="asAlchemicalElixir.drawback"
                        [oneLiner]="true"
                    />
                </p>
            }
        }

        <!-- Alchemical poison data -->
        @if (asAlchemicalPoison(); as asAlchemicalPoison) {
            @if (
                asAlchemicalPoison.savingThrow ||
                asAlchemicalPoison.maxDuration ||
                asAlchemicalPoison.stages.length
            ) {
                <p>
                    @if (asAlchemicalPoison.savingThrow) {
                        <span>
                            <strong>Saving Throw</strong>
                            {{ asAlchemicalPoison.savingThrow }}
                        </span>
                    }

                    @if (asAlchemicalPoison.stages[0]) {
                        <span>
                            <strong>Onset</strong>
                            {{ asAlchemicalPoison.stages[0] }}
                        </span>
                    }

                    @if (asAlchemicalPoison.maxDuration) {
                        <span>
                            <strong>Maximum Duration</strong>
                            {{ asAlchemicalPoison.maxDuration }}
                        </span>
                    }

                    @for (
                        stage of asAlchemicalPoison.stages;
                        track stageIndex;
                        let stageIndex = $index
                    ) {
                        @if (stageIndex > 0) {
                            <span>
                                <strong>Stage {{ stageIndex }}</strong>
                                {{ asAlchemicalPoison.stages[stageIndex] }}
                            </span>
                        }
                    }
                </p>
            }
        }

        @if (item.subTypeDesc) {
            <p>
                @if (item.subType) {
                    <strong>{{ item.subType }}</strong>
                }
                {{ item.subTypeDesc }}
            </p>
        }

        @if (item.craftRequirement) {
            <p>
                <strong>Craft Requirement</strong>
                {{ item.craftRequirement }}
            </p>
        }

        @if (item.hasSuccessResults()) {
            <ul>
                @if (doesItemHaveValue("critsuccess")) {
                    <li>
                        <span class="gap-text">
                            <strong>Critical Success</strong>

                            <app-description
                                [text]="item.critsuccess"
                                [oneLiner]="true"
                            />
                        </span>
                    </li>
                }

                @if (doesItemHaveValue("success")) {
                    <li>
                        <span class="gap-text">
                            <strong>Success</strong>

                            <app-description
                                [text]="item.success"
                                [oneLiner]="true"
                            />
                        </span>
                    </li>
                }

                @if (doesItemHaveValue("failure")) {
                    <li>
                        <span class="gap-text">
                            <strong>Failure</strong>

                            <app-description
                                [text]="item.failure"
                                [oneLiner]="true"
                            />
                        </span>
                    </li>
                }

                @if (doesItemHaveValue("critfailure")) {
                    <li>
                        <span class="gap-text">
                            <strong>Critical Failure</strong>

                            <app-description
                                [text]="item.critfailure"
                                [oneLiner]="true"
                            />
                        </span>
                    </li>
                }
            </ul>
        }

        @if (item.inputRequired) {
            <div class="list-item newrow problem">
                <strong>Player input required:</strong>

                @for (
                    inputRequired of item.inputRequired.split("\n\n");
                    track $index
                ) {
                    <div class="newrow left-aligned">
                        <app-description
                            class="newrow"
                            [text]="inputRequired"
                        />
                    </div>
                }
            </div>
        }
    </div>
}
