<button class="minimizebutton lower" (click)="minimize()">&#8691;</button>
<div id="inventory-height" class="attributeBox">
    <h3 class="box-header">Inventory</h3>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading()">
        <button class="fullsize-only list-item center-aligned"
            (click)="toggleMenu('items')">
            Get Items
        </button>
        <h5>Cash</h5>
        <div class="list-item">
            <strong>P</strong>
            <input class="number4" type="number" value="{{this.characterService.get_Character().cash[0]}}" disabled>
            <strong>G</strong>
            <input class="number4" type="number" value="{{this.characterService.get_Character().cash[1]}}" disabled>
            <strong>S</strong>
            <input class="number4" type="number" value="{{this.characterService.get_Character().cash[2]}}" disabled>
            <strong>C</strong>
            <input class="number4" type="number" value="{{this.characterService.get_Character().cash[3]}}" disabled>
        </div>
        <h5>Bulk</h5>
        <ng-container *ngFor="let bulk of get_Bulk()">
            <div class="list-item">
                <strong>Bulk</strong>
                <input class="number2" type="number" value="{{bulk.$current}}" disabled>
                <app-tags [objectName]="'Bulk'" [showTraits]=true [showFeats]=true [showItems]=true
                    [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            </div>
            <div class="fullsize-only list-item">
                <strong>Encumbrance</strong>
                <input class="number2" type="number"
                    [className]="(bulk.$penalty.length) ? 'penalty' : (bulk.$bonus.length) ? 'bonus' : ''"
                    value="{{bulk.$encumbered.value}}" title="{{bulk.$encumbered.desc}}" disabled>
                <strong>Maximum</strong>
                <input class="number2" type="number"
                    [className]="(bulk.$penalty.length) ? 'penalty' : (bulk.$bonus.length) ? 'bonus' : ''"
                    value="{{bulk.$max.value}}" title="{{bulk.$max.desc}}" disabled>
                <app-tags [objectName]="'Max Bulk'" [showTraits]=true [showFeats]=true [showItems]=true
                    [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            </div>
        </ng-container>
        <h3 class="fullsize-only box-header">Items</h3>
        <div class="fullsize-only list-item" *ngFor="let maxInvested of [get_maxInvested()]">
            <strong>Invested</strong><input type="number" class="number2"
                [className]="(get_InvestedItems().length > maxInvested.value) ? 'problem' : ''"
                [ngModel]="get_InvestedItems().length" disabled>
            <strong>Max Invested</strong><input type="number" class="number2" title="{{maxInvested.explain}}"
                [className]="(maxInvested.penalty) ? 'penalty' : (maxInvested.bonus) ? 'bonus' : ''"
                [ngModel]="get_maxInvested().value" disabled>
            <app-tags [specialEffects]=maxInvested.effects></app-tags>
        </div>
        <ng-container *ngFor="let items of [get_InventoryItems(true)]">
            <ng-container *ngFor="let itemSet of items.names">
                <ng-container *ngFor="let listID of [get_ID()*1000]">
                    <h5 class="fullsize-only" *ngIf="items[itemSet.key].length">{{itemSet.name}}</h5>
                    <ng-container *ngFor="let item of sort_ItemSet(items[itemSet.key])">
                        <div class="fullsize-only list-item" *ngFor="let inventoryID of [item.id]">
                            <button class="row sublist-toggle"
                               
                                [className]="((item.equippable && item.equipped) || (item.can_Invest() && item.invested)) ? 'fancy-button' : ''"
                                (click)="toggleItem(inventoryID)">
                                {{(item.amount != undefined && item.amount != 1) ? item.amount+" " : ""}}
                                {{(item['get_Name']) ? item.get_Name() : item.name}}
                            </button>
                            <div class="list-item sublist lower"
                               
                                [className]="((item.equippable && item.equipped) || (item.can_Invest() && item.invested)) ? 'fancy-list' : ''"
                                *ngIf="get_ShowItem()==inventoryID">
                                <div class="row" *ngFor="let prof of [(item.get_Prof ? item.get_Prof() : item.prof)]">
                                    <span
                                        *ngIf="item.type == 'armors'">{{(prof == 'Unarmored') ? prof : prof.substr(0, prof.length - 6)}}
                                        {{item.group}}
                                        {{(item.type=="armors" && prof != "Unarmored") ? "Armor" : ""}}</span>
                                    <span
                                        *ngIf="item.type == 'weapons'">{{(prof == 'Unarmed') ? prof : prof.substr(0, prof.length - 8)}}
                                        {{item.group}}</span>
                                </div>
                                <button class="row" [disabled]="!item.amount"
                                    (click)="on_ConsumableUse(item)" *ngIf="item.amount != undefined && item.actions">
                                    <span>Use</span> <span>{{(item.actions) ? get_Actions(item) : ""}}</span>
                                </button>
                                <div class="row">
                                    <span *ngIf="item.equippable">
                                        <button *ngIf="!item.equipped"
                                            (click)="onEquip(item, true)">Equip</button>
                                        <button *ngIf="item.equipped"
                                            (click)="onEquip(item, false)">Unequip</button>
                                    </span>
                                    <span *ngIf="item.can_Invest()">
                                        <button *ngIf="!item.invested"
                                            (click)="onInvest(item, true)"
                                            [disabled]="get_InvestedItems().length >= get_maxInvested()[0] && !item.invested">Invest</button>
                                        <button *ngIf="item.invested"
                                            (click)="onInvest(item, false)">Uninvest</button>
                                    </span>
                                    <span
                                        *ngIf="item.can_Stack()">
                                        <button
                                            (click)="onAmountChange(item, -1)" [disabled]="item.amount <= 0">-1</button>
                                        <button
                                            (click)="onAmountChange(item, 1)">+1</button>
                                    </span>
                                    <span
                                        *ngIf="!item.equippable && !item.can_Invest() && !item.can_Stack()">
                                        &nbsp;
                                        <!-- This span is a placeholder that appears if no other button is valid on the left side of the Drop button -->
                                    </span>
                                    <span *ngIf="item.gainItems && item.gainItems.length">
                                        <button (click)="drop_Package(item)"
                                            title="Drop this item, but keep all items granted by it">
                                            Drop Package
                                        </button>
                                    </span>
                                    <span>
                                        <button (click)="drop_InventoryItem(item)">
                                            Drop
                                        </button>
                                    </span>
                                </div>
                                <div class="row" *ngIf="get_Price(item)">
                                    <span
                                        *ngIf="item.can_Stack()">
                                        <button
                                            (click)="onAmountChange(item, -1, true)" title="Sell at half price" [disabled]="item.amount <= 0">Sell 1</button>
                                        <button
                                            (click)="onAmountChange(item, 1, true)" [disabled]="!have_Funds(get_Price(item))">Buy 1</button>
                                    </span>
                                    <span
                                        *ngIf="!item.can_Stack()">
                                        &nbsp;
                                        <!-- This span is a placeholder that appears if no other button is valid on the left side of the Sell button -->
                                    </span>
                                    <span>
                                        <button (click)="drop_InventoryItem(item, true)" title="Sell at half price">
                                            Sell
                                        </button>
                                    </span>
                                </div>
                                <div class="row left-aligned">
                                    <span><input type="checkbox" [(ngModel)]="item.showNotes">Notes</span>
                                    <span *ngIf="item['get_Name']"><input type="checkbox"
                                            [(ngModel)]="item.showName">Name</span>
                                    <span *ngIf="item.moddable && item.moddable != '-' && item.type != 'shield'"><input
                                            type="checkbox" [(ngModel)]="item.showRunes">Runes</span>
                                    <span *ngIf="item.moddable && item.moddable != '-'"><input type="checkbox"
                                            [(ngModel)]="item.showMaterial">Material</span>
                                </div>
<!--Changing Notes-->
                                <div class="row" *ngIf="item.showNotes">
                                    Notes <input type="textarea" class="fullwidth" [(ngModel)]="item.notes">
                                </div>
<!--Changing Name-->                                
                                <div class="row" *ngIf="item.showName">
                                    Name <input type="textarea" class="fullwidth" [(ngModel)]="item.displayName"
                                        (blur)="onNameChange()">
                                </div>
                                <app-itemRunes class="row" [item]=item [itemStore]=false *ngIf="item.showRunes"></app-itemRunes>
                                <app-item [item]=item
                                    [allowActivate]="(item.equippable ? item.equipped : true) && (item.can_Invest() ? item.invested : true)"
                                    [armoredSkirt]="item.get_ArmoredSkirt ? item.get_ArmoredSkirt(characterService) : null">
                                </app-item>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-container>
<!--Other Items-->            
            <h5 class="fullsize-only">Miscellaneous Items</h5>
            <button class="fullsize-only" (click)="add_NewOtherItem()">Add</button>
            <div class="fullsize-only list-item" *ngFor="let item of items.otheritems">
                <strong>Name</strong>
                <input type="text" [(ngModel)]="item.name">
                <strong>Bulk</strong>
                <input class="number2" [(ngModel)]="item.bulk" (blur)="validate_Bulk(item)" (keypress)="bulkOnly($event)">
                <button (click)="remove_OtherItem(item)">Drop</button>
            </div>
        </ng-container>
    </ng-container>
</div>
<div *ngIf="set_Span()"></div>