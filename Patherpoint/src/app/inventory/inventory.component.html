<button class="minimizebutton lower" (click)="minimize()" *ngIf="creature=='Character'">&#8691;</button>
<div id="{{creature}}-inventory-height" class="attributeBox">
    <h3 class="box-header">Inventory</h3>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading()">
        <button class="fullsize-only list-item center-aligned"
            (click)="set_ItemsMenuTarget(creature); toggleMenu('items')">
            Get Items
        </button>
        <h5 *ngIf="creature=='Character'">Currency</h5>
        <div class="list-item" *ngIf="creature=='Character'">
            <strong>C</strong>
            <input class="number6" type="number" value="{{this.characterService.get_Character().cash[3]}}" disabled>
            <strong>S</strong>
            <input class="number6" type="number" value="{{this.characterService.get_Character().cash[2]}}" disabled>
            <strong>G</strong>
            <input class="number6" type="number" value="{{this.characterService.get_Character().cash[1]}}" disabled>
            <strong>P</strong>
            <input class="number6" type="number" value="{{this.characterService.get_Character().cash[0]}}" disabled>
            <button title="Exchange coins for higher currency, with priority on gold coins."
                (click)="sort_Cash();">Sort</button>
        </div>
        <h5>Bulk</h5>
        <ng-container *ngFor="let bulk of get_Bulk(); trackBy:trackByIndex;">
            <div class="list-item">
                <strong>Bulk</strong>
                <input class="number2"
                    [ngClass]="{'penalty':bulk.$currentpenalties, 'bonus':bulk.$currentbonuses, 'absolute':bulk.$currentabsolutes.length}"
                    type="number" title="{{bulk.$current.explain}}" value="{{bulk.$current.value}}" disabled>
                <app-tags [creature]="creature" [objectName]="'Bulk'" [showTraits]=true [showFeats]=true
                    [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            </div>
            <div class="fullsize-only list-item">
                <strong>Encumbrance Limit</strong>
                <input class="number2" type="number"
                    [ngClass]="{'penalty':bulk.$penalties, 'bonus':bulk.$bonuses, 'absolute':bulk.$absolutes.length}"
                    value="{{bulk.$encumbered.value}}" title="{{bulk.$encumbered.explain}}" disabled>
                <app-tags [creature]="creature" [objectName]="'Encumbered Limit'" [showTraits]=true [showFeats]=true
                    [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            </div>
            <div class="fullsize-only list-item">
                <strong>Maximum Bulk</strong>
                <input class="number2" type="number"
                    [ngClass]="{'penalty':bulk.$penalties, 'bonus':bulk.$bonuses, 'absolute':bulk.$absolutes.length}"
                    value="{{bulk.$max.value}}" title="{{bulk.$max.explain}}" disabled>
                <app-tags [creature]="creature" [objectName]="'Max Bulk'" [showTraits]=true [showFeats]=true
                    [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            </div>
        </ng-container>
        <ng-container *ngIf="have_QuickCrafting()">
            <h3 class="fullsize-only box-header">Quick Crafting</h3>
            <app-tags [creature]="creature" [objectName]="'Quick Crafting'" [showTraits]=true [showFeats]=true
                [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            <button class="list-item" *ngIf="have_Feat('Snare Specialist')" (click)="toggle_List('snarespecialist')">
                <h3>Snare Specialist</h3>
            </button>
            <ng-container *ngIf="get_ShowList()=='snarespecialist'">
                <div class="row" *ngIf="!get_PreparedItems('snarespecialist').length">You don't have any snares prepared
                    for quick deployment.</div>
                <ng-container *ngFor="let preparedItem of get_PreparedItems('snarespecialist'); trackBy:trackByIndex;">
                    <div class="list-item"
                        *ngFor="let inventoryID of ['snarespecialist'+preparedItem.item.id]; trackBy:trackByIndex;">
                        <button class="row sublist-toggle" (click)="toggle_Item(inventoryID)"
                            [ngClass]="{'inactive-button':!preparedItem.learned.snareSpecialistAvailable}">
                            <span>{{preparedItem.learned.snareSpecialistAvailable}}
                                {{(preparedItem.item.get_Name) ? preparedItem.item.get_Name() : preparedItem.item.name}}</span>
                            <span>{{(preparedItem.item.level) ? "Level "+preparedItem.item.level : "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}}</span>
                        </button>
                        <div class="list-item sublist lower" *ngIf="get_ShowItem()==inventoryID"
                            [ngClass]="{'inactive-list':!preparedItem.learned.snareSpecialistAvailable}">
                            <ng-container>
                                <button class="row center-aligned"
                                    (click)="craft_Item(preparedItem.item, preparedItem.learned, 'snarespecialist')"
                                    title="{{cannot_Craft(preparedItem.item, preparedItem.learned, 'snarespecialist').join('\n')}}"
                                    [disabled]="cannot_Craft(preparedItem.item, preparedItem.learned, 'snarespecialist').length">
                                    <span>Deploy Snare <app-actionIcons
                                            [actionString]="get_SnareSpecialistActions(preparedItem.item)">
                                        </app-actionIcons>
                                    </span>
                                </button>
                            </ng-container>
                            <app-item [item]=preparedItem.item [itemStore]=true></app-item>
                        </div>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
        <h3 class="fullsize-only box-header">Items</h3>
        <div class="fullsize-only list-item" *ngFor="let maxInvested of [get_MaxInvested()]; trackBy:trackByIndex;">
            <strong>Invested</strong><input type="number" class="number2"
                [ngClass]="{'problem':(get_Invested() > maxInvested.value)}" [ngModel]="get_Invested()" disabled>
            <strong>Max Invested</strong><input type="number" class="number2" title="{{maxInvested.explain}}"
                [ngClass]="{'penalty':maxInvested.penalties, 'bonus':maxInvested.bonuses, 'absolute':maxInvested.absolutes}"
                [ngModel]="get_MaxInvested().value" disabled>
            <app-tags [creature]="creature" [objectName]="'Max Invested'" [showTraits]=true [showFeats]=true
                [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
        </div>
        <div class="list-item" [ngClass]="{'fullsize-only':inventoryIndex != 0}"
            *ngFor="let inventory of get_Inventories(creature, true, true); let inventoryIndex = index; trackBy:trackByIndex;">
            <h3 class="fullsize-only row">{{get_InventoryName(inventory)}}
                <span
                    *ngIf="inventory.bulkLimit && inventory.bulkLimit % 1 == 0">&nbsp;{{"("+inventory.get_Bulk()+" / "+inventory.bulkLimit+" Bulk)"}}</span>
                <span
                    *ngIf="inventory.bulkLimit && inventory.bulkLimit % 1 != 0">&nbsp;{{"("+(inventory.get_Bulk(false)*10)+"L / "+(inventory.bulkLimit*10)+"L Bulk)"}}</span>
            </h3>
            <ng-container *ngFor="let itemSet of inventory.names; trackBy:trackByIndex;">
                <ng-container *ngFor="let listID of [get_ID()*1000]">
                    <h5 class="row" *ngIf="inventory[itemSet.key].length">{{itemSet.name}}</h5>
                    <ng-container *ngFor="let item of sort_ItemSet(inventory[itemSet.key]); trackBy:trackByIndex;">
                        <div class="list-item" *ngFor="let inventoryID of [item.id]; trackBy:trackByIndex;">
                            <button class="row sublist-toggle"
                                [ngClass]="{'fancy-button':((item.equippable && item.equipped) || (item.can_Invest() && item.invested))}"
                                (click)="toggle_Item(inventoryID)">
                                {{(item.amount != undefined && item.amount != 1) ? item.amount+" " : ""}}
                                {{(item['get_Name']) ? item.get_Name() : item.name}}&nbsp;
                                <span class="lower"
                                    *ngFor="let containedItems of [get_ContainedItems(item)]">{{containedItems ? "contains "+containedItems+" items" : ""}}</span>
                            </button>
                            <div class="list-item sublist lower"
                                [ngClass]="{'fancy-list':((item.equippable && item.equipped) || (item.can_Invest() && item.invested))}"
                                *ngIf="get_ShowItem()==inventoryID">
                                <div class="row"
                                    *ngFor="let prof of [(item.get_Prof ? item.get_Prof() : item.prof)]; trackBy:trackByIndex;">
                                    <span
                                        *ngIf="item.type == 'armors'">{{(["Light Barding","Heavy Barding"].includes(item.prof)) ? item.prof : item.prof.split(" ")[0]}}
                                        {{item.group}}
                                        {{(item.type=="armors" && (!["Unarmored Defense","Light Barding","Heavy Barding"].includes(item.prof))) ? "Armor" : ""}}</span>
                                    <span
                                        *ngIf="item.type == 'weapons'">{{(prof == 'Unarmed') ? prof : prof.substr(0, prof.length - 8)}}
                                        {{item.group}}</span>
                                </div>
                                <div class="row" *ngIf="item.expiration">
                                    <span><strong>Duration</strong> {{get_Duration(item.expiration)}}</span>
                                </div>
                                <button class="row left-aligned" [disabled]="!item.amount"
                                    (click)="on_ConsumableUse(item, creature, inventory)"
                                    *ngIf="item.amount != undefined && !['alchemicalelixirs','potions'].includes(item.type) && item.actions && (!item.targets || item.targets.length == 0)">
                                    <span>Use<app-actionIcons [actionString]="item.actions">
                                        </app-actionIcons>{{(item.activationType) ? item.activationType : ""}}
                                    </span>
                                </button>
                                <ng-container *ngIf="item.amount != undefined && item.storedSpells.length && !['weaponrunes', 'armorrunes', 'oils'].includes(this.item.type)">
                                    <ng-container *ngFor="let spell of get_ItemSpell(item); trackBy:trackByIndex;">
                                        <button class="row center-aligned"
                                            (click)="on_SpellItemUse(item, creature, inventory)"
                                            *ngIf="['self', 'ally'].includes(spell.target)">
                                            <span>Use<app-actionIcons [actionString]="spell.actions">
                                            </app-actionIcons>{{(spell.activationType) ? spell.activationType : ""}} {{spell.target == 'ally' ? "(Cast spell on yourself)" : "(Cast spell)"}}
                                            </span>
                                        </button>
                                        <button class="row center-aligned"
                                            (click)="on_SpellItemUse(item, (creature=='Character' ? 'Companion' : 'Character'), inventory)"
                                            *ngIf="['companion', 'ally'].includes(spell.target) && get_CompanionAvailable()">
                                            <span>Use<app-actionIcons [actionString]="spell.actions">
                                            </app-actionIcons>{{(spell.activationType) ? spell.activationType : ""}} (Cast spell on
                                            {{creature == "Character" ? "your animal companion" : "your master"}})
                                            </span>
                                        </button>
                                        <button class="row center-aligned"
                                            (click)="on_SpellItemUse(item, 'Familiar', inventory)"
                                            *ngIf="['companion', 'ally'].includes(spell.target) && get_FamiliarAvailable()">
                                            <span>Use<app-actionIcons [actionString]="spell.actions">
                                            </app-actionIcons>{{(spell.activationType) ? spell.activationType : ""}} (Cast spell on your familiar)
                                            </span>
                                        </button>
                                        <button class="row center-aligned" (click)="on_SpellItemUse(item, '', inventory)"
                                            *ngIf="spell.target == 'ally'">
                                            <span>Use<app-actionIcons [actionString]="spell.actions">
                                            </app-actionIcons>{{(spell.activationType) ? spell.activationType : ""}} (Cast spell on ally)
                                            </span>
                                        </button>
                                        <button class="row center-aligned" (click)="on_SpellItemUse(item, '', inventory)"
                                            *ngIf="spell.target == ''">
                                            <span>Use<app-actionIcons [actionString]="spell.actions">
                                            </app-actionIcons>{{(spell.activationType) ? spell.activationType : ""}} (Cast spell)
                                            </span>
                                        </button>
                                    </ng-container>
                                </ng-container>
                                <ng-container
                                    *ngIf="item.amount != undefined && ['alchemicalelixirs','potions'].includes(item.type) && item.actions && (!item.targets || item.targets.length == 0)">
                                    <button class="row left-aligned" [disabled]="!item.amount"
                                        (click)="on_ConsumableUse(item, creature, inventory)">
                                        <span>Use<app-actionIcons [actionString]="item.actions">
                                            </app-actionIcons>{{(item.activationType) ? item.activationType : ""}}
                                        </span>
                                    </button>
                                    <button class="row left-aligned" [disabled]="!item.amount"
                                        (click)="on_ConsumableUse(item, 'Companion', inventory)"
                                        *ngIf="get_CompanionAvailable()">
                                        <span>Use (Give to your animal companion)<app-actionIcons
                                                [actionString]="item.actions">
                                            </app-actionIcons>{{(item.activationType) ? item.activationType : ""}}
                                        </span>
                                    </button>
                                    <button class="row left-aligned" [disabled]="!item.amount"
                                        (click)="on_ConsumableUse(item, 'Familiar', inventory)"
                                        *ngIf="get_FamiliarAvailable()">
                                        <span>Use (Give to your familiar)<app-actionIcons [actionString]="item.actions">
                                            </app-actionIcons>{{(item.activationType) ? item.activationType : ""}}
                                        </span>
                                    </button>
                                </ng-container>
                                <div class="row">
                                    <span *ngIf="can_Equip(item, inventoryIndex)">
                                        <button *ngIf="!item.equipped"
                                            (click)="on_Equip(item, inventory, true)">Equip</button>
                                        <button *ngIf="item.equipped"
                                            (click)="on_Equip(item, inventory, false)">Unequip</button>
                                    </span>
                                    <span *ngIf="can_Invest(item, inventoryIndex)">
                                        <button *ngIf="!item.invested" (click)="on_Invest(item, inventory, true)"
                                            [disabled]="get_Invested() >= get_MaxInvested().value && !item.invested">Invest</button>
                                        <button *ngIf="item.invested"
                                            (click)="on_Invest(item, inventory, false)">Uninvest</button>
                                    </span>
                                    <span *ngIf="item.can_Stack()">
                                        <button (click)="onAmountChange(item, -1)"
                                            [disabled]="item.amount <= 0">-1</button>
                                        <button (click)="onAmountChange(item, 1)">+1</button>
                                    </span>
                                    <span
                                        *ngIf="!can_Equip(item, inventoryIndex) && !can_Invest(item, inventoryIndex) && !item.can_Stack()">
                                        &nbsp;
                                        <!-- This span is a placeholder that appears if no other button is valid on the left side of the Drop button -->
                                    </span>
                                    <span *ngIf="can_Drop(item) && can_DropAll(item)">
                                        <button (click)="drop_ContainerOnly(item, inventory)"
                                            title="Drop this item, but keep all items granted by it">
                                            Drop
                                        </button>
                                    </span>
                                    <span *ngIf="can_Drop(item) && !can_DropAll(item)">
                                        <button (click)="drop_InventoryItem(item, inventory)">
                                            Drop
                                        </button>
                                    </span>
                                    <span *ngIf="can_Drop(item) && can_DropAll(item)">
                                        <button (click)="drop_InventoryItem(item, inventory)"
                                            title="Drop this item and all items granted by it">
                                            Drop All
                                        </button>
                                    </span>
                                </div>
                                <div class="row" *ngIf="get_Price(item) && item.tradeable">
                                    <span *ngIf="item.can_Stack()">
                                        <button (click)="onAmountChange(item, -1, true)" title="Sell at half price"
                                            [disabled]="item.amount <= 0">Sell 1</button>
                                        <button (click)="onAmountChange(item, 1, true)"
                                            [disabled]="!have_Funds(get_Price(item))">Buy 1</button>
                                    </span>
                                    <span *ngIf="!item.can_Stack()">
                                        &nbsp;
                                        <!-- This span is a placeholder that appears if no other button is valid on the left side of the Sell button -->
                                    </span>
                                    <span>
                                        <button (click)="drop_InventoryItem(item, inventory, true)"
                                            title="Sell at half price" [disabled]="item.amount <= 0">
                                            Sell
                                        </button>
                                    </span>
                                </div>
                                <div class="list-item" *ngIf=can_Drop(item)>
                                    <strong>Move to container</strong>
                                    <span>
                                        <select [(ngModel)]="targetInventory"
                                            (ngModelChange)="move_InventoryItem(item, inventory)">
                                            <option [ngValue]="null"></option>
                                            <option
                                                *ngFor="let newTargetInventory of get_TargetInventories(item); trackBy:trackByIndex;"
                                                [ngValue]="newTargetInventory"
                                                [disabled]="!can_Fit(item, newTargetInventory, inventory)">
                                                {{get_InventoryName(newTargetInventory)}}
                                            </option>
                                        </select>
                                    </span>
                                </div>
                                <div class="list-item row left-aligned">
                                    <span><input id="{{item.id}}shownotes" type="checkbox"
                                            [(ngModel)]="item.showNotes"><label
                                            for="{{item.id}}shownotes">Notes</label></span>
                                    <span *ngIf="item['get_Name']"><input id="{{item.id}}showname" type="checkbox"
                                            [(ngModel)]="item.showName"><label
                                            for="{{item.id}}showname">Name</label></span>
                                    <span *ngIf="item.moddable && item.moddable != '-' && item.type != 'shield'"><input
                                            id="{{item.id}}showrunes" type="checkbox"
                                            [(ngModel)]="item.showRunes"><label
                                            for="{{item.id}}showrunes">Runes</label></span>
                                    <span *ngIf="item.moddable && item.moddable != '-'"><input
                                            id="{{item.id}}showmaterial" type="checkbox"
                                            [(ngModel)]="item.showMaterial"><label
                                            for="{{item.id}}showmaterial">Material</label></span>
                                </div>
                                <!--Changing Notes-->
                                <div class="row" *ngIf="item.showNotes">
                                    Notes <input type="textarea" class="fullwidth" [(ngModel)]="item.notes">
                                </div>
                                <!--Changing Name-->
                                <div class="row" *ngIf="item.showName">
                                    Name <input type="textarea" class="fullwidth" [(ngModel)]="item.displayName"
                                        (blur)="onNameChange(item)">
                                </div>
                                <app-itemRunes class="list-item" [item]=item [itemStore]=false *ngIf="item.showRunes">
                                </app-itemRunes>
                                <app-itemOils [item]=item [itemStore]=false *ngIf="item.type != 'oils'">
                                </app-itemOils>
                                <app-itemTalismans [item]=item [itemStore]=false *ngIf="can_ApplyTalismans(item)">
                                </app-itemTalismans>
                                <app-item class="lower" [creature]="creature" [item]=item
                                    [allowActivate]="(item.equippable ? item.equipped : true) && (item.can_Invest() ? item.invested : true)"
                                    [armoredSkirt]="item.get_ArmoredSkirt ? item.get_ArmoredSkirt(get_Creature(), characterService) : null">
                                </app-item>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-container>
            <!--Other Items-->
            <h5 class="fullsize-only">Miscellaneous Items</h5>
            <button class="fullsize-only row center-aligned" (click)="add_NewOtherItem(inventory)">Add</button>
            <div class="fullsize-only list-item" *ngFor="let item of inventory.otheritems; trackBy:trackByIndex;">
                <strong>Name</strong>
                <input type="text" [(ngModel)]="item.name">
                <strong>Bulk</strong>
                <input class="number2" [(ngModel)]="item.bulk" (blur)="validate_Bulk(item)"
                    (keypress)="bulkOnly($event)">
                <button (click)="remove_OtherItem(item, inventory)">Drop</button>
            </div>
        </div>
    </ng-container>
</div>
<div *ngIf="set_Span()"></div>