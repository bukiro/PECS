<button class="minimizebutton lower" (click)="minimize()" *ngIf="creature=='Character'">&#8691;</button>
<div id="{{creature}}-attacks-height" class="attributeBox">
    <h3 class="box-header">Attacks</h3>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading()">
        <app-tags [creature]="creature" [objectName]="'Attacks'" [showTraits]=true [showFeats]=true [showItems]=true
            [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
        <ng-container *ngFor="let weapon of get_EquippedWeapons(); let weaponIndex = index; trackBy:trackByIndex;">
            <div class="fullsize-only list-item" *ngIf="attackRestrictions.length && weaponIndex == 0">
                <label for="showRestricted">Show restricted attacks</label>
                <input id="showRestricted" type="checkbox" [(ngModel)]="showRestricted">
            </div>
            <div class="list-item"
                [ngClass]="{'problem fullsize-only':!get_IsAllowed(weapon), 'invisible':!get_IsAllowed(weapon) && !showRestricted}"
                *ngFor="let attack of get_Attacks(weapon)">
                <div class="row">
                    <span style="flex-basis:auto">
                        <strong *ngIf="!['alchemicalbombs', 'otherconsumablesbombs'].includes(weapon.type)">{{weapon.get_Name()}}{{(attack[0] == 'melee') ?
                            (weapon.ranged ? " melee" : "") : (weapon.melee ? " ranged" : "")}}
                        </strong>
                        <strong *ngFor="let handwraps of get_HandwrapsOfMightyBlows(weapon)">
                            ({{handwraps.get_Name()}})
                        </strong>
                        <button style="flex-basis:auto" [disabled]="!weapon.amount"
                            (click)="on_ConsumableUse(weapon, null)"
                            *ngIf="['alchemicalbombs', 'otherconsumablesbombs'].includes(weapon.type)">
                            <span>{{(weapon.amount != undefined && weapon.amount != 1) ?
                                weapon.amount+" " : ""}}{{weapon.get_Name()}}<app-actionIcons
                                    [actionString]="weapon.actions">
                                </app-actionIcons>{{weapon.activationType ? weapon.activationType : ""}}
                            </span>
                        </button>
                    </span>
                    <span style="flex-basis:auto">
                        Attack
                        <input
                            [ngClass]="{'penalty':attack[4].length, 'bonus':attack[5].length, 'absolute':attack[6].length}"
                            type="number" class="number2" title="{{attack[2]}}" [ngModel]="attack[1]" disabled>
                        <ng-container *ngFor="let damage of [get_Damage(weapon, attack[0])]; trackBy:trackByIndex;">
                            <span *ngIf="!damage[0].includes('0d0')">&nbsp;Damage&nbsp;</span>
                            <strong *ngFor="let line of damage[0].split('\n'); trackBy:trackByIndex;"
                                title="{{damage[1]}}">
                                <span
                                    [ngClass]="{'penalty':damage[3].length, 'bonus':damage[2].length, 'absolute':damage[4].length}"
                                    *ngIf="!line.includes('0d0')">{{line}}</span><br>
                            </strong>
                        </ng-container>
                    </span>
                </div>
                <ng-container
                    *ngFor="let traits of [weapon.get_Traits(characterService, get_Creature())]; trackBy:trackByIndex;">
                    <div class="fullsize-only row left-aligned tags" *ngIf="traits.length">
                        <cite class="trait" *ngFor="let trait of traits; trackBy:trackByIndex;"
                            title="{{get_Traits(trait)[0].description}}">{{trait}}</cite>
                    </div>
                </ng-container>
                <div class="fullsize-only row left-aligned"
                    *ngFor="let runes of [get_HintRunes(weapon, attack[0])]; trackBy:trackByIndex;"
                    style="margin-top:initial">
                    <cite class="rune" *ngFor="let rune of runes; trackBy:trackByIndex;"
                        title="{{rune.hint}}">{{rune.name}}</cite>
                </div>
                <app-tags [creature]="creature" [objectName]=weapon.name [showTraits]=true [showFeats]=true
                    [showItems]=true [showActivities]=true [showConditions]=true
                    [specialNames]="get_SpecialShowon(weapon, attack[0])" [specialEffects]=attack[3]></app-tags>
                <div class="fullsize-only lower row left-aligned"
                    *ngFor="let poison of weapon.poisonsApplied; let index = index; trackBy:trackByIndex;">
                    <button title="{{get_PoisonTitle(poison)}}" (click)="on_PoisonUse(weapon, poison)">
                        <span>Spend/Remove {{poison.name}}</span>
                    </button>
                </div>
                <div class="fullsize-only lower row left-aligned"
                    *ngFor="let talisman of weapon.talismans; let index = index; trackBy:trackByIndex;">
                    <button title="{{get_TalismanTitle(talisman)}}" (click)="on_TalismanUse(weapon, talisman, index)">
                        <span>Activate {{talisman.name}}<app-actionIcons [actionString]="talisman.actions">
                            </app-actionIcons>{{(talisman.activationType) ? talisman.activationType : ""}}
                        </span>
                    </button>
                </div>
                <div class="fullsize-only lower row left-aligned"
                    *ngFor="let spec of get_CritSpecialization(weapon, attack[0]); trackBy:trackByIndex;">
                    <strong>Critical specialization effect&nbsp;</strong>{{spec.desc}}
                </div>
                <div class="fullsize-only lower row left-aligned" *ngIf="weapon.criticalHint">
                    <strong>Critical hit effect&nbsp;</strong>{{weapon.criticalHint}}
                </div>
                <ng-container *ngFor="let rune of get_Runes(weapon, attack[0]); trackBy:trackByIndex;"
                    style="margin-top:initial">
                    <div class="fullsize-only lower row left-aligned" *ngIf="rune.criticalHint">
                        <span>
                            <strong>Critical hit effect&nbsp;</strong>{{rune.criticalHint}}
                            <span *ngIf="rune.name=='Grievous'">{{get_GrievousData(weapon, rune)}}</span>
                        </span>
                        <div class="row left-aligned" *ngIf="rune.critsuccess">
                            <strong>Critical Success</strong>&nbsp;{{rune.critsuccess}}
                        </div>
                        <div class="row left-aligned" *ngIf="rune.success">
                            <strong>Success</strong>&nbsp;{{rune.success}}
                        </div>
                        <div class="row left-aligned" *ngIf="rune.failure">
                            <strong>Failure</strong>&nbsp;{{rune.failure}}
                        </div>
                        <div class="row left-aligned" *ngIf="rune.critfailure">
                            <strong>Critical Failure</strong>&nbsp;{{rune.critfailure}}
                        </div>
                    </div>
                </ng-container>
            </div>
        </ng-container>
        <ng-container *ngFor="let ammoType of get_AmmoTypes(); let index = index; trackBy:trackByIndex;">
            <h3 class="box-header" *ngIf="index == 0">Ammunition</h3>
            <app-tags [creature]="creature" [objectName]="'Ammunition'" [showTraits]=true [showFeats]=true
                [showItems]=true [showActivities]=true [showConditions]=true></app-tags>
            <ng-container *ngFor="let ammo of get_Ammo(ammoType); let ammoIndex = index; trackBy:trackByIndex;">
                <h5 class="fullsize-only" *ngIf="ammoIndex == 0">{{ammoType}}</h5>
                <div class="list-item">
                    <strong>{{(ammo.item.amount != undefined && ammo.item.amount != 1) ? ammo.item.amount+" " : ""}}
                        {{ammo.item.get_Name()}}</strong>
                    <button [disabled]="!ammo.item.amount"
                        title="{{ammo.item.storedSpells.length ? 'Cast spell on your enemy. To choose another target (if applicable), use the item in the inventory instead.' : ''}}"
                        (click)="on_ConsumableUse(ammo.item, ammo.inventory)">
                        <span>Use<app-actionIcons [actionString]="ammo.item.actions">
                            </app-actionIcons>{{(ammo.item.activationType) ? ammo.item.activationType : ""}}</span>
                    </button>
                </div>
            </ng-container>
        </ng-container>
        <ng-container *ngIf="get_Snares().length">
            <h3 class="box-header">Deployed Snares</h3>
            <app-tags [creature]="creature" [objectName]="'Snares'" [showTraits]=true [showFeats]=true [showItems]=true
                [showActivities]=true [showConditions]=true></app-tags>
            <div class="list-item" *ngFor="let snare of get_Snares(); let snareIndex = index; trackBy:trackByIndex;">
                <button class="row sublist-toggle" (click)="toggle_Item(snare.item.id+snareIndex)">
                    {{snare.item.get_Name()}}
                </button>
                <div class="list-item sublist lower" *ngIf="get_ShowItem()==snare.item.id+snareIndex">
                    <button class="row center-aligned" [disabled]="!snare.item.amount"
                        (click)="on_ConsumableUse(snare.item, snare.inventory)">
                        <span>Trigger/Remove</span>
                    </button>
                    <app-item [item]=snare.item [itemStore]=true></app-item>
                </div>
            </div>
        </ng-container>
        <h3 class="fullsize-only box-header" *ngIf="!still_loading()">Weapon Proficiencies</h3>
        <app-tags [creature]="creature" [objectName]="'Weapon Proficiencies'" [showTraits]=true [showFeats]=true
            [showItems]=true [showActivities]=true [showConditions]=true></app-tags>
        <ng-container *ngFor="let skill of get_Skills('', 'Weapon Proficiency'); trackBy:trackByIndex;">
            <app-skill class="fullsize-only" [creature]="creature" [skill]=skill [showValue]=false></app-skill>
        </ng-container>
        <ng-container *ngFor="let skill of get_Skills('', 'Specific Weapon Proficiency'); trackBy:trackByIndex;">
            <app-skill class="fullsize-only" [creature]="creature" [skill]=skill [showValue]=false></app-skill>
        </ng-container>
    </ng-container>
</div>
<div *ngIf="set_Span()"></div>