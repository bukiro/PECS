<button class="minimizebutton lower" (click)="minimize()">&#8691;</button>
<div id="spells-height" class="itemBox">
    <button class="list-item" (click)="toggleSpellMenu()">Close</button>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading() && get_Character().class && get_SpellMenuState()=='in'">
        <div class="list-item">
            <span>
                <input id="allowHeightened" type="checkbox" [(ngModel)]="allowHeightened">
                <label for="allowHeightened">Allow heightened spells</label>
            </span>
        </div>
        <ng-container *ngFor="let casting of get_SpellCastings(); let index = index; trackBy:trackByIndex;">
            <h3>{{(casting.className + " " + casting.tradition + ((casting.castingType == "Focus") ? (" " + casting.source) : " Spells")).trim()}}
                <span class="lower"
                    *ngIf="['Prepared', 'Spontaneous'].includes(casting.castingType)">
                    <span class="lower">
                        {{casting.castingType}}
                    </span>
                </span>
            </h3>
            <div class="list-item" *ngIf="need_Spellbook(casting)">
                <span>
                    <input id="allowBorrow" type="checkbox" [(ngModel)]="allowBorrow">
                    <label for="allowBorrow" title="Allow selecting spells not in your spellbook">Borrow spells</label>
                </span>
            </div>
            <div class="list-item" *ngIf="apply_SpellSubstitution(casting)">
                <span>
                    <input id="allowSpellSubstitution" type="checkbox" [(ngModel)]="prepared">
                    <label for="allowSpellSubstitution" title="Selected spells are immediately prepared">Spell Substitution</label>
                </span>
            </div>
            <ng-container *ngFor="let level of [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; trackBy:trackByIndex;">
                <ng-container *ngIf="level <= get_MaxSpellLevel()">
                    <h5 *ngIf="level == -1 && casting.castingType == 'Focus'">Focus Spells</h5>
                    <h5 *ngIf="level == 0">Cantrips</h5>
                    <h5 *ngIf="level > 0 && casting.castingType != 'Focus'">{{"Level "+level}}</h5>
                    <!--Fixed information-->
                    <div class="fullsize-only list-item fancy-button" *ngIf="get_SpellsTaken(1, get_Character().level, level, '', casting, '', '', true).length" >
                        <button class="row sublist-toggle fancy-button"
                            (click)="toggle_Choice(index+'showFixedChanges'+level)">
                            Show fixed changes
                        </button>
                        <div class="list-item sublist fancy-list" *ngIf="get_ShowChoice()==index+'showFixedChanges'+level">
                            <!--Fixed Spells gained-->
                            <div class="list-item"
                                *ngFor="let spellTaken of get_SpellsTaken(1, get_Character().level, level, '', casting, '', '', true); trackBy:trackByIndex;">
                                {{spellTaken.gain.name}} {{spellTaken.gain.source ? "("+spellTaken.gain.source+")" : ""}}
                                <button class="right-bound" (click)="toggle_Spell(spellTaken.choice.id+spellTaken.gain.name+'desc')">
                                    Show Description
                                </button>
                                <div class="row left-aligned" *ngIf="this.get_ShowSpell()==spellTaken.choice.id+spellTaken.gain.name+'desc'">
                                    <app-spell [spell]="get_Spells(spellTaken.gain.name)[0]" [spellLevel]="level"></app-spell>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Spell choices-->
                    <ng-container *ngFor="let choice of get_SpellChoices(casting, level); trackBy:trackByIndex;">
                        <app-spellchoice (showChoiceMessage)="receive_ChoiceMessage($event)"
                            (showSpellMessage)="receive_SpellMessage($event)" [spellCasting]="casting" [choice]="choice"
                            [allowHeightened]="allowHeightened" [allowBorrow]="allowBorrow" [showChoice]="showChoice" [showSpell]="showSpell"
                            [level]="level" [prepared]="this.prepared" [spellbook]="true"></app-spellchoice>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>
    </ng-container>
</div>