<div id="items" class="itemBox">
    <button class="list-item" (click)="toggleItemsMenu()">Close</button>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <div class="list-item">
        <strong>Find (in Name or Description)</strong>
        <span>
            <input type=text [(ngModel)]="wordFilter" (ngModelChange)=check_Filter() />
            <button (click)="set_Filter()" [disabled]="wordFilter.length < 5"
                >Show All</button>
            <button (click)="wordFilter='';check_Filter()">Clear</button>
        </span>
    </div>
    <div class="list-item">
        <strong>Sort by</strong>
        <select [(ngModel)]="sorting">
            <option *ngFor="let sort of ['Name','Level']" [ngValue]="sort.toLowerCase()">
                {{sort}}
            </option>
        </select>
    </div>
    <div class="list-item" *ngIf="get_ItemsMenuTarget()">
        <strong>Give items to</strong>
        <select [(ngModel)]="creature" (ngModelChange)="set_ItemsMenuTarget()">
            <option *ngFor="let target of ['Character','Companion']" [ngValue]="target">
                {{target}}
            </option>
        </select>
    </div>
    <h5>Get Cash</h5>
        <div class="list-item">
            <div class="row">
                <strong>Platinum</strong>
                <input class="number4" type="number" [(ngModel)]="cashP" (keypress)="numbersOnly($event)">
                <strong>Gold</strong>
                <input class="number4" type="number" [(ngModel)]="cashG" (keypress)="numbersOnly($event)">
                <strong>Silver</strong>
                <input class="number4" type="number" [(ngModel)]="cashS" (keypress)="numbersOnly($event)">
                <strong>Copper</strong>
                <input class="number4" type="number" [(ngModel)]="cashC" (keypress)="numbersOnly($event)">
            </div>
            <div class="row">
                <span>
                    <button (click)="change_Cash(1, 0, true)" [disabled]="cashP < 0 || cashG < 0 || cashS < 0 || cashC < 0">Gain</button>
                </span>
                <span>
                    <button (click)="change_Cash(-1, 0, true)" [disabled]="cashP < 0 || cashG < 0 || cashS < 0 || cashC < 0" [disabled]="!have_Funds()">Spend</button>
                </span>
            </div>
        </div>
    <ng-container *ngFor="let items of [get_Items(true)]">
        <ng-container *ngFor="let creatureType of ['Character','Companion']">
            <h3>Get {{creatureType == "Companion" ? "Animal Companion " : ""}}Items</h3>
            <ng-container *ngFor="let itemSet of items.names; let index = index; trackBy:trackByIndex;">
                <ng-container *ngFor="let listID of [creatureType+(index*1000+1000)]">
                    <button class="list-item"
                        [ngStyle]="{'--accent':get_Accent(), 'display':!get_VisibleItems(items[itemSet.key], creatureType).length ? 'none' : 'flex' }"
                        (click)="toggle_List(listID)">
                        <strong>{{itemSet.name}}</strong>
                    </button>
                    <ng-container *ngIf="get_ShowList()==listID||get_ShowList()=='All'">
                        <ng-container *ngFor="let item of get_VisibleItems(items[itemSet.key], creatureType)|sortBy:'asc':sorting">
                            <div class="list-item" *ngFor="let inventoryID of [listID+get_ID()]">
                                <button class="row sublist-toggle"
                                    (click)="toggle_Item(inventoryID)">
                                    <span>{{(item.get_Name) ? item.get_Name() : item.name}}</span>
                                    <span
                                        *ngIf="item.type == 'armors'">{{(["Unarmored","Light Barding","Heavy Barding"].includes(item.prof)) ? item.prof : item.prof.substr(0, item.prof.length - 6)}}
                                        {{item.group}}
                                        {{(item.type=="armors" && (!["Unarmored","Light Barding","Heavy Barding"].includes(item.prof))) ? "Armor" : ""}}</span>
                                    <span
                                        *ngIf="item.type == 'weapons'">{{(item.prof == 'Unarmed') ? item.prof : item.prof.substr(0, item.prof.length - 8)}}
                                        {{item.group}}</span>
                                    <span>{{(item.level) ? "Level "+item.level : "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}}</span>
                                </button>
                                <div class="list-item sublist lower"
                                    *ngIf="get_ShowItem()==inventoryID">
                                    <button class="row center-aligned"
                                        (click)="grant_Item(creature, item)">
                                        Gift {{item.stack && item.stack > 1 ? item.stack+" " : ""}}to {{creature}}
                                    </button>
                                    <button class="row center-aligned"
                                        (click)="grant_Item(creature, item, true)"
                                        [disabled]="!have_Funds(get_Price(item)) || !get_Price(item)">
                                        Buy {{item.stack && item.stack > 1 ? item.stack+" " : ""}}for {{creature}}
                                    </button>
                                    <app-itemRunes class="row" [item]=item [itemStore]=true></app-itemRunes>
                                    <app-item [item]=item [itemStore]=true></app-item>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>
        <h3>Create custom item</h3>
        <button class="list-item" (click)="toggle_List('CreateNew')">Create custom
            item</button>
        <ng-container *ngIf="get_ShowList()=='CreateNew'">
            <ng-container *ngFor="let listID of [get_ID()*1000]">
                <div class="list-item">
                    <span><strong>Type</strong></span>
                    <span><select [(ngModel)]="newItemType" (ngModelChange)="initialize_NewItem()">
                            <option *ngFor="let name of get_NewItemFilter()" [ngValue]="name.key">
                                {{name.name}}
                            </option>
                        </select></span>
                </div>
                <ng-container *ngIf="newItem">
                    <div class="list-item" *ngFor="let inventoryID of [listID+get_ID()]">
                        <button class="row sublist-toggle center-aligned"
                            (click)="toggle_Item(inventoryID)">
                            Copy existing item
                        </button>
                        <div class="list-item sublist lower"
                            *ngIf="get_ShowItem()==inventoryID">
                            <h5>New Items</h5>
                            <div class="list-item" *ngFor="let item of get_Items()[newItemType]">
                                {{(item.get_Name) ? item.get_Name() : item.name}}
                                <button class="row center-aligned"
                                    (click)="copy_Item(item);toggle_Item(0)">
                                    Copy
                                </button>
                            </div>
                            <h5>Inventory Items</h5>
                            <ng-container *ngFor="let itemset of get_InventoryItemSets(newItemType)">
                                <div class="list-item" *ngFor="let item of itemset">
                                    {{(item.get_Name) ? item.get_Name() : item.name}}
                                    <button class="row center-aligned"
                                        (click)="copy_Item(item);toggle_Item(0)">
                                        Copy
                                    </button>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                    <ng-container *ngFor="let property of get_NewItemProperties()|sortBy:'asc':'priority'|sortBy:'asc':'group'">
                        <ng-container *ngIf="!(property.key == 'equippable' && !newItem['allowEquippable'])">
                            <app-newItemProperty [propertyData]=property [propertyKey]=property.key [newItem]=newItem></app-newItemProperty>
                        </ng-container>
                    </ng-container>
                    <div class="list-item row" *ngIf="newItem['moddable'] && newItem['moddable'] != '-'">
                        <strong>Runes</strong>
                        <app-itemRunes class="row" [item]=newItem [itemStore]=true></app-itemRunes>
                    </div>
                    <div class="list-item row">
                        <button class="row center-aligned"
                            (click)="grant_CustomItem(creature)">
                            Get this item
                        </button>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
    </ng-container>
</div>