<button class="minimizebutton lower" (click)="minimize()" *ngIf="creature=='Character'">&#8691;</button>
<div id="{{creature}}-health-height" class="attributeBox">
    <ng-container *ngFor="let health of [calculate_Health()]; trackBy:trackByIndex;">
        <h3 class="box-header">Health:
            <span
                [ngClass]="{'penalty':(health.$currentHP.result <= 0), 'bonus':(health.$currentHP.result > health.$maxHP.result)}"
                title="{{health.$currentHP.explain}}">{{health.$currentHP.result}}</span>
            Hit Points
        </h3>
        <app-tags [creature]="creature" [objectName]="'Health'" [showTraits]=true [showFeats]=true [showItems]=true
            [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
        <div class="loading" *ngIf="still_loading()">Loading</div>
        <ng-container *ngIf="!still_loading()">
            <button class="list-item center-aligned" (click)="rest()" title="{{get_Waiting(48000)}}"
                [disabled]="get_Waiting(48000).length" *ngIf="creature=='Character'">Rest</button>
            <app-tags [creature]="creature" [objectName]="'Rest'" [showTraits]=true [showFeats]=true [showItems]=true
                [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            <div class="fullsize-only list-item">
                <div class="row">
                    <strong>Max HP</strong>
                    <span>
                        <input class="number3" type="number"
                            [ngClass]="{'penalty':show_PenaltiesOnThis('Max HP'), 'bonus':show_BonusesOnThis('Max HP'), 'absolute':get_AbsolutesOnThis('Max HP').length}"
                            title="{{health.$maxHP.explain}}" value="{{health.$maxHP.result}}" disabled>
                    </span>
                    <strong>Temp HP</strong>
                    <span>
                        <select [(ngModel)]="selectedTempHP" (change)="on_TempHPSelected(selectedTempHP)"
                            *ngIf="health.temporaryHP.length > 1">
                            <option *ngFor="let tempHPSet of health.temporaryHP; trackBy:trackByIndex;"
                                [ngValue]="tempHPSet">
                                {{tempHPSet.amount + (tempHPSet.source ? " (" + tempHPSet.source + ")" : "")}}
                            </option>
                        </select>
                        <input class="number3" type="number" [ngClass]="{'bonus':(health.temporaryHP[0].amount > 0)}"
                            title="{{health.temporaryHP[0].source ? 'Source: ' + health.temporaryHP[0].source : ''}}"
                            value="{{health.temporaryHP[0].amount}}" disabled *ngIf="health.temporaryHP.length == 1">
                    </span>
                </div>
                <div class="row">
                    <app-tags [creature]="creature" [objectName]="'Max HP'" [showTraits]=true [showFeats]=true
                        [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
                </div>
            </div>
            <div class="list-item" [ngClass]="{'fullsize-only':(health.$dying <= 0)}">
                <div class="row">
                    <strong>Dying</strong>
                    <span>
                        <input class="number1" type="number" [ngClass]="{'penalty':(health.$dying > 0)}"
                            value="{{health.$dying}}" disabled>
                    </span>
                    <strong>Max Dying</strong>
                    <span>
                        <input class="number1" type="number"
                            [ngClass]="{'penalty':show_PenaltiesOnThis('Max Dying'), 'bonus':show_BonusesOnThis('Max Dying'), 'absolute':get_AbsolutesOnThis('Max Dying').length}"
                            value="{{health.$maxDying}}" disabled>
                    </span>
                </div>
                <div class="row" *ngIf="health.$dying > 0">
                    <span>
                        <button (click)="on_DyingSave(true)">Save
                        </button>
                    </span>
                    <span>
                        <button (click)="on_DyingSave(false)">Fail Save
                        </button>
                    </span>
                </div>
                <div class="row" *ngIf="health.$dying > 0 && creature == 'Character'">
                    <button (click)="on_HeroPointRecover()" [disabled]="!get_Character().heroPoints">Use all hero points
                        to recover
                    </button>
                </div>
                <div class="row">
                    <app-tags [creature]="creature" [objectName]="'Max Dying'" [showTraits]=true [showFeats]=true
                        [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
                </div>
            </div>
            <div class="list-item" [ngClass]="{'fullsize-only':(health.$wounded <= 0)}">
                <strong>Wounded</strong><input class="number2" type="number"
                    [ngClass]="{'penalty':(health.$wounded > 0)}" value="{{health.$wounded}}" disabled>
                <button *ngIf="health.$wounded > 0" (click)="on_HealWounded()">Heal</button>
            </div>
            <div class="list-item row">
                <span>
                    <strong>Take Damage</strong>
                </span>
                <span>
                    <input id="nonlethal" type="checkbox" [(ngModel)]="nonlethal"><label
                        for="nonlethal">nonlethal</label>
                </span>
                <span>
                    <input class="number4" type="number" [(ngModel)]="damage" maxLength="3">
                </span>
                <span>
                    <button [disabled]="damage <= 0" (click)="on_TakeDamage(health)">Ouch!</button>
                </span>
            </div>
            <div class="list-item row">
                <span>
                    <strong>Heal Damage</strong>
                </span>
                <span>&nbsp;</span>
                <span>
                    <input class="number4" type="number" [(ngModel)]="healing" maxLength="3">
                </span>
                <span>
                    <button [disabled]="healing <= 0" (click)="on_Heal(health)">Heal</button>
                </span>
            </div>
            <div class="list-item row" *ngIf="get_NumbToDeath()" [ngClass]="{'fullsize-only':(health.$dying <= 0)}">
                <span>
                    <strong>Numb to Death</strong>
                </span>
                <span>
                    <button [disabled]="health.$dying <= 0" (click)="on_NumbToDeath(health)">Heal
                        and recover</button>
                </span>
            </div>
            <div class="fullsize-only list-item row">
                <span>
                    <strong>Temp HP</strong>
                </span>
                <span>&nbsp;</span>
                <span>
                    <input class="number4" type="number" [(ngModel)]="setTempHP" maxLength="3">
                </span>
                <span>
                    <button [disabled]="setTempHP < 0" (click)="set_TempHP(setTempHP)">Set</button>
                </span>
            </div>
            <h5>Resistances</h5>
            <ng-container *ngFor="let resistances of [get_Resistances()]; trackBy:trackByIndex;">
                <div class="list-item" *ngIf="resistances.length">
                    <div class="row" *ngFor="let resistance of resistances; trackBy:trackByIndex;">
                        <span title="{{resistance.source}}"
                            [className]="(resistance.value < 0) ? 'penalty' : 'bonus'">{{resistance.target}}:
                            {{Math.abs(resistance.value)}}{{(resistance.exception) ? " /"+resistance.exception : ""}}</span>
                    </div>
                </div>
                <app-tags [creature]="creature" [objectName]="'Resistances'" [showTraits]=true [showFeats]=true
                    [showItems]=true [showActivities]=true [showConditions]=true [showEffects]=true></app-tags>
            </ng-container>
        </ng-container>
    </ng-container>
</div>
<div *ngIf="set_Span()"></div>