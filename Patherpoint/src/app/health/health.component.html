<div *ngFor="let health of [calculate_Health()]">
    <h3>Health: <span [className]="(health.$currentHP <= 0) ? 'penalty' : (health.$currentHP > health.$maxHP) ? 'bonus' : ''">{{health.$currentHP}}</span> Hit Points</h3>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <div *ngIf="!still_loading()">
        <div class="list-item">
            <strong>Max HP</strong>
            <input class="number" type="number"
                [className]="(get_PenaltiesOnThis('Health').length) ? 'penalty' : (get_BonusesOnThis('Health').length) ? 'bonus' : ''"
                value="{{health.$maxHP}}" disabled>
            Temp HP: <input class="number" type="number"
                [className]="(health.temporaryHP < 0) ? 'penalty' : (health.temporaryHP > 0) ? 'bonus' : ''"
                value="{{health.temporaryHP}}" disabled>
            <div class="row left-aligned">
                <cite *ngFor="let effect of get_EffectsOnThis('Max HP')" [className]="effect.penalty ? 'penalty' : 'bonus'">{{effect.value}} ({{effect.source}})&nbsp;</cite>
                <cite *ngFor="let feat of get_FeatsShowingOn('Health')" [title]="(feat.hint) ? feat.hint : feat.desc">{{feat.name}}&nbsp;</cite>
                <cite *ngFor="let condition of get_ConditionsShowingOn('Health')" [className]="(condition.buff) ? 'bonus' : 'penalty'" [title]="condition.desc">{{condition.name}}&nbsp;</cite>
            </div>
        </div> 
        <div class="list-item">
            <strong>Dying</strong><input class="number" type="number"
                [className]="(health.$dying > 0) ? 'penalty' : ''"
                value="{{health.$dying}}" disabled>
            <strong>Max Dying</strong><input class="number" type="number"
                [className]="(get_PenaltiesOnThis('Max Dying').length) ? 'penalty' : (get_BonusesOnThis('Health').length) ? 'bonus' : ''"
                value="{{health.$maxDying}}" disabled>
            <div class="row">
                <button *ngIf="health.$dying > 0" (click)="on_DyingSave(true)">Save</button>
                <button *ngIf="health.$dying > 0" (click)="on_DyingSave(false)">Fail Save</button>
            </div>
            <div class="row left-aligned">
                <cite *ngFor="let effect of get_EffectsOnThis('Max Dying')" [className]="effect.penalty ? 'penalty' : 'bonus'">{{effect.value}} ({{effect.source}})&nbsp;</cite>
                <cite *ngFor="let feat of get_FeatsShowingOn('Dying')" [title]="(feat.hint) ? feat.hint : feat.desc">{{feat.name}}&nbsp;</cite>
                <cite *ngFor="let condition of get_ConditionsShowingOn('Dying')" [className]="(condition.buff) ? 'bonus' : 'penalty'" [title]="condition.desc">{{condition.name}}&nbsp;</cite>
            </div>
        </div>
        <div class="list-item">
            <strong>Wounded</strong><input class="number" type="number"
            [className]="(health.$wounded > 0) ? 'penalty' : ''"
            value="{{health.$wounded}}" disabled>
            <button *ngIf="health.$wounded > 0" (click)="on_HealWounded()">Heal</button>
        </div>
        <div class="list-item">
            <span>
                <strong>Take Damage</strong>
                <br>
                <span style="position:absolute"><input type="checkbox" [(ngModel)]="this.nonlethal">nonlethal</span>
            </span>
            <input class="number" type="number"
            [(ngModel)]="this.damage">
            <button [disabled]="this.damage <= 0" (click)="health.takeDamage(this.characterService, this.effectsService, this.damage, this.nonlethal)">Ouch!</button>
        </div>
        <div class="list-item">
            <strong>Heal Damage</strong><input class="number" type="number"
            [(ngModel)]="this.healing">
            <button [disabled]="this.healing <= 0" (click)="health.heal(this.characterService, this.effectsService, this.healing)">Heal</button>
        </div>
        <div class="list-item">
            <strong>Add Temp HP</strong><input class="number" type="number"
            [(ngModel)]="this.addTempHP">
            <button [disabled]="this.addTempHP == 0" (click)="add_TempHP(this.addTempHP)">Add</button>
        </div>
        <h3>Resistances</h3>
        <div class="list-item" *ngIf="get_Resistances().length">
            <div class="row" *ngFor="let resistance of get_Resistances()">
                <span title="{{resistance.source}}" [className]="(resistance.value < 0) ? 'penalty' : 'bonus'">{{resistance.target}}: {{Math.abs(resistance.value)}}{{(resistance.exception) ? " /"+resistance.exception : ""}}</span>
            </div>
            <div class="row left-aligned">
                <cite *ngFor="let effect of get_EffectsOnThis('Resistances')" [className]="effect.penalty ? 'penalty' : 'bonus'">{{effect.value}} ({{effect.source}})&nbsp;</cite>
                <cite *ngFor="let feat of get_FeatsShowingOn('Resistances')" [title]="(feat.hint) ? feat.hint : feat.desc">{{feat.name}}&nbsp;</cite>
                <cite *ngFor="let condition of get_ConditionsShowingOn('Resistances')" [className]="(condition.buff) ? 'bonus' : 'penalty'" [title]="condition.desc">{{condition.name}}&nbsp;</cite>
            </div>
        </div> 
    </div>
</div>