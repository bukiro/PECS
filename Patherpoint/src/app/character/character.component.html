<button class="minimizebutton lower" (click)="minimize()">&#8691;</button>
<div id="character-height" class="itemBox">
    <button class="list-item" (click)="toggleCharacterMenu()">
        Close
    </button>
    <button class="list-item" (click)="on_NewCharacter()">
        Create New Character
    </button>
    <div class="list-item">
        <button class="row sublist-toggle" (click)="toggle_List('load')">
            Load Character
        </button>
        <div class="list-item sublist" *ngIf="get_showList()=='load'">
            <div class="list-item" *ngIf="get_Savegames() && !get_Savegames().length">
                No characters available in database.
            </div>
            <div class="list-item" *ngIf="!get_Savegames()">
                Database connection failed.
            </div>
            <div class="list-item" *ngFor="let savegame of get_Savegames(); let index = index; trackBy:trackByIndex;">
                <span>
                    <strong>{{savegame.name}}</strong> Level {{savegame.level}}
                    {{savegame.heritage ? savegame.heritage : savegame.ancestry}} {{savegame.class}}
                </span>
                <span>
                    <button (click)="load_CharacterFromDB(savegame)">Load</button>
                    <button (click)="delete_CharacterFromDB(savegame, index)" [disabled]="!allowCharacterDelete[index]">Delete</button>
                    <input id="allowCharacterDelete{{index}}" type="checkbox" [(ngModel)]="allowCharacterDelete[index]">
                    <label for="allowCharacterDelete{{index}}">Allow deletion</label>
                </span>
            </div>
        </div>
    </div>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading() && get_CharacterMenuState() == 'in'">
        <div class="list-item">
            <span>Color Accent</span>
            <span>
                <input type="color" name="coloraccent" style="padding:0 2px" [(ngModel)]="get_Character().settings.accent"
                    maxLength="7">
            </span>
        </div>
        <div class="list-item">
            <label for="darkmode">Dark mode</label>
            <input id="darkmode" type="checkbox" [(ngModel)]="get_Character().settings.darkmode" (ngModelChange)="set_Changed('character-sheet')">
        </div>
        <div class="list-item">
            <span>Name</span>
            <span>
                <input type="text" name="name" [(ngModel)]="get_Character().name" (blur)="on_NameChange()"
                    maxLength="100">
            </span>
        </div>
        <div class="list-item">
            <span>Experience Points</span>
            <span>
                <input type="number" class="number4" name="experiencePoints" [(ngModel)]="get_Character().experiencePoints" (keypress)="numbersOnly($event)"
                    maxLength="4" title="{{get_Character().experiencePoints >= 1000 && 'You are ready to level up!'}}" [ngClass]="{'bonus':get_Character().experiencePoints >= 1000}">
            </span>
        </div>
        <div class="list-item">
            <span>
                Alignment
            </span>
            <span>
                <select [(ngModel)]="get_Character().alignment" (ngModelChange)="on_AlignmentChange()">
                    <option *ngFor="let alignment of get_Alignments(); trackBy:trackByIndex;" [ngValue]="alignment">
                        {{alignment}}
                    </option>
                </select>
            </span>
        </div>
        <div class="list-item" *ngFor="let oldLevel of [get_Character().level]; trackBy:trackByIndex;">
            <span>
                Level
            </span>
            <span>
                <select [(ngModel)]="get_Character().level" (ngModelChange)="on_LevelChange(oldLevel)">
                    <option *ngFor="let level of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; trackBy:trackByIndex;"
                        [ngValue]="level">
                        {{level}}
                    </option>
                </select>
            </span>
        </div>
        <!--BaseValues-->
        <div class="list-item">
            <button class="row sublist-toggle fancy-button" (click)="toggle_List('alternateBaseValues')">
                Alternate Ability Values: {{(get_Character().baseValues.length) ? "Used" : "Not used"}}
            </button>
            <div class="list-item sublist fancy-list" *ngIf="get_showList()=='alternateBaseValues'">
                <div class="list-item">
                    <span>
                        <input id="useAlternateBaseValues" type="checkbox" (change)="on_BaseValueChange()"
                            [checked]="get_Character().baseValues.length">
                        <label for="useAlternateBaseValues">
                            <strong>Enter your own Ability values</strong>
                        </label>
                    </span>
                </div>
                <div class="list-item" *ngFor="let ability of get_Character().baseValues; trackBy:trackByIndex;">
                    {{ability.name}}
                    <input type="number" class="number2" [(ngModel)]="ability.baseValue"
                        (blur)="on_AbilityChange(ability.name)" maxlength="2" (keypress)="numbersOnly($event)">
                </div>
            </div>
        </div>
        <h3>History</h3>
        <!--Class-->
        <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.name}"
            *ngFor="let listID of ['class']; trackBy:trackByIndex;">
            <button class="row sublist-toggle" [ngClass]="{'fancy-button':get_Character().class.name}"
                (click)="toggle_List(listID)">
                Class{{(get_Character().class.name) ? ": "+ get_Character().class.name : ""}}
            </button>
            <div class="list-item sublist" [ngClass]="{'fancy-list':get_Character().class.name}"
                *ngIf="get_showList()==listID">
                <ng-container *ngFor="let class of get_AvailableClasses()|sortBy:'asc':'name'; trackBy:trackByIndex;">
                    <div class="row list-item" *ngFor="let itemID of ['class'+class.name]; trackBy:trackByIndex;">
                        <span>
                            <input id="{{class.name}}" type="checkbox"
                                (change)="onClassChange(class, $event.target.checked)"
                                [checked]="class.name === get_Character().class.name">
                            <label for="{{class.name}}">
                                <strong>{{class.name}}</strong>
                            </label>
                        </span>
                        <button (click)="toggle_Item(itemID)">
                            Show Description
                        </button>
                        <div class="row lower" *ngIf="this.get_showItem()==itemID">
                            <div class="row left-aligned tags">
                                <cite class="trait" *ngFor="let trait of class.traits; trackBy:trackByIndex;"
                                    title="{{get_Traits(trait)[0]?.description}}">{{trait}}</cite>
                            </div>
                            <div class="row left-aligned" *ngIf="class.sourceBook">
                                <strong>Source&nbsp;</strong><i>{{class.sourceBook}}</i>
                            </div>
                            <div class="row left-aligned" *ngFor="let desc of class.desc; trackBy:trackByIndex;">
                                <ng-container *ngFor="let text of desc.value.split('\n\n'); let textIndex = index; trackBy:trackByIndex;">
                                    <h6 *ngIf="textIndex == 0">{{desc.name}}</h6>
                                    <p *ngIf="text.split('\n').length == 1">
                                         {{text}}
                                    </p>
                                    <ul *ngIf="text.split('\n').length > 1">
                                        <li *ngFor="let line of text.split('\n'); trackBy:trackByIndex;">{{line}}</li>
                                    </ul>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
        <!--Ancestry-->
        <ng-container *ngIf="get_Character().class.name">
            <div class="list-item list-header" [ngClass]="{'fullsize-only':(get_Character().class.ancestry.name)}"
                *ngFor="let listID of ['ancestry']; trackBy:trackByIndex;">
                <button class="row sublist-toggle" [ngClass]="{'fancy-button':((get_Character().class.ancestry.name))}"
                    (click)="toggle_List(listID)">
                    Ancestry{{(get_Character().class.ancestry.name) ? ": "+ get_Character().class.ancestry.name : ""}}
                </button>
                <div class="list-item sublist" [ngClass]="{'fancy-list':((get_Character().class.ancestry.name))}"
                    *ngIf="get_showList()==listID">
                    <ng-container *ngFor="let ancestry of get_AvailableAncestries()|sortBy:'asc':'name'; trackBy:trackByIndex;">
                        <div class="row list-item" *ngFor="let itemID of ['ancestry'+ancestry.name]; trackBy:trackByIndex;">
                            <span>
                                <input id="{{ancestry.name}}" type="checkbox"
                                    (change)="onAncestryChange(ancestry, $event.target.checked)"
                                    [checked]="ancestry.name === get_Character().class.ancestry.name">
                                <label for="{{ancestry.name}}">
                                    <strong>{{ancestry.name}}&nbsp;</strong>
                                <cite class="trait" *ngIf="ancestry.traits.includes('Rare')"
                                    title="{{get_Traits('Rare')[0]?.description}}">Rare</cite>
                                <cite class="trait" *ngIf="ancestry.traits.includes('Uncommon')"
                                    title="{{get_Traits('Uncommon')[0]?.description}}">Uncommon</cite>
                                </label>
                            </span>
                            <button (click)="toggle_Item(itemID)">
                                Show Description
                            </button>
                            <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                <div class="row left-aligned tags">
                                    <cite class="trait" *ngFor="let trait of ancestry.traits; trackBy:trackByIndex;"
                                        title="{{get_Traits(trait)[0]?.description}}">{{trait}}</cite>
                                </div>
                                <div class="row left-aligned" *ngIf="ancestry.sourceBook">
                                    <strong>Source&nbsp;</strong><i>{{ancestry.sourceBook}}</i>
                                </div>
                                <div class="row left-aligned" *ngFor="let desc of ancestry.desc; trackBy:trackByIndex;">
                                    <ng-container *ngFor="let text of desc.value.split('\n\n'); let textIndex = index; trackBy:trackByIndex;">
                                        <h6 *ngIf="textIndex == 0">{{desc.name}}</h6>
                                        <p *ngIf="text.split('\n').length == 1">
                                             {{text}}
                                        </p>
                                        <ul *ngIf="text.split('\n').length > 1">
                                            <li *ngFor="let line of text.split('\n'); trackBy:trackByIndex;">{{line}}</li>
                                        </ul>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </ng-container>
        <!--Heritage-->
        <ng-container *ngIf="get_Character().class.ancestry.name">
            <div class="list-item" [ngClass]="{'fullsize-only':(get_Character().class.heritage.name)}"
                *ngFor="let listID of ['heritage']; trackBy:trackByIndex;">
                <button class="row sublist-toggle" [ngClass]="{'fancy-button':((get_Character().class.heritage.name))}"
                    (click)="toggle_List(listID)">
                    Heritage{{(get_Character().class.heritage.name) ? ": "+ get_Character().class.heritage.name : ""}}
                </button>
                <div class="list-item sublist" [ngClass]="{'fancy-list':((get_Character().class.heritage.name))}"
                    *ngIf="get_showList()==listID">
                    <div class="list-item"
                        *ngFor="let heritage of get_AvailableHeritages('', get_Character().class.ancestry.name)|sortBy:'asc':'name'; trackBy:trackByIndex;">
                        <span>
                            <input *ngIf="!heritage.subTypes.length" id="{{heritage.name}}" type="checkbox"
                                (change)="onHeritageChange(heritage, $event.target.checked)"
                                [checked]="heritage.name === get_Character().class.heritage.name">
                            <button class="lower left" *ngIf="heritage.subTypes.length" id="{{heritage.name}}"
                                (click)="toggle_Item(heritage.name+'desc')">v</button>
                            <label for="{{heritage.name}}">
                                <strong>{{heritage.name}}&nbsp;</strong>
                                <cite class="trait" *ngIf="heritage.traits.includes('Rare')"
                                    title="{{get_Traits('Rare')[0]?.description}}">Rare</cite>
                                <cite class="trait" *ngIf="heritage.traits.includes('Uncommon')"
                                    title="{{get_Traits('Uncommon')[0]?.description}}">Uncommon</cite>
                            </label>
                        </span>
                        <button (click)="toggle_Item(heritage.name+'desc')">
                            Show Description
                        </button>
                        <div class="row lower" *ngIf="this.get_showItem()==heritage.name+'desc'">
                            <!--Subheritages-->
                            <div class="list-item" *ngFor="let subheritage of heritage.subTypes; trackBy:trackByIndex;">
                                <span>
                                    <input id="{{subheritage.name}}" type="checkbox"
                                        (change)="onHeritageChange(subheritage, $event.target.checked)"
                                        [checked]="subheritage.name === get_Character().class.heritage.name">
                                    <label for="{{subheritage.name}}">
                                        <strong>{{subheritage.subType}}</strong>
                                    </label>
                                </span>
                            </div>
                            <!--End Subheritages-->
                            <div class="row left-aligned" *ngIf="heritage.sourceBook">
                                <strong>Source&nbsp;</strong><i>{{heritage.sourceBook}}</i>
                            </div>
                            <div class="row left-aligned">
                                <ng-container *ngFor="let desc of heritage.desc.split('\n\n'); trackBy:trackByIndex;">
                                    <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                    <ul *ngIf="desc.split('\n').length > 1">
                                        <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">{{line}}</li>
                                    </ul>
                                </ng-container>
                            </div>
                            <ng-container *ngFor="let activityName of heritage.gainActivities; trackBy:trackByIndex;">
                                <div class="row left-aligned"
                                    *ngFor="let activity of get_Activities(activityName); trackBy:trackByIndex;">
                                    <h4 class="left-aligned">{{activity.name}}
                                        <app-actionIcons [actionString]="activity.actions">
                                        </app-actionIcons>
                                        {{(activity.activationType) ? activity.activationType : ""}}
                                    </h4>
                                    <app-activity class="row" [activity]=activity [allowActivate]=false>
                                    </app-activity>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
        <!--Languages-->
        <div class="list-item" [ngClass]="{'fullsize-only':(!get_Character().class.languages.includes(''))}"
            *ngIf="get_LanguagesAvailable()">
            <button class="row sublist-toggle" [ngClass]="{'fancy-button':(!get_Character().class.languages.includes(''))}"
                (click)="toggle_List('languages')">
                Languages
            </button>
            <div class="list-item sublist" [ngClass]="{'fancy-list':(!get_Character().class.languages.includes(''))}"
                *ngIf="get_showList()=='languages'">
                <div class="row left-aligned">
                    <strong *ngIf="get_Character().class.ancestry.recommendedLanguages.length">Recommended
                        Languages&nbsp;</strong>{{get_Character().class.ancestry.recommendedLanguages.join(', ')}}
                </div>
                <div class="list-item"
                    *ngFor="let language of get_Character().class.languages; let index = index; trackBy:trackByIndex;">
                    <input class="row" type="text" [(ngModel)]="get_Character().class.languages[index]"
                        (blur)="on_LanguageChange()">
                </div>
            </div>
        </div>
        <!--Available Ancestry Feats-->
        <div class="list-item fullsize-only" *ngIf="get_Character().class.ancestry.name">
            <strong>Available Ancestry Feats</strong>
            <div class="row left-aligned" *ngIf="get_Character().class.ancestry.ancestries.length">
                <cite class="trait"
                    *ngFor="let trait of get_Character().class.ancestry.ancestries; trackBy:trackByIndex;">{{trait}}&nbsp;</cite>
            </div>
        </div>
        <!--Background-->
        <ng-container *ngIf="get_Character().class.name">
            <div class="list-item" [ngClass]="{'fullsize-only':(get_Character().class.background.name)}"
                *ngFor="let listID of ['background']; trackBy:trackByIndex;">
                <button class="row sublist-toggle"
                    [ngClass]="{'fancy-button':((get_Character().class.background.name))}"
                    (click)="toggle_List(listID)">
                    Background{{(get_Character().class.background.name) ? ": "+ get_Character().class.background.name : ""}}
                </button>
                <div class="list-item sublist" [ngClass]="{'fancy-list':((get_Character().class.background.name))}"
                    *ngIf="get_showList()==listID">
                    <ng-container *ngFor="let background of get_AvailableBackgrounds()|sortBy:'asc':'name'; trackBy:trackByIndex;">
                        <div class="row list-item" *ngFor="let itemID of ['background'+background.name]; trackBy:trackByIndex;">
                            <span>
                                <input *ngIf="!background.subTypes" id="{{background.name}}" type="checkbox"
                                    (change)="onBackgroundChange(background, $event.target.checked)"
                                    [checked]="background.name === get_Character().class.background.name">
                                <button class="lower left" *ngIf="background.subTypes" id="{{background.name}}"
                                    (click)="toggle_Item(itemID)">v</button>
                                <label for="{{background.name}}">
                                    <strong>{{background.name}}&nbsp;</strong>
                                    <cite class="trait" *ngIf="background.traits.includes('Rare')"
                                        title="{{get_Traits('Rare')[0]?.description}}">Rare</cite>
                                    <cite class="trait" *ngIf="background.traits.includes('Uncommon')"
                                        title="{{get_Traits('Uncommon')[0]?.description}}">Uncommon</cite>
                                </label>
                            </span>
                            <button (click)="toggle_Item(itemID)">
                                Show Description
                            </button>
                            <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                <!--Subbackgrounds-->
                                <div class="list-item" *ngFor="let subbackground of get_SubBackgrounds(background.name); trackBy:trackByIndex;">
                                    <span>
                                        <input id="{{subbackground.name}}" type="checkbox"
                                            (change)="onBackgroundChange(subbackground, $event.target.checked)"
                                            [checked]="subbackground.name === get_Character().class.background.name">
                                        <label for="{{subbackground.name}}">
                                            <strong>{{subbackground.subType}}</strong>
                                        </label>
                                    </span>
                                </div>
                                <!--End Subbackgrounds-->
                                <div class="row left-aligned tags">
                                    <cite class="trait" *ngFor="let trait of background.traits; trackBy:trackByIndex;"
                                        title="{{get_Traits(trait)[0]?.description}}">{{trait}}</cite>
                                </div>
                                <div class="row left-aligned" *ngIf="background.sourceBook">
                                    <strong>Source&nbsp;</strong><i>{{background.sourceBook}}</i>
                                </div>
                                <div class="row left-aligned" *ngIf="background.prerequisites">
                                    <strong>Prerequisites&nbsp;</strong>{{background.prerequisites}}
                                </div>
                                <div class="row left-aligned" *ngIf="background.region">
                                    <strong>Region&nbsp;</strong>{{background.region}}
                                </div>
                                <div class="row left-aligned">
                                    <ng-container *ngFor="let desc of background.desc.split('\n\n'); trackBy:trackByIndex;">
                                        <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                        <ul *ngIf="desc.split('\n').length > 1">
                                            <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">{{line}}</li>
                                        </ul>
                                    </ng-container>
                                </div>
                                <div class="list-item lower row problem" *ngIf="background.inputRequired">
                                    <strong>Player input required:</strong>
                                    <div class="row left-aligned">
                                        <p *ngFor="let inputRequired of background.inputRequired.split('\n'); trackBy:trackByIndex;">
                                            {{inputRequired}}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </ng-container>
        <!--Deity-->
        <ng-container *ngIf="get_Character().class.name">
            <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.deity}"
                *ngFor="let listID of ['deity']; trackBy:trackByIndex;">
                <button class="row sublist-toggle" [ngClass]="{'fancy-button':get_Character().class.deity}"
                    (click)="toggle_List(listID)">
                    Deity{{get_Character().class.deity ? ": "+get_Character().class.deity : ""}}
                </button>
                <div class="list-item sublist" [ngClass]="{'fancy-list':get_Character().class.deity}"
                    *ngIf="get_showList()==listID">
                    <ng-container *ngFor="let deity of get_Deities(); trackBy:trackByIndex;">
                        <div class="row list-item" *ngFor="let itemID of ['deity'+deity.name]; trackBy:trackByIndex;">
                            <span>
                                <input id="{{deity.name}}" type="checkbox"
                                    (change)="on_DeityChange(deity, $event.target.checked)"
                                    [checked]="deity.name === get_Character().class.deity">
                                <label for="{{deity.name}}">
                                    <strong>{{deity.name}} ({{deity.alignment}})</strong>
                                </label>
                            </span>
                            <button (click)="toggle_Item(itemID)">
                                Show Description
                            </button>
                            <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                <div class="row left-aligned">
                                    <strong>Follower Alignments&nbsp;</strong>{{deity.followerAlignments.join(", ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Divine Ability&nbsp;</strong>{{deity.divineAbilityFilter.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Divine Font&nbsp;</strong>{{deity.divineFontFilter.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Divine Skill&nbsp;</strong>{{deity.divineSkillFilter.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Favored Weapon&nbsp;</strong>{{deity.favoredWeapon.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Domains&nbsp;</strong>{{deity.domains.join(", ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Cleric Spells</strong>
                                </div>
                                <div class="list-item lower left-aligned" *ngFor="let spell of deity.clericSpells; trackBy:trackByIndex;">
                                    <strong>Level
                                        {{spell.level}}&nbsp;</strong>{{spell.name}}{{(spell.note ? "("+spell.note+")" : "")}}
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </ng-container>
        <!--Levels-->
        <ng-container *ngIf="get_Character().class">
            <ng-container *ngFor="let level of get_Character().class.levels; trackBy:trackByIndex;">
                <h3 *ngIf="level.number > 0">Level {{level.number}}</h3>
                <!--Fixed information-->
                <ng-container *ngIf="level.number > 0">
                    <div class="fullsize-only list-item" *ngFor="let listID of ['showFixedChanges'+level.number]; trackBy:trackByIndex;">
                        <button class="row sublist-toggle fancy-button" (click)="toggle_List(listID)">
                            Show fixed changes
                        </button>
                        <div class="list-item sublist fancy-list" *ngIf="get_showList()==listID">
                            <!--Fixed Ability boosts-->
                            <div class="list-item"
                                *ngFor="let boost of get_AbilityBoosts(level.number, level.number, '', '', '', '', true); trackBy:trackByIndex;">
                                Ability {{(boost.type == 'Flaw') ? 'Flaw' : 'Boost'}} ({{boost.source}}): {{boost.name}}
                            </div>
                            <!--Fixed Skill Increases-->
                            <div class="list-item"
                                *ngFor="let skillIncrease of get_SkillIncreases(level.number, level.number, '', '', '', true); trackBy:trackByIndex;">
                                {{(skillIncrease.name.includes("Lore:")) ? "Lore " : ""}}Skill Training
                                ({{skillIncrease.source}}): {{skillIncrease.name}}
                            </div>
                            <!--Fixed Feats-->
                            <div title="{{get_FeatsAndFeatures(feat.name)[0]?.desc}}" class="list-item"
                                *ngFor="let feat of get_FeatsTaken(level.number, level.number, '', '', '', true); trackBy:trackByIndex;">
                                Feat ({{feat.source}}): {{feat.name}}
                                <button class="right-bound" (click)="toggle_Item(level.number+feat.name+feat.source+'desc')">
                                    Show Description
                                </button>
                                <div class="row left-aligned" *ngIf="this.get_showItem()==level.number+feat.name+feat.source+'desc'">
                                    <app-feat [feat]="get_FeatsAndFeatures(feat.name)[0]" [choice]="null" [levelNumber]="level.number"></app-feat>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </ng-container>
                <div class="list-item" *ngIf="level.number > 0">
                    <span>
                        <input id="sameLevelFeatsOnly{{level.number}}" type="checkbox" [(ngModel)]="sameLevelFeatsOnly">
                        <label for="sameLevelFeatsOnly{{level.number}}">Show only feats of this level</label>
                    </span>
                </div>
                <div class="list-item" *ngIf="level.number > 0">
                    <span>
                        <input id="archetypeFeats{{level.number}}" type="checkbox" [(ngModel)]="archetypeFeats">
                        <label for="archetypeFeats{{level.number}}">Show archetype feats</label>
                    </span>
                </div>
                <!--Languages - show if you have gained languages this level-->
                <div class="list-item" [ngClass]="{'fullsize-only':!get_Character().class.languages.includes('')}"
                    *ngIf="level.number > 0 && get_LanguagesAvailable(level.number)">
                    <button class="row sublist-toggle" [ngClass]="{'fancy-button':!get_Character().class.languages.includes('')}"
                        (click)="toggle_List('languages'+level.number)">
                        Languages
                    </button>
                    <div class="list-item sublist" [ngClass]="{'fancy-list':!get_Character().class.languages.includes('')}"
                        *ngIf="get_showList()=='languages'+level.number">
                        <div class="row left-aligned">
                            <strong *ngIf="get_Character().class.ancestry.recommendedLanguages.length">Recommended
                                Languages&nbsp;</strong>{{get_Character().class.ancestry.recommendedLanguages.join(', ')}}
                        </div>
                        <div class="list-item"
                            *ngFor="let language of get_Character().class.languages; let index = index; trackBy:trackByIndex;">
                            <input class="row" type="text" [(ngModel)]="get_Character().class.languages[index]"
                                (blur)="on_LanguageChange()">
                        </div>
                    </div>
                </div>
                <!--Ability boosts-->
                <ng-container *ngFor="let choice of level.abilityChoices; trackBy:trackByIndex;">
                    <ng-container *ngFor="let listID of [choice.id]; trackBy:trackByIndex;">
                        <div class="list-item" *ngIf="get_MaxAvailable(choice)"
                            [ngClass]="{'problem':(choice.boosts.length > get_MaxAvailable(choice) || someAbilitiesIllegal(choice)), 'fullsize-only':(choice.boosts.length == get_MaxAvailable(choice))}">
                            <button class="row sublist-toggle"
                                [ngClass]="{'fancy-button':(choice.boosts.length == get_MaxAvailable(choice))}"
                                (click)="toggle_List(listID)">
                                Ability {{choice.infoOnly ? "Choice (no Boost)" : "Boost"}}{{(get_MaxAvailable(choice) > 1) ? "s" : ""}}
                                ({{choice.source}}){{(get_MaxAvailable(choice) > 1) ?
                                    ": "+ choice.boosts.length + "/" + (get_MaxAvailable(choice)) :
                                    (choice.boosts.length) ? ": "+ choice.boosts[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngClass]="{'fancy-list':(choice.boosts.length == get_MaxAvailable(choice))}"
                                *ngIf="get_showList()==listID">
                                <div class="list-item" *ngFor="let ability of get_AvailableAbilities(choice); trackBy:trackByIndex;"
                                    [ngClass]="{'problem':abilityIllegal(level.number, ability)}">
                                    <div class="row" *ngFor="let itemID of [choice.id+ability.name]; trackBy:trackByIndex;">
                                        <span>
                                            <input id="{{itemID}}" type="checkbox"
                                                (change)="on_AbilityBoost(ability.name, $event.target.checked, choice, false)"
                                                [checked]="get_AbilityBoosts(level.number, level.number, ability.name, 'Boost', choice.source).length || get_AbilityBoosts(level.number, level.number, ability.name, 'Info', choice.source).length"
                                                [disabled]="cannotBoost(ability, level, choice).length">
                                            <label for="{{itemID}}">
                                                <strong>{{ability.name}}:</strong>
                                                {{ability.baseValue(get_Character(), characterService, level.number).result}}&nbsp;
                                                <cite class="problem"
                                                    *ngFor="let reason of cannotBoost(ability, level, choice); trackBy:trackByIndex;">
                                                    {{reason}}
                                                </cite>
                                                <cite class="problem" *ngIf="abilityIllegal(level.number, ability)">
                                                    Abilities cannot be raised above 18 on level 1!&nbsp;
                                                </cite>
                                            </label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!--Skill Increases-->
                <ng-container *ngFor="let choice of level.skillChoices; trackBy:trackByIndex;">
                    <ng-container *ngFor="let listID of [choice.id]; trackBy:trackByIndex;">
                        <div class="list-item" *ngIf="choice.available + get_SkillINTBonus(choice)"
                            [ngClass]="{'problem':(choice.increases.length > choice.available + get_SkillINTBonus(choice) || someIllegal(choice)), 'fullsize-only':(choice.increases.length == choice.available + get_SkillINTBonus(choice))}">
                            <button class="row sublist-toggle"
                                [ngClass]="{'fancy-button':(choice.increases.length == choice.available + get_SkillINTBonus(choice))}"
                                (click)="toggle_List(listID)">
                                Skill Training
                                ({{choice.source}}){{(choice.available + get_SkillINTBonus(choice) > 1) ?
                                    (": "+ choice.increases.length +"/"+ (choice.available + get_SkillINTBonus(choice)) ) : 
                                    (choice.increases.length) ? ": "+ choice.increases[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngClass]="{'fancy-list':(choice.available + get_SkillINTBonus(choice) == choice.increases.length)}"
                                *ngIf="get_showList()==listID">
                                <div class="list-item"
                                    *ngFor="let skill of get_AvailableSkills(choice, level)|sortBy:'asc':'name'; trackBy:trackByIndex;"
                                    [ngClass]="{'problem':(!skill.isLegal(get_Character(), this.characterService, level.number) ||
                                    (!skill.isLegal(get_Character(), this.characterService, level.number, choice.maxRank) && skillIncreasedByThis(skill, choice)))}">
                                    <div class="row" *ngFor="let itemID of [choice.id+skill.name]; trackBy:trackByIndex;">
                                        <span>
                                            <input id="{{itemID}}" type="checkbox"
                                                (change)="on_SkillIncrease(skill.name, $event.target.checked, choice, false)"
                                                [checked]="skillIncreasedByThis(skill, choice)"
                                                [disabled]="skillLockedByThis(skill, choice) || (cannotIncrease(skill, level, choice).length && !skillIncreasedByThis(skill, choice))">
                                            <label for="{{itemID}}">
                                                <strong>{{skill.name}}{{skill.ability ? " (" + skill.ability.substr(0,3) + ")" : ""}}:</strong>
                                                <app-proficiency-form [creature]="'Character'" [skill]="skill"
                                                    [characterService]="this.characterService" [level]="level.number">
                                                </app-proficiency-form>
                                                <cite class="problem"
                                                    *ngFor="let reason of cannotIncrease(skill, level, choice); trackBy:trackByIndex;">
                                                    {{reason}}
                                                </cite>
                                                <cite class="problem"
                                                    *ngIf="!skill.isLegal(get_Character(), this.characterService, level.number) || (!skill.isLegal(get_Character(), this.characterService, level.number, choice.maxRank) && skillIncreasedByThis(skill, choice))">
                                                    This skill was raised higher than allowed!
                                                </cite>
                                            </label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!--Feat choices-->
                <ng-container *ngFor="let choice of get_FeatChoices(level); let index = index; trackBy:trackByIndex;">
                    <app-featchoice (showChoiceMessage)="receive_ChoiceMessage($event)"
                        (showFeatMessage)="receive_FeatMessage($event)" [choice]="choice" [levelNumber]=level.number
                        [showFeat]="get_showItem()" [showChoice]="get_showList()" [sameLevelFeatsOnly]="sameLevelFeatsOnly" [archetypeFeats]="archetypeFeats">
                    </app-featchoice>
                </ng-container>
                <!--Animal Companion-->
                <ng-container *ngIf="get_CompanionAvailable(level.number)">
                    <div class="list-item"
                        [ngClass]="{'fullsize-only':(get_Companion().name && get_Companion().species)}"
                        *ngFor="let listID of ['animalCompanion']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle"
                            [ngClass]="{'fancy-button':(get_Companion().name && get_Companion().species)}"
                            (click)="toggle_List(listID)">
                            Animal Companion Basics
                        </button>
                        <div class="list-item sublist"
                            [ngClass]="{'fancy-list':(get_Companion().name && get_Companion().species)}"
                            *ngIf="get_showList()==listID">
                            <button class="list-item" (click)="on_NewCompanion(level)">
                                Create New Animal Companion
                            </button>
                            <div class="list-item">
                                <span>Animal Companion Name</span>
                                <span>
                                    <input type="text" name="name" [(ngModel)]="get_Companion().name" maxLength="30">
                                </span>
                            </div>
                            <div class="list-item">
                                <span>Animal Companion Species</span>
                                <span>
                                    <input type="text" name="name" [(ngModel)]="get_Companion().species" maxLength="30">
                                </span>
                            </div>
                        </div>
                    </div>
                    <!--Animal Type-->
                    <div class="list-item" [ngClass]="{'fullsize-only':(get_Companion().class.ancestry.name)}"
                        *ngFor="let listID of ['animaltype']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle"
                            [ngClass]="{'fancy-button':(get_Companion().class.ancestry.name)}"
                            (click)="toggle_List(listID)">
                            Animal Companion
                            Type{{(get_Companion().class.ancestry.name) ? ": "+ get_Companion().class.ancestry.name : ""}}
                        </button>
                        <div class="list-item sublist" [ngClass]="{'fancy-list':(get_Companion().class.ancestry.name)}"
                            *ngIf="get_showList()==listID">
                            <div class="list-item" *ngFor="let type of get_AvailableCompanionTypes()|sortBy:'asc':'name'; trackBy:trackByIndex;">
                                <div class="row" *ngFor="let itemID of ['animaltype'+type.name+'desc']; trackBy:trackByIndex;">
                                    <span>
                                        <input id="{{type.name}}" type="checkbox"
                                            (change)="on_CompanionTypeChange(type, $event.target.checked)"
                                            [checked]="type.name === get_Companion().class.ancestry.name">
                                        <label for="{{type.name}}">
                                            <strong>{{type.name}}</strong>
                                        </label>
                                    </span>
                                    <button (click)="toggle_Item(itemID)">
                                        Show Description
                                    </button>
                                    <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                        <div class="row left-aligned">
                                            <div class="row left-aligned tags">
                                                <cite class="trait" *ngFor="let trait of type.traits; trackBy:trackByIndex;"
                                                    title="{{get_Traits(trait)[0]?.description}}">{{trait}}</cite>
                                            </div>
                                            <div class="row left-aligned" *ngIf="type.sourceBook">
                                                <strong>Source&nbsp;</strong><i>{{type.sourceBook}}</i>
                                            </div>
                                            <ng-container *ngFor="let desc of type.desc.split('\n\n'); trackBy:trackByIndex;">
                                                <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">{{line}}</li>
                                                </ul>
                                            </ng-container>
                                            <p>
                                                <strong>Size</strong>
                                                {{size(type.size)}}
                                            </p>
                                            <ng-container *ngFor="let gain of type.gainItems; trackBy:trackByIndex;">
                                                <p *ngFor="let item of get_ItemFromGain(gain); trackBy:trackByIndex;">
                                                    <strong>Melee</strong> {{item.displayName}}, <strong>Damage</strong>
                                                    {{item.dicenum+"d"+item.dicesize}}
                                                </p>
                                            </ng-container>
                                            <p>
                                                <span
                                                    *ngFor="let ability of get_AnimalCompanionAbilities(type); let index = index; trackBy:trackByIndex;">{{index ? ", " : ""}}<strong>{{ability.name}}</strong>
                                                    {{ability.modifier}}</span>
                                            </p>
                                            <p>
                                                <strong>Hit Points</strong>
                                                {{type.hitpoints}}
                                            </p>
                                            <p>
                                                <strong>Skill</strong>
                                                {{type.skillChoices[0].increases[0].name}}
                                            </p>
                                            <p>
                                                <strong>Senses</strong>
                                                {{type.senses.join(", ")}}
                                            </p>
                                            <p>
                                                <strong>Speed</strong>
                                                <span *ngFor="let speed of type.speeds; let index = index; trackBy:trackByIndex;">
                                                    {{index > 0 ? ", " : ""}}{{speed.name.split(' ')[0] + " " + speed.value + " feet"}}
                                                </span>
                                            </p>
                                            <p>
                                                <strong>Support Benefit</strong>
                                                {{type.supportBenefit}}
                                            </p>
                                            <p *ngIf="type.specialdesc.length">
                                                <strong>Special</strong>
                                                {{type.specialdesc}}
                                            </p>
                                        </div>
                                        <ng-container *ngFor="let gain of [type.activities[1]]; trackBy:trackByIndex;">
                                            <div class="row left-aligned"
                                                *ngFor="let activity of get_Activities(gain.name); trackBy:trackByIndex;">
                                                <h4 class="left-aligned">Advanced Maneuver: {{activity.name}}
                                                    <app-actionIcons [actionString]="activity.actions">
                                                    </app-actionIcons>
                                                    {{(activity.activationType) ? activity.activationType : ""}}
                                                </h4>
                                                <app-activity class="row" [activity]=activity [allowActivate]=false>
                                                </app-activity>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Animal Specializations-->
                <ng-container *ngIf="get_CompanionSpecializationsAvailable(level.number)">
                    <ng-container *ngFor="let available of [get_CompanionSpecializationsAvailable(level.number)]; trackBy:trackByIndex;">
                        <div class="list-item"
                            [ngClass]="{'fullsize-only':(get_TakenCompanionSpecializations(level.number).length == available)}"
                            *ngFor="let listID of ['animalspecialization'+level.number]; trackBy:trackByIndex;">
                            <button class="row sublist-toggle"
                                [ngClass]="{'fancy-button':(get_TakenCompanionSpecializations(level.number).length == available)}"
                                (click)="toggle_List(listID)">
                                Animal Companion
                                Specialization{{available > 1 ?
                                        ": "+ get_TakenCompanionSpecializations(level.number).length +"/"+ available : 
                                        (get_TakenCompanionSpecializations(level.number).length == 1) ? ": "+ get_Companion().class.specializations[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngClass]="{'fancy-list':(get_TakenCompanionSpecializations(level.number).length == available)}"
                                *ngIf="get_showList()==listID">
                                <div class="list-item"
                                    *ngFor="let spec of get_AvailableCompanionSpecializations(level.number)|sortBy:'asc':'name'; trackBy:trackByIndex;">
                                    <div class="row"
                                        *ngFor="let itemID of ['animalspecialization'+spec.name+'desc'+level.number]; trackBy:trackByIndex;">
                                        <span>
                                            <input id="{{spec.name}}" type="checkbox"
                                                (change)="on_SpecializationChange(spec, $event.target.checked, level.number)"
                                                [checked]="have_CompanionSpecialization(spec.name)">
                                            <label for="{{spec.name}}">
                                                <strong>{{spec.name}}</strong>
                                            </label>
                                        </span>
                                        <button (click)="toggle_Item(itemID)">
                                            Show Description
                                        </button>
                                        <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                            <div class="row left-aligned">
                                                <p>
                                                    {{spec.desc}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!--Familiar-->
                <ng-container *ngIf="get_FamiliarAvailable(level.number)">
                    <div class="list-item" [ngClass]="{'fullsize-only':(get_Familiar().name && get_Familiar().species)}"
                        *ngFor="let listID of ['familiar']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle"
                            [ngClass]="{'fancy-button':(get_Familiar().name && get_Familiar().species)}"
                            (click)="toggle_List(listID)">
                            Familiar Basics
                        </button>
                        <div class="list-item sublist"
                            [ngClass]="{'fancy-list':(get_Familiar().name && get_Familiar().species)}"
                            *ngIf="get_showList()==listID">

                            <button class="list-item" (click)="on_NewFamiliar()">
                                Create New Familiar
                            </button>
                            <div class="list-item">
                                <span>Familiar Name</span>
                                <span>
                                    <input type="text" name="name" [(ngModel)]="get_Familiar().name" maxLength="30">
                                </span>
                            </div>
                            <div class="list-item">
                                <span>Familiar Species</span>
                                <span>
                                    <input type="text" name="species" [(ngModel)]="get_Familiar().species"
                                        maxLength="30">
                                </span>
                            </div>
                            <div class="list-item">
                                <span>Swimmer</span>
                                <span>
                                    <input type="checkbox" name="familiar-swimmer"
                                        (click)="on_FamiliarSpeedChange($event.target.checked)"
                                        [checked]="is_FamiliarSwimmer()"><label for="familiar-swimmer">Gain Swim Speed
                                        instead of Land Speed</label>
                                </span>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Different Worlds-->
                <ng-container *ngFor="let feat of get_DifferentWorldsFeat(level.number); trackBy:trackByIndex;">
                    <!--Different Worlds Name-->
                    <div class="list-item" [ngClass]="{'fullsize-only':(feat.data.name != '')}"
                        *ngFor="let listID of ['differentWorlds_Name']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle" [ngClass]="{'fancy-button':(feat.data.name != '')}"
                            (click)="toggle_List(listID)">
                            Alternative Name (Different Worlds){{(feat.data.name) ? ": "+ feat.data.name : ""}}
                        </button>
                        <div class="list-item sublist" [ngClass]="{'fancy-list':(feat.data.name != '')}"
                            *ngIf="get_showList()==listID">
                            <div class="list-item">
                                <strong>Name:
                                    <input type="text" [(ngModel)]="feat.data.name"
                                        (blur)=on_NameChange() maxLength="30">
                                </strong>
                            </div>
                        </div>
                    </div>
                    <!--Different Worlds Background-->
                    <div class="list-item" [ngClass]="{'fullsize-only':(feat.data.background != '')}"
                        *ngFor="let listID of ['differentWorlds_Background']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle" [ngClass]="{'fancy-button':(feat.data.background)}"
                            (click)="toggle_List(listID)">
                            Alternative Background (Different
                            Worlds){{(feat.data.background) ? ": "+ feat.data.background : ""}}
                        </button>
                        <div class="list-item sublist" [ngClass]="{'fancy-list':((feat.data.background))}"
                            *ngIf="get_showList()==listID">
                            <div class="list-item" *ngFor="let background of get_Backgrounds(); trackBy:trackByIndex;">
                                <div class="row" *ngFor="let itemID of ['differentWorlds_Background'+background.name]; trackBy:trackByIndex;">
                                    <span>
                                        <input *ngIf="!background.subTypes" id="{{background.name}}"
                                            type="checkbox"
                                            (change)="onDifferentWorldsBackgroundChange(level, feat, background, $event.target.checked)"
                                            [checked]="background.name === feat.data.background || background.name === get_Character().class.background.name"
                                            [disabled]="background.name === get_Character().class.background.name">
                                        <button class="lower left" *ngIf="background.subTypes"
                                            id="{{background.name}}" (click)="toggle_Item(itemID)">v</button>
                                        <label for="{{background.name}}">
                                            <strong>{{background.name}}</strong>
                                        </label>
                                    </span>
                                    <button (click)="toggle_Item(itemID)">
                                        Show Description
                                    </button>
                                    <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                        <!--Subbackgrounds-->
                                        <div class="list-item" *ngFor="let subbackground of get_SubBackgrounds(background.name); trackBy:trackByIndex;">
                                            <span>
                                                <input id="{{subbackground.name}}" type="checkbox"
                                                    (change)="onDifferentWorldsBackgroundChange(level, feat, subbackground, $event.target.checked)"
                                                    [checked]="subbackground.name === feat.data.background || subbackground.name === get_Character().class.background.name"
                                                    [disabled]="subbackground.name === get_Character().class.background.name || subbackground.superType == get_Character().class.background.superType">
                                                <label for="{{subbackground.name}}">
                                                    <strong>{{subbackground.subType}}</strong>
                                                </label>
                                            </span>
                                        </div>
                                        <!--End Subbackgrounds-->
                                        <div class="row left-aligned">
                                            <ng-container *ngFor="let desc of background.desc.split('\n\n'); trackBy:trackByIndex;">
                                                <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">{{line}}</li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Fuse Stance-->
                <ng-container *ngFor="let feat of get_FuseStanceFeat(level.number); trackBy:trackByIndex;">
                    <!--Fuse Stance Name-->
                    <div class="list-item" [ngClass]="{'fullsize-only':(feat.data.name != '')}"
                        *ngFor="let listID of ['fuseStance_Name']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle" [ngClass]="{'fancy-button':(feat.data.name != '')}"
                            (click)="toggle_List(listID)">
                            Fused Stance Name (Fuse Stance){{(feat.data.name) ? ": "+ feat.data.name : ""}}
                        </button>
                        <div class="list-item sublist" [ngClass]="{'fancy-list':(feat.data.name != '')}"
                            *ngIf="get_showList()==listID">
                            <div class="list-item">
                                <strong>Name:
                                    <input type="text" [(ngModel)]="feat.data.name"
                                        (blur)="on_FuseStanceNameChange()" maxLength="30">
                                </strong>
                            </div>
                        </div>
                    </div>
                    <!--Fuse Stance Stance 1-->
                    <div class="list-item" [ngClass]="{'fullsize-only':(feat.data.stance1 != '')}"
                        *ngFor="let listID of ['fuseStance_Stance1']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle" [ngClass]="{'fancy-button':(feat.data.stance1)}"
                            (click)="toggle_List(listID)">
                            Fused Stance 1 (Fuse Stance){{(feat.data.stance1) ? ": "+ feat.data.stance1 : ""}}
                        </button>
                        <div class="list-item sublist" [ngClass]="{'fancy-list':((feat.data.stance1))}"
                            *ngIf="get_showList()==listID">
                            <div class="list-item" [ngClass]="{'unavailable':stance.reason}"
                                *ngFor="let stance of get_StancesToFuse(level.number); trackBy:trackByIndex;">
                                <div class="row" *ngFor="let itemID of ['fuseStance_stance1'+stance.name]; trackBy:trackByIndex;">
                                    <span>
                                        <input id="{{stance.name}}" type="checkbox"
                                            (change)="on_FuseStanceStanceChange(feat, 'stance1', stance.name, $event.target.checked)"
                                            [checked]="stance.name == feat.data.stance1 || stance.name == feat.data.stance2"
                                            [disabled]="stance.name == feat.data.stance2" *ngIf="!stance.reason">
                                        <label for="{{stance.name}}">
                                            <strong>{{stance.name}}&nbsp;</strong>
                                            <span>
                                                <cite class="problem" *ngIf="stance.reason">
                                                    {{stance.reason}}
                                                </cite>
                                            </span>
                                        </label>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Fuse Stance Stance 2-->
                    <div class="list-item" [ngClass]="{'fullsize-only':(feat.data.stance2 != '')}"
                        *ngFor="let listID of ['fuseStance_Stance2']; trackBy:trackByIndex;">
                        <button class="row sublist-toggle" [ngClass]="{'fancy-button':(feat.data.stance2)}"
                            (click)="toggle_List(listID)">
                            Fused Stance 2 (Fuse Stance){{(feat.data.stance2) ? ": "+ feat.data.stance2 : ""}}
                        </button>
                        <div class="list-item sublist" [ngClass]="{'fancy-list':((feat.data.stance2))}"
                            *ngIf="get_showList()==listID">
                            <div class="list-item" [ngClass]="{'unavailable':stance.reason}"
                                *ngFor="let stance of get_StancesToFuse(level.number); trackBy:trackByIndex;">
                                <div class="row" *ngFor="let itemID of ['fuseStance_stance2'+stance.name]; trackBy:trackByIndex;">
                                    <span>
                                        <input id="{{stance.name}}" type="checkbox"
                                            (change)="on_FuseStanceStanceChange(feat, 'stance2', stance.name, $event.target.checked)"
                                            [checked]="stance.name == feat.data.stance1 || stance.name == feat.data.stance2"
                                            [disabled]="stance.name == feat.data.stance1" *ngIf="!stance.reason">
                                        <label for="{{stance.name}}">
                                            <strong>{{stance.name}}&nbsp;</strong>
                                            <span>
                                                <cite class="problem" *ngIf="stance.reason">
                                                    {{stance.reason}}
                                                </cite>
                                            </span>
                                        </label>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Lore Training-->
                <ng-container *ngFor="let choice of level.loreChoices; trackBy:trackByIndex;">
                    <ng-container *ngFor="let listID of [choice.id]; trackBy:trackByIndex;">
                        <div class="list-item" *ngIf="choice.available"
                            [ngClass]="{'problem':(choice.increases.length > choice.available), 'fullsize-only':(choice.available == choice.increases.length)}">
                            <button class="row sublist-toggle"
                                [ngClass]="{'fancy-button':(choice.available == choice.increases.length)}"
                                (click)="toggle_List(listID)">
                                Lore Training
                                ({{choice.source}}){{(choice.increases.length) ? ": "+ choice.increases[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngClass]="{'fancy-list':(choice.available == choice.increases.length)}"
                                *ngIf="get_showList()==listID">
                                <div class="list-item" *ngFor="let itemID of [choice.id+'LoreIncreaseBox']; trackBy:trackByIndex;">
                                    <span>
                                        <input id="{{itemID}}" type="checkbox"
                                            (change)="on_LoreChange($event.target.checked, choice)"
                                            [checked]="get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length"
                                            [disabled]="choice.loreName == '' || get_Skills('Lore: '+choice.loreName).length && !get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length">
                                        <label style="display:initial" for="{{itemID}}">
                                            <strong>Lore:
                                                <input type="text" [(ngModel)]="choice.loreName"
                                                    [disabled]="get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length"
                                                    (blur)="on_LoreNameChange" maxLength="20">
                                            </strong>
                                        </label>
                                        <cite class="problem"
                                            *ngIf="get_Skills('Lore: '+choice.loreName).length && !get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length">
                                            You are already trained in this Lore!
                                        </cite>
                                    </span>
                                    <div class="row">
                                        {{choice.loreDesc}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>
    </ng-container>
</div>