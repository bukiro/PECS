<button class="minimizebutton lower" [ngStyle]="{'background-color':get_Accent()}" (click)="minimize()">&#8691;</button>
<div id="character-height" class="itemBox">
    <button class="list-item" [ngStyle]="{'background-color':get_Accent()}" (click)="toggleCharacterMenu()">
        Close
    </button>
    <div class="loading" *ngIf="still_loading()">Loading</div>
    <ng-container *ngIf="!still_loading()">
        <div class="list-item row">
            <span>Color Accent</span>
            <span>
                <input type="text" name="name" [(ngModel)]="get_Character().settings.accent"
                    (blur)="this.characterService.set_Changed()" maxLength="7">
            </span>
        </div>
        <div class="list-item row">
            <span>Name</span>
            <span>
                <input type="text" name="name" [(ngModel)]="get_Character().name"
                    (blur)="this.characterService.set_Changed()" maxLength="30">
            </span>
        </div>
        <div class="list-item row">
            <span>
                Alignment
            </span>
            <span>
                <select [(ngModel)]="get_Character().alignment" (ngModelChange)="set_Changed()">
                    <option *ngFor="let alignment of get_Alignments()" [value]="alignment">
                        {{alignment}}
                    </option>
                </select>
            </span>
        </div>
        <div class="list-item row">
            <span>
                Level
            </span>
            <span>
                <select [(ngModel)]="get_Character().level" (ngModelChange)="on_LevelChange()">
                    <option *ngFor="let level of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]" [value]="level">
                        {{level}}
                    </option>
                </select>
            </span>
        </div>
        <!--BaseValues-->
        <div class="list-item">
            <button class="row sublist-toggle fancy-button" [ngStyle]="{'color':get_Accent()}"
                (click)="toggle_List('alternateBaseValues')">
                Alternate Ability Values: {{(get_Character().baseValues.length) ? "Used" : "Not used"}}
            </button>
            <div class="list-item sublist fancy-list" *ngIf="get_showList()=='alternateBaseValues'">
                <div class="list-item">
                    <span>
                        <input id="useAlternateBaseValues" type="checkbox" (change)="onBaseValueChange()"
                            [checked]="get_Character().baseValues.length">
                        <label for="useAlternateBaseValues">
                            <strong>Enter your own Ability values</strong>
                        </label>
                    </span>
                </div>
                <div class="list-item" *ngFor="let ability of get_Character().baseValues">
                    {{ability.name}}
                    <input type="number" class="number2" [(ngModel)]="ability.baseValue" (blur)=set_Changed()
                        maxlength="2" (keypress)="numbersOnly($event)">
                </div>
            </div>
        </div>
        <h3>History</h3>
        <!--Class-->
        <div class="list-item" [className]="(get_Character().class.name) ? 'fullsize-only' : ''"
            *ngFor="let listID of ['class']">
            <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                [ngStyle]="(get_Character().class.name) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                [className]="(get_Character().class.name) ? 'fancy-button' : ''" (click)="toggle_List(listID)">
                Class{{(get_Character().class.name) ? ": "+ get_Character().class.name : ""}}
            </button>
            <div class="list-item sublist"
                [ngStyle]="(get_Character().class.name) ? {} : {'border-color':get_Accent(listID)}"
                [className]="(get_Character().class.name) ? 'fancy-list' : ''" *ngIf="get_showList()==listID">
                <div class="list-item" *ngFor="let class of get_Classes()">
                    <span>
                        <input id="{{class.name}}" type="checkbox"
                            (change)="onClassChange(class, $event.target.checked)"
                            [checked]="class.name === get_Character().class.name">
                        <label for="{{class.name}}">
                            <strong>{{class.name}}</strong>
                        </label>
                    </span>
                </div>
            </div>
        </div>
        <!--Ancestry-->
        <ng-container *ngIf="get_Character().class.name">
            <div class="list-item list-header"
                [className]="(get_Character().class.ancestry.name) ? 'fullsize-only' : ''"
                *ngFor="let listID of ['ancestry']">
                <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                    [ngStyle]="(get_Character().class.ancestry.name) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                    [className]="((get_Character().class.ancestry.name)) ? 'fancy-button' : ''"
                    (click)="toggle_List(listID)">
                    Ancestry{{(get_Character().class.ancestry.name) ? ": "+ get_Character().class.ancestry.name : ""}}
                </button>
                <div class="list-item sublist"
                    [ngStyle]="(get_Character().class.ancestry.name) ? {} : {'border-color':get_Accent(listID)}"
                    [className]="((get_Character().class.ancestry.name)) ? 'fancy-list' : ''"
                    *ngIf="get_showList()==listID">
                    <div class="list-item" *ngFor="let ancestry of get_Ancestries()">
                        <span>
                            <input id="{{ancestry.name}}" type="checkbox"
                                (change)="onAncestryChange(ancestry, $event.target.checked)"
                                [checked]="ancestry.name === get_Character().class.ancestry.name">
                            <label for="{{ancestry.name}}">
                                <strong>{{ancestry.name}}</strong>
                            </label>
                        </span>
                    </div>
                </div>
            </div>
        </ng-container>
        <!--Heritage-->
        <ng-container *ngIf="get_Character().class.ancestry.name">
            <div class="list-item" [className]="(get_Character().class.heritage.name) ? 'fullsize-only' : ''"
                *ngFor="let listID of ['heritage']">
                <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                    [ngStyle]="(get_Character().class.heritage.name) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                    [className]="((get_Character().class.heritage.name)) ? 'fancy-button' : ''"
                    (click)="toggle_List(listID)">
                    Heritage{{(get_Character().class.heritage.name) ? ": "+ get_Character().class.heritage.name : ""}}
                </button>
                <div class="list-item sublist"
                    [ngStyle]="(get_Character().class.heritage.name) ? {} : {'border-color':get_Accent(listID)}"
                    [className]="((get_Character().class.heritage.name)) ? 'fancy-list' : ''"
                    *ngIf="get_showList()==listID">
                    <div class="list-item"
                        *ngFor="let heritage of get_Heritages('', get_Character().class.ancestry.name)">
                        <span>
                            <input *ngIf="!heritage.subTypes.length" id="{{heritage.name}}" type="checkbox"
                                (change)="onHeritageChange(heritage, $event.target.checked)"
                                [checked]="heritage.name === get_Character().class.heritage.name">
                            <button class="lower left" [ngStyle]="{'background-color':get_Accent()}"
                                *ngIf="heritage.subTypes.length" id="{{heritage.name}}"
                                (click)="toggle_Item(heritage.name+'desc')">v</button>
                            <label for="{{heritage.name}}">
                                <strong>{{heritage.name}}</strong>
                            </label>
                        </span>
                        <button [ngStyle]="{'background-color':get_Accent()}"
                            (click)="toggle_Item(heritage.name+'desc')">
                            Show Description
                        </button>
                        <div class="row lower" *ngIf="this.get_showItem()==heritage.name+'desc'">
                            <!--Subheritages-->
                            <div class="list-item" *ngFor="let subheritage of heritage.subTypes">
                                <span>
                                    <input id="{{subheritage.name}}" type="checkbox"
                                        (change)="onHeritageChange(subheritage, $event.target.checked)"
                                        [checked]="subheritage.name === get_Character().class.heritage.name">
                                    <label for="{{subheritage.name}}">
                                        <strong>{{subheritage.subType}}</strong>
                                    </label>
                                </span>
                            </div>
                            <!--End Subheritages-->
                            <div class="row left-aligned">
                                <ng-container *ngFor="let desc of heritage.desc.split('\n\n')">
                                    <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                    <ul *ngIf="desc.split('\n').length > 1">
                                        <li *ngFor="let line of desc.split('\n')">{{line}}</li>
                                    </ul>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
        <!--Languages-->
        <div class="list-item" *ngIf="get_LanguagesAvailable()">
            <button class="row sublist-toggle" (mouseover)="hover = 'languages'" (mouseout)="hover = ''"
                [ngStyle]="(get_AvailableLanguages() == 0) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                [className]="(get_AvailableLanguages() == 0) ? 'fancy-button' : ''" (click)="toggle_List('languages')">
                Languages
            </button>
            <div class="list-item sublist"
                [ngStyle]="(get_AvailableLanguages() == 0) ? {} : {'border-color':get_Accent('languages')}"
                [className]="(get_AvailableLanguages() == 0) ? 'fancy-list' : ''" *ngIf="get_showList()=='languages'">
                <div class="row left-aligned">
                    <strong *ngIf="get_Character().class.ancestry.recommendedLanguages.length">Recommended
                        Languages&nbsp;</strong>{{get_Character().class.ancestry.recommendedLanguages.join(', ')}}
                </div>
                <div class="list-item"
                    *ngFor="let language of get_Character().class.ancestry.languages; let index = index; trackBy:trackByIndex;">
                    <input class="row" type="text" [(ngModel)]="get_Character().class.ancestry.languages[index]"
                        (blur)="set_Changed()">
                </div>
            </div>
        </div>
        <!--Available Ancestry Feats-->
        <div class="list-item" *ngIf="get_Character().class.ancestry.name">
            <strong>Available Ancestry Feats</strong>
            <div class="row left-aligned" *ngIf="get_Character().class.ancestry.ancestries.length">
                <cite class="trait"
                    *ngFor="let trait of get_Character().class.ancestry.ancestries">{{trait}}&nbsp;</cite>
            </div>
        </div>
        <!--Background-->
        <ng-container *ngIf="get_Character().class.name">
            <div class="list-item" [className]="(get_Character().class.background.name) ? 'fullsize-only' : ''"
                *ngFor="let listID of ['background']">
                <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                    [ngStyle]="(get_Character().class.background.name) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                    [className]="((get_Character().class.background.name)) ? 'fancy-button' : ''"
                    (click)="toggle_List(listID)">
                    Background{{(get_Character().class.background.name) ? ": "+ get_Character().class.background.name : ""}}
                </button>
                <div class="list-item sublist"
                    [ngStyle]="(get_Character().class.background.name) ? {} : {'border-color':get_Accent(listID)}"
                    [className]="((get_Character().class.background.name)) ? 'fancy-list' : ''"
                    *ngIf="get_showList()==listID">
                    <ng-container *ngFor="let background of get_Backgrounds()">
                        <div class="row" class="list-item" *ngFor="let itemID of ['background'+background.name]">
                            <span>
                                <input *ngIf="!background.subTypes.length" id="{{background.name}}" type="checkbox"
                                    (change)="onBackgroundChange(background, $event.target.checked)"
                                    [checked]="background.name === get_Character().class.background.name">
                                <button class="lower left" [ngStyle]="{'background-color':get_Accent()}"
                                    *ngIf="background.subTypes.length" id="{{background.name}}"
                                    (click)="toggle_Item(itemID)">v</button>
                                <label for="{{background.name}}">
                                    <strong>{{background.name}}</strong>
                                </label>
                            </span>
                            <button [ngStyle]="{'background-color':get_Accent()}" (click)="toggle_Item(itemID)">
                                Show Description
                            </button>
                            <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                <!--Subbackgrounds-->
                                <div class="list-item" *ngFor="let subbackground of background.subTypes">
                                    <span>
                                        <input id="{{subbackground.name}}" type="checkbox"
                                            (change)="onBackgroundChange(subbackground, $event.target.checked)"
                                            [checked]="subbackground.name === get_Character().class.background.name">
                                        <label for="{{subbackground.name}}">
                                            <strong>{{subbackground.subType}}</strong>
                                        </label>
                                    </span>
                                </div>
                                <!--End Subbackgrounds-->
                                <div class="row left-aligned">
                                    <ng-container *ngFor="let desc of background.desc.split('\n\n')">
                                        <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                        <ul *ngIf="desc.split('\n').length > 1">
                                            <li *ngFor="let line of desc.split('\n')">{{line}}</li>
                                        </ul>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </ng-container>
        <!--Deity-->
        <ng-container *ngIf="get_Character().class.name">
            <div class="list-item" [className]="(get_Character().deity) ? 'fullsize-only' : ''"
                *ngFor="let listID of ['deity']">
                <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                    [ngStyle]="(get_Character().deity.name) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                    [className]="((get_Character().deity.name)) ? 'fancy-button' : ''" (click)="toggle_List(listID)">
                    Deity{{(get_Character().deity.name) ? ": "+ get_Character().deity.name : ""}}
                </button>
                <div class="list-item sublist"
                    [ngStyle]="(get_Character().deity.name) ? {} : {'border-color':get_Accent(listID)}"
                    [className]="((get_Character().deity.name)) ? 'fancy-list' : ''" *ngIf="get_showList()==listID">
                    <ng-container *ngFor="let deity of get_Deities()">
                        <div class="row" class="list-item" *ngFor="let itemID of ['deity'+deity.name]">
                            <span>
                                <input id="{{deity.name}}" type="checkbox"
                                    (change)="on_DeityChange(deity, $event.target.checked)"
                                    [checked]="deity.name === get_Character().deity.name">
                                <label for="{{deity.name}}">
                                    <strong>{{deity.name}} ({{deity.alignment}})</strong>
                                </label>
                            </span>
                            <button [ngStyle]="{'background-color':get_Accent()}" (click)="toggle_Item(itemID)">
                                Show Description
                            </button>
                            <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                <div class="row left-aligned">
                                    <strong>Follower Alignments&nbsp;</strong>{{deity.followerAlignments.join(", ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Divine Ability&nbsp;</strong>{{deity.divineAbility.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Divine Font&nbsp;</strong>{{deity.divineFont.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Divine Skill&nbsp;</strong>{{deity.divineSkill.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Favored Weapon&nbsp;</strong>{{deity.favoredWeapon.join(" or ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Domains&nbsp;</strong>{{deity.domains.join(", ")}}
                                </div>
                                <div class="row left-aligned">
                                    <strong>Cleric Spells</strong>
                                </div>
                                <div class="row left-aligned" *ngFor="let spell of deity.clericSpells">
                                    <strong>Level
                                        {{spell.level}}&nbsp;</strong>{{spell.spell}}{{(spell.note ? "("+spell.note+")" : "")}}
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </ng-container>
        <!--Levels-->
        <ng-container *ngIf="get_Character().class">
            <ng-container *ngFor="let level of get_Character().class.levels">
                <h3 *ngIf="level.number > 0">Level {{level.number}}</h3>
                <!--Fixed information-->
                <ng-container *ngIf="level.number > 0">
                    <div class="fullsize-only list-item" *ngFor="let listID of ['showFixedChanges'+level.number]">
                        <button class="row sublist-toggle fancy-button" [ngStyle]="{'color':get_Accent()}"
                            (click)="toggle_List(listID)">
                            Show fixed changes
                        </button>
                        <div class="list-item sublist fancy-list" *ngIf="get_showList()==listID">
                            <!--Fixed Ability boosts-->
                            <div class="list-item"
                                *ngFor="let boost of get_AbilityBoosts(level.number, level.number, '', '', '', '', true)">
                                Ability {{(boost.type == 'Flaw') ? 'Flaw' : 'Boost'}} ({{boost.source}}): {{boost.name}}
                            </div>
                            <!--Fixed Skill Increases-->
                            <div class="list-item"
                                *ngFor="let skillIncrease of get_SkillIncreases(level.number, level.number, '', '', '', true)">
                                {{(skillIncrease.name.indexOf("Lore:") > -1) ? "Lore " : ""}}Skill Training
                                ({{skillIncrease.source}}): {{skillIncrease.name}}
                            </div>
                            <!--Fixed Feats-->
                            <div title="{{get_FeatsAndFeatures(feat.name)[0].desc}}" class="list-item"
                                *ngFor="let feat of get_FeatsTaken(level.number, level.number, '', '', '', true)">
                                Feat ({{feat.source}}): {{feat.name}}
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Different Worlds-->
                <ng-container *ngFor="let feat of get_DifferentWorldsFeat(level.number)">
                    <!--Different Worlds Name-->
                    <div class="list-item" [className]="(feat.data.name != '') ? 'fullsize-only' : ''"
                        *ngFor="let listID of ['differentWorlds_Name']">
                        <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                            [ngStyle]="(feat.data.name != '') ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                            [className]="(feat.data.name != '') ? 'fancy-button' : ''" (click)="toggle_List(listID)">
                            Alternative Name (Different Worlds){{(feat.data.name) ? ": "+ feat.data.name : ""}}
                        </button>
                        <div class="list-item sublist"
                            [ngStyle]="(feat.data.name) ? {} : {'border-color':get_Accent(listID)}"
                            [className]="(feat.data.name != '') ? 'fancy-list' : ''" *ngIf="get_showList()==listID">
                            <div class="list-item">
                                <strong>Name:
                                    <input type="text" [(ngModel)]="feat.data.name"
                                        (blur)=this.characterService.set_Changed() maxLength="30">
                                </strong>
                            </div>
                        </div>
                    </div>
                    <!--Different Worlds Background-->
                    <div class="list-item" [className]="(feat.data.background != '') ? 'fullsize-only' : ''"
                        *ngFor="let listID of ['differentWorlds_Background']">
                        <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                            [ngStyle]="(feat.data.background) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                            [className]="(feat.data.background) ? 'fancy-button' : ''" (click)="toggle_List(listID)">
                            Alternative Background (Different
                            Worlds){{(feat.data.background) ? ": "+ feat.data.background : ""}}
                        </button>
                        <div class="list-item sublist"
                            [ngStyle]="(feat.data.background) ? {} : {'border-color':get_Accent(listID)}"
                            [className]="((feat.data.background)) ? 'fancy-list' : ''" *ngIf="get_showList()==listID">
                            <div class="list-item" *ngFor="let background of get_Backgrounds()">
                                <div class="row" *ngFor="let itemID of ['differentWorlds_Background'+background.name]">
                                    <span>
                                        <input *ngIf="!background.subTypes.length" id="{{background.name}}"
                                            type="checkbox"
                                            (change)="onDifferentWorldsBackgroundChange(level, feat, background, $event.target.checked)"
                                            [checked]="background.name === feat.data.background || background.name === get_Character().class.background.name"
                                            [disabled]="background.name === get_Character().class.background.name">
                                        <button class="lower left" [ngStyle]="{'background-color':get_Accent()}"
                                            *ngIf="background.subTypes.length" id="{{background.name}}"
                                            (click)="toggle_Item(itemID)">v</button>
                                        <label for="{{background.name}}">
                                            <strong>{{background.name}}</strong>
                                        </label>
                                    </span>
                                    <button [ngStyle]="{'background-color':get_Accent()}" (click)="toggle_Item(itemID)">
                                        Show Description
                                    </button>
                                    <div class="row lower" *ngIf="this.get_showItem()==itemID">
                                        <!--Subbackgrounds-->
                                        <div class="list-item" *ngFor="let subbackground of background.subTypes">
                                            <span>
                                                <input id="{{subbackground.name}}" type="checkbox"
                                                    (change)="onDifferentWorldsBackgroundChange(level, feat, subbackground, $event.target.checked)"
                                                    [checked]="subbackground.name === feat.data.background || subbackground.name === get_Character().class.background.name"
                                                    [disabled]="subbackground.name === get_Character().class.background.name || subbackground.superType == get_Character().class.background.superType">
                                                <label for="{{subbackground.name}}">
                                                    <strong>{{subbackground.subType}}</strong>
                                                </label>
                                            </span>
                                        </div>
                                        <!--End Subbackgrounds-->
                                        <div class="row left-aligned">
                                            <ng-container *ngFor="let desc of background.desc.split('\n\n')">
                                                <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n')">{{line}}</li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Ability boosts-->
                <ng-container *ngFor="let choice of level.abilityChoices">
                    <ng-container *ngFor="let listID of [choice.id]">
                        <div class="list-item" *ngIf="get_MaxAvailable(choice)"
                            [className]="((choice.boosts.length > get_MaxAvailable(choice) || someAbilitiesIllegal(choice)) ? 'problem' : '') +' '+ ((choice.boosts.length == get_MaxAvailable(choice)) ? 'fullsize-only' : '')">
                            <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                                [ngStyle]="(choice.boosts.length == get_MaxAvailable(choice)) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                                [className]="(choice.boosts.length == get_MaxAvailable(choice)) ? 'fancy-button' : ''"
                                (click)="toggle_List(listID)">
                                Ability Boosts
                                ({{choice.source}}){{(get_MaxAvailable(choice) > 1) ?
                                    ": "+ choice.boosts.length + "/" + (get_MaxAvailable(choice)) :
                                    (choice.boosts.length) ? ": "+ choice.boosts[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngStyle]="(choice.boosts.length == get_MaxAvailable(choice)) ? {} : {'border-color':get_Accent(listID)}"
                                [className]="(choice.boosts.length == get_MaxAvailable(choice)) ? 'fancy-list' : ''"
                                *ngIf="get_showList()==listID">
                                <div class="list-item" *ngFor="let ability of get_AvailableAbilities(choice)"
                                    [className]="(abilityIllegal(level.number, ability)) ? 'problem' : ''">
                                    <div class="row" *ngFor="let itemID of [choice.id+ability.name]">
                                        <span>
                                            <input id="{{itemID}}" type="checkbox"
                                                (change)="on_AbilityBoost(ability.name, $event.target.checked, choice, false)"
                                                [checked]="get_AbilityBoosts(level.number, level.number, ability.name, 'Boost', choice.source).length"
                                                [disabled]="cannotBoost(ability, level, choice).length">
                                            <label for="{{itemID}}">
                                                <strong>{{ability.name}}:</strong>
                                                {{ability.baseValue(this.characterService, level.number)}}&nbsp;
                                                <cite class="problem"
                                                    *ngFor="let reason of cannotBoost(ability, level, choice)">
                                                    {{reason}}
                                                </cite>
                                                <cite class="problem" *ngIf="abilityIllegal(level.number, ability)">
                                                    Abilities cannot be raised above 18 on level 1!&nbsp;
                                                </cite>
                                            </label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!--Skill Increases-->
                <ng-container *ngFor="let choice of level.skillChoices">
                    <ng-container *ngFor="let listID of [choice.id]">
                        <div class="list-item" *ngIf="choice.available"
                            [className]="((choice.increases.length > choice.available + get_SkillINTBonus(choice) || someIllegal(choice)) ? 'problem' : '') +' '+ ((choice.increases.length == choice.available + get_SkillINTBonus(choice)) ? 'fullsize-only' : '')">
                            <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                                [ngStyle]="(choice.increases.length == choice.available + get_SkillINTBonus(choice)) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                                [className]="(choice.increases.length == choice.available + get_SkillINTBonus(choice)) ? 'fancy-button' : ''"
                                (click)="toggle_List(listID)">
                                Skill Training
                                ({{choice.source}}){{(choice.available + get_SkillINTBonus(choice) > 1) ?
                                    (": "+ choice.increases.length +"/"+ (choice.available + get_SkillINTBonus(choice)) ) : 
                                    (choice.increases.length) ? ": "+ choice.increases[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngStyle]="(choice.available + get_SkillINTBonus(choice) == choice.increases.length) ? {} : {'border-color':get_Accent(listID)}"
                                [className]="(choice.available + get_SkillINTBonus(choice) == choice.increases.length) ? 'fancy-list' : ''"
                                *ngIf="get_showList()==listID">
                                <div class="list-item"
                                    *ngFor="let skill of get_AvailableSkills(choice)|sortBy:'asc':'name'"
                                    [className]="(!skill.isLegal(this.characterService, level.number) ||
                                        (!skill.isLegal(this.characterService, level.number, choice.maxRank) && skillIncreasedByThis(skill, choice))) ? 'problem' : ''">
                                    <div class="row" *ngFor="let itemID of [choice.id+skill.name]">
                                        <span>
                                            <input id="{{itemID}}" type="checkbox"
                                                (change)="on_SkillIncrease(skill.name, $event.target.checked, choice, false)"
                                                [checked]="skillIncreasedByThis(skill, choice)"
                                                [disabled]="cannotIncrease(skill, level, choice).length && !skillIncreasedByThis(skill, choice)">
                                            <label for="{{itemID}}">
                                                <strong>{{skill.name}}:</strong>
                                                <app-proficiency-form [skill]="skill"
                                                    [characterService]="this.characterService" [level]="level.number">
                                                </app-proficiency-form>
                                                <cite class="problem"
                                                    *ngFor="let reason of cannotIncrease(skill, level, choice)">
                                                    {{reason}}
                                                </cite>
                                                <cite class="problem"
                                                    *ngIf="!skill.isLegal(this.characterService, level.number) || (!skill.isLegal(this.characterService, level.number, choice.maxRank) && skillIncreasedByThis(skill, choice))">
                                                    This skill was raised higher than allowed!
                                                </cite>
                                            </label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!--Tradition Choices-->
                <ng-container *ngFor="let choice of level.traditionChoices">
                    <ng-container *ngIf="choice.abilityAvailable">
                        <ng-container *ngFor="let listID of [choice.id+'ability']">
                            <div class="list-item" [className]="(choice.ability ? 'fullsize-only' : '')">
                                <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                                    [ngStyle]="choice.ability ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                                    [className]="choice.ability ? 'fancy-button' : ''" (click)="toggle_List(listID)">
                                    {{choice.source}} Key Ability
                                    {{(choice.ability) ? ": "+ choice.ability : ""}}
                                </button>
                                <div class="list-item sublist"
                                    [ngStyle]="choice.ability ? {} : {'border-color':get_Accent(listID)}"
                                    [className]="choice.ability ? 'fancy-list' : ''" *ngIf="get_showList()==listID">
                                    <div class="list-item"
                                        *ngFor="let ability of get_AvailableTraditionAbilities(choice)">
                                        <div class="row" *ngFor="let itemID of [choice.id+'ability'+ability]">
                                            <span>
                                                <input id="{{itemID}}" type="checkbox"
                                                    (change)="on_TraditionChoice('ability', ability, choice.tradition, $event.target.checked, choice, false)"
                                                    [checked]="ability == choice.ability"
                                                    [disabled]="choice.ability && ability != choice.ability">
                                                <label for="{{itemID}}">
                                                    <strong>{{ability}}</strong>
                                                </label>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngIf="choice.traditionAvailable">
                        <ng-container *ngFor="let listID of [choice.id+'tradition']">
                            <div class="list-item" [className]="(choice.tradition ? 'fullsize-only' : '')">
                                <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                                    [ngStyle]="choice.tradition ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                                    [className]="choice.tradition ? 'fancy-button' : ''" (click)="toggle_List(listID)">
                                    {{choice.source}} Tradition{{(choice.tradition) ? ": "+ choice.tradition : ""}}
                                </button>
                                <div class="list-item sublist"
                                    [ngStyle]="choice.tradition ? {} : {'border-color':get_Accent(listID)}"
                                    [className]="choice.tradition ? 'fancy-list' : ''" *ngIf="get_showList()==listID">
                                    <div class="list-item" *ngFor="let tradition of get_AvailableTraditions(choice)">
                                        <div class="row" *ngFor="let itemID of [choice.id+'tradition'+tradition]">
                                            <span>
                                                <input id="{{itemID}}" type="checkbox"
                                                    (change)="on_TraditionChoice('tradition', choice.ability, tradition, $event.target.checked, choice, false)"
                                                    [checked]="tradition == choice.tradition"
                                                    [disabled]="choice.tradition && tradition != choice.tradition">
                                                <label for="{{itemID}}">
                                                    <strong>{{tradition}}</strong>
                                                </label>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
                <!--Lore Training-->
                <ng-container *ngFor="let choice of level.loreChoices">
                    <ng-container *ngFor="let listID of [choice.id]">
                        <div class="list-item" *ngIf="choice.available"
                            [className]="((choice.increases.length > choice.available) ? 'problem' : '') +' '+ ((choice.available == choice.increases.length) ? 'fullsize-only' : '')">
                            <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                                [ngStyle]="(choice.available == choice.increases.length) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                                [className]="(choice.available == choice.increases.length) ? 'fancy-button' : ''"
                                (click)="toggle_List(listID)">
                                Lore Training
                                ({{choice.source}}){{(choice.increases.length) ? ": "+ choice.increases[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngStyle]="(choice.available == choice.increases.length) ? {} : {'border-color':get_Accent(listID)}"
                                [className]="(choice.available == choice.increases.length) ? 'fancy-list' : ''"
                                *ngIf="get_showList()==listID">
                                <div class="list-item" *ngFor="let itemID of [choice.id+'LoreIncreaseBox']">
                                    <span>
                                        <input id="{{itemID}}" type="checkbox"
                                            (change)="on_LoreChange($event.target.checked, choice)"
                                            [checked]="get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length"
                                            [disabled]="choice.loreName == '' || get_Skills('Lore: '+choice.loreName).length && !get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length">
                                        <label style="display:initial" for="{{itemID}}">
                                            <strong>Lore:
                                                <input type="text" [(ngModel)]="choice.loreName"
                                                    [disabled]="get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length"
                                                    (blur)=this.characterService.set_Changed() maxLength="20">
                                            </strong>
                                        </label>
                                        <cite class="problem"
                                            *ngIf="get_Skills('Lore: '+choice.loreName).length && !get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length">
                                            You are already trained in this Lore!
                                        </cite>
                                    </span>
                                    <div class="row">
                                        {{choice.loreDesc}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!--Feat choices-->
                <ng-container *ngFor="let choice of level.featChoices">
                    <ng-container *ngFor="let listID of [choice.source+choice.id]">
                        <div class="list-item" *ngIf="choice.available"
                            [className]="((choice.feats.length > choice.available || cannotTakeSome(choice)) ? 'problem' : '') +' '+ ((choice.available == choice.feats.length) ? 'fullsize-only' : '')">
                            <button class="row sublist-toggle" (mouseover)="hover = listID" (mouseout)="hover = ''"
                                [ngStyle]="(choice.available == choice.feats.length) ? {'color':get_Accent()} : {'background-color':get_Accent()}"
                                [className]="(choice.available == choice.feats.length) ? 'fancy-button' : ''"
                                (click)="toggle_List(listID)">
                                {{(choice.level) ? "Level "+choice.level+" " : ""}}{{choice.type}} Feats
                                ({{choice.source}}){{(choice.available > 1) ?
                                    ": "+ choice.feats.length +"/"+ choice.available : 
                                    (choice.feats.length) ? ": "+ choice.feats[0].name : ""}}
                            </button>
                            <div class="list-item sublist"
                                [ngStyle]="(choice.available == choice.feats.length) ? {} : {'border-color':get_Accent(listID)}"
                                [className]="(choice.available == choice.feats.length ) ? 'fancy-list' : ''"
                                *ngIf="get_showList()==listID">
                                <div title="{{(this.get_showItem()==choice.id+feat.name+'desc') ? '' : feat.shortDesc}}"
                                    class="list-item" *ngFor="let feat of get_AvailableFeats(choice)"
                                    [className]="(cannotTake(feat, choice).length) ? 'problem' : ''">
                                    <div class="row" *ngFor="let itemID of [choice.id+feat.name+'desc']">
                                        <span style="flex-grow:2">
                                            <input *ngIf="!feat.subTypes" id="{{choice.id+feat.name}}" type="checkbox"
                                                (change)="on_FeatTaken(feat.name, $event.target.checked, choice, false)"
                                                [checked]="featTakenByThis(feat, choice)"
                                                [disabled]="cannotTake(feat, choice).length && !featTakenByThis(feat, choice)">
                                            <button class="lower left" [ngStyle]="{'background-color':get_Accent()}"
                                                *ngIf="feat.subTypes" id="{{choice.id+feat.name}}"
                                                (click)="toggle_Item(itemID)">v</button>
                                            <label for="{{choice.id+feat.name}}">
                                                <strong>{{feat.name}}&nbsp;</strong><cite>Level {{feat.levelreq}}</cite>
                                            </label>
                                            <cite class="problem" *ngFor="let reason of cannotTake(feat, choice)">
                                                {{reason}}
                                            </cite>
                                        </span>
                                        <button (mouseover)="hover = itemID" (mouseout)="hover = ''"
                                            [ngStyle]="{'background-color':get_Accent()}" (click)="toggle_Item(itemID)">
                                            Show Description
                                        </button>
                                        <div class="row lower left-aligned" *ngIf="this.get_showItem()==itemID">
                                            <!--Subfeats-->
                                            <div class="list-item" *ngFor="let subfeat of get_SubFeats(feat, choice)"
                                                [className]="(cannotTake(subfeat, choice).length) ? 'problem' : ''">
                                                <span>
                                                    <input id="{{choice.id+subfeat.name}}" type="checkbox"
                                                        (change)="on_FeatTaken(subfeat.name, $event.target.checked, choice, false)"
                                                        [checked]="featTakenByThis(subfeat, choice)"
                                                        [disabled]="cannotTake(subfeat, choice).length && !featTakenByThis(subfeat, choice)">
                                                    <label for="{{choice.id+subfeat.name}}">
                                                        <strong>{{subfeat.subType}}&nbsp;</strong>
                                                        <span [className]="(req.met == false) ? 'problem' : ''"
                                                            *ngFor="let req of get_FeatRequirements(choice, subfeat, feat)">{{(req.desc == ", ") ? req.desc : "&nbsp;"+req.desc }}</span>
                                                        <cite class="problem"
                                                            *ngFor="let reason of cannotTake(subfeat, choice)">
                                                            {{reason}}
                                                        </cite>
                                                    </label>
                                                </span>
                                            </div>
                                            <!--Unavailable Subfeats-->
                                            <div class="list-item unavailable"
                                                *ngFor="let subfeat of get_SubFeats(feat, choice, true)">
                                                <span>
                                                    <strong>{{subfeat.subType}}&nbsp;</strong>
                                                    <span [className]="(req.met == false) ? 'problem' : ''"
                                                        *ngFor="let req of get_FeatRequirements(choice, subfeat, feat)">{{(req.desc == ", ") ? req.desc : "&nbsp;"+req.desc }}</span>
                                                </span>
                                                <span>
                                                    <cite class="problem"
                                                        *ngFor="let reason of cannotTake(subfeat, choice)">
                                                        {{reason}}
                                                    </cite>
                                                </span>
                                            </div>
                                            <!--End Subfeats-->
                                            <div class="row left-aligned">
                                                <cite class="trait" *ngFor="let trait of feat.traits">
                                                    {{trait}}
                                                </cite>
                                            </div>
                                            <div class="row left-aligned">
                                                <p>
                                                    <strong>Requirements&nbsp;</strong>
                                                    <span [className]="(req.met == false) ? 'problem' : ''"
                                                        *ngFor="let req of get_FeatRequirements(choice, feat)">{{req.desc}}</span>
                                                </p>
                                                <ng-container *ngFor="let desc of feat.desc.split('\n\n')">
                                                    <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                    <ul *ngIf="desc.split('\n').length > 1">
                                                        <li *ngFor="let line of desc.split('\n')">{{line}}</li>
                                                    </ul>
                                                </ng-container>
                                                <p *ngIf="feat.specialdesc.length">
                                                    <strong>Special</strong>
                                                    {{feat.specialdesc}}
                                                </p>
                                            </div>
                                            <ng-container *ngFor="let name of feat.gainActivities">
                                                <div class="row left-aligned"
                                                    *ngFor="let activity of get_Activities(name)">
                                                    <h4>{{activity.name}}
                                                        {{activity.get_Actions()}}{{(activity.activationType) ? " - " + activity.activationType : ""}}
                                                    </h4>
                                                    <app-activity class="row" [activity]=activity [allowActivate]=false>
                                                    </app-activity>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                                <!--UnavailableFeats-->
                                <div class="list-item unavailable"
                                    title="{{(this.get_showItem()==choice.id+feat.name+'desc') ? '' : feat.shortDesc}}"
                                    *ngFor="let feat of get_AvailableFeats(choice, true)">
                                    <div class="row" *ngFor="let itemID of [choice.id+feat.name+'desc']">
                                        <span>
                                            <strong>{{feat.name}}&nbsp;</strong><cite>Level {{feat.levelreq}}</cite>
                                        </span>
                                        <span>
                                            <cite class="problem" *ngFor="let reason of cannotTake(feat, choice)">
                                                {{reason}}
                                            </cite>
                                        </span>
                                        <button (mouseover)="hover = itemID" (mouseout)="hover = ''"
                                            [ngStyle]="{'background-color':get_Accent()}" (click)="toggle_Item(itemID)">
                                            Show Description
                                        </button>
                                        <div class="row lower left-aligned" *ngIf="this.get_showItem()==itemID">
                                            <!--Subfeats-->
                                            <div class="list-item unavailable"
                                                *ngFor="let subfeat of get_SubFeats(feat, choice)">
                                                <span>
                                                    <strong>{{subfeat.subType}}&nbsp;</strong>
                                                    <span [className]="(req.met == false) ? 'problem' : ''"
                                                        *ngFor="let req of get_FeatRequirements(choice, subfeat, feat)">{{(req.desc == ", ") ? req.desc : "&nbsp;"+req.desc }}</span>
                                                </span>
                                                <span>
                                                    <cite class="problem"
                                                        *ngFor="let reason of cannotTake(subfeat, choice)">
                                                        {{reason}}
                                                    </cite>
                                                </span>
                                            </div>
                                            <!--Unavailable Subfeats-->
                                            <div class="list-item unavailable"
                                                *ngFor="let subfeat of get_SubFeats(feat, choice, true)">
                                                <span>
                                                    <strong>{{subfeat.subType}}&nbsp;</strong>
                                                    <span [className]="(req.met == false) ? 'problem' : ''"
                                                        *ngFor="let req of get_FeatRequirements(choice, subfeat, feat)">{{(req.desc == ", ") ? req.desc : "&nbsp;"+req.desc }}</span>
                                                </span>
                                                <span>
                                                    <cite class="problem"
                                                        *ngFor="let reason of cannotTake(subfeat, choice)">
                                                        {{reason}}
                                                    </cite>
                                                </span>
                                            </div>
                                            <!--End Subfeats-->
                                            <div class="row left-aligned">
                                                <cite class="trait" *ngFor="let trait of feat.traits">
                                                    {{trait}}
                                                </cite>
                                            </div>
                                            <div class="row left-aligned">
                                                <p>
                                                    <strong>Requirements&nbsp;</strong>
                                                    <span [className]="(req.met == false) ? 'problem' : ''"
                                                        *ngFor="let req of get_FeatRequirements(choice, feat)">{{req.desc}}</span>
                                                </p>
                                                <ng-container *ngFor="let desc of feat.desc.split('\n\n')">
                                                    <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                    <ul *ngIf="desc.split('\n').length > 1">
                                                        <li *ngFor="let line of desc.split('\n')">{{line}}</li>
                                                    </ul>
                                                </ng-container>
                                                <p *ngIf="feat.specialdesc.length">
                                                    <strong>Special</strong>
                                                    {{feat.specialdesc}}
                                                </p>
                                            </div>
                                            <ng-container *ngFor="let name of feat.gainActivities">
                                                <ng-container *ngFor="let activity of get_Activities(name)">
                                                    <h4>{{activity.name}}
                                                        {{activity.get_Actions()}}{{(activity.activationType) ? " - " + activity.activationType : ""}}
                                                    </h4>
                                                    <app-activity class="row" [activity]=activity [allowActivate]=false>
                                                    </app-activity>
                                                </ng-container>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </ng-container>
        </ng-container>
    </ng-container>
</div>