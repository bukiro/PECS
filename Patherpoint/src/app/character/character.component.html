<div class="window-button-container">
    <button class="minimizebutton lower"
        [ngbTooltip]="get_Minimized() ? 'Click to show all choices and information.' : 'Click to hide finished choices and show compact information.'"
        [ngClass]="{'fancy-button':get_Minimized()}" (click)="minimize()">
        <i class='bi-arrows-collapse' *ngIf="get_Minimized()"></i>
        <i class='bi-arrows-expand' *ngIf="!get_Minimized()"></i>
    </button>
    <button class="tilemodebutton" [ngClass]="{'fancy-button':get_TileMode()}" (click)="toggle_TileMode()"
        [ngbTooltip]="get_TileMode() ? 'Click to enable list layout' : 'Click to enable tiled layout'">
        <!--Content is css only-->
        <div>
            <div> </div>
            <div> </div>
            <div> </div>
            <div> </div>
        </div>
    </button>
</div>
<div id="character-height" class="itembox">
    <button class="list-item center-aligned" (click)="toggleCharacterMenu()">
        <header class="sectionHeader">Close</header>
    </button>
    <div class="charactersheet-column-container">
        <div class="charactersheet-column">
            <div class="itembox-inner">
                <div class="loading" *ngIf="still_loading()">Loading</div>
                <!--Management list mode-->
                <ng-container *ngIf="!get_TileMode()">
                    <div class="list-item">
                        <button class="newrow" (click)="on_NewCharacter()">
                            New Character
                        </button>
                    </div>
                    <div class="list-item">
                        <button class="newrow" (click)="toggle_List('load')"
                            [ngClass]="{'activechoice':get_ShowList()=='load'}">
                            Load Character
                        </button>
                    </div>
                    <div class="list-item" [ngbTooltip]="!get_Savegames() ? 'Database connection failed.' : ''">
                        <button class="newrow" (click)="save_CharacterToDB()" *ngIf="!still_loading()"
                            [disabled]="!get_Savegames() || get_IsBlankCharacter()">
                            Save Character
                        </button>
                    </div>
                    <div class="list-item">
                        <button class="newrow" (click)="toggle_List('settings')"
                            [ngClass]="{'activechoice':get_ShowList()=='settings'}">
                            Settings
                        </button>
                    </div>
                </ng-container>
                <!--Management tile mode-->
                <div class="newrow list-item" *ngIf="get_TileMode()">
                    <div class="icon-list">
                        <button (click)="on_NewCharacter()">
                            <app-gridIcon [ngbTooltip]="'New Character'" [title]="'N E W'">
                            </app-gridIcon>
                        </button>
                        <button class="sublist-toggle" (click)="toggle_List('load')"
                            [ngClass]="{'activechoice':get_ShowList()=='load'}">
                            <app-gridIcon [ngbTooltip]="'Load Character'" [title]="'L O A D'">
                            </app-gridIcon>
                        </button>
                        <button (click)="save_CharacterToDB()" *ngIf="!still_loading()"
                            [disabled]="!get_Savegames() || get_IsBlankCharacter()">
                            <app-gridIcon
                                [ngbTooltip]="!get_Savegames() ? 'Database connection failed.' : (get_IsBlankCharacter() ? 'No changes to character yet.' : 'Save Character')"
                                [title]="'S A V E'">
                            </app-gridIcon>
                        </button>
                        <button (click)="toggle_List('settings')"
                            [ngClass]="{'activechoice':get_ShowList()=='settings'}">
                            <app-gridIcon [ngbTooltip]="'Settings'" [title]="'C O N F'">
                            </app-gridIcon>
                        </button>
                    </div>
                </div>
                <ng-container *ngIf="!still_loading() && get_CharacterMenuState() == 'in'">
                    <div class="list-item">
                        <strong>Experience Points</strong>
                        <span>
                            <button (click)="on_LevelUp()"
                                *ngIf="get_Character().experiencePoints >= 1000 && get_Character().level < 20">Level
                                Up</button>
                            <input type="number" class="number4" id="experiencePoints"
                                [(ngModel)]="get_Character().experiencePoints" (keypress)="numbersOnly($event)"
                                maxLength="4"
                                [ngbTooltip]="(get_Character().experiencePoints >= 1000 && get_Character().level < 20) ? 'You are ready to level up!' : ''"
                                [ngClass]="{'bonus':(get_Character().experiencePoints >= 1000 && get_Character().level < 20)}">
                        </span>
                    </div>
                    <div class="list-item" *ngFor="let oldLevel of [get_Character().level]; trackBy:trackByIndex;">
                        <strong>
                            Level
                        </strong>
                        <span>
                            <select [(ngModel)]="get_Character().level" (ngModelChange)="on_LevelChange(oldLevel)">
                                <option
                                    *ngFor="let level of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; trackBy:trackByIndex;"
                                    [ngValue]="level">
                                    {{level}}
                                </option>
                            </select>
                        </span>
                    </div>
                    <header class="subsectionHeader">Show Level</header>
                    <!--Level selection-->
                    <div class="list-item">
                        <div id="levelBox" class="fullwidth levelBoxTop">
                            <button class="center-aligned" (click)="toggle_Level(0)"
                                [ngClass]="{'fancy-button':get_ShowLevel()==0}">Everything</button>
                            <button class="center-aligned" (click)="toggle_Level(-1)"
                                [ngClass]="{'fancy-button':get_ShowLevel()==-1}">History</button>
                        </div>
                        <div id="levelBox" class="fullwidth">
                            <button class="center-aligned"
                                *ngFor="let levelNumber of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; trackBy:trackByIndex;"
                                (click)="toggle_Level(levelNumber)" [disabled]="!get_Character().class.name"
                                [ngClass]="{'fancy-button':get_ShowLevel()==levelNumber}">{{levelNumber}}</button>
                        </div>
                    </div>
                    <app-tags [creature]="'Character'" [objectName]="'Character'" [showTraits]=true [showFeats]=true
                        [showItems]=true [showActivities]=true [showConditions]=true></app-tags>
                    <div [ngClass]="{'invisible':get_ShowLevel() > 0}">
                        <header class="sectionHeader">History</header>
                        <div class="list-item">
                            <strong>Name</strong>
                            <span>
                                <input type="text" id="charactername" [(ngModel)]="get_Character().name"
                                    (blur)="on_NameChange()" maxLength="100">
                            </span>
                        </div>
                        <div class="list-item">
                            <div class="newrow">
                                <strong>Party name</strong>
                                <span>
                                    <input type="text" id="partyname" [(ngModel)]="get_Character().partyName"
                                        maxLength="100">
                                </span>
                            </div>
                            <div class="newrow">
                                <span></span>
                                <span>
                                    <select [(ngModel)]="get_Character().partyName">
                                        <option *ngFor="let partyName of get_Parties(); trackBy:trackByIndex;"
                                            [ngValue]="partyName">
                                            {{partyName}}
                                        </option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        <div class="list-item">
                            <strong>
                                Alignment
                            </strong>
                            <span>
                                <select [(ngModel)]="get_Character().alignment" (ngModelChange)="on_AlignmentChange()">
                                    <option *ngFor="let alignment of get_Alignments(); trackBy:trackByIndex;"
                                        [ngValue]="alignment">
                                        {{alignment}}
                                    </option>
                                </select>
                            </span>
                        </div>
                        <!--Available Ancestry Feats-->
                        <div class="list-item fullsize-only" *ngIf="get_Character().class.ancestry.name">
                            <strong>Available Ancestry Feats</strong>
                            <div class="newrow left-aligned" *ngIf="get_Character().class.ancestry?.ancestries.length">
                                <cite class="trait"
                                    *ngFor="let ancestry of get_Character().class.ancestry.ancestries; trackBy:trackByIndex;">{{ancestry}}&nbsp;</cite>
                            </div>
                        </div>
                        <!--History list mode-->
                        <ng-container *ngIf="!get_TileMode()">
                            <!--BaseValues-->
                            <div class="list-item">
                                <button class="newrow fancy-button"
                                    [ngClass]="{'choicecleared':get_Character().baseValues.length, 'activechoice':get_ShowList()=='alternativeBaseValues'}"
                                    (click)="toggle_List('alternativeBaseValues')">
                                    Alternative Ability Values: {{(get_Character().baseValues.length) ? "Used" : "Not
                                    Used"}}
                                </button>
                            </div>
                            <!--Class-->
                            <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.name}">
                                <button class="newrow"
                                    [ngClass]="{'fancy-button choicecleared':get_Character().class.name, 'activechoice':get_ShowList()=='class'}"
                                    (click)="toggle_List('class')">
                                    Class{{(get_Character().class.name) ? ": "+ get_Character().class.name : ""}}
                                </button>
                            </div>
                            <!--Ancestry-->
                            <ng-container *ngIf="get_Character().class.name">
                                <div class="list-item list-header"
                                    [ngClass]="{'fullsize-only':get_Character().class.ancestry.name}">
                                    <button class="newrow"
                                        [ngClass]="{'fancy-button choicecleared':get_Character().class.ancestry.name, 'activechoice':get_ShowList()=='ancestry'}"
                                        (click)="toggle_List('ancestry')">
                                        Ancestry{{(get_Character().class.ancestry.name) ? ": "+
                                        get_Character().class.ancestry.name : ""}}
                                    </button>
                                </div>
                            </ng-container>
                            <!--Heritage-->
                            <ng-container *ngIf="get_Character().class.ancestry.name">
                                <div class="list-item"
                                    [ngClass]="{'fullsize-only':get_Character().class.heritage.name}">
                                    <button class="newrow"
                                        [ngClass]="{'fancy-button choicecleared':get_Character().class.heritage.name, 'activechoice':get_ShowList()=='heritage'}"
                                        (click)="toggle_List('heritage')">
                                        Heritage{{(get_Character().class.heritage.name) ? ": "+
                                        get_Character().class.heritage.name : ""}}
                                    </button>
                                </div>
                            </ng-container>
                            <!--Languages-->
                            <div class="list-item" [ngClass]="{'fullsize-only':!get_BlankLanguages()}"
                                *ngIf="get_LanguagesAvailable()">
                                <button class="newrow"
                                    [ngClass]="{'fancy-button choicecleared':!get_BlankLanguages(), 'activechoice':get_ShowList()=='languages'}"
                                    (click)="toggle_List('languages')">
                                    Languages
                                </button>
                            </div>
                            <!--Background-->
                            <ng-container *ngIf="get_Character().class.name">
                                <div class="list-item"
                                    [ngClass]="{'fullsize-only':(get_Character().class.background.name)}">
                                    <button class="newrow"
                                        [ngClass]="{'fancy-button choicecleared':((get_Character().class.background.name)), 'activechoice':get_ShowList()=='background'}"
                                        (click)="toggle_List('background')">
                                        Background{{(get_Character().class.background.name) ? ": "+
                                        get_Character().class.background.name : ""}}
                                    </button>
                                </div>
                            </ng-container>
                            <!--Deity-->
                            <ng-container *ngIf="get_Character().class.name">
                                <div class="list-item" [ngClass]="{'fullsize-only':get_Character().class.deity}">
                                    <button class="newrow"
                                        [ngClass]="{'fancy-button choicecleared':get_Character().class.deity, 'activechoice':get_ShowList()=='deity'}"
                                        (click)="toggle_List('deity')">
                                        Deity{{get_Character().class.deity ? ": "+get_Character().class.deity : ""}}
                                    </button>
                                </div>
                            </ng-container>
                        </ng-container>
                        <!--History tile mode-->
                        <div class="list-item icon-list" *ngIf="get_TileMode()">
                            <!--BaseValues-->
                            <button class="fancy-button"
                                [ngClass]="{'choicecleared':get_Character().baseValues.length, 'activechoice':get_ShowList()=='alternativeBaseValues'}"
                                (click)="toggle_List('alternativeBaseValues')">
                                <app-gridIcon class="fancy-button"
                                    [ngbTooltip]="'Alternative Ability Values: ' + (get_Character().baseValues.length ? 'Used' : 'Not Used')"
                                    [title]="'A B I'">
                                </app-gridIcon>
                            </button>
                            <!--Class-->
                            <button
                                [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.name, 'activechoice':get_ShowList()=='class'}"
                                (click)="toggle_List('class')">
                                <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.name}"
                                    [ngbTooltip]="'Class' + (get_Character().class.name ? ': ' + get_Character().class.name : '')"
                                    [title]="get_Character().class.name ? get_Character().class.name : 'C L A S'">
                                </app-gridIcon>
                            </button>
                            <!--Ancestry-->
                            <ng-container *ngIf="get_Character().class.name">
                                <button
                                    [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.ancestry.name, 'activechoice':get_ShowList()=='ancestry'}"
                                    (click)="toggle_List('ancestry')">
                                    <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.ancestry.name}"
                                        [ngbTooltip]="'Ancestry' + (get_Character().class.ancestry.name ? ': ' + get_Character().class.ancestry.name : '')"
                                        [title]="get_Character().class.ancestry.name ? get_Character().class.ancestry.name : 'A N C E'">
                                    </app-gridIcon>
                                </button>
                            </ng-container>
                            <!--Heritage-->
                            <ng-container *ngIf="get_Character().class.ancestry.name">
                                <button
                                    [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.heritage.name, 'activechoice':get_ShowList()=='heritage'}"
                                    (click)="toggle_List('heritage')">
                                    <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.heritage.name}"
                                        [ngbTooltip]="'Heritage' + (get_Character().class.heritage.name ? ': ' + get_Character().class.heritage.name : '')"
                                        [title]="get_Character().class.heritage.name ? get_Character().class.heritage.name : 'H E R I'">
                                    </app-gridIcon>
                                </button>
                            </ng-container>
                            <!--Languages-->
                            <button
                                [ngClass]="{'fancy-button choicecleared fullsize-only':!get_BlankLanguages(), 'activechoice':get_ShowList()=='languages'}"
                                (click)="toggle_List('languages')" *ngIf="get_LanguagesAvailable()">
                                <app-gridIcon [ngClass]="{'fancy-button':!get_BlankLanguages()}"
                                    [ngbTooltip]="'Languages'" [title]="'L A N G'"
                                    [superTitle]="get_Character().class.languages.length.toString()">
                                </app-gridIcon>
                            </button>
                            <!--Background-->
                            <ng-container *ngIf="get_Character().class.name">
                                <button
                                    [ngClass]="{'fancy-button choicecleared fullsize-only':((get_Character().class.background.name)), 'activechoice':get_ShowList()=='background'}"
                                    (click)="toggle_List('background')">
                                    <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.background.name}"
                                        [ngbTooltip]="'Background' + (get_Character().class.background.name ? ': ' + get_Character().class.background.name : '')"
                                        [title]="get_Character().class.background.name ? get_Character().class.background.name : 'B A C K'">
                                    </app-gridIcon>
                                </button>
                            </ng-container>
                            <!--Deity-->
                            <ng-container *ngIf="get_Character().class.name">
                                <button
                                    [ngClass]="{'fancy-button choicecleared fullsize-only':get_Character().class.deity, 'activechoice':get_ShowList()=='deity'}"
                                    (click)="toggle_List('deity')">
                                    <app-gridIcon [ngClass]="{'fancy-button':get_Character().class.deity}"
                                        [ngbTooltip]="'Deity' + (get_Character().class.deity ? ': ' + get_Character().class.deity : '')"
                                        [title]="get_Character().class.deity ? get_Character().class.deity : 'D E I T'">
                                    </app-gridIcon>
                                </button>
                            </ng-container>
                        </div>
                    </div>
                    <!--Levels-->
                    <ng-container *ngIf="get_Character().class">
                        <ng-container *ngFor="let level of get_Character().class.levels; trackBy:trackByIndex;">
                            <div
                                [ngClass]="{'invisible':!(level.number > 0 && [0,level.number].includes(get_ShowLevel()))}">
                                <header class="sectionHeader" *ngIf="level.number > 0">Level {{level.number}}</header>
                                <div [ngClass]="{'character-choice-grid':get_TileMode()}">
                                    <div [ngClass]="{'icon-list vertical':get_TileMode()}">
                                        <ng-container
                                            *ngFor="let fixedAbilityBoosts of [get_AbilityBoosts(level.number, level.number, '', '', '', '', true)]; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let fixedSkillIncreases of [get_SkillIncreases(level.number, level.number, '', '', '', true)]; trackBy:trackByIndex;">
                                                <ng-container
                                                    *ngFor="let fixedFeats of [get_FeatsTaken(level.number, level.number, '', '', '', true, 'feat')]; trackBy:trackByIndex;">
                                                    <ng-container
                                                        *ngFor="let fixedFeatures of [get_FeatsTaken(level.number, level.number, '', '', '', true, 'feature')]; trackBy:trackByIndex;">
                                                        <ng-container
                                                            *ngIf="fixedAbilityBoosts.length + fixedSkillIncreases.length + fixedFeatures.length + fixedFeats.length > 0">
                                                            <!--Fixed information list mode-->
                                                            <div class="fullsize-only list-item"
                                                                *ngIf="!get_TileMode()">
                                                                <button class="newrow sublist-toggle fancy-button"
                                                                    (click)="toggle_List('fixedchanges', level.number, {abilityBoosts:fixedAbilityBoosts, skillIncreases:fixedSkillIncreases, features:fixedFeatures, feats:fixedFeats})"
                                                                    [ngClass]="{'activechoice':get_ShowList()=='fixedchanges' && get_ShowContentLevelNumber()==level.number}">
                                                                    Show fixed changes
                                                                </button>
                                                            </div>
                                                            <!--Fixed information tile mode-->
                                                            <div class="fullsize-only" *ngIf="get_TileMode()">
                                                                <button
                                                                    [ngClass]="{'fancy-button activechoice':get_ShowFixedChangesLevelNumber()==level.number}"
                                                                    (click)="toggle_FixedChangesLevelNumber(level.number)">
                                                                    <app-gridIcon
                                                                        [ngClass]="{'fancy-button':get_ShowFixedChangesLevelNumber()==level.number}"
                                                                        [ngbTooltip]="(get_ShowFixedChangesLevelNumber()==level.number ? 'Hide' : 'Show') + ' fixed changes'"
                                                                        [title]="'F I X'">
                                                                    </app-gridIcon>
                                                                </button>
                                                            </div>
                                                        </ng-container>
                                                    </ng-container>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                    <!--Ability boosts list mode-->
                                    <ng-container *ngIf="!get_TileMode()">
                                        <ng-container
                                            *ngFor="let choice of level.abilityChoices; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let maxAvailable of [get_MaxAvailable(choice)]; trackBy:trackByIndex;">
                                                <div class="list-item" *ngIf="maxAvailable"
                                                    [ngClass]="{'problem':(choice.boosts.length > maxAvailable || someAbilitiesIllegal(choice, level.number)), 'fullsize-only':choice.boosts.length == maxAvailable}">
                                                    <button class="newrow sublist-toggle abilityboost"
                                                        [ngClass]="{'fancy-button choicecleared':choice.boosts.length == maxAvailable, 'activechoice':get_ShowList()==choice.id}"
                                                        (click)="toggle_List(choice.id, level.number, choice)">
                                                        {{get_AbilityChoiceTitle(choice)}}
                                                    </button>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                    <!--Ability boosts tile mode-->
                                    <div class="icon-list vertical" *ngIf="get_TileMode()">
                                        <!--Fixed ability boosts tile mode-->
                                        <ng-container
                                            *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                            <ng-container
                                                *ngFor="let boost of get_AbilityBoosts(level.number, level.number, '', '', '', '', true); trackBy:trackByIndex;">
                                                <ng-template #FixedAbilityBoostContent>
                                                    <div class="newrow left-aligned">
                                                        <strong>{{boost.type == 'Flaw' ? 'Flaw' :
                                                            'Boost'}}&nbsp;</strong>
                                                        {{boost.name}}
                                                    </div>
                                                    <div class="newrow left-aligned">
                                                        <strong>Source&nbsp;</strong> {{boost.source}}
                                                    </div>
                                                </ng-template>
                                                <button class="fullsize-only inactive-button"
                                                    #FixedAbilityPopover="ngbPopover"
                                                    [ngbPopover]="FixedAbilityBoostContent" triggers="click">
                                                    <app-gridIcon class="abilityboost"
                                                        [ngbTooltip]="!FixedAbilityPopover.isOpen() && ((boost.type == 'Flaw' ? 'Flaw: ' : 'Boost: ') + boost.name)"
                                                        [title]="boost.name" [superTitle]="'(locked)'"
                                                        [detail]="(boost.type == 'Flaw' ? 'Flaw' : 'Boost')">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                        <ng-container
                                            *ngFor="let choice of level.abilityChoices; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let maxAvailable of [get_MaxAvailable(choice)]; trackBy:trackByIndex;">
                                                <button class="abilityboost"
                                                    (click)="toggle_List(choice.id, level.number, choice)"
                                                    [ngClass]="{'problem':(choice.boosts.length > maxAvailable || someAbilitiesIllegal(choice, level.number)), 'fancy-button fullsize-only choicecleared':choice.boosts.length == maxAvailable, 'activechoice':get_ShowList()==choice.id}"
                                                    *ngIf="maxAvailable">
                                                    <app-gridIcon class="abilityboost"
                                                        [ngbTooltip]="get_AbilityChoiceTitle(choice)"
                                                        [superTitle]="maxAvailable.toString()"
                                                        [title]="(maxAvailable == 1 && choice.boosts.length) ? choice.boosts[0].name : choice.boosts.length.toString()"
                                                        [ngClass]="{'fancy-button':choice.boosts.length == maxAvailable}">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                    <!--Skill Increases-->
                                    <div [ngClass]="{'icon-list vertical':get_TileMode()}">
                                        <!--Fixed skill increases tile mode-->
                                        <ng-container
                                            *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                            <ng-container
                                                *ngFor="let skillIncrease of get_SkillIncreases(level.number, level.number, '', '', '', true); trackBy:trackByIndex;">
                                                <ng-template #FixedSkillIncreaseContent>
                                                    <div class="newrow left-aligned">
                                                        <strong>{{skillIncrease.name}}</strong>
                                                    </div>
                                                    <div class="newrow left-aligned">
                                                        <strong>Source&nbsp;</strong> {{skillIncrease.source}}
                                                    </div>
                                                </ng-template>
                                                <button class="fullsize-only inactive-button"
                                                    #FixedSkillPopover="ngbPopover"
                                                    [ngbPopover]="FixedSkillIncreaseContent" triggers="click">
                                                    <app-gridIcon class="skillincrease"
                                                        [ngbTooltip]="!FixedSkillPopover.isOpen() && skillIncrease.name"
                                                        [title]="skillIncrease.name" [superTitle]="'(locked)'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                        <ng-container
                                            *ngFor="let choice of get_SkillChoices(level); let index = index; trackBy:trackByIndex;">
                                            <app-skillchoice (showChoiceMessage)="receive_SkillChoiceMessage($event)"
                                                [choice]="choice" [showChoice]="get_ShowList()" [level]="level"
                                                [excludeTemporary]="true">
                                            </app-skillchoice>
                                        </ng-container>
                                    </div>
                                    <!--Feat choices-->
                                    <div [ngClass]="{'icon-list vertical':get_TileMode()}">
                                        <!--Fixed feats tile mode-->
                                        <ng-container
                                            *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                            <ng-container
                                                *ngFor="let feat of get_FeatsTaken(level.number, level.number, '', '', '', true, 'feat'); trackBy:trackByIndex;">
                                                <ng-template #FixedFeatContent>
                                                    <header class="spellHeader">{{feat.name}}</header>
                                                    <app-feat [feat]="get_FeatsAndFeatures(feat.name)[0]"
                                                        [choice]="null" [levelNumber]="level.number">
                                                    </app-feat>
                                                </ng-template>
                                                <button class="fullsize-only inactive-button"
                                                    #FixedFeatPopover="ngbPopover" [ngbPopover]="FixedFeatContent"
                                                    triggers="click">
                                                    <app-gridIcon class="featchoice"
                                                        [ngbTooltip]="!FixedFeatPopover.isOpen() && feat.name"
                                                        [title]="feat.name" [superTitle]="'(locked)'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                        <ng-container
                                            *ngFor="let choice of get_FeatChoices(level, false); let index = index; trackBy:trackByIndex;">
                                            <app-featchoice (showFeatChoiceMessage)="receive_FeatChoiceMessage($event)"
                                                (showFeatMessage)="receive_FeatMessage($event)" [choice]="choice"
                                                [levelNumber]="level.number" [showContent]="false"
                                                [showFeat]="get_ShowItem()" [showChoice]="get_ShowList()"
                                                [unavailableFeats]="get_Character().settings.unavailableFeats"
                                                [lowerLevelFeats]="get_Character().settings.lowerLevelFeats"
                                                [higherLevelFeats]="get_Character().settings.higherLevelFeats"
                                                [archetypeFeats]="get_Character().settings.archetypeFeats">
                                            </app-featchoice>
                                        </ng-container>
                                    </div>
                                    <!--Special choices-->
                                    <div [ngClass]="{'icon-list vertical':get_TileMode()}">
                                        <!--Fixed features tile mode-->
                                        <ng-container
                                            *ngIf="get_TileMode() && get_ShowFixedChangesLevelNumber()==level.number">
                                            <ng-container
                                                *ngFor="let feature of get_FeatsTaken(level.number, level.number, '', '', '', true, 'feature'); trackBy:trackByIndex;">
                                                <ng-template #FixedFeatureContent>
                                                    <header class="spellHeader">{{feature.name}}</header>
                                                    <app-feat [feat]="get_FeatsAndFeatures(feature.name)[0]"
                                                        [choice]="null" [levelNumber]="level.number">
                                                    </app-feat>
                                                </ng-template>
                                                <button class="fullsize-only inactive-button"
                                                    #FixedFeaturePopover="ngbPopover" [ngbPopover]="FixedFeatureContent"
                                                    triggers="click">
                                                    <app-gridIcon class="featchoice"
                                                        [ngbTooltip]="!FixedFeaturePopover.isOpen() && feature.name"
                                                        [title]="feature.name" [superTitle]="'(locked)'">
                                                    </app-gridIcon>
                                                </button>
                                            </ng-container>
                                        </ng-container>
                                        <!--Languages - show if you have gained languages this level-->
                                        <div class="list-item" [ngClass]="{'fullsize-only':!get_BlankLanguages()}"
                                            *ngIf="level.number > 0 && get_LanguagesAvailable(level.number)">
                                            <button class="newrow specialchoice"
                                                [ngClass]="{'fancy-button choicecleared':!get_BlankLanguages(), 'activechoice':get_ShowList()=='languages'}"
                                                (click)="toggle_List('languages')">
                                                Languages
                                            </button>
                                        </div>
                                        <ng-container
                                            *ngFor="let choice of get_FeatChoices(level, true); let index = index; trackBy:trackByIndex;">
                                            <app-featchoice (showFeatChoiceMessage)="receive_FeatChoiceMessage($event)"
                                                (showFeatMessage)="receive_FeatMessage($event)" [choice]="choice"
                                                [levelNumber]="level.number" [showContent]="false"
                                                [showFeat]="get_ShowItem()" [showChoice]="get_ShowList()"
                                                [unavailableFeats]="get_Character().settings.unavailableFeats"
                                                [lowerLevelFeats]="get_Character().settings.lowerLevelFeats"
                                                [higherLevelFeats]="get_Character().settings.higherLevelFeats"
                                                [archetypeFeats]="get_Character().settings.archetypeFeats">
                                            </app-featchoice>
                                        </ng-container>
                                        <!--Animal Companion-->
                                        <ng-container *ngIf="get_CompanionAvailable(level.number)">
                                            <div class="list-item"
                                                [ngClass]="{'fullsize-only':(get_Companion().name && get_Companion().species)}"
                                                *ngFor="let listID of ['animalCompanion']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':(get_Companion().name && get_Companion().species), 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Animal Companion Basics
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list choicecleared':(get_Companion().name && get_Companion().species)}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <button class="list-item" (click)="on_NewCompanion(level)">
                                                        Create New Animal Companion
                                                    </button>
                                                    <div class="list-item">
                                                        <span>Animal Companion Name</span>
                                                        <span>
                                                            <input type="text" id="companionname"
                                                                [(ngModel)]="get_Companion().name" maxLength="30">
                                                        </span>
                                                    </div>
                                                    <div class="list-item">
                                                        <span>Animal Companion Species</span>
                                                        <span>
                                                            <input type="text" id="companionspecies"
                                                                [(ngModel)]="get_Companion().species" maxLength="30">
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--Animal Type-->
                                            <div class="list-item"
                                                [ngClass]="{'fullsize-only':get_Companion().class.ancestry.name}"
                                                *ngFor="let listID of ['animaltype']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':get_Companion().class.ancestry.name, 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Animal Companion
                                                    Type{{(get_Companion().class.ancestry.name) ? ": "+
                                                    get_Companion().class.ancestry.name
                                                    : ""}}
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list':(get_Companion().class.ancestry.name)}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <div class="list-item"
                                                        [ngClass]="{'selected':type.name == get_Companion().class.ancestry.name}"
                                                        *ngFor="let type of get_AvailableCompanionTypes(); trackBy:trackByIndex;">
                                                        <div class="newrow"
                                                            *ngFor="let itemID of ['animaltype'+type.name+'desc']; trackBy:trackByIndex;">
                                                            <span>
                                                                <input id="{{type.name}}" type="checkbox"
                                                                    (change)="on_CompanionTypeChange(type, $event.target.checked)"
                                                                    [checked]="type.name == get_Companion().class.ancestry.name"
                                                                    [disabled]="get_Companion().class.ancestry.name && (type.name != get_Companion().class.ancestry.name)">
                                                                <label for="{{type.name}}">
                                                                    <strong>{{type.name}}</strong>
                                                                </label>
                                                            </span>
                                                            <button (click)="toggle_Item(itemID)"
                                                                [ngClass]="{'fancy-button':get_ShowItem()==itemID}">
                                                                {{get_ShowItem()==itemID ? "Hide" : "Show"}}
                                                                Description
                                                            </button>
                                                            <div class="newrow lower" *ngIf="get_ShowItem()==itemID">
                                                                <div class="newrow left-aligned">
                                                                    <div class="newrow left-aligned tags">
                                                                        <cite class="trait"
                                                                            *ngFor="let trait of type.traits; trackBy:trackByIndex;"
                                                                            [ngbPopover]="get_Traits(trait)[0]?.desc"
                                                                            openDelay=100>{{trait}}</cite>
                                                                    </div>
                                                                    <div class="newrow left-aligned"
                                                                        *ngIf="type.sourceBook">
                                                                        <strong>Source</strong><i>&nbsp;{{type.sourceBook}}</i>
                                                                    </div>
                                                                    <ng-container
                                                                        *ngFor="let desc of type.desc.split('\n\n'); trackBy:trackByIndex;">
                                                                        <p *ngIf="desc.split('\n').length == 1">
                                                                            {{desc}}
                                                                        </p>
                                                                        <ul *ngIf="desc.split('\n').length > 1">
                                                                            <li
                                                                                *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                                                {{line}}</li>
                                                                        </ul>
                                                                    </ng-container>
                                                                    <p>
                                                                        <strong>Size</strong> {{size(type.size)}}
                                                                    </p>
                                                                    <ng-container
                                                                        *ngFor="let gain of type.gainItems; trackBy:trackByIndex;">
                                                                        <p
                                                                            *ngFor="let item of get_ItemFromGain(gain); trackBy:trackByIndex;">
                                                                            <strong>Melee</strong>
                                                                            {{item.displayName}},
                                                                            <strong>Damage</strong>
                                                                            {{item.dicenum+"d"+item.dicesize}}
                                                                        </p>
                                                                    </ng-container>
                                                                    <p>
                                                                        <span
                                                                            *ngFor="let ability of get_AnimalCompanionAbilities(type); let index = index; trackBy:trackByIndex;">{{index
                                                                            ? ", " :
                                                                            ""}}<strong>{{ability.name}}</strong>
                                                                            {{ability.modifier}}</span>
                                                                    </p>
                                                                    <p>
                                                                        <strong>Hit Points</strong>
                                                                        {{type.hitpoints}}
                                                                    </p>
                                                                    <p>
                                                                        <strong>Skill</strong>
                                                                        {{type.skillChoices[0].increases[0].name}}
                                                                    </p>
                                                                    <p>
                                                                        <strong>Senses</strong>
                                                                        {{type.senses.join(",
                                                                        ")}}
                                                                    </p>
                                                                    <p>
                                                                        <strong>Speed</strong>
                                                                        <span
                                                                            *ngFor="let speed of type.speeds; let index = index; trackBy:trackByIndex;">
                                                                            {{index > 0 ? ", " :
                                                                            ""}}{{speed.name.split('
                                                                            ')[0]
                                                                            + " " +
                                                                            speed.value + " feet"}}
                                                                        </span>
                                                                    </p>
                                                                    <p>
                                                                        <strong>Support Benefit</strong>
                                                                        {{type.supportBenefit}}
                                                                    </p>
                                                                    <p *ngIf="type.specialdesc.length">
                                                                        <strong>Special</strong>
                                                                        {{type.specialdesc}}
                                                                    </p>
                                                                </div>
                                                                <ng-container
                                                                    *ngFor="let gain of [type.activities[1]]; trackBy:trackByIndex;">
                                                                    <div class="newrow left-aligned"
                                                                        *ngFor="let activity of get_Activities(gain.name); trackBy:trackByIndex;">
                                                                        <header class="spellHeader left-aligned">
                                                                            Advanced
                                                                            Maneuver:
                                                                            {{activity.name}}
                                                                            <app-actionIcons
                                                                                [actionString]="activity.actions">
                                                                            </app-actionIcons>
                                                                            {{(activity.activationType) ?
                                                                            activity.activationType : ""}}
                                                                        </header>
                                                                        <app-activity class="newrow" [activity]=activity
                                                                            [allowActivate]=false>
                                                                        </app-activity>
                                                                    </div>
                                                                </ng-container>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <!--Animal Specializations-->
                                        <ng-container *ngIf="get_CompanionSpecializationsAvailable(level.number)">
                                            <ng-container
                                                *ngFor="let available of [get_CompanionSpecializationsAvailable(level.number)]; trackBy:trackByIndex;">
                                                <div class="list-item"
                                                    [ngClass]="{'fullsize-only':get_TakenCompanionSpecializations(level.number).length == available}"
                                                    *ngFor="let listID of ['animalspecialization'+level.number]; trackBy:trackByIndex;">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':(get_TakenCompanionSpecializations(level.number).length == available), 'activechoice':get_ShowList()==listID}"
                                                        (click)="toggle_List(listID)">
                                                        Animal Companion Specialization{{available > 1 ? ": "+
                                                        get_TakenCompanionSpecializations(level.number).length +"/"+
                                                        available :
                                                        (get_TakenCompanionSpecializations(level.number).length == 1) ?
                                                        ": "+ get_Companion().class.specializations[0].name : ""}}
                                                    </button>
                                                    <div class="list-item sublist specialchoice"
                                                        [ngClass]="{'fancy-list':get_TakenCompanionSpecializations(level.number).length == available}"
                                                        *ngIf="get_ShowList()==listID">
                                                        <div class="list-item"
                                                            [ngClass]="{'selected':get_TakenCompanionSpecializations(level.number).includes(spec.name)}"
                                                            *ngFor="let spec of get_AvailableCompanionSpecializations(level.number); trackBy:trackByIndex;">
                                                            <div class="newrow"
                                                                *ngFor="let itemID of ['animalspecialization'+spec.name+'desc'+level.number]; trackBy:trackByIndex;">
                                                                <span>
                                                                    <input id="{{spec.name}}" type="checkbox"
                                                                        (change)="on_SpecializationChange(spec, $event.target.checked, level.number)"
                                                                        [checked]="have_CompanionSpecialization(spec.name)"
                                                                        [disabled]="(get_TakenCompanionSpecializations(level.number).length == available) && !get_TakenCompanionSpecializations(level.number).includes(spec.name)">
                                                                    <label for="{{spec.name}}">
                                                                        <strong>{{spec.name}}</strong>
                                                                    </label>
                                                                </span>
                                                                <button (click)="toggle_Item(itemID)"
                                                                    [ngClass]="{'fancy-button':get_ShowItem()==itemID}">
                                                                    {{get_ShowItem()==itemID ? "Hide" : "Show"}}
                                                                    Description
                                                                </button>
                                                                <div class="newrow lower"
                                                                    *ngIf="get_ShowItem()==itemID">
                                                                    <div class="newrow left-aligned">
                                                                        <p>
                                                                            {{spec.desc}}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                        <!--Familiar-->
                                        <ng-container *ngIf="get_FamiliarAvailable(level.number)">
                                            <div class="list-item"
                                                [ngClass]="{'fullsize-only':(get_Familiar().name && get_Familiar().species)}"
                                                *ngFor="let listID of ['familiar']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':(get_Familiar().name && get_Familiar().species), 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Familiar Basics
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list':(get_Familiar().name && get_Familiar().species)}"
                                                    *ngIf="get_ShowList()==listID">

                                                    <button class="list-item" (click)="on_NewFamiliar()">
                                                        Create New Familiar
                                                    </button>
                                                    <div class="list-item">
                                                        <span>Familiar Name</span>
                                                        <span>
                                                            <input type="text" id="familiarname"
                                                                [(ngModel)]="get_Familiar().name" maxLength="30">
                                                        </span>
                                                    </div>
                                                    <div class="list-item">
                                                        <span>Familiar Species</span>
                                                        <span>
                                                            <input type="text" id="familiarspecies"
                                                                [(ngModel)]="get_Familiar().species" maxLength="30">
                                                        </span>
                                                    </div>
                                                    <div class="list-item">
                                                        <span>Swimmer</span>
                                                        <span>
                                                            <input type="checkbox" id="familiar-swimmer{{level.number}}"
                                                                (click)="on_FamiliarSpeedChange($event.target.checked)"
                                                                [checked]="is_FamiliarSwimmer()"><label
                                                                for="familiar-swimmer{{level.number}}">Gain Swim
                                                                Speed
                                                                instead of Land Speed</label>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <!--Different Worlds-->
                                        <ng-container
                                            *ngFor="let feat of get_DifferentWorldsFeat(level.number); trackBy:trackByIndex;">
                                            <!--Different Worlds Name-->
                                            <div class="list-item" [ngClass]="{'fullsize-only':feat.data.name}"
                                                *ngFor="let listID of ['differentWorlds_Name']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':feat.data.name, 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Alternative Name (Different Worlds){{(feat.data.name) ? ": "+
                                                    feat.data.name
                                                    : ""}}
                                                </button>
                                                <div class="list-item sublist" [ngClass]="{'fancy-list':feat.data.name}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <div class="list-item">
                                                        <strong>Name:
                                                            <input type="text" [(ngModel)]="feat.data.name"
                                                                (blur)=on_NameChange() maxLength="30">
                                                        </strong>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--Different Worlds Background-->
                                            <div class="list-item" [ngClass]="{'fullsize-only':feat.data.background}"
                                                *ngFor="let listID of ['differentWorlds_Background']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':feat.data.background, 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Alternative Background (Different
                                                    Worlds){{(feat.data.background) ? ": "+ feat.data.background :
                                                    ""}}
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list':feat.data.background}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <!-- Filter -->
                                                    <div class="list-item">
                                                        <strong>Filter</strong>
                                                        <div class="newrow">
                                                            <span>
                                                                <input id="differentWorldsBackgroundfilterAdventure"
                                                                    type="checkbox" [(ngModel)]="adventureBackgrounds">
                                                                <label
                                                                    for="differentWorldsBackgroundfilterAdventure">Show
                                                                    adventure
                                                                    backgrounds</label>
                                                            </span>
                                                        </div>
                                                        <div class="newrow">
                                                            <span>
                                                                <input id="differentWorldsBackgroundfilterRegional"
                                                                    type="checkbox" [(ngModel)]="regionalBackgrounds">
                                                                <label
                                                                    for="differentWorldsBackgroundfilterRegional">Show
                                                                    regional
                                                                    backgrounds</label>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <!-- End Filter -->
                                                    <div class="list-item"
                                                        [ngClass]="{'selected':background.name === feat.data.background}"
                                                        *ngFor="let background of get_Backgrounds(); trackBy:trackByIndex;">
                                                        <div class="newrow"
                                                            *ngFor="let itemID of ['differentWorlds_Background'+background.name]; trackBy:trackByIndex;">
                                                            <span>
                                                                <input *ngIf="!background.subTypes"
                                                                    id="{{background.name}}" type="checkbox"
                                                                    (change)="onDifferentWorldsBackgroundChange(level, feat, background, $event.target.checked)"
                                                                    [checked]="background.name === feat.data.background || background.name === get_Character().class.background.name"
                                                                    [disabled]="background.name === get_Character().class.background.name || (feat.data.background && (background.name != feat.data.background))">
                                                                <button class="lower left" *ngIf="background.subTypes"
                                                                    id="{{background.name}}"
                                                                    (click)="toggle_Item(itemID)">v</button>
                                                                <label for="{{background.name}}">
                                                                    <strong>{{background.name}}</strong>
                                                                    <cite class="trait"
                                                                        *ngIf="background.traits.includes('Rare')"
                                                                        [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                                        openDelay=100>Rare</cite>
                                                                    <cite class="trait"
                                                                        *ngIf="background.traits.includes('Uncommon')"
                                                                        [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                                        openDelay=100>Uncommon</cite>
                                                                    <cite class="trait" *ngIf="background.adventurePath"
                                                                        [ngbPopover]="get_Traits('Adventure')[0]?.desc"
                                                                        openDelay=100>Adventure</cite>
                                                                    <cite class="trait" *ngIf="background.region"
                                                                        [ngbPopover]="get_Traits('Regional')[0]?.desc"
                                                                        openDelay=100>Regional</cite>
                                                                </label>
                                                            </span>
                                                            <button (click)="toggle_Item(itemID)"
                                                                [ngClass]="{'fancy-button':get_ShowItem()==itemID}">
                                                                {{get_ShowItem()==itemID ? "Hide" : "Show"}}
                                                                Description
                                                            </button>
                                                            <div class="newrow lower" *ngIf="get_ShowItem()==itemID">
                                                                <!--Subbackgrounds-->
                                                                <div class="list-item"
                                                                    [ngClass]="{'selected':subbackground.name === feat.data.background}"
                                                                    *ngFor="let subbackground of get_SubBackgrounds(background.name); trackBy:trackByIndex;">
                                                                    <span>
                                                                        <input id="{{subbackground.name}}"
                                                                            type="checkbox"
                                                                            (change)="onDifferentWorldsBackgroundChange(level, feat, subbackground, $event.target.checked)"
                                                                            [checked]="subbackground.name === feat.data.background || subbackground.name === get_Character().class.background.name"
                                                                            [disabled]="(subbackground.name === get_Character().class.background.name || subbackground.superType == get_Character().class.background.superType) || (feat.data.background && (subbackground.name != feat.data.background))">
                                                                        <label for="{{subbackground.name}}">
                                                                            <strong>{{subbackground.subType}}</strong>
                                                                        </label>
                                                                    </span>
                                                                </div>
                                                                <!--End Subbackgrounds-->
                                                                <div class="newrow left-aligned">
                                                                    <ng-container
                                                                        *ngFor="let desc of background.desc.split('\n\n'); trackBy:trackByIndex;">
                                                                        <p *ngIf="desc.split('\n').length == 1">
                                                                            {{desc}}
                                                                        </p>
                                                                        <ul *ngIf="desc.split('\n').length > 1">
                                                                            <li
                                                                                *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                                                {{line}}</li>
                                                                        </ul>
                                                                    </ng-container>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <!--Blessed Blood-->
                                        <ng-container *ngIf="get_BlessedBloodFeat(level.number)">
                                            <!--Blessed Blood spells-->
                                            <ng-container
                                                *ngFor="let blessedBloodSpells of [get_BlessedBloodSpells()]; trackBy:trackByIndex;">
                                                <div class="list-item"
                                                    [ngClass]="{'fullsize-only':blessedBloodSpells >= 3}"
                                                    *ngFor="let listID of ['differentWorlds_Name']; trackBy:trackByIndex;">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':blessedBloodSpells >= 3, 'activechoice':get_ShowList()==listID}"
                                                        (click)="toggle_List(listID)">
                                                        Deity Spells (Blessed Blood): {{blessedBloodSpells}}/3
                                                    </button>
                                                    <div class="list-item sublist specialchoice"
                                                        [ngClass]="{'fancy-list':blessedBloodSpells >= 3}"
                                                        *ngIf="get_ShowList()==listID">
                                                        <div class="list-item"
                                                            [ngClass]="{'selected':get_BlessedBloodHaveSpell(spell)}"
                                                            *ngFor="let spell of get_BlessedBloodDeitySpells(); trackBy:trackByIndex;">
                                                            <ng-container
                                                                *ngFor="let itemID of ['blessedBlood'+spell.name]; trackBy:trackByIndex;">
                                                                <span>
                                                                    <input id="blessedBlood{{spell.name}}"
                                                                        type="checkbox"
                                                                        (change)="on_BlessedBloodSpellTaken(spell, level, $event.target.checked)"
                                                                        [checked]="get_BlessedBloodHaveSpell(spell)"
                                                                        [disabled]="blessedBloodSpells >= 3 && !get_BlessedBloodHaveSpell(spell)">
                                                                    <label for="blessedBlood{{spell.name}}">
                                                                        <strong>{{spell.name}}</strong>
                                                                    </label>
                                                                </span>
                                                                <button (click)="toggle_Item(itemID)"
                                                                    [ngClass]="{'fancy-button':get_ShowItem()=='blessedBlood'+spell.name}">
                                                                    {{get_ShowItem()=='blessedBlood'+spell.name ?
                                                                    "Hide"
                                                                    :
                                                                    "Show"}}
                                                                    Description
                                                                </button>
                                                                <div class="newrow lower"
                                                                    *ngIf="get_ShowItem()==itemID">
                                                                    <header class="spellHeader newrow">
                                                                        <span>{{spell.name}}
                                                                            <app-actionIcons
                                                                                [actionString]="spell.actions">
                                                                            </app-actionIcons>
                                                                            {{(spell.castType) ? spell.castType :
                                                                            ""}}
                                                                        </span>
                                                                        <span>Spell {{spell.levelreq}}</span>
                                                                    </header>
                                                                    <app-spell class="newrow" [spell]=spell
                                                                        [spellLevel]="spell.levelreq">
                                                                    </app-spell>
                                                                </div>
                                                            </ng-container>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                        <!--Additional Heritages-->
                                        <ng-container
                                            *ngFor="let heritageGain of get_AdditionalHeritagesAvailable(level.number); trackBy:trackByIndex">
                                            <ng-container
                                                *ngFor="let heritageIndex of get_AdditionalHeritageIndex(heritageGain.source); trackBy:trackByIndex">
                                                <div class="list-item"
                                                    [ngClass]="{'fullsize-only':get_Character().class.additionalHeritages[heritageIndex].name}"
                                                    *ngFor="let listID of [level.number+'AdditionalHeritage'+heritageGain.source]; trackBy:trackByIndex;">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':get_Character().class.additionalHeritages[heritageIndex].name, 'activechoice':get_ShowList()==listID}"
                                                        (click)="toggle_List(listID)">
                                                        Heritage
                                                        ({{heritageGain.source}}){{(get_Character().class.additionalHeritages[heritageIndex].name)
                                                        ? ": "+
                                                        get_Character().class.additionalHeritages[heritageIndex].name
                                                        :
                                                        ""}}
                                                    </button>
                                                    <div class="list-item sublist specialchoice"
                                                        [ngClass]="{'fancy-list':((get_Character().class.additionalHeritages[heritageIndex].name))}"
                                                        *ngIf="get_ShowList()==listID">
                                                        <div class="list-item"
                                                            [ngClass]="{'selected':heritage.name === get_Character().class.additionalHeritages[heritageIndex].name}"
                                                            *ngFor="let heritage of get_AvailableHeritages('', heritageGain.ancestry, heritageIndex); trackBy:trackByIndex;">
                                                            <span>
                                                                <input *ngIf="!heritage.subTypes.length"
                                                                    id="{{heritage.name}}" type="checkbox"
                                                                    (change)="on_AdditionalHeritageChange(heritage, $event.target.checked, heritageIndex, heritageGain.source)"
                                                                    [checked]="heritage.name === get_Character().class.additionalHeritages[heritageIndex].name"
                                                                    [disabled]="get_Character().class.additionalHeritages[heritageIndex].name && (heritage.name != get_Character().class.additionalHeritages[heritageIndex].name)">
                                                                <button class="lower left"
                                                                    *ngIf="heritage.subTypes.length"
                                                                    id="{{heritage.name}}"
                                                                    (click)="toggle_Item(heritage.name+'desc')">v</button>
                                                                <label for="{{heritage.name}}">
                                                                    <strong>{{heritage.name}}&nbsp;</strong>
                                                                    <cite class="trait"
                                                                        *ngIf="heritage.traits.includes('Rare')"
                                                                        [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                                        openDelay=100>Rare</cite>
                                                                    <cite class="trait"
                                                                        *ngIf="heritage.traits.includes('Uncommon')"
                                                                        [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                                        openDelay=100>Uncommon</cite>
                                                                </label>
                                                            </span>
                                                            <button (click)="toggle_Item(heritage.name+'desc')"
                                                                [ngClass]="{'fancy-button':get_ShowItem()==heritage.name+'desc'}">
                                                                {{get_ShowItem()==heritage.name+'desc' ? "Hide" :
                                                                "Show"}}
                                                                Description
                                                            </button>
                                                            <div class="newrow lower"
                                                                *ngIf="get_ShowItem()==heritage.name+'desc'">
                                                                <!--Subheritages-->
                                                                <div class="list-item"
                                                                    [ngClass]="{'selected':subheritage.name === get_Character().class.additionalHeritages[heritageIndex].name}"
                                                                    *ngFor="let subheritage of heritage.subTypes; trackBy:trackByIndex;">
                                                                    <span>
                                                                        <input id="{{subheritage.name}}" type="checkbox"
                                                                            (change)="on_AdditionalHeritageChange(subheritage, $event.target.checked, heritageIndex, heritageGain.source)"
                                                                            [checked]="subheritage.name === get_Character().class.heritage.name"
                                                                            [disabled]="get_Character().class.additionalHeritages[heritageIndex].name && (subheritage.name != get_Character().class.additionalHeritages[heritageIndex].name)">
                                                                        <label for="{{subheritage.name}}">
                                                                            <strong>{{subheritage.subType}}</strong>
                                                                        </label>
                                                                    </span>
                                                                </div>
                                                                <!--End Subheritages-->
                                                                <div class="newrow left-aligned"
                                                                    *ngIf="heritage.sourceBook">
                                                                    <strong>Source</strong><i>&nbsp;{{heritage.sourceBook}}</i>
                                                                </div>
                                                                <div class="newrow left-aligned">
                                                                    <ng-container
                                                                        *ngFor="let desc of heritage.desc.split('\n\n'); trackBy:trackByIndex;">
                                                                        <p *ngIf="desc.split('\n').length == 1">
                                                                            {{desc}}
                                                                        </p>
                                                                        <ul *ngIf="desc.split('\n').length > 1">
                                                                            <li
                                                                                *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                                                {{line}}</li>
                                                                        </ul>
                                                                    </ng-container>
                                                                </div>
                                                                <ng-container
                                                                    *ngFor="let activityName of heritage.gainActivities; trackBy:trackByIndex;">
                                                                    <div class="newrow left-aligned"
                                                                        *ngFor="let activity of get_Activities(activityName); trackBy:trackByIndex;">
                                                                        <header class="spellHeader left-aligned">
                                                                            {{activity.name}}
                                                                            <app-actionIcons
                                                                                [actionString]="activity.actions">
                                                                            </app-actionIcons>
                                                                            {{(activity.activationType) ?
                                                                            activity.activationType : ""}}
                                                                        </header>
                                                                        <app-activity class="newrow" [activity]=activity
                                                                            [allowActivate]=false>
                                                                        </app-activity>
                                                                    </div>
                                                                </ng-container>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                        <!--Fuse Stance-->
                                        <ng-container
                                            *ngFor="let feat of get_FuseStanceFeat(level.number); trackBy:trackByIndex;">
                                            <!--Fuse Stance Name-->
                                            <div class="list-item" [ngClass]="{'fullsize-only':(feat.data.name != '')}"
                                                *ngFor="let listID of ['fuseStance_Name']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':(feat.data.name != ''), 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Fused Stance Name (Fuse Stance){{(feat.data.name) ? ": "+
                                                    feat.data.name
                                                    :
                                                    ""}}
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list':(feat.data.name != '')}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <div class="list-item">
                                                        <strong>Name:
                                                            <input type="text" [(ngModel)]="feat.data.name"
                                                                (blur)="on_FuseStanceNameChange()" maxLength="30">
                                                        </strong>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--Fuse Stance Stance 1-->
                                            <div class="list-item" [ngClass]="{'fullsize-only':feat.data.stance1}"
                                                *ngFor="let listID of ['fuseStance_Stance1']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle specialchoice"
                                                    [ngClass]="{'fancy-button choicecleared':feat.data.stance1, 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Fused Stance 1 (Fuse Stance){{(feat.data.stance1) ? ": "+
                                                    feat.data.stance1
                                                    : ""}}
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list':feat.data.stance1}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <div class="list-item"
                                                        [ngClass]="{'unavailable':stance.reason, 'selected':stance.name == feat.data.stance1}"
                                                        *ngFor="let stance of get_StancesToFuse(level.number); trackBy:trackByIndex;">
                                                        <div class="newrow"
                                                            *ngFor="let itemID of ['fuseStance_stance1'+stance.name]; trackBy:trackByIndex;">
                                                            <span>
                                                                <input id="{{stance.name}}" type="checkbox"
                                                                    (change)="on_FuseStanceStanceChange(feat, 'stance1', stance.name, $event.target.checked)"
                                                                    [checked]="stance.name == feat.data.stance1 || stance.name == feat.data.stance2"
                                                                    [disabled]="stance.name == feat.data.stance2 || (feat.data.stance1 && (stance.name != feat.data.stance1))"
                                                                    *ngIf="!stance.reason">
                                                                <label for="{{stance.name}}">
                                                                    <strong>{{stance.name}}&nbsp;</strong>
                                                                    <span>
                                                                        <cite class="problem" *ngIf="stance.reason">
                                                                            {{stance.reason}}
                                                                        </cite>
                                                                    </span>
                                                                </label>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--Fuse Stance Stance 2-->
                                            <div class="list-item" [ngClass]="{'fullsize-only':feat.data.stance2}"
                                                *ngFor="let listID of ['fuseStance_Stance2']; trackBy:trackByIndex;">
                                                <button class="newrow sublist-toggle"
                                                    [ngClass]="{'fancy-button choicecleared':feat.data.stance2, 'activechoice':get_ShowList()==listID}"
                                                    (click)="toggle_List(listID)">
                                                    Fused Stance 2 (Fuse Stance){{(feat.data.stance2) ? ": "+
                                                    feat.data.stance2
                                                    : ""}}
                                                </button>
                                                <div class="list-item sublist specialchoice"
                                                    [ngClass]="{'fancy-list':feat.data.stance2}"
                                                    *ngIf="get_ShowList()==listID">
                                                    <div class="list-item"
                                                        [ngClass]="{'unavailable':stance.reason, 'selected':stance.name == feat.data.stance2}"
                                                        *ngFor="let stance of get_StancesToFuse(level.number); trackBy:trackByIndex;">
                                                        <div class="newrow"
                                                            *ngFor="let itemID of ['fuseStance_stance2'+stance.name]; trackBy:trackByIndex;">
                                                            <span>
                                                                <input id="{{stance.name}}" type="checkbox"
                                                                    (change)="on_FuseStanceStanceChange(feat, 'stance2', stance.name, $event.target.checked)"
                                                                    [checked]="stance.name == feat.data.stance1 || stance.name == feat.data.stance2"
                                                                    [disabled]="stance.name == feat.data.stance1 || (feat.data.stance2 && (stance.name != feat.data.stance2))"
                                                                    *ngIf="!stance.reason">
                                                                <label for="{{stance.name}}">
                                                                    <strong>{{stance.name}}&nbsp;</strong>
                                                                    <span>
                                                                        <cite class="problem" *ngIf="stance.reason">
                                                                            {{stance.reason}}
                                                                        </cite>
                                                                    </span>
                                                                </label>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <!--Lore Training-->
                                        <ng-container *ngFor="let choice of level.loreChoices; trackBy:trackByIndex;">
                                            <ng-container *ngFor="let listID of [choice.id]; trackBy:trackByIndex;">
                                                <div class="list-item" *ngIf="choice.available"
                                                    [ngClass]="{'problem':(choice.increases.length > choice.available), 'fullsize-only':(choice.available == choice.increases.length)}">
                                                    <button class="newrow sublist-toggle specialchoice"
                                                        [ngClass]="{'fancy-button choicecleared':(choice.available == choice.increases.length), 'activechoice':get_ShowList()==listID}"
                                                        (click)="toggle_List(listID)">
                                                        Lore Training
                                                        ({{choice.source}}){{(choice.increases.length) ? ": "+
                                                        choice.increases[0].name
                                                        :
                                                        ""}}
                                                    </button>
                                                    <div class="list-item sublist specialchoice"
                                                        [ngClass]="{'fancy-list':(choice.available == choice.increases.length)}"
                                                        *ngIf="get_ShowList()==listID">
                                                        <div class="list-item"
                                                            *ngFor="let itemID of [choice.id+'LoreIncreaseBox']; trackBy:trackByIndex;">
                                                            <span>
                                                                <input id="{{itemID}}" type="checkbox"
                                                                    (change)="on_LoreChange($event.target.checked, choice)"
                                                                    [checked]="get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length"
                                                                    [disabled]="choice.loreName == '' || get_Skills('Lore: '+choice.loreName).length && !get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length">
                                                                <label style="display:initial" for="{{itemID}}">
                                                                    <strong>Lore:
                                                                        <input type="text" [(ngModel)]="choice.loreName"
                                                                            [disabled]="get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length"
                                                                            (blur)="on_LoreNameChange" maxLength="20">
                                                                    </strong>
                                                                </label>
                                                                <cite class="problem"
                                                                    *ngIf="get_Skills('Lore: '+choice.loreName).length && !get_SkillIncreases(level.number, level.number, 'Lore: '+choice.loreName, choice.source, choice.id).length">
                                                                    You are already trained in this Lore!
                                                                </cite>
                                                            </span>
                                                            <div class="newrow">
                                                                {{choice.loreDesc}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </div>
        </div>
        <div class="charactersheet-column">
            <div class="itembox-inner">
                <div id="choiceArea-top"></div>
                <!--Choice content and templates-->
                <!--Load character content-->
                <ng-container *ngIf="get_ShowList()=='load'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">Load Character</header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <div class="list-item" *ngIf="get_Savegames() && !get_Savegames().length">
                            No characters available in database.
                        </div>
                        <div class="list-item" *ngIf="!get_Savegames()">
                            Database connection failed.
                        </div>
                        <ng-container
                            *ngFor="let savegame of get_Savegames(); let index = index; trackBy:trackByIndex;">
                            <ng-template #SavegameDeleteModal let-modal>
                                <div class="modal-header">
                                    <header class="sectionHeader modal-title" id="modal-title">Delete Character
                                    </header>
                                    <button type="button" class="close" aria-label="close"
                                        (click)="modal.dismiss('Cross click')" ngbAutofocus>
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Are you sure you want to delete <strong>{{savegame.name}}</strong>?</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-secondary"
                                        (click)="modal.dismiss('Cancel click')">Cancel</button>
                                    <button type="button" class="btn btn-danger"
                                        (click)="modal.close('Ok click')">Ok</button>
                                </div>
                            </ng-template>
                            <header class="sectionHeader center-aligned"
                                *ngIf="index == 0 || get_Savegames()[index].partyName != get_Savegames()[index-1].partyName">
                                {{savegame.partyName}}</header>
                            <div class="list-item newrow">
                                <span>
                                    <strong>{{savegame.name}}</strong> Level {{savegame.level}}
                                    <span>{{get_SavegameTitle(savegame)}}</span>
                                </span>
                                <span style="flex-basis: auto; flex-grow: 0;">
                                    <button (click)="load_CharacterFromDB(savegame)">Load</button>
                                    <button style="margin-left: .3em;"
                                        (click)="open_DeleteModal(SavegameDeleteModal, savegame)">Delete</button>
                                </span>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
                <!--Settings-->
                <ng-container *ngIf="get_ShowList()=='settings'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">Settings</header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <div class="list-item">
                            <strong>Look</strong>
                            <div class="list-item gridicon-fullsizebox">
                                <input id="accent" type="color" class="character-choice" id="coloraccent"
                                    style="padding:0 2px" [(ngModel)]="get_Character().settings.accent"
                                    (ngModelChange)="set_Accent()" maxLength="7">
                                <label for="accent"><strong>Color Accent</strong></label>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input id="darkmode" class="character-choice" type="checkbox"
                                    [(ngModel)]="get_Character().settings.darkmode" (ngModelChange)="set_Darkmode()">
                                <label for="darkmode"><strong>Dark mode</strong></label>
                            </div>
                        </div>
                        <div class="list-item">
                            <strong>Tags</strong>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="hintsShowMoreInformation" type="checkbox"
                                    [(ngModel)]="get_Character().settings.hintsShowMoreInformation">
                                <label for="hintsShowMoreInformation"><strong>Clicking a tag shows additional
                                        information, if available</strong></label>
                            </div>
                        </div>
                        <div class="list-item">
                            <strong>Choices</strong>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="autoCloseChoices" type="checkbox"
                                    [(ngModel)]="get_Character().settings.autoCloseChoices">
                                <label for="autoCloseChoices"><strong>Automatically close choices when they are
                                        finished</strong></label>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="showOtherOptions" type="checkbox"
                                    [(ngModel)]="get_Character().settings.showOtherOptions">
                                <label for="showOtherOptions"><strong>Keep showing the other options in finished
                                        choices</strong></label>
                            </div>
                        </div>
                        <div class="list-item">
                            <strong>Feats</strong>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="unavailableFeats" type="checkbox"
                                    [(ngModel)]="get_Character().settings.unavailableFeats">
                                <label for="unavailableFeats"><strong>Show unavailable feats</strong></label>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="lowerLevelFeats" type="checkbox"
                                    [(ngModel)]="get_Character().settings.lowerLevelFeats">
                                <label for="lowerLevelFeats"><strong>Show lower level feats</strong></label>
                            </div>
                            <div class="fullwidth" [ngbCollapse]="!get_Character().settings.unavailableFeats">
                                <div class="list-item gridicon-fullsizebox">
                                    <input class="character-choice" id="higherLevelFeats" type="checkbox"
                                        [(ngModel)]="get_Character().settings.higherLevelFeats">
                                    <label for="higherLevelFeats"><strong>Show higher level feats</strong></label>
                                </div>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="archetypeFeats" type="checkbox"
                                    [(ngModel)]="get_Character().settings.archetypeFeats">
                                <label for="archetypeFeats"><strong>Show archetype feats</strong></label>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Alternative Ability Values content-->
                <ng-container *ngIf="get_ShowList()=='alternativeBaseValues'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">Alternative Ability Values:
                            {{get_Character().baseValues.length ? 'Used' : 'Not used'}}</header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <div class="list-item">
                            <p>
                                You can roll your own ability scores and enter them here. If you use these values, your
                                character gets one fewer free ability boosts than normal from their ancestry and from their
                                background. These ability boosts cannot raise a score above 18. If this would happen,
                                you can put the ability boost into another ability score instead, as if it were a free
                                ability boost. The character does not get any more free ability boosts on level 1.
                            </p>
                        </div>
                        <div class="list-item gridicon-fullsizebox">
                            <input id="useAlternativeBaseValues" class="character-choice" type="checkbox"
                                (change)="on_BaseValueChange()" [checked]="get_Character().baseValues.length">
                            <label for="useAlternativeBaseValues">
                                <strong>Enter your own Ability scores</strong>
                            </label>
                        </div>
                        <div class="list-item gridicon-fullsizebox"
                            *ngFor="let ability of get_Character().baseValues; trackBy:trackByIndex;">
                            <input type="number" class="number2" [(ngModel)]="ability.baseValue"
                                (blur)="on_AbilityChange(ability.name)" maxlength="2" (keypress)="numbersOnly($event)">
                            <strong>{{ability.name}}</strong>
                        </div>
                    </div>
                </ng-container>
                <!--Class choice content-->
                <ng-container *ngIf="get_ShowList()=='class'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Class{{(get_Character().class.name) ? ": "+ get_Character().class.name : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <ng-container *ngFor="let class of get_AvailableClasses(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [class.name === get_Character().class.name]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [get_Character().class.name && (class.name != get_Character().class.name)]; trackBy:trackByIndex">
                                    <ng-template #ClassChoiceDetailsTemplate>
                                        <header class="spellHeader">{{class.name}}</header>
                                        <div class="button newrow no-animation"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="onClassChange(class, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                                "Remove" :
                                                "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned tags">
                                            <cite class="trait"
                                                *ngFor="let trait of class.traits; trackBy:trackByIndex;"
                                                [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="class.sourceBook">
                                            <strong>Source</strong><i>&nbsp;{{class.sourceBook}}</i>
                                        </div>
                                        <div class="newrow left-aligned"
                                            *ngFor="let desc of class.desc; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let text of desc.value.split('\n\n'); let textIndex = index; trackBy:trackByIndex;">
                                                <header class="featureHeader" *ngIf="textIndex == 0">{{desc.name}}
                                                </header>
                                                <p *ngIf="text.split('\n').length == 1">
                                                    {{text}}
                                                </p>
                                                <ul *ngIf="text.split('\n').length > 1">
                                                    <li *ngFor="let line of text.split('\n'); trackBy:trackByIndex;">
                                                        {{line}}
                                                    </li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                    </ng-template>
                                    <div class="newrow list-item" [ngClass]="{'selected':checked}">
                                        <div class="gridicon-fullsizebox">
                                            <input id="{{class.name}}" type="checkbox" class="character-choice"
                                                (change)="onClassChange(class, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled">
                                            <div class="gridicon-fullsizebox">
                                                <app-gridIcon class="" [title]="class.name"></app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span [ngbPopover]="ClassChoiceDetailsTemplate" triggers="click">
                                                        {{class.name}}
                                                    </span>
                                                </header>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
                <!--Ancestry choice content-->
                <ng-container *ngIf="get_ShowList()=='ancestry'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Ancestry{{(get_Character().class.ancestry.name) ? ": "+ get_Character().class.ancestry.name
                            : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <ng-container *ngFor="let ancestry of get_AvailableAncestries(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [ancestry.name === get_Character().class.ancestry.name]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [get_Character().class.ancestry.name && (ancestry.name != get_Character().class.ancestry.name)]; trackBy:trackByIndex">
                                    <ng-template #AncestryChoiceDetailsTemplate>
                                        <header class="spellHeader">{{ancestry.name}}</header>
                                        <div class="button newrow no-animation"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="onAncestryChange(ancestry, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                                "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned tags">
                                            <cite class="trait"
                                                *ngFor="let trait of ancestry.traits; trackBy:trackByIndex;"
                                                [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="ancestry.sourceBook">
                                            <strong>Source</strong><i>&nbsp;{{ancestry.sourceBook}}</i>
                                        </div>
                                        <div class="newrow left-aligned"
                                            *ngFor="let desc of ancestry.desc; trackBy:trackByIndex;">
                                            <ng-container
                                                *ngFor="let text of desc.value.split('\n\n'); let textIndex = index; trackBy:trackByIndex;">
                                                <header class="featureHeader" *ngIf="textIndex == 0">
                                                    {{desc.name}}
                                                </header>
                                                <p *ngIf="text.split('\n').length == 1">
                                                    {{text}}
                                                </p>
                                                <ul *ngIf="text.split('\n').length > 1">
                                                    <li *ngFor="let line of text.split('\n'); trackBy:trackByIndex;">
                                                        {{line}}
                                                    </li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                    </ng-template>
                                    <div class="newrow list-item" [ngClass]="{'selected':checked}">
                                        <div class="gridicon-fullsizebox">
                                            <input id="{{ancestry.name}}" type="checkbox" class="character-choice"
                                                (change)="onAncestryChange(ancestry, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled">
                                            <div class="gridicon-fullsizebox">
                                                <app-gridIcon class="" [title]="ancestry.name"
                                                    [detail]="ancestry.traits.includes('Rare') ? 'Rare' : (ancestry.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                                </app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span [ngbPopover]="AncestryChoiceDetailsTemplate"
                                                        triggers="click">{{ancestry.name}}&nbsp;</span>
                                                    <cite class="trait" *ngIf="ancestry.traits.includes('Rare')"
                                                        [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                        openDelay=100>Rare</cite>
                                                    <cite class="trait" *ngIf="ancestry.traits.includes('Uncommon')"
                                                        [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                        openDelay=100>Uncommon</cite>
                                                </header>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
                <!--Heritage choice content-->
                <ng-container *ngIf="get_ShowList()=='heritage'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Heritage{{(get_Character().class.heritage.name) ? ": "+ get_Character().class.heritage.name
                            : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <ng-container
                            *ngFor="let heritage of get_AvailableHeritages('', get_Character().class.ancestry.name); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [heritage.name === get_Character().class.heritage.name]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [get_Character().class.heritage.name && (heritage.name != get_Character().class.heritage.name)]; trackBy:trackByIndex">
                                    <ng-template #HeritageChoiceDetailsTemplate>
                                        <header class="spellHeader">{{heritage.name}}</header>
                                        <div class="button newrow no-animation"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="onHeritageChange(heritage, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                                "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned tags">
                                            <cite class="trait"
                                                *ngFor="let trait of heritage.traits; trackBy:trackByIndex;"
                                                [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="heritage.sourceBook">
                                            <strong>Source</strong><i>&nbsp;{{heritage.sourceBook}}</i>
                                        </div>
                                        <div class="newrow left-aligned">
                                            <ng-container
                                                *ngFor="let desc of heritage.desc.split('\n\n'); trackBy:trackByIndex;">
                                                <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                        {{line}}
                                                    </li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                        <ng-container
                                            *ngFor="let activityName of heritage.gainActivities; trackBy:trackByIndex;">
                                            <div class="newrow left-aligned"
                                                *ngFor="let activity of get_Activities(activityName); trackBy:trackByIndex;">
                                                <header class="spellHeader left-aligned">{{activity.name}}
                                                    <app-actionIcons [actionString]="activity.actions">
                                                    </app-actionIcons>
                                                    {{(activity.activationType) ? activity.activationType : ""}}
                                                </header>
                                                <app-activity class="newrow" [activity]=activity [allowActivate]=false>
                                                </app-activity>
                                            </div>
                                        </ng-container>
                                        <!--Subheritages-->
                                        <div class="list-item"
                                            [ngClass]="{'selected':subheritage.name === get_Character().class.heritage.name}"
                                            *ngFor="let subheritage of heritage.subTypes; trackBy:trackByIndex;">
                                            <div class="gridicon-fullsizebox lower">
                                                <input id="{{subheritage.name}}" type="checkbox"
                                                    class="character-choice"
                                                    (change)="onHeritageChange(subheritage, $event.target.checked)"
                                                    [checked]="subheritage.name === get_Character().class.heritage.name"
                                                    [disabled]="get_Character().class.heritage.name && (subheritage.name != get_Character().class.heritage.name)">
                                                <label for="{{subheritage.name}}">
                                                    <strong>{{subheritage.subType}}</strong>
                                                </label>
                                            </div>
                                        </div>
                                        <!--End Subheritages-->
                                    </ng-template>
                                    <div class="newrow list-item" [ngClass]="{'selected':checked}">
                                        <div class="gridicon-fullsizebox">
                                            <input *ngIf="!heritage.subTypes.length" id="{{heritage.name}}"
                                                type="checkbox" class="character-choice"
                                                (change)="onHeritageChange(heritage, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled">
                                            <button class="character-choice" *ngIf="heritage.subTypes.length"
                                                (click)="HeritageChoiceDetailsPopover.toggle()">+</button>
                                            <div class="gridicon-fullsizebox">
                                                <app-gridIcon class="" [title]="heritage.name"
                                                    [detail]="heritage.traits.includes('Rare') ? 'Rare' : (heritage.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                                </app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span #HeritageChoiceDetailsPopover="ngbPopover"
                                                        [ngbPopover]="HeritageChoiceDetailsTemplate"
                                                        triggers="click">{{heritage.name}}&nbsp;</span>
                                                    <cite class="trait" *ngIf="heritage.traits.includes('Rare')"
                                                        [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                        openDelay=100>Rare</cite>
                                                    <cite class="trait" *ngIf="heritage.traits.includes('Uncommon')"
                                                        [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                        openDelay=100>Uncommon</cite>
                                                </header>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
                <!--Languages content-->
                <ng-container *ngIf="get_ShowList()=='languages'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">Languages</header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <div class="newrow list-item left-aligned">
                            <strong *ngIf="get_Character().class.ancestry.recommendedLanguages.length">
                                Recommended Languages
                            </strong>
                            {{get_Character().class.ancestry.recommendedLanguages.join(', ')}}
                        </div>
                        <div class="list-item"
                            *ngFor="let language of get_Character().class.languages; trackBy:trackByIndex;">
                            <ng-template #LanguageSource>
                                <strong>Source</strong>
                                {{language.source}}
                            </ng-template>
                            <div class="newrow" [ngbPopover]="language.source ? LanguageSource : null">
                                <input class="newrow" type="text" [(ngModel)]="language.name"
                                    (blur)="on_LanguageChange()" [disabled]="language.locked">
                            </div>
                        </div>
                    </div>
                </ng-container>
                <!--Background choice content-->
                <ng-container *ngIf="get_ShowList()=='background'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Background{{(get_Character().class.background.name) ? ": "+
                            get_Character().class.background.name : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <!-- Filter -->
                        <div class="list-item lower">
                            <strong>Filter</strong>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="adventureBackgroundsFilter" type="checkbox"
                                    [(ngModel)]="adventureBackgrounds">
                                <label for="adventureBackgroundsFilter"><strong>Show adventure
                                        backgrounds</strong></label>
                            </div>
                            <div class="list-item gridicon-fullsizebox">
                                <input class="character-choice" id="regionalBackgroundsFilter" type="checkbox"
                                    [(ngModel)]="regionalBackgrounds">
                                <label for="regionalBackgroundsFilter"><strong>Show regional
                                        backgrounds</strong></label>
                            </div>
                        </div>
                        <!-- End Filter -->
                        <ng-container *ngFor="let background of get_AvailableBackgrounds(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [background.name === get_Character().class.background.name || background.name === get_Character().class.background.superType]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [get_Character().class.background.name && (background.name != get_Character().class.background.name)]; trackBy:trackByIndex">
                                    <ng-template #BackgroundChoiceDetailsTemplate>
                                        <header class="spellHeader">{{background.name}}</header>
                                        <div class="button newrow no-animation"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}"
                                            *ngIf="!background.subTypes">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="onBackgroundChange(background, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                                "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned tags">
                                            <cite class="trait"
                                                *ngFor="let trait of background.traits; trackBy:trackByIndex;"
                                                [ngbPopover]="get_Traits(trait)[0]?.desc" openDelay=100>{{trait}}</cite>
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="background.sourceBook">
                                            <strong>Source</strong><i>&nbsp;{{background.sourceBook}}</i>
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="background.prerequisites">
                                            <strong>Prerequisites</strong>&nbsp;{{background.prerequisites}}
                                        </div>
                                        <div class="newrow left-aligned" *ngIf="background.region">
                                            <strong>Region</strong>&nbsp;{{background.region}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <ng-container
                                                *ngFor="let desc of background.desc.split('\n\n'); trackBy:trackByIndex;">
                                                <p *ngIf="desc.split('\n').length == 1">{{desc}}</p>
                                                <ul *ngIf="desc.split('\n').length > 1">
                                                    <li *ngFor="let line of desc.split('\n'); trackBy:trackByIndex;">
                                                        {{line}}
                                                    </li>
                                                </ul>
                                            </ng-container>
                                        </div>
                                        <div class="list-item lower newrow problem" *ngIf="background.inputRequired">
                                            <strong>Player input required:</strong>
                                            <div class="newrow left-aligned">
                                                <p
                                                    *ngFor="let inputRequired of background.inputRequired.split('\n'); trackBy:trackByIndex;">
                                                    {{inputRequired}}
                                                </p>
                                            </div>
                                        </div>
                                        <!--Subbackgrounds-->
                                        <div class="list-item"
                                            [ngClass]="{'selected':subbackground.name === get_Character().class.background.name}"
                                            *ngFor="let subbackground of get_SubBackgrounds(background.name); trackBy:trackByIndex;">
                                            <div class="gridicon-fullsizebox lower">
                                                <input id="{{subbackground.name}}" type="checkbox"
                                                    class="character-choice"
                                                    (change)="onBackgroundChange(subbackground, $event.target.checked)"
                                                    [checked]="subbackground.name === get_Character().class.background.name"
                                                    [disabled]="get_Character().class.background.name && (subbackground.name != get_Character().class.background.name)">
                                                <label for="{{subbackground.name}}">
                                                    <strong>{{subbackground.subType}}</strong>
                                                </label>
                                            </div>
                                        </div>
                                        <!--End Subbackgrounds-->
                                    </ng-template>
                                    <div class="newrow list-item" [ngClass]="{'selected':checked}">
                                        <div class="gridicon-fullsizebox">
                                            <input *ngIf="!background.subTypes" id="{{background.name}}" type="checkbox"
                                                class="character-choice"
                                                (change)="onBackgroundChange(background, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled">
                                            <button class="character-choice" *ngIf="background.subTypes"
                                                (click)="BackgroundChoiceDetailsPopover.toggle()">+</button>
                                            <div class="gridicon-fullsizebox">
                                                <app-gridIcon class="" [title]="background.name"
                                                    [detail]="background.traits.includes('Rare') ? 'Rare' : (background.traits.includes('Uncommon') ? 'Uncommon' : '')">
                                                </app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span #BackgroundChoiceDetailsPopover="ngbPopover"
                                                        [ngbPopover]="BackgroundChoiceDetailsTemplate"
                                                        triggers="click">{{background.name}}&nbsp;</span>
                                                    <cite class="trait" *ngIf="background.traits.includes('Rare')"
                                                        [ngbPopover]="get_Traits('Rare')[0]?.desc"
                                                        openDelay=100>Rare</cite>
                                                    <cite class="trait" *ngIf="background.traits.includes('Uncommon')"
                                                        [ngbPopover]="get_Traits('Uncommon')[0]?.desc"
                                                        openDelay=100>Uncommon</cite>
                                                </header>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngIf="get_ShowList()=='deity'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Deity{{get_Character().class.deity ? ": "+get_Character().class.deity : ""}}
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <ng-container *ngFor="let deity of get_AvailableDeities(); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [deity.name === get_Character().class.deity]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [get_Character().class.deity && (deity.name != get_Character().class.deity)]; trackBy:trackByIndex">
                                    <ng-template #DeityChoiceDetailsTemplate>
                                        <header class="spellHeader">{{deity.name}}</header>
                                        <div class="button newrow no-animation"
                                            [ngClass]="{'fancy-button':checked, 'disabled':disabled}">
                                            <label>
                                                <input type="checkbox"
                                                    (change)="on_DeityChange(deity, $event.target.checked)"
                                                    [checked]="checked" [disabled]="disabled" hidden>{{checked ?
                                                "Remove" : "Choose"}}
                                            </label>
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Follower
                                                Alignments&nbsp;</strong>{{deity.followerAlignments.join(", ")}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Divine Ability&nbsp;</strong>{{deity.divineAbility.join(" or ")}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Divine Font&nbsp;</strong>{{deity.divineFont.join(" or ")}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Divine Skill&nbsp;</strong>{{deity.divineSkill.join(" or ")}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Favored Weapon&nbsp;</strong>{{deity.favoredWeapon.join(" or ")}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Domains&nbsp;</strong>{{deity.domains.join(", ")}}
                                        </div>
                                        <div class="newrow left-aligned">
                                            <strong>Cleric Spells</strong>
                                        </div>
                                        <div class="list-item lower left-aligned"
                                            *ngFor="let spell of deity.clericSpells; trackBy:trackByIndex;">
                                            <strong>Level {{spell.level}}&nbsp;</strong>
                                            {{spell.name}}{{(spell.note ? "("+spell.note+")" : "")}}
                                        </div>
                                    </ng-template>
                                    <div class="newrow list-item" [ngClass]="{'selected':checked}">
                                        <div class="gridicon-fullsizebox">
                                            <input id="{{deity.name}}" type="checkbox" class="character-choice"
                                                (change)="on_DeityChange(deity, $event.target.checked)"
                                                [checked]="checked" [disabled]="disabled">
                                            <div class="gridicon-fullsizebox">
                                                <app-gridIcon class="" [title]="deity.name" [detail]="deity.alignment">
                                                </app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span #BackgroundChoiceDetailsPopover="ngbPopover"
                                                        [ngbPopover]="DeityChoiceDetailsTemplate"
                                                        triggers="click">{{deity.name}}</span>
                                                </header>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
                <!--Fixed content template (list mode only)-->
                <ng-container *ngIf="get_ShowList()=='fixedchanges'">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            Level {{this.get_ShowContentLevelNumber()}} fixed changes
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <!--Fixed Ability boosts-->
                        <header class="sectionHeader center-aligned"
                            *ngIf="this.get_ShowContent()?.abilityBoosts?.length">
                            Ability Boosts
                        </header>
                        <ng-container *ngFor="let boost of this.get_ShowContent().abilityBoosts; trackBy:trackByIndex;">
                            <div class="list-item abilityboost">
                                <span>
                                    {{(boost.type == 'Flaw') ? 'Flaw: ' : 'Boost:
                                    '}}{{boost.name}} ({{boost.source}})
                                </span>
                            </div>
                        </ng-container>
                        <!--Fixed Skill Increases-->
                        <header class="sectionHeader center-aligned"
                            *ngIf="this.get_ShowContent()?.skillIncreases?.length">
                            Skill Increases
                        </header>
                        <ng-container
                            *ngFor="let skillIncrease of this.get_ShowContent().skillIncreases; trackBy:trackByIndex;">
                            <div class="list-item skillincrease">
                                <span>
                                    {{skillIncrease.name}}
                                    ({{skillIncrease.source}})
                                </span>
                            </div>
                        </ng-container>
                        <!--Fixed Feats-->
                        <header class="sectionHeader center-aligned" *ngIf="this.get_ShowContent()?.feats?.length">
                            Feats
                        </header>
                        <ng-container *ngFor="let feat of this.get_ShowContent().feats; trackBy:trackByIndex;">
                            <ng-template #FixedFeatDetail>
                                <header class="spellHeader">{{feat.name}}</header>
                                <app-feat [feat]="get_FeatsAndFeatures(feat.name)[0]" [choice]="null"
                                    [levelNumber]="this.get_ShowContentLevelNumber()">
                                </app-feat>
                            </ng-template>
                            <div class="list-item featchoice">
                                <span>
                                    {{feat.name}} ({{feat.source}})
                                </span>
                                <button class="lower inactive-button" [ngbPopover]="FixedFeatDetail"
                                    triggers="click">Details</button>
                            </div>
                        </ng-container>
                        <!--Fixed Features-->
                        <header class="sectionHeader center-aligned" *ngIf="this.get_ShowContent()?.features?.length">
                            Features
                        </header>
                        <ng-container *ngFor="let feature of this.get_ShowContent().features; trackBy:trackByIndex;">
                            <ng-template #FixedFeatureDetail>
                                <header class="spellHeader">{{feature.name}}</header>
                                <app-feat [feat]="get_FeatsAndFeatures(feature.name)[0]" [choice]="null"
                                    [levelNumber]="this.get_ShowContentLevelNumber()">
                                </app-feat>
                            </ng-template>
                            <div class="list-item specialchoice">
                                <span>
                                    {{feature.name}} ({{feature.source}})
                                </span>
                                <button class="lower inactive-button" [ngbPopover]="FixedFeatureDetail"
                                    triggers="click">Details</button>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngFor="let abilityContent of get_ActiveAbilityChoice(); trackBy:trackByID">
                    <div class="newrow list-item padding-8 center-aligned">
                        <header class="box-header sectionHeader">
                            {{get_AbilityChoiceTitle(abilityContent.choice)}}
                        </header>
                    </div>
                    <div id="choiceArea" class="charactersheet-app">
                        <ng-container
                            *ngFor="let ability of get_AvailableAbilities(abilityContent.choice, abilityContent.levelNumber); trackBy:trackByIndex;">
                            <ng-container
                                *ngFor="let checked of [get_AbilityTakenByThis(ability, abilityContent.choice, abilityContent.levelNumber)]; trackBy:trackByIndex">
                                <ng-container
                                    *ngFor="let disabled of [this.cannotBoost(ability, abilityContent.levelNumber, abilityContent.choice).length || (abilityContent.choice.boosts.length == get_MaxAvailable(abilityContent.choice) && !checked)]; trackBy:trackByIndex">
                                    <div class="newrow list-item"
                                        [ngClass]="{'selected':checked, 'problem':abilityIllegal(abilityContent.levelNumber, ability)}">
                                        <div class="gridicon-fullsizebox">
                                            <input id="{{ability.name}}" type="checkbox" class="character-choice"
                                                (change)="on_AbilityBoost(ability.name, $event.target.checked, abilityContent.choice, false)"
                                                [checked]="checked" [disabled]="disabled">
                                            <div class="gridicon-fullsizebox"
                                                *ngFor="let baseValue of [ability.baseValue(get_Character(), characterService, abilityContent.levelNumber)]; trackBy:trackByIndex;">
                                                <app-gridIcon [title]="ability.name" [ngbPopover]="baseValue.explain"
                                                    triggers="hover:click" openDelay=1
                                                    [superTitle]="baseValue.result.toString()">
                                                </app-gridIcon>
                                                <header class="sectionHeader">
                                                    <span>{{ability.name}}&nbsp;</span>
                                                    <cite class="problem"
                                                        *ngFor="let reason of cannotBoost(ability, abilityContent.levelNumber, abilityContent.choice); trackBy:trackByIndex;">
                                                        {{reason}}
                                                    </cite>
                                                    <cite class="problem"
                                                        *ngIf="abilityIllegal(abilityContent.levelNumber, ability)"
                                                        [ngbPopover]="'Abilities cannot be raised above 18 on level 1.'">
                                                        Limit reached&nbsp;
                                                    </cite>
                                                </header>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngFor="let featContent of get_ActiveFeatChoice(); trackBy:trackByID;">
                    <app-featchoice (showFeatChoiceMessage)="receive_FeatChoiceMessage($event)"
                        (showFeatMessage)="receive_FeatMessage($event)" [choice]="featContent.choice"
                        [levelNumber]="featContent.levelNumber" [showTitle]="false" [showFeat]="get_ShowItem()"
                        [showChoice]="featContent.name" [unavailableFeats]="get_Character().settings.unavailableFeats"
                        [lowerLevelFeats]="get_Character().settings.lowerLevelFeats"
                        [higherLevelFeats]="get_Character().settings.higherLevelFeats"
                        [archetypeFeats]="get_Character().settings.archetypeFeats">
                    </app-featchoice>
                </ng-container>
            </div>
        </div>
    </div>
</div>